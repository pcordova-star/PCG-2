(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9059],{14559:function(e,a,t){Promise.resolve().then(t.bind(t,94499))},75577:function(e,a,t){"use strict";t.d(a,{Z:function(){return g}});var s=t(57437),i=t(2265),r=t(71245),n=t(5978),l=t(99764),d=t(12381),o=t(79820),c=t(40279),u=t(75060),m=t(15291),h=t(44986),x=t(53459),f=t(23340),p=t(23675),j=t(99376),v=t(13838);function g(e){let{obras:a,actividades:t,onRegistroGuardado:g}=e,{user:N}=(0,r.a)(),{toast:b}=(0,f.pm)(),y=(0,j.useRouter)(),[w,C]=(0,i.useState)(a.length>0?a[0].id:""),[S,E]=(0,i.useState)(new Date().toISOString().slice(0,10)),[I,A]=(0,i.useState)(""),[k,F]=(0,i.useState)(""),[R,D]=(0,i.useState)([]),[O,P]=(0,i.useState)(!1),[z,Z]=(0,i.useState)(null),T=(0,i.useMemo)(()=>t.filter(e=>e.obraId===w),[t,w]),V=()=>{A(""),F(""),D([]),Z(null)},_=e=>{D(a=>a.filter((a,t)=>t!==e))},M=async e=>{if(e.preventDefault(),!w||!N){Z("Debes seleccionar obra y estar autenticado.");return}if(0===R.length&&!k.trim()){Z("Debes agregar al menos una foto o un comentario.");return}P(!0),Z(null);try{let e=[];if(R.length>0)for(let a of R){let t="".concat(Date.now(),"-").concat(a.name),s="avances/".concat(w,"/").concat(t),i=await (0,v.v)(a,s);e.push(i)}let a=(0,n.hJ)(l.N$,"obras",w,"avancesDiarios"),t={tipoRegistro:"FOTOGRAFICO",obraId:w,actividadId:"SIN_ACTIVIDAD"===I?null:I,comentario:k||"",fotos:e,visibleCliente:!0,creadoPor:{uid:N.uid,displayName:N.displayName||N.email||"An\xf3nimo"},fecha:new Date(S+"T12:00:00Z"),createdAt:(0,n.Bt)()};await (0,n.ET)(a,t),b({title:"Registro guardado",description:"El registro fotogr\xe1fico se ha guardado con \xe9xito."}),null==g||g(),resetForm()}catch(e){console.error("Error guardando registro fotogr\xe1fico:",e),Z("No se pudo guardar el registro fotogr\xe1fico. "+e.message),b({variant:"destructive",title:"Error",description:"Ocurri\xf3 un problema al guardar el registro. Revisa la consola."})}finally{P(!1)}};return(0,s.jsxs)(o.Zb,{children:[(0,s.jsxs)(o.Ol,{children:[(0,s.jsx)(o.ll,{children:"Detalles del Registro"}),(0,s.jsx)(o.SZ,{children:"Asocia tu registro a una obra y actividad, y agrega comentarios y fotos."})]}),(0,s.jsx)(o.aY,{children:(0,s.jsxs)("form",{onSubmit:M,className:"space-y-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)(u._,{htmlFor:"obra-selector",className:"font-semibold",children:"Obra*"}),(0,s.jsxs)(m.Ph,{value:w,onValueChange:e=>{C(e),V()},required:!0,children:[(0,s.jsx)(m.i4,{id:"obra-selector",children:(0,s.jsx)(m.ki,{placeholder:"Seleccionar obra"})}),(0,s.jsx)(m.Bw,{children:a.map(e=>(0,s.jsx)(m.Ql,{value:e.id,children:e.nombreFaena},e.id))})]})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)(u._,{htmlFor:"avance-fecha",className:"font-semibold",children:"Fecha del Registro*"}),(0,s.jsx)(c.I,{id:"avance-fecha",type:"date",value:S,onChange:e=>E(e.target.value),required:!0})]})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsxs)(u._,{htmlFor:"actividad-foto-selector",className:"font-semibold",children:["Actividad Asociada"," ",(0,s.jsx)("span",{className:"animate-pulse font-bold text-accent",children:"(Opcional)"})]}),(0,s.jsxs)(m.Ph,{value:I,onValueChange:A,children:[(0,s.jsx)(m.i4,{id:"actividad-foto-selector",children:(0,s.jsx)(m.ki,{placeholder:"Seleccionar actividad"})}),(0,s.jsxs)(m.Bw,{children:[(0,s.jsx)(m.Ql,{value:"SIN_ACTIVIDAD",children:"Sin actividad espec\xedfica"}),T.map(e=>(0,s.jsx)(m.Ql,{value:e.id,children:e.nombreActividad},e.id))]})]})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)(u._,{htmlFor:"comentario-foto",className:"font-semibold",children:"Comentario"}),(0,s.jsx)(p.g,{id:"comentario-foto",value:k,onChange:e=>F(e.target.value),placeholder:"Descripci\xf3n de la foto o del suceso..."})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)(u._,{htmlFor:"fotos-solo",className:"font-semibold",children:"Fotos"}),(0,s.jsx)(c.I,{id:"fotos-solo",type:"file",accept:"image/*",capture:"environment",multiple:!0,onChange:e=>{if(!e.target.files)return;let a=Array.from(e.target.files),t=[],s=!1;for(let e of a)e.type.includes("heic")||e.type.includes("heif")||/\.heic$/i.test(e.name)||/\.heif$/i.test(e.name)?s=!0:t.push(e);if(s&&(b({variant:"destructive",title:"Formato de imagen no compatible",description:"Las fotos en formato HEIC (de iPhone) no son soportadas. Por favor, cambia la configuraci\xf3n de tu c\xe1mara a 'M\xe1s compatible' (JPG) en Ajustes > C\xe1mara > Formatos.",duration:8e3}),e.target.value=""),t.length>0){if(R.length+t.length>5){Z("No m\xe1s de ".concat(5," fotos por registro.")),b({variant:"destructive",title:"L\xedmite de fotos excedido"});return}D(e=>[...e,...t])}}}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2 mt-2",children:R.map((e,a)=>(0,s.jsxs)("div",{className:"relative text-sm bg-muted p-2 rounded-md",children:[(0,s.jsxs)("span",{children:[e.name.substring(0,20),"..."]}),(0,s.jsx)("button",{type:"button",onClick:()=>_(a),className:"absolute -top-1.5 -right-1.5 bg-destructive text-destructive-foreground rounded-full h-5 w-5 flex items-center justify-center text-white",children:(0,s.jsx)(h.Z,{size:12})})]},a))})]}),z&&(0,s.jsx)("p",{className:"text-sm font-medium text-destructive",children:z}),(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsxs)(d.z,{type:"submit",disabled:O||!w,className:"w-full sm:w-auto",children:[O&&(0,s.jsx)(x.Z,{className:"mr-2 h-4 w-4 animate-spin"}),O?"Guardando...":"Guardar Registro Fotogr\xe1fico"]}),(0,s.jsx)(d.z,{type:"button",variant:"ghost",onClick:()=>y.back(),children:"Cancelar"})]})]})})]})}},94499:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return el}});var s=t(57437),i=t(2265),r=t(99376),n=t(71245),l=t(5978),d=t(99764),o=t(60062),c=t(12381),u=t(79820),m=t(74291),h=t(40279),x=t(75060),f=t(15291),p=t(33804),j=t(30767),v=t(93448),g=t(69174),N=t(5485),b=t(54585),y=t(24180),w=t(54233),C=t(66314),S=t(15847),E=t(43728),I=t(55051),A=t(45736),k=t(53459),F=t(94589),R=t(97974),D=t(75577),O=t(73367),P=t(47625),z=t(21156),Z=t(56940),T=t(97059),V=t(62994),_=t(8147),M=t(22190),L=t(54061),$=t(62804),U=t(48023),q=t(54886),J=t(31303),Y=t(27107),G=t(93292),B=t(11078),W=t(17168),K=t(23340),H=t(13134),Q=t(3289);let X=H.fC,ee=i.forwardRef((e,a)=>{let{className:t,...i}=e;return(0,s.jsx)(H.ck,{ref:a,className:(0,v.cn)("border-b",t),...i})});ee.displayName="AccordionItem";let ea=i.forwardRef((e,a)=>{let{className:t,children:i,...r}=e;return(0,s.jsx)(H.h4,{className:"flex",children:(0,s.jsxs)(H.xz,{ref:a,className:(0,v.cn)("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",t),...r,children:[i,(0,s.jsx)(Q.Z,{className:"h-4 w-4 shrink-0 transition-transform duration-200"})]})})});ea.displayName=H.xz.displayName;let et=i.forwardRef((e,a)=>{let{className:t,children:i,...r}=e;return(0,s.jsx)(H.VY,{ref:a,className:"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...r,children:(0,s.jsx)("div",{className:(0,v.cn)("pb-4 pt-0",t),children:i})})});et.displayName=H.VY.displayName;var es=t(23675);function ei(e){let{actividades:a,avances:t,montoTotalContrato:r}=e,n=(0,i.useMemo)(()=>{if(!a.length)return[];let e=a.map(e=>new Date(e.fechaInicio+"T00:00:00")).filter(e=>!isNaN(e.getTime())),s=a.map(e=>new Date(e.fechaFin+"T00:00:00")).filter(e=>!isNaN(e.getTime()));if(0===e.length||0===s.length)return[];let i=new Date;i.setHours(0,0,0,0);let n=(0,$.V)(e),l=(0,U.F)(s),d=(0,U.F)([l,i]);if(n>d)return[];let o=(0,q.D)({start:n,end:d}),c=[],u={};a.forEach(e=>{let a=(e.cantidad||0)*(e.precioContrato||0);if(0===a||!e.fechaInicio||!e.fechaFin)return;let t=new Date(e.fechaInicio+"T00:00:00"),s=new Date(e.fechaFin+"T00:00:00");if(t>s)return;let i=a/((0,J.j)(s,t)+1);(0,q.D)({start:t,end:s}).forEach(e=>{let a=(0,Y.WU)(e,"yyyy-MM-dd");u[a]||(u[a]=0),u[a]+=i})});let m=t.filter(e=>"FOTOGRAFICO"!==e.tipoRegistro&&"number"==typeof e.cantidadEjecutada),h={};m.forEach(e=>{if(!e.cantidadEjecutada||!e.actividadId||!e.fecha)return;let t=a.find(a=>a.id===e.actividadId);if(!t)return;let s=e.cantidadEjecutada*(t.precioContrato||0),i=(0,Y.WU)(e.fecha.toDate(),"yyyy-MM-dd");h[i]||(h[i]=0),h[i]+=s});let x=0,f=0;for(let e of o){let a=(0,Y.WU)(e,"yyyy-MM-dd");x+=u[a]||0,f+=h[a]||0;let t=r>0?Math.min(100,x/r*100):0,s=r>0?e>i?null:Math.min(100,f/r*100):0;c.push({fecha:(0,Y.WU)(e,"dd-MM-yy"),programado:t,real:s})}return c},[a,t,r]);return n.length?(0,s.jsxs)(u.Zb,{children:[(0,s.jsxs)(u.Ol,{children:[(0,s.jsx)(u.ll,{children:"Curva S de Avance (Programado vs. Real)"}),(0,s.jsx)(u.SZ,{children:"Comparativa del avance en base al costo acumulado del contrato."})]}),(0,s.jsx)(u.aY,{children:(0,s.jsx)(P.h,{width:"100%",height:400,children:(0,s.jsxs)(z.w,{data:n,margin:{top:5,right:20,left:-10,bottom:5},children:[(0,s.jsx)(Z.q,{strokeDasharray:"3 3"}),(0,s.jsx)(T.K,{dataKey:"fecha",tick:{fontSize:12}}),(0,s.jsx)(V.B,{tickFormatter:e=>"".concat(e,"%"),domain:[0,100],tick:{fontSize:12}}),(0,s.jsx)(_.u,{formatter:e=>["".concat(e.toFixed(1),"%"),""]}),(0,s.jsx)(M.D,{}),(0,s.jsx)(L.x,{type:"monotone",dataKey:"programado",name:"Programado",stroke:"#8884d8",strokeWidth:2,dot:!1}),(0,s.jsx)(L.x,{type:"monotone",dataKey:"real",name:"Real",stroke:"#82ca9d",strokeWidth:2,dot:!1,connectNulls:!1})]})})})]}):(0,s.jsx)("div",{className:"text-center text-muted-foreground py-8",children:"No hay suficientes datos para generar la Curva S. Aseg\xfarese de que las actividades tengan fechas y costos definidos."})}function er(){var e,a,t,v;let{user:P,role:z,companyId:Z,loading:T}=(0,n.a)(),V=(0,r.useRouter)(),_=(0,r.useSearchParams)(),{toast:M}=(0,K.pm)(),[L,$]=(0,i.useState)([]),[U,q]=(0,i.useState)(""),[J,H]=(0,i.useState)([]),{avances:Q,loading:er,refetchAvances:el,avancesPorActividad:ed}=(0,O.n)(U,J),[eo,ec]=(0,i.useState)(!0),[eu,em]=(0,i.useState)(null),[eh,ex]=(0,i.useState)(!1),[ef,ep]=(0,i.useState)(null),[ej,ev]=(0,i.useState)(null),[eg,eN]=(0,i.useState)([]),[eb,ey]=(0,i.useState)(!1),[ew,eC]=(0,i.useState)(""),[eS,eE]=(0,i.useState)(!1),[eI,eA]=(0,i.useState)(!1),[ek,eF]=(0,i.useState)(null),[eR,eD]=(0,i.useState)(0),[eO,eP]=(0,i.useState)(""),[ez,eZ]=(0,i.useState)(!0),[eT,eV]=(0,i.useState)(!1),e_=(0,i.useMemo)(()=>J.reduce((e,a)=>e+(a.cantidad||0)*(a.precioContrato||0),0),[J]),eM=(0,i.useMemo)(()=>0===e_?J.map(e=>({...e,peso:0})):J.map(e=>{let a=(e.cantidad||0)*(e.precioContrato||0)/e_*100;return{...e,peso:a}}),[J,e_]),eL=(0,i.useMemo)(()=>{if(!ef)return null;let e=(ef.cantidad||0)*(ef.precioContrato||0),a=e_>0?e/e_*100:0;return{...ef,peso:a}},[ef,e_]),e$=e=>{var a,t;if((null!==(t=null===(a=ed[e.id])||void 0===a?void 0:a.porcentajeAcumulado)&&void 0!==t?t:0)>=100)return"Terminada";let s=new Date;return(s.setHours(0,0,0,0),new Date(e.fechaFin+"T00:00:00")<s)?"Atrasada":new Date(e.fechaInicio+"T00:00:00")<=s?"En curso":"Pendiente"},eU=(0,i.useMemo)(()=>{let e=J.length;if(0===e)return{total:0,pendientes:0,enCurso:0,completadas:0,atrasadas:0};let a=J.map(e=>e$(e)),t=a.filter(e=>"Pendiente"===e).length;return{total:e,total:e,pendientes:t,enCurso:a.filter(e=>"En curso"===e).length,completadas:a.filter(e=>"Terminada"===e).length,atrasadas:a.filter(e=>"Atrasada"===e).length}},[J,ed]),eq=(0,i.useMemo)(()=>{let e={};return Q.forEach(a=>{let t=a.fecha.toDate(),s=(0,Y.WU)(t,"yyyy-MM");e[s]||(e[s]=[]),e[s].push(a)}),Object.entries(e).sort((e,a)=>a[0].localeCompare(e[0]))},[Q]);(0,i.useEffect)(()=>{T||P||V.replace("/login/usuario")},[T,P,V]),(0,i.useEffect)(()=>{P&&!T&&e();async function e(){try{let e;em(null);let a=(0,l.hJ)(d.N$,"obras");if("superadmin"===z)e=(0,l.IO)(a);else if(Z)e=(0,l.IO)(a,(0,l.ar)("empresaId","==",Z));else{$([]);return}let t=(await (0,l.PL)(e)).docs.map(e=>({id:e.id,...e.data()}));$(t);let s=_.get("obraId");s&&t.some(e=>e.id===s)?q(s):t.length>0&&q(t[0].id)}catch(e){console.error(e),em("No se pudieron cargar las obras.")}}},[P,T,z,Z,_]),(0,i.useEffect)(()=>{if(!U||!P){H([]);return}ec(!0);let e=(0,l.hJ)(d.N$,"obras",U,"actividades"),a=(0,l.IO)(e,(0,l.Xo)("fechaInicio","asc")),t=(0,l.cf)(a,e=>{H(e.docs.map(e=>({...e.data(),id:e.id}))),ec(!1)},e=>{console.error("Error cargando actividades:",e),em("No se pudieron cargar las actividades de la obra."),ec(!1)});return()=>t()},[U,P]);let eJ=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;ep(e||{nombreActividad:"",unidad:"glb",cantidad:1,precioContrato:0,fechaInicio:"",fechaFin:"",avanceProgramado:0}),ex(!0),em(null)};async function eY(e){if(e.preventDefault(),!U){em("Seleccione una obra antes de agregar una actividad.");return}if(!ef){em("No hay datos de actividad para guardar.");return}let{nombreActividad:a,fechaInicio:t,fechaFin:s,precioContrato:i,unidad:r,cantidad:n}=ef,o=Number(i),c=Number(n);if(!a||!t||!i){em("Nombre, fecha inicio y precio son obligatorios.");return}if(isNaN(o)||o<0||isNaN(c)||c<=0){em("El precio y la cantidad deben ser n\xfameros v\xe1lidos y positivos.");return}try{let e={obraId:U,nombreActividad:a,fechaInicio:t,fechaFin:s,precioContrato:o,unidad:r||"glb",cantidad:c};if(ef.id){let a=(0,l.JU)(d.N$,"obras",U,"actividades",ef.id);await (0,l.r7)(a,e),H(a=>a.map(a=>a.id===ef.id?{...a,...e}:a))}else{let a=(0,l.hJ)(d.N$,"obras",U,"actividades"),t=await (0,l.ET)(a,e),s={...e,id:t.id};H(e=>[...e,s])}ex(!1),ep(null),em(null)}catch(e){console.error(e),em("No se pudo guardar la actividad.")}}let eG=async e=>{if(U)try{let a=(0,l.IO)((0,l.hJ)(d.N$,"obras",U,"avancesDiarios"),(0,l.ar)("actividadId","==",e)),t=await (0,l.PL)(a),s=(0,l.qs)(d.N$);t.forEach(e=>{s.delete(e.ref)});let i=(0,l.JU)(d.N$,"obras",U,"actividades",e);s.delete(i),await s.commit(),H(a=>a.filter(a=>a.id!==e)),el()}catch(e){console.error(e),em("No se pudo eliminar la actividad y sus avances.")}},eB=async e=>{if(e&&e.id)try{if(e.fotos&&e.fotos.length>0){let a=e.fotos.map(e=>{try{let a=(0,o.iH)(d.IG,e);return(0,o.oq)(a)}catch(a){return console.warn("URL inv\xe1lida para Storage ref, no se pudo borrar: ".concat(e),a),Promise.resolve()}});await Promise.allSettled(a)}let a=d.N$,t=(0,l.JU)(a,"obras",e.obraId),s=(0,l.JU)(t,"avancesDiarios",e.id),i=J.find(a=>a.id===e.actividadId);await (0,l.i3)(a,async a=>{let r=await a.get(t);if(!r.exists())throw Error("La obra no existe.");if(a.delete(s),i&&e.cantidadEjecutada&&e.cantidadEjecutada>0){let s=r.data(),n=J.length;if(n>0&&i.cantidad>0){let r=e.cantidadEjecutada/i.cantidad*(1/n)*100;if(!isNaN(r)){let e=Math.max(0,(s.avanceAcumulado||0)-r);a.update(t,{avanceAcumulado:e})}}}}),M({title:"Avance eliminado",description:"El registro de avance y sus fotos asociadas han sido eliminados."})}catch(e){console.error("Error eliminando avance:",e),M({variant:"destructive",title:"Error al eliminar",description:"No se pudo eliminar el registro de avance."})}},eW=e=>{eF(e),eD(e.cantidadEjecutada||0),eP(e.comentario||""),eZ(e.visibleCliente),eA(!0)},eK=async()=>{if(!ek||!U)return;if(eR<0||!Number.isFinite(eR)){M({variant:"destructive",title:"Cantidad inv\xe1lida"});return}eV(!0);let e=d.N$,a=(0,l.JU)(e,"obras",U),t=(0,l.JU)(a,"avancesDiarios",ek.id),s=J.find(e=>e.id===ek.actividadId);try{await (0,l.i3)(e,async e=>{let i=await e.get(t);if(!i.exists())throw Error("El registro de avance ya no existe.");let r=i.data().cantidadEjecutada||0,n=eR-r;if(e.update(t,{cantidadEjecutada:eR,comentario:eO,visibleCliente:ez,updatedAt:(0,l.Bt)()}),0!==n&&s){let t=await e.get(a);if(!t.exists())throw Error("La obra no existe.");let i=t.data(),r=J.length;if(r>0&&s.cantidad>0){let t=n/s.cantidad*(1/r)*100;if(!isNaN(t)){let s=Math.max(0,Math.min(100,(i.avanceAcumulado||0)+t));e.update(a,{avanceAcumulado:s})}}}}),M({title:"Avance actualizado"}),eA(!1)}catch(e){console.error("Error actualizando avance:",e),M({variant:"destructive",title:"Error",description:e.message})}finally{eV(!1)}},eH=e=>e.toLocaleString("es-CL",{style:"currency",currency:"CLP",maximumFractionDigits:0}),eQ=async()=>{if(U)try{let e=(0,l.IO)((0,l.hJ)(d.N$,"presupuestos"),(0,l.ar)("obraId","==",U)),a=(await (0,l.PL)(e)).docs.map(e=>({id:e.id,...e.data()}));eN(a),ey(!0)}catch(e){console.error("Error fetching budgets for import:",e),M({variant:"destructive",title:"Error",description:"No se pudieron cargar los presupuestos de esta obra."})}},eX=async()=>{if(ew&&U){eE(!0);try{let a=eg.find(e=>e.id===ew);if(!a||!a.items)throw Error("El presupuesto seleccionado no tiene \xedtems para importar.");let t=new Set(J.map(e=>e.nombreActividad.trim().toLowerCase())),s=(0,l.qs)(d.N$),i=[],r=["iva","total","total bruto","costo directo","costo total","gastos generales","utilidad","administraci\xf3n","imprevistos"];for(let n of a.items)if("item"===n.type){var e;let a=(null!==(e=n.descripcion)&&void 0!==e?e:"").trim().toLowerCase();if(r.includes(a))continue;let o=n.descripcion.trim().toLowerCase();if(!t.has(o)){let e=(0,l.JU)((0,l.hJ)(d.N$,"obras",U,"actividades")),a={obraId:U,nombreActividad:n.descripcion,unidad:n.unidad,cantidad:n.cantidad,precioContrato:n.precioContrato,fechaInicio:new Date().toISOString().slice(0,10),fechaFin:new Date().toISOString().slice(0,10)};s.set(e,a),i.push({id:e.id,...a})}}0===i.length?M({title:"Nada que importar",description:"Todas las partidas del presupuesto ya existen en la programaci\xf3n o son \xedtems no v\xe1lidos."}):(await s.commit(),H(e=>[...e,...i]),M({title:"Importaci\xf3n exitosa",description:"Se agregaron ".concat(i.length," nuevas actividades a la programaci\xf3n.")})),ey(!1),eC("")}catch(e){console.error("Error importing budget:",e),M({variant:"destructive",title:"Error de importaci\xf3n",description:e.message})}finally{eE(!1)}}},e0=async()=>{if(U)try{let e=(0,l.hJ)(d.N$,"obras",U,"actividades"),a=(0,l.hJ)(d.N$,"obras",U,"avancesDiarios"),[t,s]=await Promise.all([(0,l.PL)(e),(0,l.PL)(a)]);if(t.empty&&s.empty){M({title:"Nada que reiniciar",description:"La programaci\xf3n de esta obra ya est\xe1 vac\xeda."});return}let i=(0,l.qs)(d.N$);t.forEach(e=>i.delete(e.ref)),s.forEach(e=>i.delete(e.ref)),await i.commit(),H([]),el(),M({title:"Programaci\xf3n Reiniciada",description:"Se han eliminado todas las actividades y avances de la obra."})}catch(e){console.error("Error al reiniciar la programaci\xf3n:",e),M({variant:"destructive",title:"Error",description:"No se pudo reiniciar la programaci\xf3n."})}};return T?(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Cargando sesi\xf3n..."}):P?(0,s.jsxs)("div",{className:"space-y-8",children:[(0,s.jsxs)("header",{className:"flex items-start justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)(c.z,{variant:"outline",size:"icon",onClick:()=>V.push("/dashboard"),children:(0,s.jsx)(N.Z,{})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-4xl font-bold font-headline tracking-tight",children:"Programaci\xf3n de Obras"}),(0,s.jsx)("p",{className:"mt-2 text-lg text-muted-foreground",children:"Gestiona actividades por cantidad y precio, registre avances diarios y genere estados de pago."})]})]}),U&&(0,s.jsxs)(c.z,{variant:"secondary",onClick:()=>V.push("/operaciones/estados-de-pago?obraId=".concat(U)),children:[(0,s.jsx)(b.Z,{className:"mr-2 h-4 w-4"}),"Ver Estados de Pago"]})]}),eu&&(0,s.jsx)("p",{className:"text-sm font-medium text-destructive",children:eu}),(0,s.jsxs)(u.Zb,{children:[(0,s.jsx)(u.Ol,{className:"flex flex-row items-center justify-between",children:(0,s.jsxs)("div",{children:[(0,s.jsx)(u.ll,{children:"Selector de Obra"}),(0,s.jsx)(u.SZ,{children:"Filtre las actividades y avances por obra."})]})}),(0,s.jsx)(u.aY,{children:(0,s.jsxs)("div",{className:"max-w-xs space-y-2",children:[(0,s.jsx)(x._,{htmlFor:"obra-select",children:"Seleccione una obra"}),(0,s.jsxs)(f.Ph,{value:U,onValueChange:q,children:[(0,s.jsx)(f.i4,{id:"obra-select",children:(0,s.jsx)(f.ki,{placeholder:"Seleccione una obra"})}),(0,s.jsx)(f.Bw,{children:L.map(e=>(0,s.jsx)(f.Ql,{value:e.id,children:e.nombreFaena},e.id))})]})]})})]}),(0,s.jsxs)(u.Zb,{children:[(0,s.jsx)(u.Ol,{children:(0,s.jsx)(u.ll,{children:"Resumen de Actividades"})}),(0,s.jsx)(u.aY,{children:(0,s.jsxs)("div",{className:"text-sm text-muted-foreground flex flex-wrap gap-x-4 gap-y-2",children:[(0,s.jsxs)("span",{className:"font-medium text-foreground",children:["Total: ",eU.total]}),(0,s.jsx)("span",{className:"hidden sm:inline",children:"\xb7"}),(0,s.jsxs)("span",{children:["Pendientes: ",eU.pendientes]}),(0,s.jsx)("span",{className:"hidden sm:inline",children:"\xb7"}),(0,s.jsxs)("span",{children:["En curso: ",eU.enCurso]}),(0,s.jsx)("span",{className:"hidden sm:inline",children:"\xb7"}),(0,s.jsxs)("span",{children:["Atrasadas: ",eU.atrasadas]}),(0,s.jsx)("span",{className:"hidden sm:inline",children:"\xb7"}),(0,s.jsxs)("span",{children:["Completadas: ",eU.completadas]})]})})]}),(0,s.jsxs)(u.Zb,{children:[(0,s.jsxs)(u.Ol,{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(u.ll,{children:"Actividades Programadas"}),(0,s.jsx)(u.SZ,{children:eo?"Cargando...":"Mostrando ".concat(J.length," actividades.")})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsxs)(c.z,{onClick:eQ,variant:"outline",disabled:!U,children:[(0,s.jsx)(y.Z,{className:"mr-2 h-4 w-4"}),"Importar desde Presupuesto"]}),(0,s.jsxs)(c.z,{onClick:()=>eJ(),children:[(0,s.jsx)(w.Z,{className:"mr-2 h-4 w-4"}),"Nueva Actividad"]}),(0,s.jsxs)(j.aR,{children:[(0,s.jsx)(j.vW,{asChild:!0,children:(0,s.jsxs)(c.z,{variant:"destructive",disabled:!U||0===J.length,children:[(0,s.jsx)(C.Z,{className:"mr-2 h-4 w-4"}),"Reiniciar Programaci\xf3n"]})}),(0,s.jsxs)(j._T,{children:[(0,s.jsxs)(j.fY,{children:[(0,s.jsx)(j.f$,{children:"\xbfEst\xe1 seguro de reiniciar la programaci\xf3n?"}),(0,s.jsx)(j.yT,{children:"Esta acci\xf3n eliminar\xe1 TODAS las actividades y avances diarios de la obra seleccionada. Es irreversible. Los Estados de Pago generados previamente NO se eliminar\xe1n."})]}),(0,s.jsxs)(j.xo,{children:[(0,s.jsx)(j.le,{children:"Cancelar"}),(0,s.jsx)(j.OL,{onClick:e0,children:"S\xed, reiniciar programaci\xf3n"})]})]})]})]})]}),(0,s.jsx)(u.aY,{className:"p-0",children:(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)(p.iA,{children:[(0,s.jsx)(p.xD,{children:(0,s.jsxs)(p.SC,{children:[(0,s.jsx)(p.ss,{className:"w-[30%]",children:"Actividad"}),(0,s.jsx)(p.ss,{children:"Un."}),(0,s.jsx)(p.ss,{children:"Cant."}),(0,s.jsx)(p.ss,{children:"P. Unitario"}),(0,s.jsx)(p.ss,{children:"Total"}),(0,s.jsx)(p.ss,{children:"Peso (%)"}),(0,s.jsx)(p.ss,{children:"Av. Real (%)"}),(0,s.jsx)(p.ss,{className:"hidden md:table-cell",children:"Inicio"}),(0,s.jsx)(p.ss,{className:"hidden md:table-cell",children:"Fin"}),(0,s.jsx)(p.ss,{children:"Estado"}),(0,s.jsx)(p.ss,{className:"text-right",children:"Acciones"})]})}),(0,s.jsx)(p.RM,{children:eo?(0,s.jsx)(p.SC,{children:(0,s.jsx)(p.pj,{colSpan:11,className:"text-center",children:"Cargando..."})}):eM.length>0?eM.map(e=>{var a,t,i,r,n;let l=(null!==(a=e.cantidad)&&void 0!==a?a:0)*(null!==(t=e.precioContrato)&&void 0!==t?t:0),d=ed[e.id];return(0,s.jsxs)(p.SC,{children:[(0,s.jsx)(p.pj,{className:"font-medium",children:e.nombreActividad}),(0,s.jsx)(p.pj,{children:null!==(i=e.unidad)&&void 0!==i?i:"-"}),(0,s.jsx)(p.pj,{children:null!==(r=e.cantidad)&&void 0!==r?r:"-"}),(0,s.jsx)(p.pj,{children:eH(e.precioContrato)}),(0,s.jsx)(p.pj,{children:l>0?eH(l):"-"}),(0,s.jsxs)(p.pj,{className:"font-semibold",children:[e.peso.toFixed(2),"%"]}),(0,s.jsxs)(p.pj,{className:"font-semibold text-blue-600",children:[null!==(n=null==d?void 0:d.porcentajeAcumulado.toFixed(1))&&void 0!==n?n:"0.0","%"]}),(0,s.jsx)(p.pj,{className:"hidden md:table-cell",children:e.fechaInicio}),(0,s.jsx)(p.pj,{className:"hidden md:table-cell",children:e.fechaFin}),(0,s.jsx)(p.pj,{children:(0,s.jsx)(en,{estado:e$(e)})}),(0,s.jsx)(p.pj,{className:"text-right",children:(0,s.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,s.jsxs)(c.z,{variant:"ghost",size:"icon",onClick:()=>eJ(e),children:[(0,s.jsx)(S.Z,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Editar"})]}),(0,s.jsxs)(j.aR,{children:[(0,s.jsx)(j.vW,{asChild:!0,children:(0,s.jsxs)(c.z,{variant:"ghost",size:"icon",className:"text-destructive hover:text-destructive",children:[(0,s.jsx)(E.Z,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Eliminar"})]})}),(0,s.jsxs)(j._T,{children:[(0,s.jsxs)(j.fY,{children:[(0,s.jsx)(j.f$,{children:"\xbfEst\xe1 seguro de que desea eliminar esta actividad?"}),(0,s.jsxs)(j.yT,{children:['Esta acci\xf3n no se puede deshacer. Se eliminar\xe1 permanentemente la actividad "',e.nombreActividad,'" y todos sus avances asociados.']})]}),(0,s.jsxs)(j.xo,{children:[(0,s.jsx)(j.le,{children:"Cancelar"}),(0,s.jsx)(j.OL,{onClick:()=>eG(e.id),className:"bg-destructive hover:bg-destructive/90",children:"Eliminar"})]})]})]})]})})]},e.id)}):(0,s.jsx)(p.SC,{children:(0,s.jsx)(p.pj,{colSpan:11,className:"text-center text-muted-foreground py-8",children:"No hay actividades para esta obra."})})})]})})})]}),(0,s.jsx)(m.Vq,{open:eh,onOpenChange:ex,children:(0,s.jsx)(m.cZ,{className:"sm:max-w-2xl",children:(0,s.jsxs)("form",{onSubmit:eY,children:[(0,s.jsxs)(m.fK,{children:[(0,s.jsx)(m.$N,{children:(null==eL?void 0:eL.id)?"Editar Actividad":"Crear Nueva Actividad"}),(0,s.jsx)(m.Be,{children:(null==eL?void 0:eL.id)?"Modifica los detalles y haz clic en Guardar.":"Completa los detalles para registrar una nueva actividad."})]}),(0,s.jsxs)("div",{className:"grid gap-4 py-4 md:grid-cols-2 lg:grid-cols-3",children:[(0,s.jsxs)("div",{className:"space-y-2 col-span-full",children:[(0,s.jsx)(x._,{children:"Nombre Actividad*"}),(0,s.jsx)(h.I,{value:(null==eL?void 0:eL.nombreActividad)||"",onChange:e=>ep(a=>a?{...a,nombreActividad:e.target.value}:null)})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(x._,{children:"Unidad*"}),(0,s.jsx)(h.I,{value:(null==eL?void 0:eL.unidad)||"",onChange:e=>ep(a=>a?{...a,unidad:e.target.value}:null),placeholder:"m\xb2, m\xb3, glb, etc."})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(x._,{children:"Cantidad*"}),(0,s.jsx)(h.I,{type:"number",value:(null==eL?void 0:eL.cantidad)||"",onChange:e=>ep(a=>a?{...a,cantidad:Number(e.target.value)}:null)})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(x._,{children:"Precio Unitario*"}),(0,s.jsx)(h.I,{type:"number",value:(null==eL?void 0:eL.precioContrato)||"",onChange:e=>ep(a=>a?{...a,precioContrato:Number(e.target.value)}:null)})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(x._,{children:"Fecha Inicio*"}),(0,s.jsx)(h.I,{type:"date",value:(null==eL?void 0:eL.fechaInicio)||"",onChange:e=>ep(a=>a?{...a,fechaInicio:e.target.value}:null)})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(x._,{children:"Fecha Fin"}),(0,s.jsx)(h.I,{type:"date",value:(null==eL?void 0:eL.fechaFin)||"",onChange:e=>ep(a=>a?{...a,fechaFin:e.target.value}:null)})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(x._,{children:"Peso en Contrato (%)"}),(0,s.jsx)(h.I,{type:"text",value:(null==eL?void 0:null===(e=eL.peso)||void 0===e?void 0:e.toFixed(2))+"%",readOnly:!0,disabled:!0})]}),eu&&(0,s.jsx)("p",{className:"col-span-full text-sm font-medium text-destructive",children:eu})]}),(0,s.jsx)(m.cN,{children:(0,s.jsx)(c.z,{type:"submit",children:"Guardar Actividad"})})]})})}),(0,s.jsx)(m.Vq,{open:eb,onOpenChange:ey,children:(0,s.jsxs)(m.cZ,{children:[(0,s.jsxs)(m.fK,{children:[(0,s.jsx)(m.$N,{children:"Importar Actividades desde Presupuesto"}),(0,s.jsx)(m.Be,{children:"Selecciona un presupuesto de la obra actual. Se importar\xe1n todas las partidas que no existan ya en la programaci\xf3n."})]}),(0,s.jsxs)("div",{className:"py-4 space-y-4",children:[(0,s.jsx)(x._,{htmlFor:"presupuesto-select",children:"Presupuesto a importar"}),(0,s.jsxs)(f.Ph,{value:ew,onValueChange:eC,children:[(0,s.jsx)(f.i4,{id:"presupuesto-select",children:(0,s.jsx)(f.ki,{placeholder:"Seleccione un presupuesto"})}),(0,s.jsx)(f.Bw,{children:eg.map(e=>(0,s.jsxs)(f.Ql,{value:e.id,children:[e.nombre," - ",e.fechaCreacion.toDate().toLocaleDateString()]},e.id))})]})]}),(0,s.jsxs)(m.cN,{children:[(0,s.jsx)(c.z,{variant:"ghost",onClick:()=>ey(!1),children:"Cancelar"}),(0,s.jsx)(c.z,{onClick:eX,disabled:eS||!ew,children:eS?"Importando...":"Importar Partidas"})]})]})}),U&&(0,s.jsx)(ei,{actividades:J,avances:Q,montoTotalContrato:e_}),(0,s.jsxs)("section",{className:"space-y-4 mt-8",children:[(0,s.jsxs)("header",{className:"space-y-1",children:[(0,s.jsx)("h3",{className:"text-xl font-semibold",children:"Avance diario"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Registra el avance de la obra. Esta informaci\xf3n alimentar\xe1 el Estado de Pago."})]}),(0,s.jsxs)("div",{className:"grid gap-6",children:[U&&(0,s.jsxs)(W.mQ,{defaultValue:"cantidad",className:"w-full",children:[(0,s.jsxs)(W.dr,{children:[(0,s.jsx)(W.SP,{value:"cantidad",children:"Avance con Cantidad"}),(0,s.jsx)(W.SP,{value:"foto",children:"Solo Registro Fotogr\xe1fico"})]}),(0,s.jsx)(W.nU,{value:"cantidad",children:(0,s.jsx)(R.Z,{obraId:U,actividades:J,onAvanceRegistrado:el})}),(0,s.jsx)(W.nU,{value:"foto",children:(0,s.jsx)(D.Z,{obras:L,actividades:J,onRegistroGuardado:el})})]}),!er&&Q.length>0&&(0,s.jsxs)(u.Zb,{children:[(0,s.jsxs)(u.Ol,{children:[(0,s.jsx)(u.ll,{children:"Historial de Avances Diarios"}),(0,s.jsx)(u.SZ,{children:"\xdaltimos avances registrados para la obra seleccionada."})]}),(0,s.jsx)(u.aY,{children:(0,s.jsx)(X,{type:"single",collapsible:!0,className:"w-full",defaultValue:null===(a=eq[0])||void 0===a?void 0:a[0],children:eq.map(e=>{let[a,t]=e,r=new Date(a+"-02"),n=(0,Y.WU)(r,"MMMM 'de' yyyy",{locale:G.es});return(0,s.jsxs)(ee,{value:a,children:[(0,s.jsx)(ea,{className:"text-lg font-medium",children:n}),(0,s.jsx)(et,{className:"space-y-4 pl-4",children:t.map(e=>{let a=J.find(a=>a.id===e.actividadId);return(0,s.jsxs)("div",{className:"border-b pb-4 last:border-b-0",children:[(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("p",{className:"font-semibold",children:[e.fecha.toDate().toLocaleDateString("es-CL")," - ",(null==a?void 0:a.nombreActividad)||"Avance General"]}),(0,s.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Reportado por: ",e.creadoPor.displayName]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)(g.C,{variant:"outline",className:"FOTOGRAFICO"===e.tipoRegistro?"bg-blue-100 text-blue-800":"",children:["FOTOGRAFICO"===e.tipoRegistro?(0,s.jsx)(I.Z,{className:"h-3 w-3 mr-1"}):null,"FOTOGRAFICO"===e.tipoRegistro?"Solo Foto":"Avance: ".concat(e.cantidadEjecutada," ").concat((null==a?void 0:a.unidad)||"")]}),(0,s.jsx)(c.z,{variant:"ghost",size:"icon",className:"h-6 w-6 text-muted-foreground",onClick:()=>eW(e),children:(0,s.jsx)(S.Z,{className:"h-4 w-4"})}),(0,s.jsxs)(j.aR,{children:[(0,s.jsx)(j.vW,{asChild:!0,children:(0,s.jsx)(c.z,{variant:"ghost",size:"icon",className:"h-6 w-6 text-muted-foreground hover:text-destructive",children:(0,s.jsx)(E.Z,{className:"h-4 w-4"})})}),(0,s.jsxs)(j._T,{children:[(0,s.jsxs)(j.fY,{children:[(0,s.jsx)(j.f$,{children:"\xbfEliminar este registro de avance?"}),(0,s.jsxs)(j.yT,{children:["Esta acci\xf3n no se puede deshacer. Se eliminar\xe1 el registro del d\xeda ",e.fecha.toDate().toLocaleDateString("es-CL")," y las fotos asociadas. El c\xe1lculo de avance se reajustar\xe1."]})]}),(0,s.jsxs)(j.xo,{children:[(0,s.jsx)(j.le,{children:"Cancelar"}),(0,s.jsx)(j.OL,{onClick:()=>eB(e),className:"bg-destructive hover:bg-destructive/90",children:"Confirmar Eliminaci\xf3n"})]})]})]})]})]}),e.comentario&&(0,s.jsxs)("p",{className:"text-sm mt-1",children:['"',e.comentario,'"']}),e.fotos&&e.fotos.length>0&&(0,s.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-2 mt-2",children:e.fotos.map(e=>(0,s.jsxs)("div",{className:"w-full aspect-square relative group",children:[(0,s.jsx)(i.Suspense,{fallback:(0,s.jsx)("div",{className:"bg-muted animate-pulse w-full h-full rounded-md"}),children:(0,s.jsx)(B.Z,{storagePath:e})}),(0,s.jsx)("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center cursor-pointer",onClick:()=>ev(e),children:(0,s.jsx)("p",{className:"text-white text-xs text-center",children:"Ver foto"})}),(0,s.jsx)("a",{href:e,download:!0,target:"_blank",rel:"noopener noreferrer",onClick:e=>e.stopPropagation(),className:"absolute bottom-1 right-1 bg-white/80 text-black p-1 rounded-full hover:bg-white transition-colors",children:(0,s.jsx)(A.Z,{className:"h-3 w-3"})})]},e))})]},e.id)})})]},a)})})})]})]})]}),(0,s.jsx)(m.Vq,{open:!!ej,onOpenChange:e=>!e&&ev(null),children:(0,s.jsxs)(m.cZ,{className:"max-w-4xl h-[90vh]",children:[(0,s.jsxs)(m.fK,{children:[(0,s.jsx)(m.$N,{children:"Vista de la imagen"}),(0,s.jsx)(m.Be,{children:"Imagen registrada en el avance."})]}),(0,s.jsx)("div",{className:"flex-grow flex items-center justify-center overflow-hidden",children:ej&&(0,s.jsx)("img",{src:ej,alt:"Vista ampliada",className:"max-w-full max-h-full object-contain"})}),(0,s.jsx)(m.cN,{children:(0,s.jsx)(c.z,{variant:"outline",onClick:()=>ev(null),children:"Cerrar"})})]})}),(0,s.jsx)(m.Vq,{open:eI,onOpenChange:eA,children:(0,s.jsxs)(m.cZ,{children:[(0,s.jsxs)(m.fK,{children:[(0,s.jsx)(m.$N,{children:"Editar Registro de Avance"}),(0,s.jsx)(m.Be,{children:"Ajuste la cantidad, comentario o visibilidad del registro."})]}),(0,s.jsxs)("div",{className:"py-4 space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(x._,{children:"Actividad"}),(0,s.jsx)(h.I,{value:(null===(t=J.find(e=>e.id===(null==ek?void 0:ek.actividadId)))||void 0===t?void 0:t.nombreActividad)||"N/A",disabled:!0})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(x._,{htmlFor:"edit-cantidad",children:"Cantidad Ejecutada"}),(0,s.jsx)(h.I,{id:"edit-cantidad",type:"number",value:eR,onChange:e=>eD(Number(e.target.value))}),(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Unidad: ",null===(v=J.find(e=>e.id===(null==ek?void 0:ek.actividadId)))||void 0===v?void 0:v.unidad]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(x._,{htmlFor:"edit-comentario",children:"Comentario"}),(0,s.jsx)(es.g,{id:"edit-comentario",value:eO,onChange:e=>eP(e.target.value)})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(F.r,{id:"edit-visible",checked:ez,onCheckedChange:eZ}),(0,s.jsx)(x._,{htmlFor:"edit-visible",children:"Visible para el cliente"})]})]}),(0,s.jsxs)(m.cN,{children:[(0,s.jsx)(c.z,{variant:"ghost",onClick:()=>eA(!1),disabled:eT,children:"Cancelar"}),(0,s.jsxs)(c.z,{onClick:eK,disabled:eT,children:[eT&&(0,s.jsx)(k.Z,{className:"mr-2 h-4 w-4 animate-spin"}),eT?"Guardando...":"Guardar Cambios"]})]})]})})]}):(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Redirigiendo a login..."})}let en=e=>{let{estado:a}=e;return(0,s.jsx)(g.C,{variant:"outline",className:(0,v.cn)("font-semibold",{Terminada:"bg-green-100 text-green-800 border-green-200","En curso":"bg-blue-100 text-blue-800 border-blue-200",Pendiente:"bg-gray-100 text-gray-800 border-gray-200",Atrasada:"bg-red-100 text-red-800 border-red-200"}[a]),children:a})};function el(){return(0,s.jsx)(i.Suspense,{fallback:(0,s.jsx)("div",{children:"Cargando programaci\xf3n..."}),children:(0,s.jsx)(er,{})})}},11078:function(e,a,t){"use strict";t.d(a,{Z:function(){return d}});var s=t(57437),i=t(2265),r=t(60062),n=t(99764),l=t(69140);function d(e){let{storagePath:a}=e,[t,d]=(0,i.useState)(null),[o,c]=(0,i.useState)(null);return((0,i.useEffect)(()=>{async function e(){try{let e=(0,r.iH)(n.IG,a),t=await (0,r.Jt)(e);d(t)}catch(e){console.error("Error fetching image URL for path ".concat(a,":"),e),"storage/object-not-found"===e.code?c("La imagen no fue encontrada."):c("No se pudo cargar la imagen.")}}a&&e()},[a]),o)?(0,s.jsx)("div",{className:"aspect-square flex items-center justify-center bg-muted rounded-md text-destructive text-xs text-center p-2",children:o}):t?(0,s.jsx)("div",{className:"relative aspect-square w-full h-full overflow-hidden rounded-md",children:(0,s.jsx)("img",{src:t,alt:"Imagen de avance desde ".concat(a),className:"w-full h-full object-cover transition-transform hover:scale-105"})}):(0,s.jsx)(l.O,{className:"aspect-square w-full h-full rounded-md"})}},30767:function(e,a,t){"use strict";t.d(a,{OL:function(){return j},_T:function(){return m},aR:function(){return d},f$:function(){return f},fY:function(){return h},le:function(){return v},vW:function(){return o},xo:function(){return x},yT:function(){return p}});var s=t(57437),i=t(2265),r=t(7880),n=t(93448),l=t(12381);let d=r.fC,o=r.xz,c=r.h_,u=i.forwardRef((e,a)=>{let{className:t,...i}=e;return(0,s.jsx)(r.aV,{className:(0,n.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...i,ref:a})});u.displayName=r.aV.displayName;let m=i.forwardRef((e,a)=>{let{className:t,...i}=e;return(0,s.jsxs)(c,{children:[(0,s.jsx)(u,{}),(0,s.jsx)(r.VY,{ref:a,className:(0,n.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...i})]})});m.displayName=r.VY.displayName;let h=e=>{let{className:a,...t}=e;return(0,s.jsx)("div",{className:(0,n.cn)("flex flex-col space-y-2 text-center sm:text-left",a),...t})};h.displayName="AlertDialogHeader";let x=e=>{let{className:a,...t}=e;return(0,s.jsx)("div",{className:(0,n.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...t})};x.displayName="AlertDialogFooter";let f=i.forwardRef((e,a)=>{let{className:t,...i}=e;return(0,s.jsx)(r.Dx,{ref:a,className:(0,n.cn)("text-lg font-semibold",t),...i})});f.displayName=r.Dx.displayName;let p=i.forwardRef((e,a)=>{let{className:t,...i}=e;return(0,s.jsx)(r.dk,{ref:a,className:(0,n.cn)("text-sm text-muted-foreground",t),...i})});p.displayName=r.dk.displayName;let j=i.forwardRef((e,a)=>{let{className:t,...i}=e;return(0,s.jsx)(r.aU,{ref:a,className:(0,n.cn)((0,l.d)(),t),...i})});j.displayName=r.aU.displayName;let v=i.forwardRef((e,a)=>{let{className:t,...i}=e;return(0,s.jsx)(r.$j,{ref:a,className:(0,n.cn)((0,l.d)({variant:"outline"}),"mt-2 sm:mt-0",t),...i})});v.displayName=r.$j.displayName},69174:function(e,a,t){"use strict";t.d(a,{C:function(){return l}});var s=t(57437);t(2265);var i=t(90535),r=t(93448);let n=(0,i.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function l(e){let{className:a,variant:t,...i}=e;return(0,s.jsx)("div",{className:(0,r.cn)(n({variant:t}),a),...i})}},74291:function(e,a,t){"use strict";t.d(a,{$N:function(){return f},Be:function(){return p},Vq:function(){return d},cN:function(){return x},cZ:function(){return m},fK:function(){return h},hg:function(){return o}});var s=t(57437),i=t(2265),r=t(70001),n=t(44986),l=t(93448);let d=r.fC,o=r.xz,c=r.h_;r.x8;let u=i.forwardRef((e,a)=>{let{className:t,...i}=e;return(0,s.jsx)(r.aV,{ref:a,className:(0,l.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...i})});u.displayName=r.aV.displayName;let m=i.forwardRef((e,a)=>{let{className:t,children:i,...d}=e;return(0,s.jsxs)(c,{children:[(0,s.jsx)(u,{}),(0,s.jsxs)(r.VY,{ref:a,className:(0,l.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...d,children:[i,(0,s.jsxs)(r.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,s.jsx)(n.Z,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});m.displayName=r.VY.displayName;let h=e=>{let{className:a,...t}=e;return(0,s.jsx)("div",{className:(0,l.cn)("flex flex-col space-y-1.5 text-center sm:text-left",a),...t})};h.displayName="DialogHeader";let x=e=>{let{className:a,...t}=e;return(0,s.jsx)("div",{className:(0,l.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...t})};x.displayName="DialogFooter";let f=i.forwardRef((e,a)=>{let{className:t,...i}=e;return(0,s.jsx)(r.Dx,{ref:a,className:(0,l.cn)("text-lg font-semibold leading-none tracking-tight",t),...i})});f.displayName=r.Dx.displayName;let p=i.forwardRef((e,a)=>{let{className:t,...i}=e;return(0,s.jsx)(r.dk,{ref:a,className:(0,l.cn)("text-sm text-muted-foreground",t),...i})});p.displayName=r.dk.displayName},69140:function(e,a,t){"use strict";t.d(a,{O:function(){return r}});var s=t(57437),i=t(93448);function r(e){let{className:a,...t}=e;return(0,s.jsx)("div",{className:(0,i.cn)("animate-pulse rounded-md bg-muted",a),...t})}},17168:function(e,a,t){"use strict";t.d(a,{SP:function(){return o},dr:function(){return d},mQ:function(){return l},nU:function(){return c}});var s=t(57437),i=t(2265),r=t(20271),n=t(93448);let l=r.fC,d=i.forwardRef((e,a)=>{let{className:t,...i}=e;return(0,s.jsx)(r.aV,{ref:a,className:(0,n.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",t),...i})});d.displayName=r.aV.displayName;let o=i.forwardRef((e,a)=>{let{className:t,...i}=e;return(0,s.jsx)(r.xz,{ref:a,className:(0,n.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",t),...i})});o.displayName=r.xz.displayName;let c=i.forwardRef((e,a)=>{let{className:t,...i}=e;return(0,s.jsx)(r.VY,{ref:a,className:(0,n.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...i})});c.displayName=r.VY.displayName},23675:function(e,a,t){"use strict";t.d(a,{g:function(){return n}});var s=t(57437),i=t(2265),r=t(93448);let n=i.forwardRef((e,a)=>{let{className:t,...i}=e;return(0,s.jsx)("textarea",{className:(0,r.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:a,...i})});n.displayName="Textarea"}},function(e){e.O(0,[4358,9990,6137,1211,9759,3562,6008,9923,2550,1,4233,3719,5434,2981,7974,2971,2117,1744],function(){return e(e.s=14559)}),_N_E=e.O()}]);