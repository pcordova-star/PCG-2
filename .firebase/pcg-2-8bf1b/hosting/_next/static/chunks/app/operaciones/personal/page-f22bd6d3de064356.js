(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3309,5284],{29030:function(e,a,r){Promise.resolve().then(r.bind(r,94038))},94038:function(e,a,r){"use strict";r.r(a),r.d(a,{default:function(){return C}});var t=r(57437),s=r(2265),n=r(12381),o=r(79820),l=r(40279),i=r(75060),d=r(15291),c=r(33804),u=r(30767),f=r(74291),m=r(5485),p=r(54233),x=r(15847),h=r(43728),g=r(99764),b=r(5978),j=r(68245),v=r(69174),N=r(71245),y=r(99376),w=r(27648);function C(){let{user:e,companyId:a,role:r}=(0,N.a)();(0,y.useRouter)();let[C,R]=(0,s.useState)([]),[I,k]=(0,s.useState)(""),[z,_]=(0,s.useState)([]),[S,E]=(0,s.useState)(!0),[F,A]=(0,s.useState)(!0),[O,Z]=(0,s.useState)(null),[D,T]=(0,s.useState)(!1),[$,P]=(0,s.useState)(null);(0,s.useEffect)(()=>{(a||"superadmin"===r)&&e();async function e(){E(!0);try{let e;let t=(0,b.hJ)(g.N$,"obras");e="superadmin"===r?(0,b.IO)(t,(0,b.Xo)("nombreFaena")):(0,b.IO)(t,(0,b.ar)("empresaId","==",a),(0,b.Xo)("nombreFaena"));let s=(await (0,b.PL)(e)).docs.map(e=>{var a;return{id:e.id,nombreFaena:null!==(a=e.data().nombreFaena)&&void 0!==a?a:""}});R(s),s.length>0&&!I&&k(s[0].id)}catch(e){console.error(e),Z("No se pudieron cargar las obras disponibles.")}finally{E(!1)}}},[a,r]),(0,s.useEffect)(()=>{if(!I){_([]),A(!1);return}A(!0);let e=(0,b.hJ)(g.N$,"obras",I,"personal"),a=(0,b.IO)(e,(0,b.Xo)("creadoEn","desc")),r=(0,b.cf)(a,e=>{_(e.docs.map(e=>({id:e.id,...e.data()}))),A(!1)},e=>{console.error(e),Z("Error al cargar el personal de la obra."),A(!1)});return()=>r()},[I]);let B=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;P(e||{nombre:"",rut:"",cargo:"",empresa:"",fechaIngreso:new Date().toISOString().slice(0,10),autorizado:!1,observaciones:""}),T(!0),Z(null)},V=e=>{$&&P({...$,[e.target.name]:e.target.value})},U=e=>{$&&P({...$,autorizado:e})},X=async e=>{if(e.preventDefault(),Z(null),!$||!$.nombre||!$.rut||!$.cargo||!$.empresa||!$.fechaIngreso){Z("Todos los campos marcados con * son obligatorios.");return}if(!I){Z("Debe seleccionar una obra.");return}try{if($.id){let e=(0,b.JU)(g.N$,"obras",I,"personal",$.id);await (0,b.r7)(e,{...$,actualizadoEn:(0,b.Bt)()})}else{let e=(0,b.hJ)(g.N$,"obras",I,"personal");await (0,b.ET)(e,{...$,obraId:I,creadoEn:(0,b.Bt)(),actualizadoEn:(0,b.Bt)()})}T(!1),P(null)}catch(e){console.error(e),Z("No se pudo guardar el registro del personal. Intente nuevamente.")}},Y=async e=>{try{let a=(0,b.JU)(g.N$,"obras",I,"personal",e);await (0,b.oe)(a)}catch(e){console.error(e),Z("No se pudo eliminar el registro. Intente nuevamente.")}};return S?(0,t.jsx)("p",{className:"text-muted-foreground",children:"Cargando obras..."}):(0,t.jsxs)("div",{className:"space-y-8",children:[(0,t.jsx)(n.z,{asChild:!0,variant:"outline",size:"sm",children:(0,t.jsxs)(w.default,{href:"/operaciones",children:[(0,t.jsx)(m.Z,{className:"mr-2 h-4 w-4"}),"Volver a Operaciones"]})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-4xl font-bold font-headline tracking-tight",children:"Personal de Obra"}),(0,t.jsx)("p",{className:"mt-2 text-lg text-muted-foreground",children:"Gestione el plantel de trabajadores y su estado para cada obra. Los datos se guardan en tiempo real en Firestore."})]}),(0,t.jsxs)(o.Zb,{children:[(0,t.jsxs)(o.Ol,{children:[(0,t.jsx)(o.ll,{children:"Selector de Obra"}),(0,t.jsx)(o.SZ,{children:"Seleccione una obra para gestionar su personal asignado."})]}),(0,t.jsx)(o.aY,{children:(0,t.jsxs)("div",{className:"max-w-xs space-y-2",children:[(0,t.jsx)(i._,{htmlFor:"obra-select",children:"Obra seleccionada"}),(0,t.jsxs)(d.Ph,{value:I,onValueChange:k,children:[(0,t.jsx)(d.i4,{id:"obra-select",children:(0,t.jsx)(d.ki,{placeholder:"Seleccione una obra"})}),(0,t.jsx)(d.Bw,{children:C.map(e=>(0,t.jsx)(d.Ql,{value:e.id,children:e.nombreFaena},e.id))})]})]})})]}),(0,t.jsxs)(o.Zb,{children:[(0,t.jsxs)(o.Ol,{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)(o.ll,{children:"Personal Asignado en Obra"}),(0,t.jsx)(o.SZ,{children:F?"Cargando personal...":"Mostrando ".concat(z.length," personas en la obra.")})]}),(0,t.jsxs)(n.z,{onClick:()=>B(),disabled:!I,children:[(0,t.jsx)(p.Z,{className:"mr-2 h-4 w-4"}),"Agregar Personal"]})]}),(0,t.jsxs)(o.aY,{className:"p-0",children:[(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)(c.iA,{children:[(0,t.jsx)(c.xD,{children:(0,t.jsxs)(c.SC,{children:[(0,t.jsx)(c.ss,{children:"Nombre"}),(0,t.jsx)(c.ss,{children:"RUT"}),(0,t.jsx)(c.ss,{children:"Cargo"}),(0,t.jsx)(c.ss,{children:"Empresa"}),(0,t.jsx)(c.ss,{children:"Fecha Ingreso"}),(0,t.jsx)(c.ss,{children:"Autorizado"}),(0,t.jsx)(c.ss,{className:"text-right",children:"Acciones"})]})}),(0,t.jsx)(c.RM,{children:F?(0,t.jsx)(c.SC,{children:(0,t.jsx)(c.pj,{colSpan:7,className:"text-center h-24",children:"Cargando..."})}):z.length>0?z.map(e=>(0,t.jsxs)(c.SC,{children:[(0,t.jsx)(c.pj,{className:"font-medium",children:e.nombre}),(0,t.jsx)(c.pj,{children:e.rut}),(0,t.jsx)(c.pj,{children:e.cargo}),(0,t.jsx)(c.pj,{children:e.empresa}),(0,t.jsx)(c.pj,{children:e.fechaIngreso}),(0,t.jsx)(c.pj,{children:(0,t.jsx)(v.C,{variant:e.autorizado?"default":"destructive",children:e.autorizado?"S\xed":"No"})}),(0,t.jsx)(c.pj,{className:"text-right",children:(0,t.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,t.jsxs)(n.z,{variant:"ghost",size:"icon",onClick:()=>B(e),children:[(0,t.jsx)(x.Z,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"sr-only",children:"Editar"})]}),(0,t.jsxs)(u.aR,{children:[(0,t.jsx)(u.vW,{asChild:!0,children:(0,t.jsxs)(n.z,{variant:"ghost",size:"icon",className:"text-destructive hover:text-destructive",children:[(0,t.jsx)(h.Z,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"sr-only",children:"Eliminar"})]})}),(0,t.jsxs)(u._T,{children:[(0,t.jsxs)(u.fY,{children:[(0,t.jsx)(u.f$,{children:"\xbfDesea eliminar este registro?"}),(0,t.jsxs)(u.yT,{children:['Se eliminar\xe1 permanentemente a "',e.nombre,'" de la obra. Esta acci\xf3n no se puede deshacer.']})]}),(0,t.jsxs)(u.xo,{children:[(0,t.jsx)(u.le,{children:"Cancelar"}),(0,t.jsx)(u.OL,{onClick:()=>Y(e.id),className:"bg-destructive hover:bg-destructive/90",children:"Eliminar"})]})]})]})]})})]},e.id)):(0,t.jsx)(c.SC,{children:(0,t.jsx)(c.pj,{colSpan:7,className:"h-24 text-center",children:"No hay personal registrado para esta obra."})})})]})}),O&&(0,t.jsx)("p",{className:"p-4 text-sm font-medium text-destructive",children:O})]})]}),(0,t.jsx)(f.Vq,{open:D,onOpenChange:T,children:(0,t.jsx)(f.cZ,{className:"sm:max-w-lg",children:(0,t.jsxs)("form",{onSubmit:X,children:[(0,t.jsxs)(f.fK,{children:[(0,t.jsx)(f.$N,{children:(null==$?void 0:$.id)?"Editar Personal":"Agregar Nuevo Personal"}),(0,t.jsx)(f.Be,{children:"Complete la informaci\xf3n del trabajador para esta obra."})]}),(0,t.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i._,{htmlFor:"nombre",children:"Nombre*"}),(0,t.jsx)(l.I,{id:"nombre",name:"nombre",value:(null==$?void 0:$.nombre)||"",onChange:V})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i._,{htmlFor:"rut",children:"RUT*"}),(0,t.jsx)(l.I,{id:"rut",name:"rut",value:(null==$?void 0:$.rut)||"",onChange:V})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i._,{htmlFor:"cargo",children:"Cargo*"}),(0,t.jsx)(l.I,{id:"cargo",name:"cargo",value:(null==$?void 0:$.cargo)||"",onChange:V})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i._,{htmlFor:"empresa",children:"Empresa*"}),(0,t.jsx)(l.I,{id:"empresa",name:"empresa",value:(null==$?void 0:$.empresa)||"",onChange:V})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i._,{htmlFor:"fechaIngreso",children:"Fecha de Ingreso*"}),(0,t.jsx)(l.I,{id:"fechaIngreso",name:"fechaIngreso",type:"date",value:(null==$?void 0:$.fechaIngreso)||"",onChange:V})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2 pt-6",children:[(0,t.jsx)(j.X,{id:"autorizado",checked:null==$?void 0:$.autorizado,onCheckedChange:e=>U(!!e)}),(0,t.jsx)(i._,{htmlFor:"autorizado",className:"font-medium",children:"Autorizado para ingresar a la obra"})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i._,{htmlFor:"observaciones",children:"Observaciones"}),(0,t.jsx)("textarea",{id:"observaciones",name:"observaciones",value:(null==$?void 0:$.observaciones)||"",onChange:V,className:"w-full min-h-[80px] rounded-md border border-input bg-background px-3 py-2 text-sm"})]}),O&&(0,t.jsx)("p",{className:"text-sm font-medium text-destructive",children:O})]}),(0,t.jsxs)(f.cN,{children:[(0,t.jsx)(n.z,{type:"button",variant:"ghost",onClick:()=>T(!1),children:"Cancelar"}),(0,t.jsx)(n.z,{type:"submit",children:"Guardar Registro"})]})]})})})]})}},30767:function(e,a,r){"use strict";r.d(a,{OL:function(){return g},_T:function(){return f},aR:function(){return i},f$:function(){return x},fY:function(){return m},le:function(){return b},vW:function(){return d},xo:function(){return p},yT:function(){return h}});var t=r(57437),s=r(2265),n=r(7880),o=r(93448),l=r(12381);let i=n.fC,d=n.xz,c=n.h_,u=s.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,t.jsx)(n.aV,{className:(0,o.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",r),...s,ref:a})});u.displayName=n.aV.displayName;let f=s.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,t.jsxs)(c,{children:[(0,t.jsx)(u,{}),(0,t.jsx)(n.VY,{ref:a,className:(0,o.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",r),...s})]})});f.displayName=n.VY.displayName;let m=e=>{let{className:a,...r}=e;return(0,t.jsx)("div",{className:(0,o.cn)("flex flex-col space-y-2 text-center sm:text-left",a),...r})};m.displayName="AlertDialogHeader";let p=e=>{let{className:a,...r}=e;return(0,t.jsx)("div",{className:(0,o.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...r})};p.displayName="AlertDialogFooter";let x=s.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,t.jsx)(n.Dx,{ref:a,className:(0,o.cn)("text-lg font-semibold",r),...s})});x.displayName=n.Dx.displayName;let h=s.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,t.jsx)(n.dk,{ref:a,className:(0,o.cn)("text-sm text-muted-foreground",r),...s})});h.displayName=n.dk.displayName;let g=s.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,t.jsx)(n.aU,{ref:a,className:(0,o.cn)((0,l.d)(),r),...s})});g.displayName=n.aU.displayName;let b=s.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,t.jsx)(n.$j,{ref:a,className:(0,o.cn)((0,l.d)({variant:"outline"}),"mt-2 sm:mt-0",r),...s})});b.displayName=n.$j.displayName},69174:function(e,a,r){"use strict";r.d(a,{C:function(){return l}});var t=r(57437);r(2265);var s=r(90535),n=r(93448);let o=(0,s.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function l(e){let{className:a,variant:r,...s}=e;return(0,t.jsx)("div",{className:(0,n.cn)(o({variant:r}),a),...s})}},12381:function(e,a,r){"use strict";r.d(a,{d:function(){return i},z:function(){return d}});var t=r(57437),s=r(2265),n=r(37053),o=r(90535),l=r(93448);let i=(0,o.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=s.forwardRef((e,a)=>{let{className:r,variant:s,size:o,asChild:d=!1,...c}=e,u=d?n.g7:"button";return(0,t.jsx)(u,{className:(0,l.cn)(i({variant:s,size:o,className:r})),ref:a,...c})});d.displayName="Button"},79820:function(e,a,r){"use strict";r.d(a,{Ol:function(){return l},SZ:function(){return d},Zb:function(){return o},aY:function(){return c},eW:function(){return u},ll:function(){return i}});var t=r(57437),s=r(2265),n=r(93448);let o=s.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,t.jsx)("div",{ref:a,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...s})});o.displayName="Card";let l=s.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,t.jsx)("div",{ref:a,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",r),...s})});l.displayName="CardHeader";let i=s.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,t.jsx)("div",{ref:a,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",r),...s})});i.displayName="CardTitle";let d=s.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,t.jsx)("div",{ref:a,className:(0,n.cn)("text-sm text-muted-foreground",r),...s})});d.displayName="CardDescription";let c=s.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,t.jsx)("div",{ref:a,className:(0,n.cn)("p-6 pt-0",r),...s})});c.displayName="CardContent";let u=s.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,t.jsx)("div",{ref:a,className:(0,n.cn)("flex items-center p-6 pt-0",r),...s})});u.displayName="CardFooter"},68245:function(e,a,r){"use strict";r.d(a,{X:function(){return i}});var t=r(57437),s=r(2265),n=r(9270),o=r(59559),l=r(93448);let i=s.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,t.jsx)(n.fC,{ref:a,className:(0,l.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",r),...s,children:(0,t.jsx)(n.z$,{className:(0,l.cn)("flex items-center justify-center text-current"),children:(0,t.jsx)(o.Z,{className:"h-4 w-4"})})})});i.displayName=n.fC.displayName},74291:function(e,a,r){"use strict";r.d(a,{$N:function(){return x},Be:function(){return h},Vq:function(){return i},cN:function(){return p},cZ:function(){return f},fK:function(){return m},hg:function(){return d}});var t=r(57437),s=r(2265),n=r(70001),o=r(44986),l=r(93448);let i=n.fC,d=n.xz,c=n.h_;n.x8;let u=s.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,t.jsx)(n.aV,{ref:a,className:(0,l.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",r),...s})});u.displayName=n.aV.displayName;let f=s.forwardRef((e,a)=>{let{className:r,children:s,...i}=e;return(0,t.jsxs)(c,{children:[(0,t.jsx)(u,{}),(0,t.jsxs)(n.VY,{ref:a,className:(0,l.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",r),...i,children:[s,(0,t.jsxs)(n.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,t.jsx)(o.Z,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});f.displayName=n.VY.displayName;let m=e=>{let{className:a,...r}=e;return(0,t.jsx)("div",{className:(0,l.cn)("flex flex-col space-y-1.5 text-center sm:text-left",a),...r})};m.displayName="DialogHeader";let p=e=>{let{className:a,...r}=e;return(0,t.jsx)("div",{className:(0,l.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...r})};p.displayName="DialogFooter";let x=s.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,t.jsx)(n.Dx,{ref:a,className:(0,l.cn)("text-lg font-semibold leading-none tracking-tight",r),...s})});x.displayName=n.Dx.displayName;let h=s.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,t.jsx)(n.dk,{ref:a,className:(0,l.cn)("text-sm text-muted-foreground",r),...s})});h.displayName=n.dk.displayName},40279:function(e,a,r){"use strict";r.d(a,{I:function(){return o}});var t=r(57437),s=r(2265),n=r(93448);let o=s.forwardRef((e,a)=>{let{className:r,type:s,...o}=e;return(0,t.jsx)("input",{type:s,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:a,...o})});o.displayName="Input"},75060:function(e,a,r){"use strict";r.d(a,{_:function(){return d}});var t=r(57437),s=r(2265),n=r(370),o=r(90535),l=r(93448);let i=(0,o.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=s.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,t.jsx)(n.f,{ref:a,className:(0,l.cn)(i(),r),...s})});d.displayName=n.f.displayName},15291:function(e,a,r){"use strict";r.d(a,{Bw:function(){return x},Ph:function(){return c},Ql:function(){return h},i4:function(){return f},ki:function(){return u}});var t=r(57437),s=r(2265),n=r(74797),o=r(3289),l=r(47969),i=r(59559),d=r(93448);let c=n.fC;n.ZA;let u=n.B4,f=s.forwardRef((e,a)=>{let{className:r,children:s,...l}=e;return(0,t.jsxs)(n.xz,{ref:a,className:(0,d.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",r),...l,children:[s,(0,t.jsx)(n.JO,{asChild:!0,children:(0,t.jsx)(o.Z,{className:"h-4 w-4 opacity-50"})})]})});f.displayName=n.xz.displayName;let m=s.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,t.jsx)(n.u_,{ref:a,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",r),...s,children:(0,t.jsx)(l.Z,{className:"h-4 w-4"})})});m.displayName=n.u_.displayName;let p=s.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,t.jsx)(n.$G,{ref:a,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",r),...s,children:(0,t.jsx)(o.Z,{className:"h-4 w-4"})})});p.displayName=n.$G.displayName;let x=s.forwardRef((e,a)=>{let{className:r,children:s,position:o="popper",...l}=e;return(0,t.jsx)(n.h_,{children:(0,t.jsxs)(n.VY,{ref:a,className:(0,d.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===o&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",r),position:o,...l,children:[(0,t.jsx)(m,{}),(0,t.jsx)(n.l_,{className:(0,d.cn)("p-1","popper"===o&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s}),(0,t.jsx)(p,{})]})})});x.displayName=n.VY.displayName,s.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,t.jsx)(n.__,{ref:a,className:(0,d.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",r),...s})}).displayName=n.__.displayName;let h=s.forwardRef((e,a)=>{let{className:r,children:s,...o}=e;return(0,t.jsxs)(n.ck,{ref:a,className:(0,d.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r),...o,children:[(0,t.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,t.jsx)(n.wU,{children:(0,t.jsx)(i.Z,{className:"h-4 w-4"})})}),(0,t.jsx)(n.eT,{children:s})]})});h.displayName=n.ck.displayName,s.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,t.jsx)(n.Z0,{ref:a,className:(0,d.cn)("-mx-1 my-1 h-px bg-muted",r),...s})}).displayName=n.Z0.displayName},33804:function(e,a,r){"use strict";r.d(a,{RM:function(){return i},SC:function(){return d},iA:function(){return o},pj:function(){return u},ss:function(){return c},xD:function(){return l}});var t=r(57437),s=r(2265),n=r(93448);let o=s.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,t.jsx)("div",{className:"relative w-full overflow-auto",children:(0,t.jsx)("table",{ref:a,className:(0,n.cn)("w-full caption-bottom text-sm",r),...s})})});o.displayName="Table";let l=s.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,t.jsx)("thead",{ref:a,className:(0,n.cn)("[&_tr]:border-b",r),...s})});l.displayName="TableHeader";let i=s.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,t.jsx)("tbody",{ref:a,className:(0,n.cn)("[&_tr:last-child]:border-0",r),...s})});i.displayName="TableBody",s.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,t.jsx)("tfoot",{ref:a,className:(0,n.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",r),...s})}).displayName="TableFooter";let d=s.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,t.jsx)("tr",{ref:a,className:(0,n.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",r),...s})});d.displayName="TableRow";let c=s.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,t.jsx)("th",{ref:a,className:(0,n.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",r),...s})});c.displayName="TableHead";let u=s.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,t.jsx)("td",{ref:a,className:(0,n.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",r),...s})});u.displayName="TableCell",s.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,t.jsx)("caption",{ref:a,className:(0,n.cn)("mt-4 text-sm text-muted-foreground",r),...s})}).displayName="TableCaption"},71245:function(e,a,r){"use strict";r.d(a,{H:function(){return f},a:function(){return m}});var t=r(57437),s=r(43301),n=r(2265),o=r(99764),l=r(99376),i=r(5978);async function d(e){var a;let r=o.N$,t=null===(a=e.email)||void 0===a?void 0:a.toLowerCase().trim();if(!t)return{role:"none",companyId:null};let s=(0,i.IO)((0,i.hJ)(r,"invitacionesUsuarios"),(0,i.ar)("email","==",t),(0,i.ar)("estado","==","pendiente_auth"),(0,i.b9)(1)),n=await (0,i.PL)(s);if(n.empty)return console.log("No hay invitaci\xf3n pendiente para ".concat(t,".")),{role:"none",companyId:null};let l=n.docs[0],d=l.data(),c=(0,i.JU)(r,"users",e.uid),u=(0,i.qs)(r);return u.set(c,{nombre:d.nombre||e.displayName,email:t,role:d.roleDeseado,empresaId:d.empresaId,activo:!0,createdAt:(0,i.Bt)(),updatedAt:(0,i.Bt)()},{merge:!0}),u.update(l.ref,{estado:"activado",uid:e.uid,activatedAt:(0,i.Bt)()}),await u.commit(),console.log("Usuario ".concat(t," activado con rol ").concat(d.roleDeseado," en empresa ").concat(d.empresaId,".")),{role:d.roleDeseado,companyId:d.empresaId}}async function c(e){}let u=(0,n.createContext)(void 0);function f(e){let{children:a}=e,[r,f]=(0,n.useState)(null),[m,p]=(0,n.useState)("none"),[x,h]=(0,n.useState)(null),[g,b]=(0,n.useState)(null),[j,v]=(0,n.useState)(!0),N=(0,l.useRouter)(),y=(0,l.usePathname)();async function w(e,a){try{await (0,s.e5)(o.lX,e,a)}catch(e){if("auth/invalid-credential"===e.code||"auth/wrong-password"===e.code||"auth/user-not-found"===e.code)throw Error("Credenciales inv\xe1lidas. Por favor, revisa tu correo y contrase\xf1a.");if("auth/too-many-requests"===e.code)throw Error("Demasiados intentos fallidos. Por seguridad, el acceso desde este dispositivo ha sido bloqueado temporalmente.");throw console.error("Error de login no manejado:",e),Error("Ocurri\xf3 un error inesperado al iniciar sesi\xf3n.")}}async function C(){try{await (0,s.w7)(o.lX),f(null),p("none"),h(null),b(null),N.push("/")}catch(e){console.error("Error al cerrar sesi\xf3n",e)}}return(0,n.useEffect)(()=>{let e=(0,s.Aj)(o.lX,async e=>{if(e){await c(e);let a=(0,i.JU)(o.N$,"users",e.uid),r=await (0,i.QT)(a),t="none",s=null,n=!1;if(r.exists()){let e=r.data();e.role&&void 0!==e.empresaId&&(t=e.role,s=e.empresaId,n=!0===e.mustChangePassword)}if("none"===t){let a=await d(e);t=a.role,s=a.companyId,n=!0}p(t),h(s),f(e);let l="/cambiar-password"===y;if(n&&!l)N.replace("/cambiar-password");else if(!n){if("none"===t)N.replace("/sin-acceso");else if(y.startsWith("/login")||"/"===y||l){let e="cliente"===t?"/cliente":"contratista"===t?"/cumplimiento/contratista":"/dashboard";N.replace(e)}}}else f(null),p("none"),h(null),b(null);v(!1)});return()=>e()},[N,y]),(0,n.useEffect)(()=>{if(x){let e=(0,i.JU)(o.N$,"companies",x),a=(0,s.Aj)(o.lX,a=>{a&&(0,i.QT)(e).then(e=>{e.exists()?b({id:e.id,...e.data()}):b(null)})});return()=>a()}b(null)},[x]),(0,t.jsx)(u.Provider,{value:{user:r,role:m,companyId:x,company:g,loading:j,login:w,logout:C},children:a})}function m(){let e=(0,n.useContext)(u);if(!e)throw Error("useAuth debe usarse dentro de un AuthProvider");return e}},99764:function(e,a,r){"use strict";let t,s,n,o,l;r.d(a,{IG:function(){return o},N$:function(){return n},lX:function(){return s},x2:function(){return l}});var i=r(738),d=r(43301),c=r(5978),u=r(60062),f=r(13491);let m={apiKey:"AIzaSyBfMp_dH9XhFSXEeMxY-Cdy8MDRIgWrxR0",authDomain:"pcg-2-8bf1b.firebaseapp.com",projectId:"pcg-2-8bf1b",storageBucket:"pcg-2-8bf1b.appspot.com",messagingSenderId:"1073834543546",appId:"1:1073834543546:web:2f85a4a8350280f8589737"};for(let e in m)if(Object.prototype.hasOwnProperty.call(m,e)&&!m[e]){let a=e.replace(/([A-Z])/g,"_$1").toUpperCase(),r="NEXT_PUBLIC_FIREBASE_".concat(a);throw Error("Error de configuraci\xf3n del cliente: La variable de entorno Firebase '".concat(r,"' no est\xe1 definida o est\xe1 vac\xeda. ")+"Aseg\xfarate de que est\xe9 configurada en tu archivo .env.local o en las variables de entorno de producci\xf3n.")}t=(0,i.C6)().length?(0,i.Mq)():(0,i.ZF)(m),s=(0,d.v0)(t),n=(0,c.ad)(t),o=(0,u.cF)(t),l=(0,f.$C)(t,"us-central1")},93448:function(e,a,r){"use strict";r.d(a,{cn:function(){return n}});var t=r(61994),s=r(53335);function n(){for(var e=arguments.length,a=Array(e),r=0;r<e;r++)a[r]=arguments[r];return(0,s.m6)((0,t.W)(a))}}},function(e){e.O(0,[4358,9990,6137,1211,2972,9759,3562,6008,9923,2550,1,8038,2971,2117,1744],function(){return e(e.s=29030)}),_N_E=e.O()}]);