(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4550],{82521:function(e,r,n){Promise.resolve().then(n.bind(n,93217))},99376:function(e,r,n){"use strict";var t=n(35475);n.o(t,"notFound")&&n.d(r,{notFound:function(){return t.notFound}}),n.o(t,"useParams")&&n.d(r,{useParams:function(){return t.useParams}}),n.o(t,"usePathname")&&n.d(r,{usePathname:function(){return t.usePathname}}),n.o(t,"useRouter")&&n.d(r,{useRouter:function(){return t.useRouter}}),n.o(t,"useSearchParams")&&n.d(r,{useSearchParams:function(){return t.useSearchParams}})},93217:function(e,r,n){"use strict";n.r(r),n.d(r,{default:function(){return p}});var t=n(57437),a=n(71245),s=n(79820),o=n(96246),i=n(69140),l=n(12381),d=n(27648),c=n(5485),u=n(2265),f=n(5978),m=n(99764);function p(){var e,r,n;let{user:p,role:h,companyId:x,loading:v}=(0,a.a)(),[N,g]=(0,u.useState)(null),[b,y]=(0,u.useState)(!0);return((0,u.useEffect)(()=>{x?(async()=>{y(!0);let e=(0,f.JU)(m.N$,"companies",x),r=await (0,f.QT)(e);r.exists()&&g({id:r.id,...r.data()}),y(!1)})():y(!1)},[x]),v)?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)(i.O,{className:"h-8 w-1/4"}),(0,t.jsxs)(s.Zb,{children:[(0,t.jsxs)(s.Ol,{children:[(0,t.jsx)(i.O,{className:"h-6 w-1/2"}),(0,t.jsx)(i.O,{className:"h-4 w-1/3"})]}),(0,t.jsxs)(s.aY,{className:"space-y-4",children:[(0,t.jsx)(i.O,{className:"h-4 w-full"}),(0,t.jsx)(i.O,{className:"h-4 w-full"}),(0,t.jsx)(i.O,{className:"h-4 w-2/3"})]})]})]}):p?(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)(l.z,{asChild:!0,variant:"outline",size:"sm",children:(0,t.jsxs)(d.default,{href:"/dashboard",children:[(0,t.jsx)(c.Z,{className:"mr-2 h-4 w-4"}),"Volver al Dashboard"]})}),(0,t.jsxs)(s.Zb,{className:"max-w-2xl mx-auto",children:[(0,t.jsx)(s.Ol,{children:(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)(o.qE,{className:"h-16 w-16",children:(0,t.jsx)(o.Q5,{className:"text-2xl",children:null!==(n=null===(e=p.displayName)||void 0===e?void 0:e[0])&&void 0!==n?n:null===(r=p.email)||void 0===r?void 0:r[0].toUpperCase()})}),(0,t.jsxs)("div",{children:[(0,t.jsx)(s.ll,{className:"text-3xl",children:p.displayName||"Usuario sin nombre"}),(0,t.jsx)(s.SZ,{children:p.email})]})]})}),(0,t.jsxs)(s.aY,{className:"space-y-4 text-sm",children:[(0,t.jsxs)("div",{className:"flex justify-between border-t pt-4",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Rol en la plataforma:"}),(0,t.jsx)("span",{className:"font-semibold",children:{superadmin:"Super Administrador",admin_empresa:"Admin de Empresa",jefe_obra:"Jefe de Obra",prevencionista:"Prevencionista de Riesgos",cliente:"Cliente",none:"Sin Rol Asignado"}[h]||h})]}),(0,t.jsxs)("div",{className:"flex justify-between border-t pt-4",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Empresa:"}),b?(0,t.jsx)(i.O,{className:"h-4 w-1/3"}):(0,t.jsx)("span",{className:"font-semibold",children:(null==N?void 0:N.nombreFantasia)||(null==N?void 0:N.razonSocial)||"No asignada"})]}),(0,t.jsxs)("div",{className:"flex justify-between border-t pt-4",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"ID de Usuario:"}),(0,t.jsx)("span",{className:"font-mono text-xs",children:p.uid})]})]})]})]}):(0,t.jsx)("p",{children:"No has iniciado sesi\xf3n."})}},96246:function(e,r,n){"use strict";n.d(r,{F$:function(){return l},Q5:function(){return d},qE:function(){return i}});var t=n(57437),a=n(2265),s=n(27954),o=n(93448);let i=a.forwardRef((e,r)=>{let{className:n,...a}=e;return(0,t.jsx)(s.fC,{ref:r,className:(0,o.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",n),...a})});i.displayName=s.fC.displayName;let l=a.forwardRef((e,r)=>{let{className:n,...a}=e;return(0,t.jsx)(s.Ee,{ref:r,className:(0,o.cn)("aspect-square h-full w-full",n),...a})});l.displayName=s.Ee.displayName;let d=a.forwardRef((e,r)=>{let{className:n,...a}=e;return(0,t.jsx)(s.NY,{ref:r,className:(0,o.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",n),...a})});d.displayName=s.NY.displayName},12381:function(e,r,n){"use strict";n.d(r,{d:function(){return l},z:function(){return d}});var t=n(57437),a=n(2265),s=n(37053),o=n(90535),i=n(93448);let l=(0,o.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=a.forwardRef((e,r)=>{let{className:n,variant:a,size:o,asChild:d=!1,...c}=e,u=d?s.g7:"button";return(0,t.jsx)(u,{className:(0,i.cn)(l({variant:a,size:o,className:n})),ref:r,...c})});d.displayName="Button"},79820:function(e,r,n){"use strict";n.d(r,{Ol:function(){return i},SZ:function(){return d},Zb:function(){return o},aY:function(){return c},eW:function(){return u},ll:function(){return l}});var t=n(57437),a=n(2265),s=n(93448);let o=a.forwardRef((e,r)=>{let{className:n,...a}=e;return(0,t.jsx)("div",{ref:r,className:(0,s.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",n),...a})});o.displayName="Card";let i=a.forwardRef((e,r)=>{let{className:n,...a}=e;return(0,t.jsx)("div",{ref:r,className:(0,s.cn)("flex flex-col space-y-1.5 p-6",n),...a})});i.displayName="CardHeader";let l=a.forwardRef((e,r)=>{let{className:n,...a}=e;return(0,t.jsx)("div",{ref:r,className:(0,s.cn)("text-2xl font-semibold leading-none tracking-tight",n),...a})});l.displayName="CardTitle";let d=a.forwardRef((e,r)=>{let{className:n,...a}=e;return(0,t.jsx)("div",{ref:r,className:(0,s.cn)("text-sm text-muted-foreground",n),...a})});d.displayName="CardDescription";let c=a.forwardRef((e,r)=>{let{className:n,...a}=e;return(0,t.jsx)("div",{ref:r,className:(0,s.cn)("p-6 pt-0",n),...a})});c.displayName="CardContent";let u=a.forwardRef((e,r)=>{let{className:n,...a}=e;return(0,t.jsx)("div",{ref:r,className:(0,s.cn)("flex items-center p-6 pt-0",n),...a})});u.displayName="CardFooter"},69140:function(e,r,n){"use strict";n.d(r,{O:function(){return s}});var t=n(57437),a=n(93448);function s(e){let{className:r,...n}=e;return(0,t.jsx)("div",{className:(0,a.cn)("animate-pulse rounded-md bg-muted",r),...n})}},71245:function(e,r,n){"use strict";n.d(r,{H:function(){return f},a:function(){return m}});var t=n(57437),a=n(43301),s=n(2265),o=n(99764),i=n(99376),l=n(5978);async function d(e){var r;let n=o.N$,t=null===(r=e.email)||void 0===r?void 0:r.toLowerCase().trim();if(!t)return{role:"none",companyId:null};let a=(0,l.IO)((0,l.hJ)(n,"invitacionesUsuarios"),(0,l.ar)("email","==",t),(0,l.ar)("estado","==","pendiente_auth"),(0,l.b9)(1)),s=await (0,l.PL)(a);if(s.empty)return console.log("No hay invitaci\xf3n pendiente para ".concat(t,".")),{role:"none",companyId:null};let i=s.docs[0],d=i.data(),c=(0,l.JU)(n,"users",e.uid),u=(0,l.qs)(n);return u.set(c,{nombre:d.nombre||e.displayName,email:t,role:d.roleDeseado,empresaId:d.empresaId,activo:!0,createdAt:(0,l.Bt)(),updatedAt:(0,l.Bt)()},{merge:!0}),u.update(i.ref,{estado:"activado",uid:e.uid,activatedAt:(0,l.Bt)()}),await u.commit(),console.log("Usuario ".concat(t," activado con rol ").concat(d.roleDeseado," en empresa ").concat(d.empresaId,".")),{role:d.roleDeseado,companyId:d.empresaId}}async function c(e){}let u=(0,s.createContext)(void 0);function f(e){let{children:r}=e,[n,f]=(0,s.useState)(null),[m,p]=(0,s.useState)("none"),[h,x]=(0,s.useState)(null),[v,N]=(0,s.useState)(null),[g,b]=(0,s.useState)(!0),y=(0,i.useRouter)(),j=(0,i.usePathname)();async function w(e,r){try{await (0,a.e5)(o.lX,e,r)}catch(e){if("auth/invalid-credential"===e.code||"auth/wrong-password"===e.code||"auth/user-not-found"===e.code)throw Error("Credenciales inv\xe1lidas. Por favor, revisa tu correo y contrase\xf1a.");if("auth/too-many-requests"===e.code)throw Error("Demasiados intentos fallidos. Por seguridad, el acceso desde este dispositivo ha sido bloqueado temporalmente.");throw console.error("Error de login no manejado:",e),Error("Ocurri\xf3 un error inesperado al iniciar sesi\xf3n.")}}async function C(){try{await (0,a.w7)(o.lX),f(null),p("none"),x(null),N(null),y.push("/")}catch(e){console.error("Error al cerrar sesi\xf3n",e)}}return(0,s.useEffect)(()=>{let e=(0,a.Aj)(o.lX,async e=>{if(e){await c(e);let r=(0,l.JU)(o.N$,"users",e.uid),n=await (0,l.QT)(r),t="none",a=null,s=!1;if(n.exists()){let e=n.data();e.role&&void 0!==e.empresaId&&(t=e.role,a=e.empresaId,s=!0===e.mustChangePassword)}if("none"===t){let r=await d(e);t=r.role,a=r.companyId,s=!0}p(t),x(a),f(e);let i="/cambiar-password"===j;if(s&&!i)y.replace("/cambiar-password");else if(!s){if("none"===t)y.replace("/sin-acceso");else if(j.startsWith("/login")||"/"===j||i){let e="cliente"===t?"/cliente":"contratista"===t?"/cumplimiento/contratista":"/dashboard";y.replace(e)}}}else f(null),p("none"),x(null),N(null);b(!1)});return()=>e()},[y,j]),(0,s.useEffect)(()=>{if(h){let e=(0,l.JU)(o.N$,"companies",h),r=(0,a.Aj)(o.lX,r=>{r&&(0,l.QT)(e).then(e=>{e.exists()?N({id:e.id,...e.data()}):N(null)})});return()=>r()}N(null)},[h]),(0,t.jsx)(u.Provider,{value:{user:n,role:m,companyId:h,company:v,loading:g,login:w,logout:C},children:r})}function m(){let e=(0,s.useContext)(u);if(!e)throw Error("useAuth debe usarse dentro de un AuthProvider");return e}},99764:function(e,r,n){"use strict";let t,a,s,o,i;n.d(r,{IG:function(){return o},N$:function(){return s},lX:function(){return a},x2:function(){return i}});var l=n(738),d=n(43301),c=n(5978),u=n(60062),f=n(13491);let m={apiKey:"AIzaSyBfMp_dH9XhFSXEeMxY-Cdy8MDRIgWrxR0",authDomain:"pcg-2-8bf1b.firebaseapp.com",projectId:"pcg-2-8bf1b",storageBucket:"pcg-2-8bf1b.appspot.com",messagingSenderId:"1073834543546",appId:"1:1073834543546:web:2f85a4a8350280f8589737"};for(let e in m)if(Object.prototype.hasOwnProperty.call(m,e)&&!m[e]){let r=e.replace(/([A-Z])/g,"_$1").toUpperCase(),n="NEXT_PUBLIC_FIREBASE_".concat(r);throw Error("Error de configuraci\xf3n del cliente: La variable de entorno Firebase '".concat(n,"' no est\xe1 definida o est\xe1 vac\xeda. ")+"Aseg\xfarate de que est\xe9 configurada en tu archivo .env.local o en las variables de entorno de producci\xf3n.")}t=(0,l.C6)().length?(0,l.Mq)():(0,l.ZF)(m),a=(0,d.v0)(t),s=(0,c.ad)(t),o=(0,u.cF)(t),i=(0,f.$C)(t,"us-central1")},93448:function(e,r,n){"use strict";n.d(r,{cn:function(){return s}});var t=n(61994),a=n(53335);function s(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];return(0,a.m6)((0,t.W)(r))}},5485:function(e,r,n){"use strict";n.d(r,{Z:function(){return t}});let t=(0,n(96471).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])}},function(e){e.O(0,[4358,9990,6137,1211,2972,8271,2971,2117,1744],function(){return e(e.s=82521)}),_N_E=e.O()}]);