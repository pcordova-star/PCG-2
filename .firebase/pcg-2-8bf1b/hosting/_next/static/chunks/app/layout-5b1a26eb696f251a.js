(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3185],{4225:function(e,r,t){Promise.resolve().then(t.bind(t,54788))},54788:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return Y}});var a=t(57437);t(2778);var s=t(71245),n=t(2265),i=t(93448),o=t(67399),l=t.n(o),d=t(23340),c=t(41915),u=t(90535),f=t(44986);let m=c.zt,p=n.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)(c.l_,{ref:r,className:(0,i.cn)("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",t),...s})});p.displayName=c.l_.displayName;let h=(0,u.j)("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),x=n.forwardRef((e,r)=>{let{className:t,variant:s,...n}=e;return(0,a.jsx)(c.fC,{ref:r,className:(0,i.cn)(h({variant:s}),t),...n})});x.displayName=c.fC.displayName,n.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)(c.aU,{ref:r,className:(0,i.cn)("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",t),...s})}).displayName=c.aU.displayName;let v=n.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)(c.x8,{ref:r,className:(0,i.cn)("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",t),"toast-close":"",...s,children:(0,a.jsx)(f.Z,{className:"h-4 w-4"})})});v.displayName=c.x8.displayName;let b=n.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)(c.Dx,{ref:r,className:(0,i.cn)("text-sm font-semibold",t),...s})});b.displayName=c.Dx.displayName;let g=n.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)(c.dk,{ref:r,className:(0,i.cn)("text-sm opacity-90",t),...s})});function j(){let{toasts:e}=(0,d.pm)();return(0,a.jsxs)(m,{children:[e.map(function(e){let{id:r,title:t,description:s,action:n,...i}=e;return(0,a.jsxs)(x,{...i,children:[(0,a.jsxs)("div",{className:"grid gap-1",children:[t&&(0,a.jsx)(b,{children:t}),s&&(0,a.jsx)(g,{children:s})]}),n,(0,a.jsx)(v,{})]},r)}),(0,a.jsx)(p,{})]})}g.displayName=c.dk.displayName;let y=(0,t(59625).Ue)(e=>({isCollapsed:!1,toggleSidebar:()=>e(e=>({isCollapsed:!e.isCollapsed}))}));var w=t(27648),_=t(99376),N=t(43335),S=t(41255),E=t(32508),C=t(157),I=t(96888),A=t(13617),k=t(37713),Z=t(94269),z=t(19965),T=t(91120),D=t(16994),O=t(10071),P=t(54585),R=t(40339),F=t(7250),U=t(11031),M=t(67350),X=t(3683),B=t(12381),W=t(59539),J=t(71488),L=t(31593);let V=[{href:"/dashboard",label:"Dashboard",icon:N.Z,roles:["superadmin","admin_empresa","jefe_obra","prevencionista"]},{href:"/obras",label:"Obras",icon:S.Z,roles:["superadmin","admin_empresa","jefe_obra","prevencionista"]},{href:"/operaciones",label:"Operaciones",icon:E.Z,roles:["superadmin","admin_empresa","jefe_obra"],subItems:[{href:"/operaciones/presupuestos",label:"Itemizados",icon:C.Z,roles:["superadmin","admin_empresa","jefe_obra"]},{href:"/operaciones/programacion",label:"Programaci\xf3n",icon:E.Z,roles:["superadmin","admin_empresa","jefe_obra"]},{href:"/operaciones/estados-de-pago",label:"Estados de Pago",icon:I.Z,roles:["superadmin","admin_empresa","jefe_obra"]}]},{href:"/prevencion",label:"Prevenci\xf3n",icon:A.Z,roles:["superadmin","admin_empresa","jefe_obra","prevencionista"],featureFlag:"feature_risk_prevention_enabled"},{href:"/checklists-operacionales",label:"Checklists",icon:k.Z,roles:["superadmin","admin_empresa","jefe_obra","prevencionista"],featureFlag:"feature_operational_checklists_enabled"},{href:"/cumplimiento",label:"Cumplimiento",icon:A.Z,roles:["superadmin","admin_empresa","contratista"],featureFlag:"feature_compliance_module_enabled"},{href:"/cubicacion/analisis-planos",label:"An\xe1lisis IA",icon:Z.Z,roles:["superadmin","admin_empresa","jefe_obra"],featureFlag:"feature_plan_analysis_enabled"},{href:"/admin/documentos/proyecto",label:"Documentos",icon:C.Z,roles:["superadmin","admin_empresa","prevencionista"],featureFlag:"feature_document_control_enabled"},{href:"/rdi",label:"RDI",icon:z.Z,roles:["superadmin","admin_empresa","jefe_obra"]}],$=[{href:"/admin/dashboard",label:"Dashboard Admin",icon:N.Z,roles:["superadmin"]},{href:"/admin/empresas",label:"Empresas",icon:T.Z,roles:["superadmin"]},{href:"/admin/usuarios",label:"Usuarios",icon:D.Z,roles:["superadmin"]},{href:"/admin/solicitudes",label:"Solicitudes",icon:O.Z,roles:["superadmin"]},{href:"/admin/facturacion",label:"Facturaci\xf3n",icon:P.Z,roles:["superadmin"]},{href:"/admin/pricing",label:"Precios",icon:R.Z,roles:["superadmin"]}];function q(e){let{item:r,isCollapsed:t}=e,s=(0,_.usePathname)(),n=s===r.href||"/dashboard"!==r.href&&s.startsWith(r.href),o=r.icon,l=(0,a.jsxs)("div",{className:(0,i.cn)("flex items-center gap-3 px-3 py-2 rounded-md transition-colors",n?"bg-primary/10 text-primary":"text-muted-foreground hover:bg-muted/50 hover:text-foreground",t&&"justify-center"),children:[(0,a.jsx)(o,{className:"h-5 w-5 shrink-0"}),(0,a.jsx)("span",{className:(0,i.cn)("transition-opacity",t?"sr-only":"opacity-100"),children:r.label})]});return t?(0,a.jsx)(J.pn,{delayDuration:0,children:(0,a.jsxs)(J.u,{children:[(0,a.jsx)(J.aJ,{asChild:!0,children:(0,a.jsx)(w.default,{href:r.href,children:l})}),(0,a.jsx)(J._v,{side:"right",children:(0,a.jsx)("p",{children:r.label})})]})}):(0,a.jsx)(w.default,{href:r.href,children:l})}function G(){let{isCollapsed:e,toggleSidebar:r}=y(),{user:t,role:o,company:l,logout:d}=(0,s.a)(),[c,u]=(0,n.useState)(!1);(0,n.useEffect)(()=>{let e=()=>u(window.innerWidth<768);return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);let f=()=>{c?y.setState({isCollapsed:!0}):r()},m=V.filter(e=>e.roles.includes(o)),p=$.filter(e=>e.roles.includes(o)),h=(0,a.jsxs)("div",{className:"flex h-full flex-col",children:[(0,a.jsxs)("header",{className:(0,i.cn)("flex items-center justify-between p-4 border-b",e&&"justify-center"),children:[!e&&(0,a.jsx)(W.K,{size:80}),(0,a.jsx)(B.z,{variant:"ghost",size:"icon",onClick:f,children:e?(0,a.jsx)(F.Z,{}):(0,a.jsx)(U.Z,{})})]}),(0,a.jsxs)("nav",{className:"flex-1 space-y-2 overflow-y-auto p-2",children:[m.map(r=>(0,a.jsx)(q,{item:r,isCollapsed:e},r.href)),"superadmin"===o&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(L.Z,{className:"my-4"}),p.map(r=>(0,a.jsx)(q,{item:r,isCollapsed:e},r.href))]})]}),(0,a.jsxs)("footer",{className:"mt-auto border-t p-2",children:[(0,a.jsx)(q,{item:{href:"/perfil",label:(null==t?void 0:t.displayName)||(null==t?void 0:t.email)||"Mi Perfil",icon:M.Z,roles:[o]},isCollapsed:e}),(0,a.jsxs)(B.z,{onClick:d,variant:"ghost",className:(0,i.cn)("w-full justify-start text-muted-foreground",e&&"justify-center"),children:[(0,a.jsx)(X.Z,{className:"h-5 w-5"}),(0,a.jsx)("span",{className:(0,i.cn)("ml-3",e&&"sr-only"),children:"Cerrar Sesi\xf3n"})]})]})]});return c?(0,a.jsxs)(a.Fragment,{children:[!e&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/40 z-40 md:hidden",onClick:f}),(0,a.jsx)("aside",{className:(0,i.cn)("fixed top-0 left-0 h-full bg-card border-r z-50 transition-transform duration-300 ease-in-out md:hidden",e?"-translate-x-full":"translate-x-0 w-64"),children:h})]}):(0,a.jsx)("aside",{className:(0,i.cn)("hidden md:block fixed top-0 left-0 h-full bg-card border-r z-30 transition-all duration-300 ease-in-out",e?"w-16":"w-64"),children:h})}var H=t(32065);function K(e){let{children:r}=e,{isCollapsed:t,toggleSidebar:o}=y(),{user:l,loading:d}=(0,s.a)(),c=(0,_.usePathname)(),[u,f]=(0,n.useState)(!1);(0,n.useEffect)(()=>{f(!0)},[]);let m=["/","/login/usuario","/login/cliente","/accept-invite","/terminos","/sin-acceso"].includes(c)||c.startsWith("/public/");return!u||m||d?(0,a.jsx)(a.Fragment,{children:r}):(0,a.jsxs)("div",{className:"flex min-h-screen",children:[(0,a.jsx)(G,{}),(0,a.jsxs)("main",{className:(0,i.cn)("flex-1 flex flex-col transition-all duration-300 ease-in-out",t?"md:ml-16":"md:ml-64"),children:[(0,a.jsx)("header",{className:"flex items-center h-14 px-4 border-b md:hidden sticky top-0 bg-card z-20",children:(0,a.jsxs)(B.z,{variant:"ghost",size:"icon",onClick:o,children:[(0,a.jsx)(H.Z,{className:"h-6 w-6"}),(0,a.jsx)("span",{className:"sr-only",children:"Toggle Sidebar"})]})}),(0,a.jsx)("div",{className:"p-4 md:p-8 flex-1",children:r})]})]})}function Y(e){let{children:r}=e;return(0,a.jsx)("html",{lang:"es",suppressHydrationWarning:!0,children:(0,a.jsxs)("body",{className:(0,i.cn)("font-body antialiased",l().variable),children:[(0,a.jsx)(s.H,{children:(0,a.jsx)(n.Suspense,{fallback:(0,a.jsx)("div",{children:"Cargando..."}),children:(0,a.jsx)(K,{children:r})})}),(0,a.jsx)(j,{})]})})}},59539:function(e,r,t){"use strict";t.d(r,{K:function(){return s}});var a=t(57437);function s(e){let{size:r=60}=e;return(0,a.jsx)("div",{className:"flex items-center justify-center",children:(0,a.jsx)("img",{src:"/logo.png",alt:"PCG - Plataforma de Control y Gesti\xf3n",width:r,height:r})})}},12381:function(e,r,t){"use strict";t.d(r,{d:function(){return l},z:function(){return d}});var a=t(57437),s=t(2265),n=t(37053),i=t(90535),o=t(93448);let l=(0,i.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=s.forwardRef((e,r)=>{let{className:t,variant:s,size:i,asChild:d=!1,...c}=e,u=d?n.g7:"button";return(0,a.jsx)(u,{className:(0,o.cn)(l({variant:s,size:i,className:t})),ref:r,...c})});d.displayName="Button"},31593:function(e,r,t){"use strict";t.d(r,{Z:function(){return o}});var a=t(57437),s=t(2265),n=t(90759),i=t(93448);let o=s.forwardRef((e,r)=>{let{className:t,orientation:s="horizontal",decorative:o=!0,...l}=e;return(0,a.jsx)(n.f,{ref:r,decorative:o,orientation:s,className:(0,i.cn)("shrink-0 bg-border","horizontal"===s?"h-[1px] w-full":"h-full w-[1px]",t),...l})});o.displayName=n.f.displayName},71488:function(e,r,t){"use strict";t.d(r,{_v:function(){return c},aJ:function(){return d},pn:function(){return o},u:function(){return l}});var a=t(57437),s=t(2265),n=t(91668),i=t(93448);let o=n.zt,l=n.fC,d=n.xz,c=s.forwardRef((e,r)=>{let{className:t,sideOffset:s=4,...o}=e;return(0,a.jsx)(n.VY,{ref:r,sideOffset:s,className:(0,i.cn)("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...o})});c.displayName=n.VY.displayName},71245:function(e,r,t){"use strict";t.d(r,{H:function(){return f},a:function(){return m}});var a=t(57437),s=t(43301),n=t(2265),i=t(99764),o=t(99376),l=t(5978);async function d(e){var r;let t=i.N$,a=null===(r=e.email)||void 0===r?void 0:r.toLowerCase().trim();if(!a)return{role:"none",companyId:null};let s=(0,l.IO)((0,l.hJ)(t,"invitacionesUsuarios"),(0,l.ar)("email","==",a),(0,l.ar)("estado","==","pendiente_auth"),(0,l.b9)(1)),n=await (0,l.PL)(s);if(n.empty)return console.log("No hay invitaci\xf3n pendiente para ".concat(a,".")),{role:"none",companyId:null};let o=n.docs[0],d=o.data(),c=(0,l.JU)(t,"users",e.uid),u=(0,l.qs)(t);return u.set(c,{nombre:d.nombre||e.displayName,email:a,role:d.roleDeseado,empresaId:d.empresaId,activo:!0,createdAt:(0,l.Bt)(),updatedAt:(0,l.Bt)()},{merge:!0}),u.update(o.ref,{estado:"activado",uid:e.uid,activatedAt:(0,l.Bt)()}),await u.commit(),console.log("Usuario ".concat(a," activado con rol ").concat(d.roleDeseado," en empresa ").concat(d.empresaId,".")),{role:d.roleDeseado,companyId:d.empresaId}}async function c(e){}let u=(0,n.createContext)(void 0);function f(e){let{children:r}=e,[t,f]=(0,n.useState)(null),[m,p]=(0,n.useState)("none"),[h,x]=(0,n.useState)(null),[v,b]=(0,n.useState)(null),[g,j]=(0,n.useState)(!0),y=(0,o.useRouter)(),w=(0,o.usePathname)();async function _(e,r){try{await (0,s.e5)(i.lX,e,r)}catch(e){if("auth/invalid-credential"===e.code||"auth/wrong-password"===e.code||"auth/user-not-found"===e.code)throw Error("Credenciales inv\xe1lidas. Por favor, revisa tu correo y contrase\xf1a.");if("auth/too-many-requests"===e.code)throw Error("Demasiados intentos fallidos. Por seguridad, el acceso desde este dispositivo ha sido bloqueado temporalmente.");throw console.error("Error de login no manejado:",e),Error("Ocurri\xf3 un error inesperado al iniciar sesi\xf3n.")}}async function N(){try{await (0,s.w7)(i.lX),f(null),p("none"),x(null),b(null),y.push("/")}catch(e){console.error("Error al cerrar sesi\xf3n",e)}}return(0,n.useEffect)(()=>{let e=(0,s.Aj)(i.lX,async e=>{if(e){await c(e);let r=(0,l.JU)(i.N$,"users",e.uid),t=await (0,l.QT)(r),a="none",s=null,n=!1;if(t.exists()){let e=t.data();e.role&&void 0!==e.empresaId&&(a=e.role,s=e.empresaId,n=!0===e.mustChangePassword)}if("none"===a){let r=await d(e);a=r.role,s=r.companyId,n=!0}p(a),x(s),f(e);let o="/cambiar-password"===w;if(n&&!o)y.replace("/cambiar-password");else if(!n){if("none"===a)y.replace("/sin-acceso");else if(w.startsWith("/login")||"/"===w||o){let e="cliente"===a?"/cliente":"contratista"===a?"/cumplimiento/contratista":"/dashboard";y.replace(e)}}}else f(null),p("none"),x(null),b(null);j(!1)});return()=>e()},[y,w]),(0,n.useEffect)(()=>{if(h){let e=(0,l.JU)(i.N$,"companies",h),r=(0,s.Aj)(i.lX,r=>{r&&(0,l.QT)(e).then(e=>{e.exists()?b({id:e.id,...e.data()}):b(null)})});return()=>r()}b(null)},[h]),(0,a.jsx)(u.Provider,{value:{user:t,role:m,companyId:h,company:v,loading:g,login:_,logout:N},children:r})}function m(){let e=(0,n.useContext)(u);if(!e)throw Error("useAuth debe usarse dentro de un AuthProvider");return e}},23340:function(e,r,t){"use strict";t.d(r,{pm:function(){return f}});var a=t(2265);let s=0,n=new Map,i=e=>{if(n.has(e))return;let r=setTimeout(()=>{n.delete(e),c({type:"REMOVE_TOAST",toastId:e})},1e6);n.set(e,r)},o=(e,r)=>{switch(r.type){case"ADD_TOAST":return{...e,toasts:[r.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===r.toast.id?{...e,...r.toast}:e)};case"DISMISS_TOAST":{let{toastId:t}=r;return t?i(t):e.toasts.forEach(e=>{i(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===t||void 0===t?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===r.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==r.toastId)}}},l=[],d={toasts:[]};function c(e){d=o(d,e),l.forEach(e=>{e(d)})}function u(e){let{...r}=e,t=(s=(s+1)%Number.MAX_SAFE_INTEGER).toString(),a=()=>c({type:"DISMISS_TOAST",toastId:t});return c({type:"ADD_TOAST",toast:{...r,id:t,open:!0,onOpenChange:e=>{e||a()}}}),{id:t,dismiss:a,update:e=>c({type:"UPDATE_TOAST",toast:{...e,id:t}})}}function f(){let[e,r]=a.useState(d);return a.useEffect(()=>(l.push(r),()=>{let e=l.indexOf(r);e>-1&&l.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>c({type:"DISMISS_TOAST",toastId:e})}}},99764:function(e,r,t){"use strict";let a,s,n,i,o;t.d(r,{IG:function(){return i},N$:function(){return n},lX:function(){return s},x2:function(){return o}});var l=t(738),d=t(43301),c=t(5978),u=t(60062),f=t(13491);let m={apiKey:"AIzaSyBfMp_dH9XhFSXEeMxY-Cdy8MDRIgWrxR0",authDomain:"pcg-2-8bf1b.firebaseapp.com",projectId:"pcg-2-8bf1b",storageBucket:"pcg-2-8bf1b.appspot.com",messagingSenderId:"1073834543546",appId:"1:1073834543546:web:2f85a4a8350280f8589737"};for(let e in m)if(Object.prototype.hasOwnProperty.call(m,e)&&!m[e]){let r=e.replace(/([A-Z])/g,"_$1").toUpperCase(),t="NEXT_PUBLIC_FIREBASE_".concat(r);throw Error("Error de configuraci\xf3n del cliente: La variable de entorno Firebase '".concat(t,"' no est\xe1 definida o est\xe1 vac\xeda. ")+"Aseg\xfarate de que est\xe9 configurada en tu archivo .env.local o en las variables de entorno de producci\xf3n.")}a=(0,l.C6)().length?(0,l.Mq)():(0,l.ZF)(m),s=(0,d.v0)(a),n=(0,c.ad)(a),i=(0,u.cF)(a),o=(0,f.$C)(a,"us-central1")},93448:function(e,r,t){"use strict";t.d(r,{cn:function(){return n}});var a=t(61994),s=t(53335);function n(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,s.m6)((0,a.W)(r))}},2778:function(){}},function(e){e.O(0,[31,4358,9990,6137,1211,2972,9759,6008,9923,9664,3059,2971,2117,1744],function(){return e(e.s=4225)}),_N_E=e.O()}]);