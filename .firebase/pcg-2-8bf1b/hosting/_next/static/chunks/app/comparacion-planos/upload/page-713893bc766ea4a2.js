(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2408],{36374:function(e,t,a){Promise.resolve().then(a.bind(a,82440))},82440:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return A}});var r=a(57437),i=a(2265),n=a(12381),s=a(40279),l=a(75060),o=a(95937);let d=(0,a(96471).Z)("FileCheck2",[["path",{d:"M4 22h14a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v4",key:"1pf5j1"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"m3 15 2 2 4-4",key:"1lhrkk"}]]);var c=a(25361),u=a(53459),p=a(91230);let f=["application/pdf","image/jpeg","image/png"];function m(e){let{onSubmit:t,isSubmitting:a=!1}=e,[m,h]=(0,i.useState)(null),[x,v]=(0,i.useState)(null),[g,b]=(0,i.useState)(null),y=(e,t)=>{var a;b(null);let r=(null===(a=e.target.files)||void 0===a?void 0:a[0])||null;if(r){if(!f.includes(r.type)){b("Tipo de archivo no permitido: ".concat(r.name,". Sube PDF, JPG o PNG.")),t(null),e.target.value="";return}if(r.size>15728640){b("Archivo demasiado grande: ".concat(r.name,". El m\xe1ximo es ").concat(15,"MB.")),t(null),e.target.value="";return}}t(r)},j=e=>{let{file:t}=e;return t?(0,r.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground mt-2",children:[(0,r.jsx)(d,{className:"h-4 w-4 text-green-600 flex-shrink-0"}),(0,r.jsxs)("span",{className:"truncate",children:[t.name," (",(t.size/1024/1024).toFixed(2)," MB)"]})]}):null};return(0,r.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),!m||!x){b("Debes seleccionar ambos archivos para iniciar el an\xe1lisis.");return}b(null),t({planoA:m,planoB:x})},className:"space-y-6",children:[g&&(0,r.jsxs)(o.bZ,{variant:"destructive",children:[(0,r.jsx)(c.Z,{className:"h-4 w-4"}),(0,r.jsx)(o.Cd,{children:"Error"}),(0,r.jsx)(o.X,{children:g})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(l._,{htmlFor:"planoA",children:"Plano A (versi\xf3n original)"}),(0,r.jsx)(s.I,{id:"planoA",type:"file",accept:".pdf,.jpg,.jpeg,.png",onChange:e=>y(e,h),disabled:a}),(0,r.jsx)(j,{file:m})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(l._,{htmlFor:"planoB",children:"Plano B (versi\xf3n modificada)"}),(0,r.jsx)(s.I,{id:"planoB",type:"file",accept:".pdf,.jpg,.jpeg,.png",onChange:e=>y(e,v),disabled:a}),(0,r.jsx)(j,{file:x})]})]}),(0,r.jsxs)(n.z,{type:"submit",className:"w-full",disabled:a||!m||!x,children:[a&&(0,r.jsx)(u.Z,{className:"mr-2 h-4 w-4 animate-spin"}),a?"Iniciando...":"Iniciar An\xe1lisis",!a&&(0,r.jsx)(p.Z,{className:"ml-2 h-4 w-4"})]})]})}var h=a(79820),x=a(99376),v=a(27648),g=a(5485),b=a(94402),y=a(71245),j=a(23340);async function w(){let e=await a.e(9980).then(a.bind(a,27781));return e.GlobalWorkerOptions.workerSrc="/pdf.worker.min.mjs",e}async function N(e){let t=await w(),a=await e.arrayBuffer(),r=await t.getDocument({data:a}).promise,i=await r.getPage(1),n=i.getViewport({scale:1}),s=Math.min(1600/n.width,1600/n.height,1),l=i.getViewport({scale:s}),o=document.createElement("canvas"),d=o.getContext("2d");if(!d)throw Error("El contexto del canvas no est\xe1 disponible para la conversi\xf3n.");return o.width=l.width,o.height=l.height,d.fillStyle="#FFFFFF",d.fillRect(0,0,o.width,o.height),await i.render({canvasContext:d,viewport:l}).promise,new Promise((t,a)=>{o.toBlob(r=>{if(!r){a(Error("No se pudo crear el blob desde el canvas."));return}t(new File([r],e.name.replace(/\.pdf$/i,".jpg"),{type:"image/jpeg"}))},"image/jpeg",.8)})}async function S(e){return"application/pdf"===e.type?N(e):e}function A(){let e=(0,x.useRouter)(),{user:t,company:a,role:s,loading:l}=(0,y.a)(),{toast:o}=(0,j.pm)(),[d,c]=(0,i.useState)(!1),u=(0,i.useMemo)(()=>!l&&("superadmin"===s||!!a&&!0===a.feature_plan_comparison_enabled&&["admin_empresa","jefe_obra"].includes(s)),[a,s,l]),p=async a=>{if(!t){o({variant:"destructive",title:"Error de autenticaci\xf3n",description:"Debes iniciar sesi\xf3n para iniciar un an\xe1lisis."});return}c(!0),o({title:"Preparando archivos...",description:"Convirtiendo PDFs si es necesario. Esto puede tardar un momento."});try{let[r,i]=await Promise.all([S(a.planoA),S(a.planoB)]),n=await t.getIdToken(),s=new FormData;s.append("planoA",r),s.append("planoB",i);let l=await fetch("/api/comparacion-planos/upload",{method:"POST",headers:{Authorization:"Bearer ".concat(n)},body:s}),d=await l.json();if(!l.ok)throw Error(d.error||"Error en el servidor al subir los archivos.");o({title:"An\xe1lisis iniciado",description:"Job creado con ID: ".concat(d.jobId)}),e.push("/comparacion-planos/".concat(d.jobId))}catch(e){console.error("Error al iniciar an\xe1lisis:",e),o({variant:"destructive",title:"Error",description:e.message})}finally{c(!1)}};return l?(0,r.jsx)("div",{className:"max-w-6xl mx-auto px-4 py-8",children:"Cargando..."}):u?(0,r.jsxs)("div",{className:"max-w-2xl mx-auto px-4 py-8 space-y-8",children:[(0,r.jsxs)("header",{className:"space-y-2",children:[(0,r.jsx)(n.z,{asChild:!0,variant:"outline",size:"sm",children:(0,r.jsxs)(v.default,{href:"/dashboard",children:[(0,r.jsx)(g.Z,{className:"mr-2 h-4 w-4"}),"Volver al Dashboard"]})}),(0,r.jsx)("h1",{className:"text-3xl font-semibold text-gray-900",children:"Comparaci\xf3n de Planos con IA"}),(0,r.jsx)("p",{className:"text-muted-foreground",children:"Sube dos versiones de un mismo plano (original y modificado) para que la IA detecte las diferencias, analice el impacto en la cubicaci\xf3n y eval\xfae las consecuencias en las distintas especialidades."})]}),(0,r.jsxs)(h.Zb,{children:[(0,r.jsxs)(h.Ol,{children:[(0,r.jsx)(h.ll,{children:"Cargar Planos"}),(0,r.jsx)(h.SZ,{children:"Selecciona la versi\xf3n original (Plano A) y la versi\xf3n modificada (Plano B). Los archivos pueden ser PDF, JPG o PNG."})]}),(0,r.jsx)(h.aY,{children:(0,r.jsx)(m,{onSubmit:p,isSubmitting:d})})]})]}):(0,r.jsxs)("div",{className:"max-w-6xl mx-auto px-4 py-8",children:[(0,r.jsx)(n.z,{asChild:!0,variant:"outline",size:"sm",className:"mb-4",children:(0,r.jsxs)(v.default,{href:"/dashboard",children:[(0,r.jsx)(g.Z,{className:"mr-2 h-4 w-4"}),"Volver al Dashboard"]})}),(0,r.jsx)(h.Zb,{className:"max-w-2xl mx-auto",children:(0,r.jsxs)(h.Ol,{className:"items-center text-center",children:[(0,r.jsx)(b.Z,{className:"h-12 w-12 text-destructive"}),(0,r.jsx)(h.ll,{children:"Acceso Denegado"}),(0,r.jsx)(h.SZ,{children:"No tienes permisos para acceder al m\xf3dulo de Comparaci\xf3n de Planos. Contacta a un administrador para habilitar esta funci\xf3n para tu empresa."})]})})]})}},95937:function(e,t,a){"use strict";a.d(t,{Cd:function(){return d},X:function(){return c},bZ:function(){return o}});var r=a(57437),i=a(2265),n=a(90535),s=a(93448);let l=(0,n.j)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),o=i.forwardRef((e,t)=>{let{className:a,variant:i,...n}=e;return(0,r.jsx)("div",{ref:t,role:"alert",className:(0,s.cn)(l({variant:i}),a),...n})});o.displayName="Alert";let d=i.forwardRef((e,t)=>{let{className:a,...i}=e;return(0,r.jsx)("h5",{ref:t,className:(0,s.cn)("mb-1 font-medium leading-none tracking-tight",a),...i})});d.displayName="AlertTitle";let c=i.forwardRef((e,t)=>{let{className:a,...i}=e;return(0,r.jsx)("div",{ref:t,className:(0,s.cn)("text-sm [&_p]:leading-relaxed",a),...i})});c.displayName="AlertDescription"},40279:function(e,t,a){"use strict";a.d(t,{I:function(){return s}});var r=a(57437),i=a(2265),n=a(93448);let s=i.forwardRef((e,t)=>{let{className:a,type:i,...s}=e;return(0,r.jsx)("input",{type:i,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:t,...s})});s.displayName="Input"},75060:function(e,t,a){"use strict";a.d(t,{_:function(){return d}});var r=a(57437),i=a(2265),n=a(370),s=a(90535),l=a(93448);let o=(0,s.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=i.forwardRef((e,t)=>{let{className:a,...i}=e;return(0,r.jsx)(n.f,{ref:t,className:(0,l.cn)(o(),a),...i})});d.displayName=n.f.displayName},23340:function(e,t,a){"use strict";a.d(t,{pm:function(){return p}});var r=a(2265);let i=0,n=new Map,s=e=>{if(n.has(e))return;let t=setTimeout(()=>{n.delete(e),c({type:"REMOVE_TOAST",toastId:e})},1e6);n.set(e,t)},l=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:a}=t;return a?s(a):e.toasts.forEach(e=>{s(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===a||void 0===a?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},o=[],d={toasts:[]};function c(e){d=l(d,e),o.forEach(e=>{e(d)})}function u(e){let{...t}=e,a=(i=(i+1)%Number.MAX_SAFE_INTEGER).toString(),r=()=>c({type:"DISMISS_TOAST",toastId:a});return c({type:"ADD_TOAST",toast:{...t,id:a,open:!0,onOpenChange:e=>{e||r()}}}),{id:a,dismiss:r,update:e=>c({type:"UPDATE_TOAST",toast:{...e,id:a}})}}function p(){let[e,t]=r.useState(d);return r.useEffect(()=>(o.push(t),()=>{let e=o.indexOf(t);e>-1&&o.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>c({type:"DISMISS_TOAST",toastId:e})}}},370:function(e,t,a){"use strict";a.d(t,{f:function(){return o}});var r=a(2265);a(54887);var i=a(37053),n=a(57437),s=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,t)=>{let a=(0,i.Z8)(`Primitive.${t}`),s=r.forwardRef((e,r)=>{let{asChild:i,...s}=e,l=i?a:t;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,n.jsx)(l,{...s,ref:r})});return s.displayName=`Primitive.${t}`,{...e,[t]:s}},{}),l=r.forwardRef((e,t)=>(0,n.jsx)(s.label,{...e,ref:t,onMouseDown:t=>{var a;t.target.closest("button, input, select, textarea")||(null===(a=e.onMouseDown)||void 0===a||a.call(e,t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));l.displayName="Label";var o=l},5485:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(96471).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},25361:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(96471).Z)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},53459:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(96471).Z)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},94402:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(96471).Z)("ShieldAlert",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]])}},function(e){e.O(0,[4358,9990,6137,1211,2972,3288,2971,2117,1744],function(){return e(e.s=36374)}),_N_E=e.O()}]);