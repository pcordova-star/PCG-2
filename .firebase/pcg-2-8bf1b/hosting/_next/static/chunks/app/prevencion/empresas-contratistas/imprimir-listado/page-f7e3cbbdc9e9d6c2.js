(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4522],{28428:function(e,r,a){Promise.resolve().then(a.bind(a,42674))},42674:function(e,r,a){"use strict";a.r(r),a.d(r,{default:function(){return b}});var t=a(57437),n=a(29),s=a.n(n),o=a(2265),c=a(99376),i=a(12381),d=a(33804),l=a(69174),f=a(99764),u=a(5978),x=a(93448);function m(e){let{estado:r}=e;return(0,t.jsx)(l.C,{variant:"outline",className:(0,x.cn)({POR_EVALUAR:"bg-gray-100 text-gray-800 border-gray-300",APROBADA:"bg-green-100 text-green-800 border-green-300",APROBADA_CON_OBSERVACIONES:"bg-yellow-100 text-yellow-800 border-yellow-300",RECHAZADA:"bg-red-100 text-red-800 border-red-300"}[r]||"bg-gray-100","font-semibold"),children:{POR_EVALUAR:"Por Evaluar",APROBADA:"Aprobada",APROBADA_CON_OBSERVACIONES:"Con Observaciones",RECHAZADA:"Rechazada"}[r]})}function p(){var e;let r=(0,c.useSearchParams)(),a=r.get("obraId"),n=r.get("estado"),[l,x]=(0,o.useState)(null),[p,b]=(0,o.useState)([]),[h,g]=(0,o.useState)(!0),[j,v]=(0,o.useState)(null);return((0,o.useEffect)(()=>{if(!a){v("No se especific\xf3 una obra para el reporte."),g(!1);return}(async()=>{g(!0),v(null);try{let e=(0,u.JU)(f.N$,"obras",a),r=await (0,u.QT)(e);if(r.exists())x({id:r.id,nombreFaena:r.data().nombreFaena});else throw Error("La obra especificada no fue encontrada.");let t=(0,u.hJ)(f.N$,"empresasContratistas"),s=[(0,u.ar)("obraId","==",a),(0,u.Xo)("razonSocial","asc")];n&&"TODOS"!==n&&s.push((0,u.ar)("estadoEvaluacion","==",n));let o=(0,u.IO)(t,...s),c=(await (0,u.PL)(o)).docs.map(e=>({id:e.id,...e.data()}));b(c)}catch(e){console.error("Error al generar el listado:",e),v(e instanceof Error?e.message:"Un error ocurri\xf3 al cargar los datos.")}finally{g(!1)}})()},[a,n]),(0,o.useEffect)(()=>{h||j||!(p.length>0)||setTimeout(()=>window.print(),500)},[h,j,p]),h)?(0,t.jsx)("div",{className:"p-8 text-center",children:"Generando listado..."}):j?(0,t.jsx)("div",{className:"p-8 text-center text-red-500",children:j}):(0,t.jsxs)("div",{className:"jsx-68fcf6a9a83c6cf5 bg-white min-h-screen p-4 sm:p-8 print:p-0",children:[(0,t.jsx)(s(),{id:"68fcf6a9a83c6cf5",children:"@media print{body{background-color:#fff;color:#000}.print-hidden{display:none!important}.printable-area{-webkit-box-shadow:none!important;-moz-box-shadow:none!important;box-shadow:none!important;border:none!important;padding:0!important}}@page{size:A4 landscape;margin:20mm}"}),(0,t.jsxs)("div",{className:"jsx-68fcf6a9a83c6cf5 max-w-7xl mx-auto",children:[(0,t.jsxs)("div",{className:"jsx-68fcf6a9a83c6cf5 flex justify-between items-center mb-6 print-hidden",children:[(0,t.jsx)("h1",{className:"jsx-68fcf6a9a83c6cf5 text-xl font-bold",children:"Vista Previa de Listado de Empresas"}),(0,t.jsxs)("div",{className:"jsx-68fcf6a9a83c6cf5 flex gap-2",children:[(0,t.jsx)(i.z,{variant:"outline",onClick:()=>window.history.back(),children:"Volver"}),(0,t.jsx)(i.z,{onClick:()=>window.print(),children:"Imprimir / Guardar PDF"})]})]}),(0,t.jsxs)("div",{className:"jsx-68fcf6a9a83c6cf5 printable-area p-8 border rounded-lg bg-card text-card-foreground shadow-md text-sm",children:[(0,t.jsx)("header",{className:"jsx-68fcf6a9a83c6cf5 mb-8",children:(0,t.jsxs)("div",{className:"jsx-68fcf6a9a83c6cf5 flex justify-between items-start border-b pb-4",children:[(0,t.jsxs)("div",{className:"jsx-68fcf6a9a83c6cf5",children:[(0,t.jsx)("h2",{className:"jsx-68fcf6a9a83c6cf5 text-2xl font-bold text-primary",children:"PCG 2.0"}),(0,t.jsx)("p",{className:"jsx-68fcf6a9a83c6cf5 text-muted-foreground",children:"Reporte de Empresas Contratistas DS44"})]}),(0,t.jsxs)("div",{className:"jsx-68fcf6a9a83c6cf5 text-right",children:[(0,t.jsxs)("p",{className:"jsx-68fcf6a9a83c6cf5",children:[(0,t.jsx)("strong",{className:"jsx-68fcf6a9a83c6cf5 font-semibold",children:"Obra:"})," ",null!==(e=null==l?void 0:l.nombreFaena)&&void 0!==e?e:"N/A"]}),(0,t.jsxs)("p",{className:"jsx-68fcf6a9a83c6cf5",children:[(0,t.jsx)("strong",{className:"jsx-68fcf6a9a83c6cf5 font-semibold",children:"Fecha Reporte:"})," ",new Date().toLocaleDateString("es-CL")]}),(0,t.jsxs)("p",{className:"jsx-68fcf6a9a83c6cf5",children:[(0,t.jsx)("strong",{className:"jsx-68fcf6a9a83c6cf5 font-semibold",children:"Filtro Estado:"})," ","TODOS"===n?"Todos":n]})]})]})}),(0,t.jsx)("main",{className:"jsx-68fcf6a9a83c6cf5",children:(0,t.jsxs)(d.iA,{children:[(0,t.jsx)(d.xD,{children:(0,t.jsxs)(d.SC,{children:[(0,t.jsx)(d.ss,{children:"Raz\xf3n Social / RUT"}),(0,t.jsx)(d.ss,{children:"Estado"}),(0,t.jsx)(d.ss,{children:"Docs OK"}),(0,t.jsx)(d.ss,{children:"Evaluador"}),(0,t.jsx)(d.ss,{children:"Fecha Evaluaci\xf3n"})]})}),(0,t.jsx)(d.RM,{children:0===p.length?(0,t.jsx)(d.SC,{children:(0,t.jsx)(d.pj,{colSpan:5,className:"text-center h-24",children:"No hay empresas que coincidan con los filtros para este reporte."})}):p.map(e=>(0,t.jsxs)(d.SC,{children:[(0,t.jsxs)(d.pj,{children:[(0,t.jsx)("div",{className:"jsx-68fcf6a9a83c6cf5 font-medium",children:e.razonSocial}),(0,t.jsx)("div",{className:"jsx-68fcf6a9a83c6cf5 text-xs text-muted-foreground",children:e.rut})]}),(0,t.jsx)(d.pj,{children:(0,t.jsx)(m,{estado:e.estadoEvaluacion})}),(0,t.jsxs)(d.pj,{className:"font-semibold",children:[[e.contratoMarco,e.certificadoMutual,e.certificadoCotizaciones,e.padronTrabajadores,e.reglamentoInterno,e.matrizRiesgos,e.procedimientosTrabajoSeguro,e.programaTrabajo,e.planEmergenciaPropio,e.registroCapacitacionInterna,e.actaReunionInicial].filter(Boolean).length," / 11"]}),(0,t.jsx)(d.pj,{children:e.evaluador}),(0,t.jsx)(d.pj,{children:e.fechaEvaluacion})]},e.id))})]})})]})]})]})}function b(){return(0,t.jsx)(o.Suspense,{fallback:(0,t.jsx)("div",{className:"p-8 text-center",children:"Cargando..."}),children:(0,t.jsx)(p,{})})}},69174:function(e,r,a){"use strict";a.d(r,{C:function(){return c}});var t=a(57437);a(2265);var n=a(90535),s=a(93448);let o=(0,n.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function c(e){let{className:r,variant:a,...n}=e;return(0,t.jsx)("div",{className:(0,s.cn)(o({variant:a}),r),...n})}},12381:function(e,r,a){"use strict";a.d(r,{d:function(){return i},z:function(){return d}});var t=a(57437),n=a(2265),s=a(37053),o=a(90535),c=a(93448);let i=(0,o.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=n.forwardRef((e,r)=>{let{className:a,variant:n,size:o,asChild:d=!1,...l}=e,f=d?s.g7:"button";return(0,t.jsx)(f,{className:(0,c.cn)(i({variant:n,size:o,className:a})),ref:r,...l})});d.displayName="Button"},33804:function(e,r,a){"use strict";a.d(r,{RM:function(){return i},SC:function(){return d},iA:function(){return o},pj:function(){return f},ss:function(){return l},xD:function(){return c}});var t=a(57437),n=a(2265),s=a(93448);let o=n.forwardRef((e,r)=>{let{className:a,...n}=e;return(0,t.jsx)("div",{className:"relative w-full overflow-auto",children:(0,t.jsx)("table",{ref:r,className:(0,s.cn)("w-full caption-bottom text-sm",a),...n})})});o.displayName="Table";let c=n.forwardRef((e,r)=>{let{className:a,...n}=e;return(0,t.jsx)("thead",{ref:r,className:(0,s.cn)("[&_tr]:border-b",a),...n})});c.displayName="TableHeader";let i=n.forwardRef((e,r)=>{let{className:a,...n}=e;return(0,t.jsx)("tbody",{ref:r,className:(0,s.cn)("[&_tr:last-child]:border-0",a),...n})});i.displayName="TableBody",n.forwardRef((e,r)=>{let{className:a,...n}=e;return(0,t.jsx)("tfoot",{ref:r,className:(0,s.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",a),...n})}).displayName="TableFooter";let d=n.forwardRef((e,r)=>{let{className:a,...n}=e;return(0,t.jsx)("tr",{ref:r,className:(0,s.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",a),...n})});d.displayName="TableRow";let l=n.forwardRef((e,r)=>{let{className:a,...n}=e;return(0,t.jsx)("th",{ref:r,className:(0,s.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",a),...n})});l.displayName="TableHead";let f=n.forwardRef((e,r)=>{let{className:a,...n}=e;return(0,t.jsx)("td",{ref:r,className:(0,s.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",a),...n})});f.displayName="TableCell",n.forwardRef((e,r)=>{let{className:a,...n}=e;return(0,t.jsx)("caption",{ref:r,className:(0,s.cn)("mt-4 text-sm text-muted-foreground",a),...n})}).displayName="TableCaption"},99764:function(e,r,a){"use strict";let t,n,s,o,c;a.d(r,{IG:function(){return o},N$:function(){return s},lX:function(){return n},x2:function(){return c}});var i=a(738),d=a(43301),l=a(5978),f=a(60062),u=a(13491);let x={apiKey:"AIzaSyBfMp_dH9XhFSXEeMxY-Cdy8MDRIgWrxR0",authDomain:"pcg-2-8bf1b.firebaseapp.com",projectId:"pcg-2-8bf1b",storageBucket:"pcg-2-8bf1b.appspot.com",messagingSenderId:"1073834543546",appId:"1:1073834543546:web:2f85a4a8350280f8589737"};for(let e in x)if(Object.prototype.hasOwnProperty.call(x,e)&&!x[e]){let r=e.replace(/([A-Z])/g,"_$1").toUpperCase(),a="NEXT_PUBLIC_FIREBASE_".concat(r);throw Error("Error de configuraci\xf3n del cliente: La variable de entorno Firebase '".concat(a,"' no est\xe1 definida o est\xe1 vac\xeda. ")+"Aseg\xfarate de que est\xe9 configurada en tu archivo .env.local o en las variables de entorno de producci\xf3n.")}t=(0,i.C6)().length?(0,i.Mq)():(0,i.ZF)(x),n=(0,d.v0)(t),s=(0,l.ad)(t),o=(0,f.cF)(t),c=(0,u.$C)(t,"us-central1")},93448:function(e,r,a){"use strict";a.d(r,{cn:function(){return s}});var t=a(61994),n=a(53335);function s(){for(var e=arguments.length,r=Array(e),a=0;a<e;a++)r[a]=arguments[a];return(0,n.m6)((0,t.W)(r))}}},function(e){e.O(0,[4358,9990,6137,1211,2203,2971,2117,1744],function(){return e(e.s=28428)}),_N_E=e.O()}]);