(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1415,2087,5284],{62498:function(e,t,a){Promise.resolve().then(a.bind(a,66860))},27648:function(e,t,a){"use strict";a.d(t,{default:function(){return s.a}});var r=a(72972),s=a.n(r)},66860:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return I}});var r=a(57437),s=a(2265),n=a(12381),l=a(79820),i=a(15291),o=a(33804),d=a(75060),c=a(69174),u=a(5978),f=a(99764),m=a(27648),x=a(5485),p=a(54233),h=a(87928),g=a(12032),j=a(81475),b=a(5255),y=a(46271),N=a(99376),v=a(47625),w=a(93765),C=a(83046),R=a(97059),z=a(62994),A=a(25311),T=(0,w.z)({chartName:"BarChart",GraphicalChild:C.$,defaultTooltipEventType:"axis",validateTooltipEventTypes:["axis","item"],axisComponents:[{axisType:"xAxis",AxisComp:R.K},{axisType:"yAxis",AxisComp:z.B}],formatAxisMap:A.t9}),k=a(8147),S=a(71245),_=a(30767),E=a(23340);function Z(e){let{estado:t}=e;return(0,r.jsx)(c.C,{variant:"outline",className:{abierto:"bg-yellow-100 text-yellow-800 border-yellow-300",en_progreso:"bg-blue-100 text-blue-800 border-blue-300",cerrado:"bg-green-100 text-green-800 border-green-300"}[t],children:t.replace("_"," ")})}function O(e){let{criticidad:t}=e;return(0,r.jsx)(c.C,{variant:"outline",className:{baja:"bg-green-100 text-green-800 border-green-300",media:"bg-yellow-100 text-yellow-800 border-yellow-300",alta:"bg-red-100 text-red-800 border-red-300"}[t],children:t})}function I(){let[e,t]=(0,s.useState)([]),[a,c]=(0,s.useState)(""),[w,A]=(0,s.useState)([]),[I,M]=(0,s.useState)(!0),D=(0,N.useRouter)(),{companyId:H,role:P}=(0,S.a)(),{toast:$}=(0,E.pm)();(0,s.useEffect)(()=>{(H||"superadmin"===P)&&(async()=>{let e;e="superadmin"===P?(0,u.IO)((0,u.hJ)(f.N$,"obras"),(0,u.Xo)("nombreFaena")):(0,u.IO)((0,u.hJ)(f.N$,"obras"),(0,u.ar)("empresaId","==",H),(0,u.Xo)("nombreFaena"));let a=(await (0,u.PL)(e)).docs.map(e=>({id:e.id,...e.data()}));t(a),a.length>0&&c(a[0].id)})()},[H,P]),(0,s.useEffect)(()=>{if(!a){A([]),M(!1);return}M(!0);let e=(0,u.IO)((0,u.hJ)(f.N$,"hallazgos"),(0,u.ar)("obraId","==",a),(0,u.Xo)("createdAt","desc")),t=(0,u.cf)(e,e=>{A(e.docs.map(e=>({id:e.id,...e.data()}))),M(!1)});return()=>t()},[a]);let B=async e=>{try{let t=(0,u.JU)(f.N$,"hallazgos",e);await (0,u.r7)(t,{estado:"cerrado"}),$({title:"Hallazgo cerrado",description:"El estado del hallazgo ha sido actualizado."})}catch(e){console.error("Error cerrando hallazgo:",e),$({variant:"destructive",title:"Error",description:"No se pudo cerrar el hallazgo."})}},Y=(0,s.useMemo)(()=>({total:w.length,abiertos:w.filter(e=>"abierto"===e.estado).length,enProgreso:w.filter(e=>"en_progreso"===e.estado).length,cerrados:w.filter(e=>"cerrado"===e.estado).length,criticos:w.filter(e=>"alta"===e.criticidad).length}),[w]),F=(0,s.useMemo)(()=>{let e={};return w.forEach(t=>{e[t.tipoRiesgo]||(e[t.tipoRiesgo]={total:0,abiertos:0,cerrados:0}),e[t.tipoRiesgo].total++,"abierto"===t.estado||"en_progreso"===t.estado?e[t.tipoRiesgo].abiertos++:"cerrado"===t.estado&&e[t.tipoRiesgo].cerrados++}),Object.entries(e).map(e=>{let[t,a]=e;return{tipo:t,...a}})},[w]),q=(0,s.useMemo)(()=>[{name:"Baja",count:w.filter(e=>"baja"===e.criticidad).length,fill:"#22c55e"},{name:"Media",count:w.filter(e=>"media"===e.criticidad).length,fill:"#facc15"},{name:"Alta",count:w.filter(e=>"alta"===e.criticidad).length,fill:"#ef4444"}],[w]);return(0,r.jsxs)("div",{className:"space-y-8",children:[(0,r.jsxs)("header",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)(n.z,{variant:"outline",size:"icon",onClick:()=>D.push("/prevencion"),children:(0,r.jsx)(x.Z,{className:"h-4 w-4"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"Dashboard de Hallazgos"}),(0,r.jsx)("p",{className:"text-muted-foreground",children:"An\xe1lisis y seguimiento de los hallazgos de seguridad en terreno."})]})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsxs)(n.z,{onClick:()=>D.push("/prevencion/hallazgos/crear"),children:[(0,r.jsx)(p.Z,{className:"mr-2 h-4 w-4"}),"Nuevo Hallazgo"]}),(0,r.jsx)(n.z,{variant:"outline",onClick:()=>D.push("/prevencion/hallazgos/equipo-responsable"),children:"Configurar Equipo"})]})]}),(0,r.jsxs)(l.Zb,{children:[(0,r.jsx)(l.Ol,{children:(0,r.jsx)(l.ll,{children:"Selecci\xf3n de Obra"})}),(0,r.jsx)(l.aY,{children:(0,r.jsxs)("div",{className:"max-w-sm",children:[(0,r.jsx)(d._,{htmlFor:"obra-select",children:"Obra Activa"}),(0,r.jsxs)(i.Ph,{value:a,onValueChange:c,children:[(0,r.jsx)(i.i4,{id:"obra-select",children:(0,r.jsx)(i.ki,{placeholder:"Seleccionar obra..."})}),(0,r.jsx)(i.Bw,{children:e.map(e=>(0,r.jsx)(i.Ql,{value:e.id,children:e.nombreFaena},e.id))})]})]})})]}),(0,r.jsxs)("section",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-5",children:[(0,r.jsxs)(l.Zb,{children:[(0,r.jsxs)(l.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,r.jsx)(l.ll,{className:"text-sm font-medium",children:"Total Hallazgos"}),(0,r.jsx)(h.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,r.jsxs)(l.aY,{children:[(0,r.jsx)("div",{className:"text-4xl font-bold",children:I?"...":Y.total}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Registros en la obra seleccionada"})]})]}),(0,r.jsxs)(l.Zb,{children:[(0,r.jsxs)(l.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,r.jsx)(l.ll,{className:"text-sm font-medium",children:"Abiertos"}),(0,r.jsx)(g.Z,{className:"h-4 w-4 text-yellow-500"})]}),(0,r.jsxs)(l.aY,{children:[(0,r.jsx)("div",{className:"text-4xl font-bold",children:I?"...":Y.abiertos}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Pendientes de gesti\xf3n"})]})]}),(0,r.jsxs)(l.Zb,{children:[(0,r.jsxs)(l.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,r.jsx)(l.ll,{className:"text-sm font-medium",children:"En Progreso"}),(0,r.jsx)(j.Z,{className:"h-4 w-4 text-blue-500"})]}),(0,r.jsxs)(l.aY,{children:[(0,r.jsx)("div",{className:"text-4xl font-bold",children:I?"...":Y.enProgreso}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Con plan de acci\xf3n iniciado"})]})]}),(0,r.jsxs)(l.Zb,{children:[(0,r.jsxs)(l.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,r.jsx)(l.ll,{className:"text-sm font-medium",children:"Cerrados"}),(0,r.jsx)(b.Z,{className:"h-4 w-4 text-green-500"})]}),(0,r.jsxs)(l.aY,{children:[(0,r.jsx)("div",{className:"text-4xl font-bold",children:I?"...":Y.cerrados}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Gestionados y verificados"})]})]}),(0,r.jsxs)(l.Zb,{className:"border-red-500 bg-red-50",children:[(0,r.jsxs)(l.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,r.jsx)(l.ll,{className:"text-sm font-medium text-red-800",children:"Cr\xedticos (Nivel Alto)"}),(0,r.jsx)(y.Z,{className:"h-4 w-4 text-red-500"})]}),(0,r.jsxs)(l.aY,{children:[(0,r.jsx)("div",{className:"text-4xl font-bold text-red-900",children:I?"...":Y.criticos}),(0,r.jsx)("p",{className:"text-xs text-red-700",children:"Requieren acci\xf3n inmediata"})]})]})]}),(0,r.jsxs)("div",{className:"grid gap-8 md:grid-cols-2 lg:grid-cols-3 items-start",children:[(0,r.jsxs)(l.Zb,{className:"lg:col-span-1",children:[(0,r.jsx)(l.Ol,{children:(0,r.jsx)(l.ll,{children:"Hallazgos por Criticidad"})}),(0,r.jsx)(l.aY,{children:I?(0,r.jsx)("p",{children:"Cargando..."}):(0,r.jsx)(v.h,{width:"100%",height:250,children:(0,r.jsxs)(T,{data:q,layout:"vertical",margin:{left:10},children:[(0,r.jsx)(R.K,{type:"number",hide:!0}),(0,r.jsx)(z.B,{type:"category",dataKey:"name",width:60,tick:{fontSize:12}}),(0,r.jsx)(k.u,{}),(0,r.jsx)(C.$,{dataKey:"count",name:"Hallazgos"})]})})})]}),(0,r.jsxs)(l.Zb,{className:"lg:col-span-2",children:[(0,r.jsx)(l.Ol,{children:(0,r.jsx)(l.ll,{children:"Hallazgos por Tipo de Riesgo"})}),(0,r.jsx)(l.aY,{children:I?(0,r.jsx)("p",{children:"Cargando..."}):(0,r.jsxs)(o.iA,{children:[(0,r.jsx)(o.xD,{children:(0,r.jsxs)(o.SC,{children:[(0,r.jsx)(o.ss,{children:"Tipo de Riesgo"}),(0,r.jsx)(o.ss,{className:"text-center",children:"Total"}),(0,r.jsx)(o.ss,{className:"text-center",children:"Abiertos"}),(0,r.jsx)(o.ss,{className:"text-center",children:"Cerrados"})]})}),(0,r.jsx)(o.RM,{children:F.map(e=>(0,r.jsxs)(o.SC,{children:[(0,r.jsx)(o.pj,{className:"font-medium",children:e.tipo}),(0,r.jsx)(o.pj,{className:"text-center font-bold",children:e.total}),(0,r.jsx)(o.pj,{className:"text-center text-yellow-600",children:e.abiertos}),(0,r.jsx)(o.pj,{className:"text-center text-green-600",children:e.cerrados})]},e.tipo))})]})})]})]}),(0,r.jsxs)(l.Zb,{children:[(0,r.jsxs)(l.Ol,{children:[(0,r.jsx)(l.ll,{children:"Listado Completo de Hallazgos"}),(0,r.jsx)(l.SZ,{children:"Aqu\xed puedes ver y gestionar todos los hallazgos registrados para la obra seleccionada."})]}),(0,r.jsx)(l.aY,{children:I?(0,r.jsx)("p",{children:"Cargando..."}):0===w.length?(0,r.jsx)("p",{className:"text-muted-foreground text-center py-4",children:"No hay hallazgos registrados para esta obra."}):(0,r.jsxs)(o.iA,{children:[(0,r.jsx)(o.xD,{children:(0,r.jsxs)(o.SC,{children:[(0,r.jsx)(o.ss,{children:"Fecha"}),(0,r.jsx)(o.ss,{children:"Tipo de Riesgo"}),(0,r.jsx)(o.ss,{children:"Criticidad"}),(0,r.jsx)(o.ss,{children:"Responsable"}),(0,r.jsx)(o.ss,{children:"Estado"}),(0,r.jsx)(o.ss,{className:"text-right",children:"Acciones"})]})}),(0,r.jsx)(o.RM,{children:w.map(e=>(0,r.jsxs)(o.SC,{children:[(0,r.jsx)(o.pj,{children:e.createdAt.toDate().toLocaleDateString("es-CL")}),(0,r.jsx)(o.pj,{children:e.tipoRiesgo}),(0,r.jsx)(o.pj,{children:(0,r.jsx)(O,{criticidad:e.criticidad})}),(0,r.jsx)(o.pj,{children:e.responsableNombre||"No asignado"}),(0,r.jsx)(o.pj,{children:(0,r.jsx)(Z,{estado:e.estado})}),(0,r.jsx)(o.pj,{className:"text-right",children:(0,r.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,r.jsx)(n.z,{variant:"outline",size:"sm",asChild:!0,children:(0,r.jsx)(m.default,{href:"/prevencion/hallazgos/detalle/".concat(e.id),children:"Ver Detalle"})}),"cerrado"!==e.estado&&(0,r.jsxs)(_.aR,{children:[(0,r.jsx)(_.vW,{asChild:!0,children:(0,r.jsx)(n.z,{variant:"secondary",size:"sm",children:"Cerrar"})}),(0,r.jsxs)(_._T,{children:[(0,r.jsxs)(_.fY,{children:[(0,r.jsx)(_.f$,{children:"\xbfConfirmar Cierre de Hallazgo?"}),(0,r.jsx)(_.yT,{children:'Esta acci\xf3n marcar\xe1 el hallazgo como "cerrado". Aseg\xfarate de que las acciones correctivas hayan sido implementadas y verificadas.'})]}),(0,r.jsxs)(_.xo,{children:[(0,r.jsx)(_.le,{children:"Cancelar"}),(0,r.jsx)(_.OL,{onClick:()=>B(e.id),children:"Confirmar Cierre"})]})]})]})]})})]},e.id))})]})})]})]})}},30767:function(e,t,a){"use strict";a.d(t,{OL:function(){return g},_T:function(){return f},aR:function(){return o},f$:function(){return p},fY:function(){return m},le:function(){return j},vW:function(){return d},xo:function(){return x},yT:function(){return h}});var r=a(57437),s=a(2265),n=a(7880),l=a(93448),i=a(12381);let o=n.fC,d=n.xz,c=n.h_,u=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(n.aV,{className:(0,l.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...s,ref:t})});u.displayName=n.aV.displayName;let f=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsxs)(c,{children:[(0,r.jsx)(u,{}),(0,r.jsx)(n.VY,{ref:t,className:(0,l.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...s})]})});f.displayName=n.VY.displayName;let m=e=>{let{className:t,...a}=e;return(0,r.jsx)("div",{className:(0,l.cn)("flex flex-col space-y-2 text-center sm:text-left",t),...a})};m.displayName="AlertDialogHeader";let x=e=>{let{className:t,...a}=e;return(0,r.jsx)("div",{className:(0,l.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a})};x.displayName="AlertDialogFooter";let p=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(n.Dx,{ref:t,className:(0,l.cn)("text-lg font-semibold",a),...s})});p.displayName=n.Dx.displayName;let h=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(n.dk,{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",a),...s})});h.displayName=n.dk.displayName;let g=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(n.aU,{ref:t,className:(0,l.cn)((0,i.d)(),a),...s})});g.displayName=n.aU.displayName;let j=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(n.$j,{ref:t,className:(0,l.cn)((0,i.d)({variant:"outline"}),"mt-2 sm:mt-0",a),...s})});j.displayName=n.$j.displayName},69174:function(e,t,a){"use strict";a.d(t,{C:function(){return i}});var r=a(57437);a(2265);var s=a(90535),n=a(93448);let l=(0,s.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i(e){let{className:t,variant:a,...s}=e;return(0,r.jsx)("div",{className:(0,n.cn)(l({variant:a}),t),...s})}},12381:function(e,t,a){"use strict";a.d(t,{d:function(){return o},z:function(){return d}});var r=a(57437),s=a(2265),n=a(37053),l=a(90535),i=a(93448);let o=(0,l.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=s.forwardRef((e,t)=>{let{className:a,variant:s,size:l,asChild:d=!1,...c}=e,u=d?n.g7:"button";return(0,r.jsx)(u,{className:(0,i.cn)(o({variant:s,size:l,className:a})),ref:t,...c})});d.displayName="Button"},79820:function(e,t,a){"use strict";a.d(t,{Ol:function(){return i},SZ:function(){return d},Zb:function(){return l},aY:function(){return c},eW:function(){return u},ll:function(){return o}});var r=a(57437),s=a(2265),n=a(93448);let l=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...s})});l.displayName="Card";let i=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",a),...s})});i.displayName="CardHeader";let o=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",a),...s})});o.displayName="CardTitle";let d=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",a),...s})});d.displayName="CardDescription";let c=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("p-6 pt-0",a),...s})});c.displayName="CardContent";let u=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("flex items-center p-6 pt-0",a),...s})});u.displayName="CardFooter"},75060:function(e,t,a){"use strict";a.d(t,{_:function(){return d}});var r=a(57437),s=a(2265),n=a(370),l=a(90535),i=a(93448);let o=(0,l.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(n.f,{ref:t,className:(0,i.cn)(o(),a),...s})});d.displayName=n.f.displayName},15291:function(e,t,a){"use strict";a.d(t,{Bw:function(){return p},Ph:function(){return c},Ql:function(){return h},i4:function(){return f},ki:function(){return u}});var r=a(57437),s=a(2265),n=a(74797),l=a(3289),i=a(47969),o=a(59559),d=a(93448);let c=n.fC;n.ZA;let u=n.B4,f=s.forwardRef((e,t)=>{let{className:a,children:s,...i}=e;return(0,r.jsxs)(n.xz,{ref:t,className:(0,d.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",a),...i,children:[s,(0,r.jsx)(n.JO,{asChild:!0,children:(0,r.jsx)(l.Z,{className:"h-4 w-4 opacity-50"})})]})});f.displayName=n.xz.displayName;let m=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(n.u_,{ref:t,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",a),...s,children:(0,r.jsx)(i.Z,{className:"h-4 w-4"})})});m.displayName=n.u_.displayName;let x=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(n.$G,{ref:t,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",a),...s,children:(0,r.jsx)(l.Z,{className:"h-4 w-4"})})});x.displayName=n.$G.displayName;let p=s.forwardRef((e,t)=>{let{className:a,children:s,position:l="popper",...i}=e;return(0,r.jsx)(n.h_,{children:(0,r.jsxs)(n.VY,{ref:t,className:(0,d.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===l&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:l,...i,children:[(0,r.jsx)(m,{}),(0,r.jsx)(n.l_,{className:(0,d.cn)("p-1","popper"===l&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s}),(0,r.jsx)(x,{})]})})});p.displayName=n.VY.displayName,s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(n.__,{ref:t,className:(0,d.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",a),...s})}).displayName=n.__.displayName;let h=s.forwardRef((e,t)=>{let{className:a,children:s,...l}=e;return(0,r.jsxs)(n.ck,{ref:t,className:(0,d.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...l,children:[(0,r.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,r.jsx)(n.wU,{children:(0,r.jsx)(o.Z,{className:"h-4 w-4"})})}),(0,r.jsx)(n.eT,{children:s})]})});h.displayName=n.ck.displayName,s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(n.Z0,{ref:t,className:(0,d.cn)("-mx-1 my-1 h-px bg-muted",a),...s})}).displayName=n.Z0.displayName},33804:function(e,t,a){"use strict";a.d(t,{RM:function(){return o},SC:function(){return d},iA:function(){return l},pj:function(){return u},ss:function(){return c},xD:function(){return i}});var r=a(57437),s=a(2265),n=a(93448);let l=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{className:"relative w-full overflow-auto",children:(0,r.jsx)("table",{ref:t,className:(0,n.cn)("w-full caption-bottom text-sm",a),...s})})});l.displayName="Table";let i=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("thead",{ref:t,className:(0,n.cn)("[&_tr]:border-b",a),...s})});i.displayName="TableHeader";let o=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("tbody",{ref:t,className:(0,n.cn)("[&_tr:last-child]:border-0",a),...s})});o.displayName="TableBody",s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("tfoot",{ref:t,className:(0,n.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",a),...s})}).displayName="TableFooter";let d=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("tr",{ref:t,className:(0,n.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",a),...s})});d.displayName="TableRow";let c=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("th",{ref:t,className:(0,n.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",a),...s})});c.displayName="TableHead";let u=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("td",{ref:t,className:(0,n.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",a),...s})});u.displayName="TableCell",s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("caption",{ref:t,className:(0,n.cn)("mt-4 text-sm text-muted-foreground",a),...s})}).displayName="TableCaption"},71245:function(e,t,a){"use strict";a.d(t,{H:function(){return f},a:function(){return m}});var r=a(57437),s=a(43301),n=a(2265),l=a(99764),i=a(99376),o=a(5978);async function d(e){var t;let a=l.N$,r=null===(t=e.email)||void 0===t?void 0:t.toLowerCase().trim();if(!r)return{role:"none",companyId:null};let s=(0,o.IO)((0,o.hJ)(a,"invitacionesUsuarios"),(0,o.ar)("email","==",r),(0,o.ar)("estado","==","pendiente_auth"),(0,o.b9)(1)),n=await (0,o.PL)(s);if(n.empty)return console.log("No hay invitaci\xf3n pendiente para ".concat(r,".")),{role:"none",companyId:null};let i=n.docs[0],d=i.data(),c=(0,o.JU)(a,"users",e.uid),u=(0,o.qs)(a);return u.set(c,{nombre:d.nombre||e.displayName,email:r,role:d.roleDeseado,empresaId:d.empresaId,activo:!0,createdAt:(0,o.Bt)(),updatedAt:(0,o.Bt)()},{merge:!0}),u.update(i.ref,{estado:"activado",uid:e.uid,activatedAt:(0,o.Bt)()}),await u.commit(),console.log("Usuario ".concat(r," activado con rol ").concat(d.roleDeseado," en empresa ").concat(d.empresaId,".")),{role:d.roleDeseado,companyId:d.empresaId}}async function c(e){}let u=(0,n.createContext)(void 0);function f(e){let{children:t}=e,[a,f]=(0,n.useState)(null),[m,x]=(0,n.useState)("none"),[p,h]=(0,n.useState)(null),[g,j]=(0,n.useState)(null),[b,y]=(0,n.useState)(!0),N=(0,i.useRouter)(),v=(0,i.usePathname)();async function w(e,t){try{await (0,s.e5)(l.lX,e,t)}catch(e){if("auth/invalid-credential"===e.code||"auth/wrong-password"===e.code||"auth/user-not-found"===e.code)throw Error("Credenciales inv\xe1lidas. Por favor, revisa tu correo y contrase\xf1a.");if("auth/too-many-requests"===e.code)throw Error("Demasiados intentos fallidos. Por seguridad, el acceso desde este dispositivo ha sido bloqueado temporalmente.");throw console.error("Error de login no manejado:",e),Error("Ocurri\xf3 un error inesperado al iniciar sesi\xf3n.")}}async function C(){try{await (0,s.w7)(l.lX),f(null),x("none"),h(null),j(null),N.push("/")}catch(e){console.error("Error al cerrar sesi\xf3n",e)}}return(0,n.useEffect)(()=>{let e=(0,s.Aj)(l.lX,async e=>{if(e){await c(e);let t=(0,o.JU)(l.N$,"users",e.uid),a=await (0,o.QT)(t),r="none",s=null,n=!1;if(a.exists()){let e=a.data();e.role&&void 0!==e.empresaId&&(r=e.role,s=e.empresaId,n=!0===e.mustChangePassword)}if("none"===r){let t=await d(e);r=t.role,s=t.companyId,n=!0}x(r),h(s),f(e);let i="/cambiar-password"===v;if(n&&!i)N.replace("/cambiar-password");else if(!n){if("none"===r)N.replace("/sin-acceso");else if(v.startsWith("/login")||"/"===v||i){let e="cliente"===r?"/cliente":"contratista"===r?"/cumplimiento/contratista":"/dashboard";N.replace(e)}}}else f(null),x("none"),h(null),j(null);y(!1)});return()=>e()},[N,v]),(0,n.useEffect)(()=>{if(p){let e=(0,o.JU)(l.N$,"companies",p),t=(0,s.Aj)(l.lX,t=>{t&&(0,o.QT)(e).then(e=>{e.exists()?j({id:e.id,...e.data()}):j(null)})});return()=>t()}j(null)},[p]),(0,r.jsx)(u.Provider,{value:{user:a,role:m,companyId:p,company:g,loading:b,login:w,logout:C},children:t})}function m(){let e=(0,n.useContext)(u);if(!e)throw Error("useAuth debe usarse dentro de un AuthProvider");return e}},23340:function(e,t,a){"use strict";a.d(t,{pm:function(){return f}});var r=a(2265);let s=0,n=new Map,l=e=>{if(n.has(e))return;let t=setTimeout(()=>{n.delete(e),c({type:"REMOVE_TOAST",toastId:e})},1e6);n.set(e,t)},i=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:a}=t;return a?l(a):e.toasts.forEach(e=>{l(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===a||void 0===a?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},o=[],d={toasts:[]};function c(e){d=i(d,e),o.forEach(e=>{e(d)})}function u(e){let{...t}=e,a=(s=(s+1)%Number.MAX_SAFE_INTEGER).toString(),r=()=>c({type:"DISMISS_TOAST",toastId:a});return c({type:"ADD_TOAST",toast:{...t,id:a,open:!0,onOpenChange:e=>{e||r()}}}),{id:a,dismiss:r,update:e=>c({type:"UPDATE_TOAST",toast:{...e,id:a}})}}function f(){let[e,t]=r.useState(d);return r.useEffect(()=>(o.push(t),()=>{let e=o.indexOf(t);e>-1&&o.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>c({type:"DISMISS_TOAST",toastId:e})}}},99764:function(e,t,a){"use strict";let r,s,n,l,i;a.d(t,{IG:function(){return l},N$:function(){return n},lX:function(){return s},x2:function(){return i}});var o=a(738),d=a(43301),c=a(5978),u=a(60062),f=a(13491);let m={apiKey:"AIzaSyBfMp_dH9XhFSXEeMxY-Cdy8MDRIgWrxR0",authDomain:"pcg-2-8bf1b.firebaseapp.com",projectId:"pcg-2-8bf1b",storageBucket:"pcg-2-8bf1b.appspot.com",messagingSenderId:"1073834543546",appId:"1:1073834543546:web:2f85a4a8350280f8589737"};for(let e in m)if(Object.prototype.hasOwnProperty.call(m,e)&&!m[e]){let t=e.replace(/([A-Z])/g,"_$1").toUpperCase(),a="NEXT_PUBLIC_FIREBASE_".concat(t);throw Error("Error de configuraci\xf3n del cliente: La variable de entorno Firebase '".concat(a,"' no est\xe1 definida o est\xe1 vac\xeda. ")+"Aseg\xfarate de que est\xe9 configurada en tu archivo .env.local o en las variables de entorno de producci\xf3n.")}r=(0,o.C6)().length?(0,o.Mq)():(0,o.ZF)(m),s=(0,d.v0)(r),n=(0,c.ad)(r),l=(0,u.cF)(r),i=(0,f.$C)(r,"us-central1")},93448:function(e,t,a){"use strict";a.d(t,{cn:function(){return n}});var r=a(61994),s=a(53335);function n(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,s.m6)((0,r.W)(t))}},5255:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(96471).Z)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},81475:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(96471).Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},87928:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(96471).Z)("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]])},46271:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(96471).Z)("Siren",[["path",{d:"M7 18v-6a5 5 0 1 1 10 0v6",key:"pcx96s"}],["path",{d:"M5 21a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-1a2 2 0 0 0-2-2H7a2 2 0 0 0-2 2z",key:"1b4s83"}],["path",{d:"M21 12h1",key:"jtio3y"}],["path",{d:"M18.5 4.5 18 5",key:"g5sp9y"}],["path",{d:"M2 12h1",key:"1uaihz"}],["path",{d:"M12 2v1",key:"11qlp1"}],["path",{d:"m4.929 4.929.707.707",key:"1i51kw"}],["path",{d:"M12 12v6",key:"3ahymv"}]])},12032:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(96471).Z)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])}},function(e){e.O(0,[4358,9990,6137,1211,2972,9759,3562,6008,9923,2550,1,4233,2971,2117,1744],function(){return e(e.s=62498)}),_N_E=e.O()}]);