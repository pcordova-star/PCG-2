(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4247],{11583:function(e,a,s){Promise.resolve().then(s.bind(s,68649))},68649:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return ep}});var i=s(57437),r=s(2265),t=s(5978),n=s(99764),l=s(99376),o=s(5485),c=s(22059),d=s(67541),u=s(87928),m=s(43728),h=s(46271),x=s(15847),p=s(69626),f=s(12381),g=s(79820),j=s(75060),v=s(15291),b=s(17168),N=s(71245),C=s(40279),y=s(23675),P=s(69174),I=s(33804),R=s(54233),w=s(74291);let _={causaNodoId:null,descripcionAccion:"",responsable:"",fechaCompromiso:"",estado:"pendiente",observaciones:""};function E(e){let{arbolCausas:a,medidas:s=[],onChange:t,readOnly:n=!1}=e,[l,o]=(0,r.useState)(!1),[c,d]=(0,r.useState)(_),u=(0,r.useMemo)(()=>a?Object.values(a.nodos):[],[a]),h=e=>{d(e||{id:crypto.randomUUID(),..._}),o(!0)},p=e=>{t(s.filter(a=>a.id!==e))};return n&&0===s.length?(0,i.jsx)("p",{className:"text-sm text-muted-foreground",children:"No hay un plan de acci\xf3n definido para esta investigaci\xf3n."}):(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsxs)("div",{className:"flex justify-between items-center",children:[(0,i.jsx)("h4",{className:"text-md font-semibold",children:"Plan de Acci\xf3n / Medidas Correctivas"}),!n&&(0,i.jsxs)(f.z,{type:"button",size:"sm",onClick:()=>h(),children:[(0,i.jsx)(R.Z,{className:"mr-2 h-4 w-4"})," Agregar Medida"]})]}),(0,i.jsxs)("div",{className:"border rounded-lg overflow-hidden",children:[(0,i.jsxs)(I.iA,{children:[(0,i.jsx)(I.xD,{children:(0,i.jsxs)(I.SC,{children:[(0,i.jsx)(I.ss,{children:"Acci\xf3n"}),a&&(0,i.jsx)(I.ss,{children:"Causa Asociada"}),(0,i.jsx)(I.ss,{children:"Responsable"}),(0,i.jsx)(I.ss,{children:"Fecha L\xedmite"}),(0,i.jsx)(I.ss,{children:"Estado"}),!n&&(0,i.jsx)(I.ss,{className:"text-right",children:"Acciones"})]})}),(0,i.jsx)(I.RM,{children:s.map(e=>{var s;return(0,i.jsxs)(I.SC,{children:[(0,i.jsx)(I.pj,{className:"text-xs",children:e.descripcionAccion}),a&&(0,i.jsx)(I.pj,{className:"text-xs text-muted-foreground",children:(null===(s=u.find(a=>a.id===e.causaNodoId))||void 0===s?void 0:s.descripcionCorta)||"General"}),(0,i.jsx)(I.pj,{className:"text-xs",children:e.responsable}),(0,i.jsx)(I.pj,{className:"text-xs",children:e.fechaCompromiso}),(0,i.jsx)(I.pj,{children:(0,i.jsx)(P.C,{variant:"outline",children:e.estado})}),!n&&(0,i.jsxs)(I.pj,{className:"text-right",children:[(0,i.jsx)(f.z,{variant:"ghost",size:"icon",onClick:()=>h(e),children:(0,i.jsx)(x.Z,{className:"h-4 w-4"})}),(0,i.jsx)(f.z,{variant:"ghost",size:"icon",onClick:()=>p(e.id),children:(0,i.jsx)(m.Z,{className:"h-4 w-4 text-destructive"})})]})]},e.id)})})]}),0===s.length&&(0,i.jsx)("p",{className:"text-center text-sm text-muted-foreground p-4",children:"No se han agregado medidas."})]}),!n&&(0,i.jsx)(w.Vq,{open:l,onOpenChange:o,children:(0,i.jsxs)(w.cZ,{children:[(0,i.jsx)(w.fK,{children:(0,i.jsx)(w.$N,{children:c.id&&s.some(e=>e.id===c.id)?"Editar Medida":"Nueva Medida Correctiva"})}),(0,i.jsxs)("div",{className:"space-y-4 py-4",children:[a&&(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(j._,{children:"Asociar a Causa del \xc1rbol (Opcional)"}),(0,i.jsxs)(v.Ph,{value:c.causaNodoId||"",onValueChange:e=>d(a=>({...a,causaNodoId:e})),children:[(0,i.jsx)(v.i4,{children:(0,i.jsx)(v.ki,{placeholder:"Seleccionar causa..."})}),(0,i.jsxs)(v.Bw,{children:[(0,i.jsx)(v.Ql,{value:"",children:"General / No asociada"}),u.map(e=>(0,i.jsx)(v.Ql,{value:e.id,children:e.descripcionCorta},e.id))]})]})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(j._,{children:"Descripci\xf3n de la Acci\xf3n"}),(0,i.jsx)(C.I,{value:c.descripcionAccion,onChange:e=>d(a=>({...a,descripcionAccion:e.target.value}))})]}),(0,i.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(j._,{children:"Responsable"}),(0,i.jsx)(C.I,{value:c.responsable,onChange:e=>d(a=>({...a,responsable:e.target.value}))})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(j._,{children:"Fecha Compromiso"}),(0,i.jsx)(C.I,{type:"date",value:c.fechaCompromiso,onChange:e=>d(a=>({...a,fechaCompromiso:e.target.value}))})]})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(j._,{children:"Estado"}),(0,i.jsxs)(v.Ph,{value:c.estado,onValueChange:e=>d(a=>({...a,estado:e})),children:[(0,i.jsx)(v.i4,{children:(0,i.jsx)(v.ki,{})}),(0,i.jsxs)(v.Bw,{children:[(0,i.jsx)(v.Ql,{value:"pendiente",children:"Pendiente"}),(0,i.jsx)(v.Ql,{value:"en_proceso",children:"En Proceso"}),(0,i.jsx)(v.Ql,{value:"cerrado",children:"Cerrado"})]})]})]})]}),(0,i.jsxs)(w.cN,{children:[(0,i.jsx)(f.z,{variant:"ghost",onClick:()=>o(!1),children:"Cancelar"}),(0,i.jsx)(f.z,{onClick:()=>{if(!c||!c.id)return;let e=s.findIndex(e=>e.id===c.id);if(e>-1){let a=[...s];a[e]=c,t(a)}else t([...s,c]);o(!1)},children:"Guardar Medida"})]})]})})]})}var S=s(30767),A=s(23340);let z={fecha:new Date().toISOString().slice(0,10),lugar:"",tipoIncidente:"Casi accidente",gravedad:"Leve",descripcionHecho:"",actoInseguro:"",condicionInsegura:"",causasInmediatas:"",causasBasicas:"",analisisIshikawa:"",analisis5Porques:"",medidasCorrectivas:"",responsableSeguimiento:"",plazoCierre:"",estadoCierre:"Abierto",metodoAnalisis:"ishikawa_5p",medidasCorrectivasDetalladas:[]};function D(e){let{obraId:a,investigaciones:s,loading:l,onUpdate:o}=e,[c,d]=(0,r.useState)(z),[u,h]=(0,r.useState)(null),{toast:x}=(0,A.pm)(),p=(e,a)=>{d(s=>({...s,[e]:a}))},b=async e=>{if(e.preventDefault(),!a){h("Seleccione una obra.");return}h(null);try{await (0,t.ET)((0,t.hJ)(n.N$,"investigacionesIncidentes"),{...c,obraId:a,createdAt:(0,t.Bt)(),updatedAt:(0,t.Bt)(),metodoAnalisis:"ishikawa_5p"}),d(z),o()}catch(e){console.error(e),h("No se pudo guardar la investigaci\xf3n.")}},N=async e=>{try{let a=(0,t.JU)(n.N$,"investigacionesIncidentes",e);await (0,t.oe)(a),x({title:"Incidente eliminado",description:"El registro del incidente ha sido eliminado."}),o()}catch(e){console.error("Error deleting incident:",e),x({variant:"destructive",title:"Error",description:"No se pudo eliminar el incidente."})}};return(0,i.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 items-start",children:[(0,i.jsxs)(g.Zb,{children:[(0,i.jsxs)(g.Ol,{children:[(0,i.jsx)(g.ll,{children:"Registrar Nuevo Incidente"}),(0,i.jsx)(g.SZ,{children:"Use este formulario para registrar eventos menores como casi accidentes o da\xf1os a la propiedad."})]}),(0,i.jsx)(g.aY,{children:(0,i.jsxs)("form",{onSubmit:b,className:"space-y-4",children:[u&&(0,i.jsx)("p",{className:"text-sm font-medium text-destructive",children:u}),(0,i.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(j._,{children:"Tipo de Suceso"}),(0,i.jsxs)(v.Ph,{value:c.tipoIncidente,onValueChange:e=>p("tipoIncidente",e),children:[(0,i.jsx)(v.i4,{children:(0,i.jsx)(v.ki,{})}),(0,i.jsxs)(v.Bw,{children:[(0,i.jsx)(v.Ql,{value:"Casi accidente",children:"Casi accidente"}),(0,i.jsx)(v.Ql,{value:"Da\xf1o a la propiedad",children:"Da\xf1o a la propiedad"})]})]})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(j._,{children:"Fecha del Suceso"}),(0,i.jsx)(C.I,{type:"date",value:c.fecha,onChange:e=>p("fecha",e.target.value)})]})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(j._,{children:"Descripci\xf3n del Hecho"}),(0,i.jsx)(y.g,{value:c.descripcionHecho,onChange:e=>p("descripcionHecho",e.target.value)})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(j._,{children:"An\xe1lisis Ishikawa (Resumen)"}),(0,i.jsx)(y.g,{value:c.analisisIshikawa,onChange:e=>p("analisisIshikawa",e.target.value),rows:2})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(j._,{children:"An\xe1lisis 5 Porqu\xe9s (Resumen)"}),(0,i.jsx)(y.g,{value:c.analisis5Porques,onChange:e=>p("analisis5Porques",e.target.value),rows:2})]}),(0,i.jsx)(E,{medidas:c.medidasCorrectivasDetalladas,onChange:e=>p("medidasCorrectivasDetalladas",e)}),(0,i.jsx)(f.z,{type:"submit",children:"Registrar Incidente"})]})})]}),(0,i.jsxs)(g.Zb,{children:[(0,i.jsxs)(g.Ol,{children:[(0,i.jsx)(g.ll,{children:"Listado de Incidentes Menores"}),(0,i.jsx)(g.SZ,{children:"Eventos analizados con Ishikawa / 5 Porqu\xe9s."})]}),(0,i.jsx)(g.aY,{children:l?(0,i.jsx)("p",{children:"Cargando..."}):0===s.length?(0,i.jsx)("p",{className:"text-muted-foreground text-sm",children:"No hay incidentes registrados para esta obra."}):(0,i.jsx)("div",{className:"space-y-3 max-h-[800px] overflow-y-auto",children:s.map(e=>(0,i.jsxs)("article",{className:"border p-3 rounded-lg text-sm space-y-2",children:[(0,i.jsxs)("div",{className:"flex justify-between items-start",children:[(0,i.jsx)("p",{className:"font-semibold",children:e.descripcionHecho}),(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)(P.C,{variant:"secondary",children:"Ishikawa / 5P"}),(0,i.jsxs)(S.aR,{children:[(0,i.jsx)(S.vW,{asChild:!0,children:(0,i.jsx)(f.z,{variant:"ghost",size:"icon",className:"h-6 w-6 text-destructive",children:(0,i.jsx)(m.Z,{className:"h-4 w-4"})})}),(0,i.jsxs)(S._T,{children:[(0,i.jsxs)(S.fY,{children:[(0,i.jsx)(S.f$,{children:"\xbfEliminar este incidente?"}),(0,i.jsx)(S.yT,{children:"Esta acci\xf3n no se puede deshacer. Se eliminar\xe1 el registro del incidente."})]}),(0,i.jsxs)(S.xo,{children:[(0,i.jsx)(S.le,{children:"Cancelar"}),(0,i.jsx)(S.OL,{onClick:()=>N(e.id),className:"bg-destructive hover:bg-destructive/90",children:"Eliminar"})]})]})]})]})]}),(0,i.jsxs)("p",{className:"text-xs text-muted-foreground",children:[e.fecha," - ",e.lugar]})]},e.id))})})]})]})}var T=s(94589),F=s(31593),k=s(68245);function H(e){let{value:a,onChange:s,readOnly:t=!1}=e,[n,l]=(0,r.useState)(a||{habilitado:!0,raizId:null,nodos:{}});(0,r.useEffect)(()=>{a&&l(a)},[a]);let o=e=>{l(e),s(e)},c=e=>{let a=crypto.randomUUID(),s={...n};s.nodos[a]={id:a,parentId:e,tipo:"hecho",descripcionCorta:"Nuevo Hecho",detalle:"",esCausaBasica:!1,esCausaInmediata:!1},e||(s.raizId=a),o(s)},d=(e,a)=>{let s={...n};s.nodos[e]={...s.nodos[e],...a},o(s)},u=e=>{let a={...n};if(Object.values(a.nodos).filter(a=>a.parentId===e).length>0){alert("No se puede borrar un nodo que tiene hijos. Borre los hijos primero.");return}delete a.nodos[e],n.raizId===e&&(a.raizId=null),o(a)},h=(e,a)=>(0,i.jsxs)("div",{className:"ml-4 pl-4 border-l border-dashed space-y-3 py-3",children:[(0,i.jsxs)("div",{className:"flex gap-2 items-start",children:[(0,i.jsxs)("div",{className:"w-full space-y-2",children:[(0,i.jsx)(j._,{className:"text-xs",children:"Descripci\xf3n corta del Hecho/Acci\xf3n/Condici\xf3n"}),(0,i.jsx)(C.I,{value:e.descripcionCorta,onChange:a=>d(e.id,{descripcionCorta:a.target.value}),readOnly:t,placeholder:"Ej: El piso estaba resbaladizo"})]}),(0,i.jsxs)("div",{className:"w-48 space-y-2",children:[(0,i.jsx)(j._,{className:"text-xs",children:"Tipo"}),(0,i.jsxs)(v.Ph,{value:e.tipo,onValueChange:a=>d(e.id,{tipo:a}),disabled:t,children:[(0,i.jsx)(v.i4,{children:(0,i.jsx)(v.ki,{})}),(0,i.jsxs)(v.Bw,{children:[(0,i.jsx)(v.Ql,{value:"hecho",children:"Hecho"}),(0,i.jsx)(v.Ql,{value:"accion",children:"Acci\xf3n"}),(0,i.jsx)(v.Ql,{value:"condicion",children:"Condici\xf3n"})]})]})]})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(j._,{className:"text-xs",children:"Detalle / Explicaci\xf3n (opcional)"}),(0,i.jsx)(y.g,{value:e.detalle,onChange:a=>d(e.id,{detalle:a.target.value}),readOnly:t,rows:2})]}),(0,i.jsxs)("div",{className:"flex items-center gap-4 text-xs",children:[(0,i.jsxs)(j._,{className:"flex items-center gap-2 font-normal",children:[(0,i.jsx)(k.X,{checked:e.esCausaInmediata,onCheckedChange:a=>d(e.id,{esCausaInmediata:!!a}),disabled:t}),(0,i.jsx)("span",{children:"Causa Inmediata"})]}),(0,i.jsxs)(j._,{className:"flex items-center gap-2 font-normal",children:[(0,i.jsx)(k.X,{checked:e.esCausaBasica,onCheckedChange:a=>d(e.id,{esCausaBasica:!!a}),disabled:t}),(0,i.jsx)("span",{children:"Causa B\xe1sica"})]})]}),!t&&(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsxs)(f.z,{type:"button",size:"sm",variant:"outline",onClick:()=>c(e.id),children:[(0,i.jsx)(p.Z,{className:"mr-1 h-3 w-3"})," \xbfQu\xe9 tuvo que ocurrir antes?"]}),n.raizId!==e.id&&(0,i.jsx)(f.z,{type:"button",size:"sm",variant:"ghost",className:"text-destructive",onClick:()=>u(e.id),children:(0,i.jsx)(m.Z,{className:"h-4 w-4"})})]}),Object.values(n.nodos).filter(a=>a.parentId===e.id).map(e=>h(e,a+1))]},e.id),x=n.raizId?n.nodos[n.raizId]:null;return(0,i.jsxs)("div",{className:"space-y-4 p-4 border rounded-md bg-slate-50",children:[(0,i.jsx)(j._,{className:"text-base font-semibold",children:"An\xe1lisis de Causas (\xc1rbol)"}),x?h(x,0):t?(0,i.jsx)("p",{className:"text-sm text-muted-foreground",children:"No se ha definido un \xe1rbol de causas para esta investigaci\xf3n."}):(0,i.jsxs)(f.z,{type:"button",variant:"secondary",onClick:()=>c(null),children:[(0,i.jsx)(p.Z,{className:"mr-2 h-4 w-4"})," Empezar con el Hecho Principal / Accidente"]})]})}var O=s(53375),M=s(2578),Z=s.n(M);let L={es:{title:"Informe de Investigaci\xf3n de Accidente",headerId:"ID Investigaci\xf3n",footer:"Informe de Investigaci\xf3n de Accidente",page:"P\xe1gina",fileName:"informe_accidente",fieldFechaAccidente:"Fecha del Accidente",fieldType:"Tipo de Suceso",fieldSeverity:"Gravedad",fieldGenerationDate:"Fecha de Generaci\xf3n",section1:"1. Datos Generales del Accidente",section2:"2. Descripci\xf3n Objetiva del Hecho",section3:"3. An\xe1lisis de Causas (\xc1rbol de Causas)",section4:"4. Plan de Acci\xf3n / Medidas Correctivas",fieldLugar:"Lugar del Accidente",fieldLesion:"Lesi\xf3n Producida",fieldParteCuerpo:"Parte del Cuerpo Afectada",fieldAgente:"Agente del Accidente",fieldMecanismo:"Mecanismo del Accidente",fieldTiempoPerdido:"\xbfHubo Tiempo Perdido?",fieldDiasReposo:"D\xedas de Reposo M\xe9dico",fieldGraveFatal:"\xbfAccidente Grave/Fatal?",yes:"S\xed",no:"No",noRegistrado:"No registrado",rootNodeDefault:"Accidente investigado",noTree:"No se ha definido un \xe1rbol de causas para esta investigaci\xf3n.",noImmediateCauses:"No se registraron causas inmediatas.",noBasicCauses:"No se registraron causas b\xe1sicas.",planAccionSinMedidas:"No existen medidas correctivas registradas.",tableDatosHeadCampo:"Campo",tableDatosHeadValor:"Valor",tableCausasHeadTipo:"Tipo",tableCausasHeadDescripcion:"Descripci\xf3n",tableCausasHeadDetalle:"Detalle",tableCausasHeadNivel:"Nivel",tablePlanHeadAccion:"Acci\xf3n",tablePlanHeadCausa:"Causa Asociada",tablePlanHeadResponsable:"Responsable",tablePlanHeadPlazo:"Fecha L\xedmite",tablePlanHeadEstado:"Estado",levelHechoPrincipal:"Hecho Principal",levelCausaInmediata:"Causa Inmediata",levelCausaBasica:"Causa B\xe1sica"},pt:{title:"Relat\xf3rio de Investiga\xe7\xe3o de Acidente",headerId:"ID da Investiga\xe7\xe3o",footer:"Relat\xf3rio de Investiga\xe7\xe3o de Acidente",page:"P\xe1gina",fileName:"relatorio_acidente",fieldFechaAccidente:"Data do Acidente",fieldType:"Tipo de Evento",fieldSeverity:"Gravidade",fieldGenerationDate:"Data de Gera\xe7\xe3o",section1:"1. Dados Gerais do Acidente",section2:"2. Descri\xe7\xe3o Objetiva do Evento",section3:"3. An\xe1lise de Causas (\xc1rvore de Causas)",section4:"4. Plano de A\xe7\xe3o / Medidas Corretivas",fieldLugar:"Local do Acidente",fieldLesion:"Les\xe3o Produzida",fieldParteCuerpo:"Parte do Corpo Atingida",fieldAgente:"Agente do Acidente",fieldMecanismo:"Mecanismo do Acidente",fieldTiempoPerdido:"Houve Afastamento?",fieldDiasReposo:"Dias de Afastamento M\xe9dico",fieldGraveFatal:"Acidente Grave/Fatal?",yes:"Sim",no:"N\xe3o",noRegistrado:"N\xe3o registrado",rootNodeDefault:"Acidente investigado",noTree:"N\xe3o foi definida uma \xe1rvore de causas para esta investiga\xe7\xe3o.",noImmediateCauses:"N\xe3o foram registradas causas imediatas.",noBasicCauses:"N\xe3o foram registradas causas b\xe1sicas.",planAccionSinMedidas:"N\xe3o existem medidas corretivas registradas.",tableDatosHeadCampo:"Campo",tableDatosHeadValor:"Valor",tableCausasHeadTipo:"Tipo",tableCausasHeadDescripcion:"Descri\xe7\xe3o",tableCausasHeadDetalle:"Detalhe",tableCausasHeadNivel:"N\xedvel",tablePlanHeadAccion:"A\xe7\xe3o",tablePlanHeadCausa:"Causa Associada",tablePlanHeadResponsable:"Respons\xe1vel",tablePlanHeadPlazo:"Prazo Final",tablePlanHeadEstado:"Estado",levelHechoPrincipal:"Fato Principal",levelCausaInmediata:"Causa Imediata",levelCausaBasica:"Causa B\xe1sica"}};function U(e,a,s){return s>250&&(e.addPage(),s=40),e.setFont("helvetica","bold"),e.setFontSize(12),e.text(a,15,s),e.line(15,s+1.5,195,s+1.5),s+8}function B(e){let{investigacion:a,obra:s,language:r="es"}=e;return(0,i.jsxs)(f.z,{size:"sm",variant:"secondary",onClick:()=>{!function(e,a){var s,i;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"es",t=L[r],n=new O.default("p","mm","a4"),l=[226,232,240];n.setFont("helvetica","bold"),n.setFontSize(16),n.text("PCG - Plataforma de Control y Gesti\xf3n",105,60,{align:"center"}),n.setFontSize(22),n.text(t.title,105,100,{align:"center"}),n.setFontSize(16),n.text(a.nombreFaena,105,120,{align:"center"}),n.setFont("helvetica","normal"),n.setFontSize(12),n.text("".concat(t.fieldFechaAccidente,": ").concat(new Date(e.fecha+"T00:00:00").toLocaleDateString("pt"===r?"pt-BR":"es-CL")),105,140,{align:"center"}),n.text("".concat(t.fieldType,": ").concat(e.tipoIncidente),105,148,{align:"center"}),n.text("".concat(t.fieldSeverity,": ").concat(e.gravedad),105,156,{align:"center"}),n.text("".concat(t.fieldGenerationDate,": ").concat(new Date().toLocaleDateString("pt"===r?"pt-BR":"es-CL")),105,164,{align:"center"}),n.addPage(),i="".concat(t.headerId,": ").concat(e.id),n.setFont("helvetica","bold"),n.setFontSize(16),n.text("PCG \xb7 Plataforma de Control y Gesti\xf3n",15,20),n.setFont("helvetica","normal"),n.setFontSize(10),n.text(i,15,26);let o=40;o=U(n,t.section1,o),Z()(n,{startY:o,body:[[t.fieldFechaAccidente,new Date(e.fecha+"T00:00:00").toLocaleDateString("pt"===r?"pt-BR":"es-CL")],[t.fieldLugar,e.lugar||t.noRegistrado],[t.fieldLesion,e.lesionDescripcion||t.noRegistrado],[t.fieldParteCuerpo,e.parteCuerpoAfectada||t.noRegistrado],[t.fieldAgente,e.agenteAccidente||t.noRegistrado],[t.fieldMecanismo,e.mecanismoAccidente||t.noRegistrado],[t.fieldTiempoPerdido,e.huboTiempoPerdido?t.yes:t.no],[t.fieldDiasReposo,(null===(s=e.diasReposoMedico)||void 0===s?void 0:s.toString())||t.noRegistrado],[t.fieldGraveFatal,e.esAccidenteGraveFatal?t.yes:t.no]],head:[[t.tableDatosHeadCampo,t.tableDatosHeadValor]],theme:"grid",headStyles:{fillColor:l,textColor:20},columnStyles:{0:{fontStyle:"bold"}},didDrawPage:e=>{var a;o=(null===(a=e.cursor)||void 0===a?void 0:a.y)||o}}),o=n.lastAutoTable.finalY+10,o=U(n,t.section2,o);let c=n.splitTextToSize(e.descripcionHecho,180);if(n.setFontSize(10),n.text(c,15,o),(o+=5*c.length+10)>200&&(n.addPage(),o=40),o=U(n,t.section3,o),e.arbolCausas&&e.arbolCausas.nodos&&e.arbolCausas.raizId){let a=Object.values(e.arbolCausas.nodos),s=a.find(a=>a.id===e.arbolCausas.raizId),i=a.filter(e=>e.esCausaInmediata),r=a.filter(e=>e.esCausaBasica),c=[];s&&c.push([s.tipo.toUpperCase(),"Nuevo Hecho"===s.descripcionCorta?t.rootNodeDefault:s.descripcionCorta,s.detalle||"-",t.levelHechoPrincipal]),i.length>0?i.forEach(e=>c.push([e.tipo.toUpperCase(),e.descripcionCorta,e.detalle===(null==s?void 0:s.detalle)?"-":e.detalle||"-",t.levelCausaInmediata])):c.push([{content:t.noImmediateCauses,colSpan:4,styles:{fontStyle:"italic",textColor:120}}]),r.length>0?r.forEach(e=>c.push([e.tipo.toUpperCase(),e.descripcionCorta,e.detalle===(null==s?void 0:s.detalle)?"-":e.detalle||"-",t.levelCausaBasica])):c.push([{content:t.noBasicCauses,colSpan:4,styles:{fontStyle:"italic",textColor:120}}]),Z()(n,{startY:o,head:[[t.tableCausasHeadTipo,t.tableCausasHeadDescripcion,t.tableCausasHeadDetalle,t.tableCausasHeadNivel]],body:c,theme:"grid",headStyles:{fillColor:l,textColor:20},didDrawPage:e=>{var a;o=(null===(a=e.cursor)||void 0===a?void 0:a.y)||o}}),o=n.lastAutoTable.finalY}else n.text(t.noTree,15,o);e.medidasCorrectivasDetalladas&&e.medidasCorrectivasDetalladas.length>0?(o>200?(n.addPage(),o=40):o+=10,o=U(n,t.section4,o),Z()(n,{startY:o,head:[[t.tablePlanHeadAccion,t.tablePlanHeadCausa,t.tablePlanHeadResponsable,t.tablePlanHeadPlazo,t.tablePlanHeadEstado]],body:e.medidasCorrectivasDetalladas.map(a=>{var s;let i=a.causaNodoId?null===(s=e.arbolCausas)||void 0===s?void 0:s.nodos[a.causaNodoId]:null,t=i?"[".concat(i.tipo,"] ").concat(i.descripcionCorta):"General";return[a.descripcionAccion,t,a.responsable,a.fechaCompromiso?new Date(a.fechaCompromiso+"T00:00:00").toLocaleDateString("pt"===r?"pt-BR":"es-CL"):"N/A",a.estado]}),theme:"grid",headStyles:{fillColor:l,textColor:20},didDrawPage:e=>{var a;o=(null===(a=e.cursor)||void 0===a?void 0:a.y)||o}}),o=n.lastAutoTable.finalY):(o>250?(n.addPage(),o=40):o+=10,o=U(n,t.section4,o),n.text(t.planAccionSinMedidas,15,o)),function(e,a,s){let i=L[s],r=e.internal.getNumberOfPages();for(let s=1;s<=r;s++){e.setPage(s);let t=e.internal.pageSize.getHeight();e.setFontSize(8),e.setTextColor(120),e.text(a,15,t-10),e.text(i.footer,105,t-10,{align:"center"}),e.text("".concat(i.page," ").concat(s," / ").concat(r),195,t-10,{align:"right"}),e.setTextColor(0)}}(n,a.nombreFaena,r);let d=new Date().toISOString().slice(0,10).replace(/-/g,""),u=r.toUpperCase(),m="".concat(t.fileName,"_").concat(a.nombreFaena.replace(/ /g,"_"),"_").concat(d,"_").concat(u,".pdf");n.save(m)}(a,s,r)},children:[(0,i.jsx)(u.Z,{className:"h-4 w-4 mr-2"}),"pt"===r?"Baixar Relat\xf3rio (PT)":"Generar Informe PDF (ES)"]})}let G={fecha:new Date().toISOString().slice(0,10),lugar:"",tipoIncidente:"Accidente sin tiempo perdido",gravedad:"Leve",descripcionHecho:"",lesionDescripcion:"",parteCuerpoAfectada:"",agenteAccidente:"",mecanismoAccidente:"",diasReposoMedico:null,huboTiempoPerdido:!1,esAccidenteGraveFatal:!1,actoInseguro:"",condicionInsegura:"",causasInmediatas:"",causasBasicas:"",analisisIshikawa:"",analisis5Porques:"",medidasCorrectivas:"",responsableSeguimiento:"",plazoCierre:"",estadoCierre:"Abierto",metodoAnalisis:"arbol_causas",arbolCausas:{habilitado:!0,raizId:null,nodos:{}},medidasCorrectivasDetalladas:[]};function Y(e){var a,s;let{obraId:l,investigaciones:o,loading:c,onUpdate:d}=e,[u,h]=(0,r.useState)(G),[x,p]=(0,r.useState)(null),[b,N]=(0,r.useState)(null),[I,R]=(0,r.useState)(null),{toast:w}=(0,A.pm)();(0,r.useEffect)(()=>{l&&(async()=>{let e=(0,t.JU)(n.N$,"obras",l),a=await (0,t.QT)(e);a.exists()&&p({id:a.id,...a.data()})})()},[l]);let _=(e,a)=>{h(s=>({...s,[e]:a}))},z=async()=>{if(!l){N("Seleccione una obra.");return}N(null);try{if(I){let e=(0,t.JU)(n.N$,"investigacionesIncidentes",I.id);await (0,t.r7)(e,{...u,updatedAt:(0,t.Bt)()}),R(null)}else await (0,t.ET)((0,t.hJ)(n.N$,"investigacionesIncidentes"),{...u,obraId:l,obraNombre:(null==x?void 0:x.nombreFaena)||"N/A",createdAt:(0,t.Bt)(),updatedAt:(0,t.Bt)()});h(G),d()}catch(e){console.error(e),N("No se pudo guardar la investigaci\xf3n.")}},D=async e=>{if(e)try{await (0,t.oe)((0,t.JU)(n.N$,"investigacionesIncidentes",e)),w({title:"Investigaci\xf3n eliminada",description:"El registro ha sido eliminado."}),d()}catch(e){console.error("Error deleting investigation:",e),w({variant:"destructive",title:"Error",description:"No se pudo eliminar la investigaci\xf3n."})}};return(0,i.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 items-start",children:[(0,i.jsxs)(g.Zb,{children:[(0,i.jsxs)(g.Ol,{children:[(0,i.jsx)(g.ll,{children:"Registrar Nuevo Accidente"}),(0,i.jsx)(g.SZ,{children:"Utilice este formulario para registrar e investigar accidentes laborales, usando el m\xe9todo de \xc1rbol de Causas."})]}),(0,i.jsx)(g.aY,{children:(0,i.jsxs)("form",{onSubmit:e=>{e.preventDefault(),z()},className:"space-y-6",children:[b&&(0,i.jsx)("p",{className:"text-sm font-medium text-destructive",children:b}),(0,i.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(j._,{children:"Tipo de Accidente"}),(0,i.jsxs)(v.Ph,{value:u.tipoIncidente,onValueChange:e=>_("tipoIncidente",e),children:[(0,i.jsx)(v.i4,{children:(0,i.jsx)(v.ki,{})}),(0,i.jsxs)(v.Bw,{children:[(0,i.jsx)(v.Ql,{value:"Accidente con tiempo perdido",children:"Accidente con tiempo perdido"}),(0,i.jsx)(v.Ql,{value:"Accidente sin tiempo perdido",children:"Accidente sin tiempo perdido"})]})]})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(j._,{children:"Fecha del Suceso"}),(0,i.jsx)(C.I,{type:"date",value:u.fecha,onChange:e=>_("fecha",e.target.value)})]})]}),(0,i.jsx)(F.Z,{}),(0,i.jsx)("h4",{className:"text-md font-semibold",children:"Datos Espec\xedficos del Accidente"}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(j._,{children:"Descripci\xf3n del Hecho"}),(0,i.jsx)(y.g,{value:u.descripcionHecho,onChange:e=>_("descripcionHecho",e.target.value)})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(j._,{children:"Lesi\xf3n Producida"}),(0,i.jsx)(y.g,{value:u.lesionDescripcion,onChange:e=>_("lesionDescripcion",e.target.value),rows:2})]}),(0,i.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(j._,{children:"Parte del Cuerpo Afectada"}),(0,i.jsx)(C.I,{value:u.parteCuerpoAfectada,onChange:e=>_("parteCuerpoAfectada",e.target.value)})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(j._,{children:"D\xedas de Reposo M\xe9dico"}),(0,i.jsx)(C.I,{type:"number",value:null!==(a=u.diasReposoMedico)&&void 0!==a?a:"",onChange:e=>_("diasReposoMedico",""===e.target.value?null:Number(e.target.value))})]})]}),(0,i.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(j._,{children:"Agente del Accidente"}),(0,i.jsx)(C.I,{value:u.agenteAccidente,onChange:e=>_("agenteAccidente",e.target.value)})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(j._,{children:"Mecanismo del Accidente"}),(0,i.jsx)(C.I,{value:u.mecanismoAccidente,onChange:e=>_("mecanismoAccidente",e.target.value)})]})]}),(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)(T.r,{id:"grave-fatal",checked:null!==(s=u.esAccidenteGraveFatal)&&void 0!==s&&s,onCheckedChange:e=>_("esAccidenteGraveFatal",e)}),(0,i.jsx)(j._,{htmlFor:"grave-fatal",children:"\xbfCorresponde a accidente grave/fatal?"})]}),(0,i.jsx)(F.Z,{}),(0,i.jsx)(H,{value:u.arbolCausas,onChange:e=>{h(a=>({...a,arbolCausas:e}))}}),(0,i.jsx)(F.Z,{}),(0,i.jsx)(E,{arbolCausas:u.arbolCausas,medidas:u.medidasCorrectivasDetalladas,onChange:e=>{h(a=>({...a,medidasCorrectivasDetalladas:e}))}}),(0,i.jsx)(f.z,{type:"submit",children:"Registrar Accidente"})]})})]}),(0,i.jsxs)(g.Zb,{children:[(0,i.jsxs)(g.Ol,{children:[(0,i.jsx)(g.ll,{children:"Listado de Accidentes Registrados"}),(0,i.jsx)(g.SZ,{children:"Accidentes que utilizan el m\xe9todo de \xc1rbol de Causas."})]}),(0,i.jsx)(g.aY,{children:c?(0,i.jsx)("p",{children:"Cargando..."}):0===o.length?(0,i.jsx)("p",{className:"text-muted-foreground text-sm",children:"No hay accidentes registrados para esta obra."}):(0,i.jsx)("div",{className:"space-y-3 max-h-[800px] overflow-y-auto",children:o.map(e=>(0,i.jsxs)("article",{className:"border p-3 rounded-lg text-sm space-y-2",children:[(0,i.jsxs)("div",{className:"flex justify-between items-start",children:[(0,i.jsx)("p",{className:"font-semibold",children:e.descripcionHecho}),(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)(P.C,{variant:"outline",children:"\xc1rbol de Causas"}),(0,i.jsxs)(S.aR,{children:[(0,i.jsx)(S.vW,{asChild:!0,children:(0,i.jsx)(f.z,{variant:"ghost",size:"icon",className:"h-6 w-6 text-destructive",children:(0,i.jsx)(m.Z,{className:"h-4 w-4"})})}),(0,i.jsxs)(S._T,{children:[(0,i.jsxs)(S.fY,{children:[(0,i.jsx)(S.f$,{children:"\xbfEliminar esta investigaci\xf3n?"}),(0,i.jsx)(S.yT,{children:"Esta acci\xf3n no se puede deshacer. Se eliminar\xe1 permanentemente la investigaci\xf3n del accidente."})]}),(0,i.jsxs)(S.xo,{children:[(0,i.jsx)(S.le,{children:"Cancelar"}),(0,i.jsx)(S.OL,{onClick:()=>D(e.id),className:"bg-destructive hover:bg-destructive/90",children:"Eliminar"})]})]})]})]})]}),(0,i.jsxs)("p",{className:"text-xs text-muted-foreground",children:[e.fecha," - ",e.lugar]}),x&&"arbol_causas"===e.metodoAnalisis&&(0,i.jsxs)("div",{className:"flex gap-2 pt-2",children:[(0,i.jsx)(B,{investigacion:e,obra:x,language:"es"}),(0,i.jsx)(B,{investigacion:e,obra:x,language:"pt"})]})]},e.id))})})]})]})}let V=["Ca\xedda de altura","Riesgo el\xe9ctrico","Sobreesfuerzo","Exposici\xf3n a ruido","Atrapamiento","Proyecci\xf3n de part\xedculas","Contacto con energ\xeda el\xe9ctrica (directo/indirecto)","Arco el\xe9ctrico durante maniobra de interruptor","Contacto con partes y piezas energizadas","Otro"],$=["Lesiones graves/fatales","Electrocuci\xf3n, shock el\xe9ctrico, quemaduras por arco.","Electrocuci\xf3n","Quemaduras severas por arco el\xe9ctrico","Lesiones musculoesquel\xe9ticas","Hipoacusia","Amputaci\xf3n/fracturas","Lesiones oculares","Otro"],q=["Ajustar peso m\xe1ximo para trabajadoras","EPP en tallaje diferenciado","Adecuar tareas en embarazo/lactancia","Capacitaci\xf3n con enfoque de g\xe9nero","Procedimiento de trabajo seguro (PTS) para comisionamiento, uso de EPP diel\xe9ctrico y ropa ign\xedfuga. Despeje y se\xf1alizaci\xf3n del \xe1rea.","Uso de traje ign\xedfugo (Arc Flash), careta facial, guantes diel\xe9ctricos. Maniobra realizada por personal autorizado y con 2do verificador.","Procedimiento de trabajo en caliente, bloqueo LOTO si aplica parcialmente, delimitaci\xf3n de 'zona prohibida'.","Otro"],Q=["Mec\xe1nico","Qu\xedmico","F\xedsico","Biol\xf3gico","Ergon\xf3mico","Psicosocial","Energ\xeda el\xe9ctrica","Otro"],J=["Eliminaci\xf3n","Sustituci\xf3n","Control de Ingenier\xeda","Control Administrativo","EPP"],W=["PENDIENTE","EN_EJECUCION","IMPLEMENTADO","RECHAZADO"],X=e=>{let{value:a,onChange:s}=e,{tarea:r,zona:t,peligro:n,riesgo:l,categoriaPeligro:o,probabilidadHombre:c,consecuenciaHombre:d,probabilidadMujer:u,consecuenciaMujer:m,jerarquiaControl:h,controlEspecificoGenero:x,responsable:p,plazo:f,estadoControl:g,probabilidadResidual:b,consecuenciaResidual:N,peligroOtro:P,riesgoOtro:I,controlEspecificoGeneroOtro:R}=a,w=(c||0)*(d||0),_=(u||0)*(m||0),E=(b||0)*(N||0),S=e=>i=>{let r="string"==typeof i?i:i.target.value,t=["probabilidadHombre","consecuenciaHombre","probabilidadMujer","consecuenciaMujer","probabilidadResidual","consecuenciaResidual"].includes(e);s({...a,[e]:t?Number(r||0):r})};return(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)("div",{className:"p-4 border rounded-lg bg-slate-50",children:[(0,i.jsx)("h4",{className:"font-semibold text-md mb-3 text-slate-700",children:"1. Identificaci\xf3n del Peligro y Riesgo"}),(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)(j._,{children:"Tarea*"}),(0,i.jsx)(C.I,{value:r,onChange:S("tarea")})]}),(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)(j._,{children:"Zona / Sector donde se presenta*"}),(0,i.jsx)(C.I,{value:t,onChange:S("zona"),placeholder:"Ej: Sala de bombas, Bodega..."})]}),(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)(j._,{children:"Categor\xeda del Peligro"}),(0,i.jsxs)(v.Ph,{value:o,onValueChange:e=>S("categoriaPeligro")(e),children:[(0,i.jsx)(v.i4,{children:(0,i.jsx)(v.ki,{placeholder:"Seleccione..."})}),(0,i.jsx)(v.Bw,{children:Q.map(e=>(0,i.jsx)(v.Ql,{value:e,children:e},e))})]})]}),(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)(j._,{children:"Peligro Identificado*"}),(0,i.jsxs)(v.Ph,{value:n,onValueChange:e=>S("peligro")(e),children:[(0,i.jsx)(v.i4,{children:(0,i.jsx)(v.ki,{placeholder:"Seleccione..."})}),(0,i.jsx)(v.Bw,{children:V.map(e=>(0,i.jsx)(v.Ql,{value:e,children:e},e))})]}),"Otro"===n&&(0,i.jsx)(C.I,{className:"mt-1",placeholder:"Especifique otro peligro",value:P,onChange:S("peligroOtro")})]}),(0,i.jsxs)("div",{className:"space-y-1 md:col-span-2",children:[(0,i.jsx)(j._,{children:"Riesgo Asociado*"}),(0,i.jsxs)(v.Ph,{value:l,onValueChange:e=>S("riesgo")(e),children:[(0,i.jsx)(v.i4,{children:(0,i.jsx)(v.ki,{placeholder:"Seleccione..."})}),(0,i.jsx)(v.Bw,{children:$.map(e=>(0,i.jsx)(v.Ql,{value:e,children:e},e))})]}),"Otro"===l&&(0,i.jsx)(C.I,{className:"mt-1",placeholder:"Especifique otro riesgo",value:I,onChange:S("riesgoOtro")})]})]})]}),(0,i.jsxs)("div",{className:"p-4 border rounded-lg",children:[(0,i.jsx)("h4",{className:"font-semibold text-md mb-3",children:"2. Evaluaci\xf3n de Riesgo Inherente (con enfoque de g\xe9nero)"}),(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,i.jsxs)("div",{className:"rounded-lg p-3 bg-blue-50 border border-blue-200",children:[(0,i.jsx)("p",{className:"text-sm font-semibold mb-2 text-blue-800",children:"Evaluaci\xf3n para Hombres"}),(0,i.jsxs)("div",{className:"grid grid-cols-3 gap-2 items-end",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)(j._,{className:"text-xs",children:"Prob."}),(0,i.jsx)(C.I,{type:"number",min:1,max:5,value:c||"",onChange:S("probabilidadHombre")})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(j._,{className:"text-xs",children:"Cons."}),(0,i.jsx)(C.I,{type:"number",min:1,max:5,value:d||"",onChange:S("consecuenciaHombre")})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{className:"text-xs",children:"Nivel"}),(0,i.jsx)("div",{className:"font-bold",children:w})]})]})]}),(0,i.jsxs)("div",{className:"rounded-lg p-3 bg-pink-50 border border-pink-200",children:[(0,i.jsx)("p",{className:"text-sm font-semibold mb-2 text-pink-800",children:"Evaluaci\xf3n para Mujeres"}),(0,i.jsxs)("div",{className:"grid grid-cols-3 gap-2 items-end",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)(j._,{className:"text-xs",children:"Prob."}),(0,i.jsx)(C.I,{type:"number",min:1,max:5,value:u||"",onChange:S("probabilidadMujer")})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(j._,{className:"text-xs",children:"Cons."}),(0,i.jsx)(C.I,{type:"number",min:1,max:5,value:m||"",onChange:S("consecuenciaMujer")})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{className:"text-xs",children:"Nivel"}),(0,i.jsx)("div",{className:"font-bold",children:_})]})]})]})]})]}),(0,i.jsxs)("div",{className:"p-4 border rounded-lg",children:[(0,i.jsx)("h4",{className:"font-semibold text-md mb-3",children:"3. Medidas de Control"}),(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)(j._,{children:"Jerarqu\xeda del Control Aplicado"}),(0,i.jsxs)(v.Ph,{value:h,onValueChange:e=>S("jerarquiaControl")(e),children:[(0,i.jsx)(v.i4,{children:(0,i.jsx)(v.ki,{placeholder:"Seleccione..."})}),(0,i.jsx)(v.Bw,{children:J.map(e=>(0,i.jsx)(v.Ql,{value:e,children:e},e))})]})]}),(0,i.jsxs)("div",{className:"space-y-1 md:col-span-2",children:[(0,i.jsx)(j._,{children:"Control espec\xedfico seg\xfan g\xe9nero (DS 44)"}),(0,i.jsxs)(v.Ph,{value:x,onValueChange:e=>S("controlEspecificoGenero")(e),children:[(0,i.jsx)(v.i4,{children:(0,i.jsx)(v.ki,{placeholder:"Seleccione..."})}),(0,i.jsx)(v.Bw,{children:q.map(e=>(0,i.jsx)(v.Ql,{value:e,children:e},e))})]}),"Otro"===x&&(0,i.jsx)(y.g,{className:"mt-1",placeholder:"Especifique...",value:R,onChange:S("controlEspecificoGeneroOtro")})]}),(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)(j._,{children:"Responsable designado"}),(0,i.jsx)(C.I,{value:p,onChange:S("responsable")})]}),(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)(j._,{children:"Fecha l\xedmite de implementaci\xf3n"}),(0,i.jsx)(C.I,{type:"date",value:f,onChange:S("plazo")})]})]})]}),(0,i.jsxs)("div",{className:"p-4 border rounded-lg bg-slate-50",children:[(0,i.jsx)("h4",{className:"font-semibold text-md mb-3 text-slate-700",children:"4. Riesgo Residual y Seguimiento"}),(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,i.jsxs)("div",{className:"rounded-lg p-3 bg-gray-100 border",children:[(0,i.jsx)("p",{className:"text-sm font-semibold mb-2 text-gray-800",children:"Evaluaci\xf3n del Riesgo Residual"}),(0,i.jsxs)("div",{className:"grid grid-cols-3 gap-2 items-end",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)(j._,{className:"text-xs",children:"Prob. Residual"}),(0,i.jsx)(C.I,{type:"number",min:1,max:5,value:b||"",onChange:S("probabilidadResidual")})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(j._,{className:"text-xs",children:"Cons. Residual"}),(0,i.jsx)(C.I,{type:"number",min:1,max:5,value:N||"",onChange:S("consecuenciaResidual")})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{className:"text-xs",children:"Nivel Residual"}),(0,i.jsx)("div",{className:"font-bold",children:E})]})]})]}),(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)(j._,{children:"Estado del Control"}),(0,i.jsxs)(v.Ph,{value:g,onValueChange:e=>S("estadoControl")(e),children:[(0,i.jsx)(v.i4,{children:(0,i.jsx)(v.ki,{placeholder:"Seleccione..."})}),(0,i.jsx)(v.Bw,{children:W.map(e=>(0,i.jsx)(v.Ql,{value:e,children:e.replace("_"," ")},e))})]})]})]})]})]})};var K=s(93448);let ee=[226,232,240];async function ea(e){try{let a=await fetch(e);if(!a.ok)return"";let s=await a.blob();return new Promise((e,a)=>{let i=new FileReader;i.onloadend=()=>e(i.result),i.onerror=a,i.readAsDataURL(s)})}catch(e){return console.error("Error fetching image for PDF:",e),""}}function es(e,a,s){return s>250&&(e.addPage(),s=40),e.setFont("helvetica","bold"),e.setFontSize(12),e.text(a,15,s),e.line(15,s+1.5,195,s+1.5),s+8}async function ei(e,a){var s;let i=new O.default("p","mm","a4"),r="IPER-".concat(String(e.correlativo).padStart(3,"0"));s=a.nombreFaena,i.setFont("helvetica","bold"),i.setFontSize(16),i.text("PCG \xb7 Plataforma de Control y Gesti\xf3n",15,20),i.setFont("helvetica","normal"),i.setFontSize(10),i.text("Obra: ".concat(s," | IPER ID: ").concat(r),15,26),i.setFontSize(18),i.text("Ficha de Identificaci\xf3n de Peligros y Evaluaci\xf3n de Riesgos (IPER)",105,45,{align:"center"});let t=60;if(t=es(i,"1. Identificaci\xf3n del Peligro y Riesgo",60),Z()(i,{startY:t,body:[["Tarea",e.tarea],["Zona / Sector",e.zona],["Categor\xeda del Peligro",e.categoriaPeligro],["Peligro Identificado",e.peligro],["Riesgo Asociado",e.riesgo]],theme:"grid",headStyles:{fillColor:ee,textColor:20},columnStyles:{0:{fontStyle:"bold"}}}),t=i.lastAutoTable.finalY+10,t=es(i,"2. Evaluaci\xf3n de Riesgo Inherente (con enfoque de g\xe9nero)",t),Z()(i,{startY:t,head:[["Evaluaci\xf3n","Probabilidad","Consecuencia","Nivel Riesgo"]],body:[["Hombres",e.probabilidad_hombre,e.consecuencia_hombre,e.nivel_riesgo_hombre],["Mujeres",e.probabilidad_mujer,e.consecuencia_mujer,e.nivel_riesgo_mujer]],theme:"grid",headStyles:{fillColor:ee,textColor:20},columnStyles:{0:{fontStyle:"bold"}}}),t=i.lastAutoTable.finalY+10,t=es(i,"3. Medidas de Control Propuestas",t),Z()(i,{startY:t,body:[["Jerarqu\xeda del Control",e.jerarquiaControl],["Control Espec\xedfico por G\xe9nero",e.control_especifico_genero||"No se especifican medidas adicionales por g\xe9nero."],["Responsable de Implementaci\xf3n",e.responsable],["Plazo de Implementaci\xf3n",e.plazo?new Date(e.plazo+"T00:00:00").toLocaleDateString("es-CL"):"No especificado"]],theme:"grid",headStyles:{fillColor:ee,textColor:20},columnStyles:{0:{fontStyle:"bold"}}}),t=i.lastAutoTable.finalY+10,t=es(i,"4. Riesgo Residual y Seguimiento",t),Z()(i,{startY:t,body:[["Nivel de Riesgo Residual","".concat(e.nivel_riesgo_residual," (Prob: ").concat(e.probabilidad_residual," / Cons: ").concat(e.consecuencia_residual,")")],["Estado del Control",e.estadoControl]],theme:"grid",headStyles:{fillColor:ee,textColor:20},columnStyles:{0:{fontStyle:"bold"}}}),t=i.lastAutoTable.finalY+20,e.firmaPrevencionistaUrl){let a=await ea(e.firmaPrevencionistaUrl);a&&i.addImage(a,"PNG",15,t,60,20)}else i.line(15,t+15,75,t+15);t+=22,i.setFontSize(9),i.text(e.firmaPrevencionistaNombre||"________________________",15,t),t+=4,i.text(e.firmaPrevencionistaCargo||"Prevencionista de Riesgos",15,t),t+=4,i.text(e.firmaPrevencionistaRut||"RUT",15,t),function(e){let a=e.internal.getNumberOfPages();for(let s=1;s<=a;s++){e.setPage(s);let i=e.internal.pageSize.getHeight();e.setFontSize(8),e.setTextColor(120),e.text("Documento generado con PCG",105,i-10,{align:"center"}),e.text("P\xe1gina ".concat(s," de ").concat(a),195,i-10,{align:"right"}),e.setTextColor(0)}}(i);let n=new Date().toISOString().slice(0,10);i.save("IPER_".concat(r,"_").concat(a.nombreFaena.replace(/ /g,"_"),"_").concat(n,".pdf"))}var er=s(53459);let et={es:{title:"Acta de Charla Operativa / Capacitaci\xf3n",fileName:"acta_charla",page:"P\xe1gina",fieldObra:"Obra",fieldMandante:"Mandante",fieldContratista:"Contratista",fieldTema:"Tema de la Charla",fieldFecha:"Fecha de Realizaci\xf3n",sectionIperTitle:"Origen de la Charla (IPER)",sectionContentTitle:"Resumen de Temas Abordados",sectionAttendeesTitle:"Lista de Asistentes",fieldIperId:"ID IPER",fieldIperTarea:"Tarea",fieldIperPeligro:"Peligro",fieldIperRiesgo:"Riesgo",fieldIperRiesgoInherente:"Riesgo Inherente (H/M)",fieldIperRiesgoResidual:"Riesgo Residual",contentFromIperIntro:"La charla se centra en los riesgos identificados en el IPER para la tarea",contentFromIperPeligro:"Peligro principal",contentFromIperRiesgo:"Riesgo evaluado",contentFromIperControl:"Medida de control clave",tableAttendeesHeadName:"Nombre",tableAttendeesHeadId:"RUT/ID",tableAttendeesHeadPosition:"Cargo",tableAttendeesHeadDate:"Fecha Firma",tableAttendeesHeadSignature:"Firma",noAsistentes:"No existen asistentes registrados en esta charla.",noFirma:"Sin firma",errorFirma:"Error al cargar firma",noEspecificado:"No especificado",noDefinida:"No definida"},pt:{title:"Ata de Palestra Operacional / Capacita\xe7\xe3o",fileName:"ata_palestra",page:"P\xe1gina",fieldObra:"Obra",fieldMandante:"Contratante",fieldContratista:"Contratada",fieldTema:"Tema da Palestra",fieldFecha:"Data de Realiza\xe7\xe3o",sectionIperTitle:"Origem da Palestra (IPER)",sectionContentTitle:"Resumo dos T\xf3picos Abordados",sectionAttendeesTitle:"Lista de Presen\xe7a",fieldIperId:"ID IPER",fieldIperTarea:"Tarefa",fieldIperPeligro:"Perigo",fieldIperRiesgo:"Risco",fieldIperRiesgoInherente:"Risco Inerente (H/M)",fieldIperRiesgoResidual:"Risco Residual",contentFromIperIntro:"A palestra foca nos riscos identificados no IPER para a tarefa",contentFromIperPeligro:"Perigo principal",contentFromIperRiesgo:"Risco avaliado",contentFromIperControl:"Medida de controle chave",tableAttendeesHeadName:"Nome",tableAttendeesHeadId:"CPF/ID",tableAttendeesHeadPosition:"Cargo",tableAttendeesHeadDate:"Data Assinatura",tableAttendeesHeadSignature:"Assinatura",noAsistentes:"N\xe3o h\xe1 participantes registrados nesta palestra.",noFirma:"Sem assinatura",errorFirma:"Erro ao carregar assinatura",noEspecificado:"N\xe3o especificado",noDefinida:"N\xe3o definida"}};async function en(e){try{let a=await fetch(e);if(!a.ok)throw Error("Network response was not ok: ".concat(a.statusText));let s=await a.blob();return new Promise((e,a)=>{let i=new FileReader;i.onloadend=()=>e(i.result),i.onerror=a,i.readAsDataURL(s)})}catch(e){return console.error("Error fetching image for PDF:",e),""}}async function el(e,a){var s,i;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"es",l=et[r],o=new O.default("p","mm","a4"),c=20,d=null;if(e.iperIdRelacionado)try{let a=o(n.N$,"obras",e.obraId,"iper",e.iperIdRelacionado),s=await (0,t.QT)(a);s.exists()&&(d={id:s.id,...s.data()})}catch(e){console.error("Error al cargar el IPER relacionado:",e)}o.setFont("helvetica","bold"),o.setFontSize(16),o.text(l.title,105,c,{align:"center"}),c+=15,Z()(o,{startY:c,body:[[l.fieldObra,(null==a?void 0:a.nombreFaena)||e.obraNombre],[l.fieldMandante,(null==a?void 0:a.mandanteRazonSocial)||l.noEspecificado],[l.fieldContratista,(null==a?void 0:null===(s=a.empresa)||void 0===s?void 0:s.nombre)||l.noEspecificado],[l.fieldTema,e.titulo],[l.fieldFecha,(null===(i=e.fechaRealizacion)||void 0===i?void 0:i.toDate().toLocaleDateString("pt"===r?"pt-BR":"es-CL"))||l.noDefinida]],theme:"grid",headStyles:{fillColor:[240,240,240],textColor:20},columnStyles:{0:{fontStyle:"bold"}}}),c=o.lastAutoTable.finalY+10,d&&(c=eo(o,l.sectionIperTitle,c,15),Z()(o,{startY:c,body:[[l.fieldIperId,d.id],[l.fieldIperTarea,d.tarea],[l.fieldIperPeligro,d.peligro],[l.fieldIperRiesgo,d.riesgo],[l.fieldIperRiesgoInherente,"".concat(d.nivel_riesgo_hombre," (H) / ").concat(d.nivel_riesgo_mujer," (M)")],[l.fieldIperRiesgoResidual,"".concat(d.nivel_riesgo_residual)]],theme:"grid",headStyles:{fillColor:[240,240,240],textColor:20},columnStyles:{0:{fontStyle:"bold"}}}),c=o.lastAutoTable.finalY+10),c=eo(o,l.sectionContentTitle,c,15),o.setFont("helvetica","normal"),o.setFontSize(10);let u=d?"".concat(l.contentFromIperIntro,' "').concat(d.tarea,'":\n\n')+"- ".concat(l.contentFromIperPeligro,": ").concat(d.peligro,".\n")+"- ".concat(l.contentFromIperRiesgo,": ").concat(d.riesgo," (Nivel: ").concat(Math.max(d.nivel_riesgo_hombre,d.nivel_riesgo_mujer),").\n")+"- ".concat(l.contentFromIperControl,": ").concat(d.control_especifico_genero||l.noEspecificado,"."):e.contenido,m=o.splitTextToSize(u,180);if(o.text(m,15,c),(c+=5*m.length+10)>220&&(o.addPage(),c=20),c=eo(o,l.sectionAttendeesTitle,c,15),e.asistentes&&e.asistentes.length>0){let a=e.asistentes.map(async e=>{let a=l.noFirma;if(e.firmaUrl)try{let s=await en(e.firmaUrl);a=s?{image:s,width:30,height:10}:l.errorFirma}catch(e){console.error("Error al procesar firma",e),a=l.errorFirma}return[e.nombre,e.rut||"-",e.cargo||"-",e.firmadoEn?new Date(e.firmadoEn).toLocaleString("pt"===r?"pt-BR":"es-CL"):"N/A",a]}),s=await Promise.all(a);Z()(o,{startY:c,head:[[l.tableAttendeesHeadName,l.tableAttendeesHeadId,l.tableAttendeesHeadPosition,l.tableAttendeesHeadDate,l.tableAttendeesHeadSignature]],body:s,theme:"grid",headStyles:{fillColor:[240,240,240],textColor:20},didDrawPage:e=>{},columnStyles:{4:{minCellHeight:15,halign:"center",valign:"middle"}}})}else o.text(l.noAsistentes,15,c);!function(e,a){let s=et[a],i=e.internal.getNumberOfPages();for(let a=1;a<=i;a++)e.setPage(a),e.setFontSize(8),e.setTextColor(150),e.text("PCG - ".concat(s.page," ").concat(a," de ").concat(i),105,285,{align:"center"})}(o,r);let h=e.fechaRealizacion?e.fechaRealizacion.toDate().toISOString().slice(0,10):"sin_fecha",x="".concat(l.fileName,"_").concat(null==a?void 0:a.nombreFaena.replace(/ /g,"_"),"_").concat(h,".pdf");o.save(x)}function eo(e,a,s,i){return e.setFont("helvetica","bold"),e.setFontSize(12),e.text(a,i,s),s+6}function ec(e){let{charla:a,obra:s,language:t="es"}=e,[n,l]=(0,r.useState)(!1),o=async()=>{l(!0),await el(a,s,t),l(!1)};return(0,i.jsxs)(f.z,{size:"sm",variant:"outline",onClick:o,disabled:n,children:[n?(0,i.jsx)(er.Z,{className:"h-4 w-4 mr-2 animate-spin"}):(0,i.jsx)(u.Z,{className:"h-4 w-4 mr-2"}),n?"pt"===t?"Gerando...":"Generando...":"pt"===t?"Gerar Ata (PDF)":"Generar Acta (PDF)"]})}var ed=s(27316),eu=s(60062);let em=[{id:"comisionamiento_tablero",nombre:"Comisionamiento de Tablero El\xe9ctrico",descripcion:"Puesta en servicio de tablero BT en sala el\xe9ctrica.",valores:{tarea:"Comisionamiento y puesta en servicio de tablero el\xe9ctrico BT",zona:"Sala el\xe9ctrica / Tablero BT",categoriaPeligro:"F\xedsico",peligro:"Contacto con energ\xeda el\xe9ctrica (directo/indirecto)",riesgo:"Electrocuci\xf3n, shock el\xe9ctrico, quemaduras por arco.",probabilidad_hombre:4,consecuencia_hombre:5,probabilidad_mujer:4,consecuencia_mujer:5,jerarquiaControl:"Control Administrativo",control_especifico_genero:"Procedimiento de trabajo seguro (PTS) para comisionamiento, uso de EPP diel\xe9ctrico y ropa ign\xedfuga. Despeje y se\xf1alizaci\xf3n del \xe1rea.",responsable:"Supervisor El\xe9ctrico",plazo:"",estadoControl:"PENDIENTE",probabilidad_residual:2,consecuencia_residual:4}},{id:"energizacion_circuito",nombre:"Energizaci\xf3n de Circuito",descripcion:"Maniobra de energizaci\xf3n de un circuito desde un tablero.",valores:{tarea:"Energizaci\xf3n de circuito el\xe9ctrico desde tablero",zona:"Sala el\xe9ctrica",categoriaPeligro:"F\xedsico",peligro:"Arco el\xe9ctrico durante maniobra de interruptor",riesgo:"Quemaduras graves, proyecci\xf3n de part\xedculas",probabilidad_hombre:3,consecuencia_hombre:5,probabilidad_mujer:3,consecuencia_mujer:5,jerarquiaControl:"EPP",control_especifico_genero:"Uso de traje ign\xedfugo (Arc Flash), careta facial, guantes diel\xe9ctricos. Maniobra realizada por personal autorizado y con 2do verificador.",responsable:"El\xe9ctrico de turno",plazo:"",estadoControl:"PENDIENTE",probabilidad_residual:1,consecuencia_residual:4}},{id:"mantenimiento_tablero_energizado",nombre:"Mantenimiento en Tablero Bajo Tensi\xf3n",descripcion:"Inspecci\xf3n y ajuste en tablero en servicio.",valores:{tarea:"Mantenimiento preventivo en tablero energizado",zona:"Sala de control",categoriaPeligro:"F\xedsico",peligro:"Contacto con partes y piezas energizadas",riesgo:"Electrocuci\xf3n, Fibrilaci\xf3n ventricular",probabilidad_hombre:5,consecuencia_hombre:5,probabilidad_mujer:5,consecuencia_mujer:5,jerarquiaControl:"Control Administrativo",control_especifico_genero:"Procedimiento de trabajo en caliente, bloqueo LOTO si aplica parcialmente, delimitaci\xf3n de 'zona prohibida'.",responsable:"Jefe de Mantenimiento",plazo:"",estadoControl:"PENDIENTE",probabilidad_residual:2,consecuencia_residual:5}}],eh={obraId:"",tarea:"",zona:"",peligro:"",riesgo:"",categoriaPeligro:"Mec\xe1nico",probabilidad_hombre:1,consecuencia_hombre:1,nivel_riesgo_hombre:1,probabilidad_mujer:1,consecuencia_mujer:1,nivel_riesgo_mujer:1,jerarquiaControl:"Control Administrativo",control_especifico_genero:"",responsable:"",plazo:"",estadoControl:"PENDIENTE",probabilidad_residual:1,consecuencia_residual:1,nivel_riesgo_residual:1,medidasControlExistentes:"",medidasControlPropuestas:"",responsableImplementacion:"",plazoImplementacion:"",firmaPrevencionistaUrl:void 0,firmaPrevencionistaNombre:void 0,firmaPrevencionistaRut:void 0,firmaPrevencionistaCargo:void 0,firmaPrevencionistaFecha:void 0,firmaPrevencionistaUserId:void 0},ex={obraId:"",obraNombre:"",iperId:"",titulo:"",tipo:"charla_iper",fechaCreacion:(0,t.Bt)(),creadaPorUid:"",generadaAutomaticamente:!1,tarea:"",zonaSector:"",peligro:"",riesgo:"",probHombres:0,consHombres:0,nivelHombres:0,probMujeres:0,consMujeres:0,nivelMujeres:0,controlGenero:"",estado:"borrador",contenido:""};function ep(){var e;let[a,s]=(0,r.useState)([]),[R,_]=(0,r.useState)(""),[E,z]=(0,r.useState)([]),[T,k]=(0,r.useState)([]),[H,O]=(0,r.useState)([]),[M,Z]=(0,r.useState)(!0),L=(0,l.useRouter)(),{user:U,companyId:B,role:G}=(0,N.a)(),{toast:V}=(0,A.pm)(),[$,q]=(0,r.useState)(eh),[Q,J]=(0,r.useState)(!1),[W,ee]=(0,r.useState)(null),[ea,es]=(0,r.useState)(""),[er,et]=(0,r.useState)("todos"),[en,el]=(0,r.useState)("iper"),[eo,ep]=(0,r.useState)(null),[ef,eg]=(0,r.useState)(ex),[ej,ev]=(0,r.useState)(!1),[eb,eN]=(0,r.useState)(!1),[eC,ey]=(0,r.useState)(null),[eP,eI]=(0,r.useState)(""),[eR,ew]=(0,r.useState)(""),[e_,eE]=(0,r.useState)(!1),[eS,eA]=(0,r.useState)(null),[ez,eD]=(0,r.useState)(null),[eT,eF]=(0,r.useState)(!1),[ek,eH]=(0,r.useState)(null),[eO,eM]=(0,r.useState)(!1);(0,r.useEffect)(()=>{let e;if(!B&&"superadmin"!==G)return;e="superadmin"===G?(0,t.IO)((0,t.hJ)(n.N$,"obras"),(0,t.Xo)("nombreFaena")):(0,t.IO)((0,t.hJ)(n.N$,"obras"),(0,t.ar)("empresaId","==",B),(0,t.Xo)("nombreFaena"));let a=(0,t.cf)(e,e=>{let a=e.docs.map(e=>({id:e.id,...e.data()}));s(a),a.length>0&&!R&&_(a[0].id)},e=>console.error("Error fetching obras:",e));return()=>a()},[B,G]),(0,r.useEffect)(()=>{if(!R){z([]),k([]),O([]),Z(!1);return}Z(!0),ee(null),ep(null);let e=[],a=(0,t.IO)((0,t.hJ)(n.N$,"investigacionesIncidentes"),(0,t.ar)("obraId","==",R),(0,t.Xo)("createdAt","desc"));e.push((0,t.cf)(a,e=>{z(e.docs.map(e=>({id:e.id,...e.data()})))}));let s=(0,t.hJ)(n.N$,"obras",R,"iper"),i=(0,t.IO)(s,(0,t.Xo)("createdAt","desc"));e.push((0,t.cf)(i,e=>{k(e.docs.map((a,s)=>({id:a.id,...a.data(),correlativo:e.docs.length-s}))),Z(!1)},e=>{console.error("Error fetching IPER:",e),Z(!1)}));let r=(0,t.IO)((0,t.hJ)(n.N$,"charlas"),(0,t.ar)("obraId","==",R),(0,t.Xo)("fechaCreacion","desc"));return e.push((0,t.cf)(r,e=>{O(e.docs.map(e=>({id:e.id,...e.data()})))})),()=>{e.forEach(e=>e())}},[R]);let eZ=(0,r.useMemo)(()=>T.filter(e=>{let a=""===ea.trim()||e.tarea.toLowerCase().includes(ea.toLowerCase())||e.peligro.toLowerCase().includes(ea.toLowerCase()),s="todos"===er||e.estadoControl===er;return a&&s}),[T,ea,er]),eL=async e=>{if(e.preventDefault(),!R){V({variant:"destructive",title:"Error",description:"Debe seleccionar una obra."});return}J(!0);try{let e=($.probabilidadHombre||1)*($.consecuenciaHombre||1),a=($.probabilidadMujer||1)*($.consecuenciaMujer||1),s=($.probabilidadResidual||1)*($.consecuenciaResidual||1),i={obraId:R,tarea:$.tarea,zona:$.zona,peligro:"Otro"===$.peligro?$.peligroOtro||"":$.peligro,riesgo:"Otro"===$.riesgo?$.riesgoOtro||"":$.riesgo,categoriaPeligro:$.categoriaPeligro,probabilidad_hombre:$.probabilidadHombre||1,consecuencia_hombre:$.consecuenciaHombre||1,nivel_riesgo_hombre:e,probabilidad_mujer:$.probabilidadMujer||1,consecuencia_mujer:$.consecuenciaMujer||1,nivel_riesgo_mujer:a,jerarquiaControl:$.jerarquiaControl,control_especifico_genero:"Otro"===$.controlEspecificoGenero?$.controlEspecificoGeneroOtro||"":$.controlEspecificoGenero||"",responsable:$.responsable||"",plazo:$.plazo||"",estadoControl:$.estadoControl,probabilidad_residual:$.probabilidadResidual||1,consecuencia_residual:$.consecuenciaResidual||1,nivel_riesgo_residual:s,createdAt:$.createdAt||(0,t.Bt)(),medidasControlExistentes:"",medidasControlPropuestas:"",responsableImplementacion:"",plazoImplementacion:""},r=$.id;if(r){let e=(0,t.JU)(n.N$,"obras",R,"iper",r);await (0,t.r7)(e,{...i,updatedAt:(0,t.Bt)()}),V({title:"\xc9xito",description:"Registro IPER actualizado."})}else{let e=(0,t.hJ)(n.N$,"obras",R,"iper");r=(await (0,t.ET)(e,i)).id,V({title:"\xc9xito",description:"Registro IPER guardado."})}if(eO&&ek){let e=await (await fetch(ek)).blob(),a=(0,eu.iH)(n.IG,"iper/".concat(r,"/firmaPrevencionista.png"));await (0,eu.KV)(a,e,{contentType:"image/png"});let s=await (0,eu.Jt)(a),i=(0,t.JU)(n.N$,"obras",R,"iper",r);await (0,t.r7)(i,{firmaPrevencionistaUrl:s,firmaPrevencionistaNombre:$.firmaPrevencionistaNombre,firmaPrevencionistaRut:$.firmaPrevencionistaRut,firmaPrevencionistaCargo:$.firmaPrevencionistaCargo,firmaPrevencionistaFecha:new Date().toISOString(),firmaPrevencionistaUserId:null==U?void 0:U.uid})}q(eh),ee(null),eH(null),eM(!1)}catch(e){console.error("Error guardando IPER:",e),V({variant:"destructive",title:"Error",description:"No se pudo guardar el registro IPER."})}finally{J(!1)}},eU=async e=>{if(R&&e)try{let a=(0,t.JU)(n.N$,"obras",R,"iper",e);await (0,t.oe)(a),V({title:"\xc9xito",description:"Registro IPER eliminado correctamente."}),ee(null)}catch(e){console.error("Error eliminando IPER:",e),V({variant:"destructive",title:"Error",description:"No se pudo eliminar el registro IPER."})}},eB=async()=>{if(!W||!U)return;let e=a.find(e=>e.id===R);if(e)try{let a={obraId:R,obraNombre:e.nombreFaena,iperId:W.id,iperIdRelacionado:W.id,titulo:"Charla de seguridad: ".concat(W.tarea),tipo:"charla_iper",fechaCreacion:(0,t.Bt)(),creadaPorUid:U.uid,generadaAutomaticamente:!0,tarea:W.tarea,zonaSector:W.zona,peligro:W.peligro,riesgo:W.riesgo,probHombres:W.probabilidad_hombre,consHombres:W.consecuencia_hombre,nivelHombres:W.nivel_riesgo_hombre,probMujeres:W.probabilidad_mujer,consMujeres:W.consecuencia_mujer,nivelMujeres:W.nivel_riesgo_mujer,controlGenero:W.control_especifico_genero,estado:"borrador",contenido:'Esta charla se enfoca en el riesgo de "'.concat(W.riesgo,'" durante la tarea de "').concat(W.tarea,'". Se deben aplicar las siguientes medidas de control: ').concat(W.medidasControlPropuestas||W.control_especifico_genero,". El nivel de riesgo inherente es ").concat(Math.max(W.nivel_riesgo_hombre,W.nivel_riesgo_mujer),".")},s=await (0,t.ET)((0,t.hJ)(n.N$,"charlas"),a);V({title:"Charla Generada",description:"Se ha creado una nueva charla en borrador."}),el("charlas"),ep(s.id)}catch(e){console.error("Error generando charla desde IPER:",e),V({variant:"destructive",title:"Error",description:"No se pudo generar la charla."})}},eG=(0,r.useMemo)(()=>H.find(e=>e.id===eo),[H,eo]);(0,r.useEffect)(()=>{eG?eg(eG):eg(ex)},[eG]);let eY=async e=>{if(e.preventDefault(),!R||!ef.titulo){V({variant:"destructive",title:"Error",description:"La obra y el t\xedtulo son obligatorios."});return}ev(!0);try{if(ef.id){let e=(0,t.JU)(n.N$,"charlas",ef.id);await (0,t.r7)(e,{...ef,fechaRealizacion:ef.fechaRealizacion?new Date(ef.fechaRealizacion):null})}else{let e=await (0,t.ET)((0,t.hJ)(n.N$,"charlas"),{...ef,obraId:R,fechaCreacion:(0,t.Bt)(),fechaRealizacion:ef.fechaRealizacion?new Date(ef.fechaRealizacion):null});ep(e.id)}V({title:"\xc9xito",description:"Charla guardada correctamente."})}catch(e){console.error(e),V({variant:"destructive",title:"Error",description:"No se pudo guardar la charla."})}finally{ev(!1)}},eV=e=>{if(!e)return"";let a=e.replace(/[^0-9kK]/g,"");if(0===a.length)return"";let s=a.slice(0,-1),i=a.slice(-1).toUpperCase();return 0===s.length?i:(s=s.replace(/\B(?=(\d{3})+(?!\d))/g,"."),"".concat(s,"-").concat(i))},e$=async()=>{if(!eo||!eP.trim()||!eR.trim()){V({variant:"destructive",title:"Error",description:"Nombre y RUT son obligatorios."});return}let e={nombre:eP,rut:eV(eR)},a=(0,t.JU)(n.N$,"charlas",eo),s=(null==eG?void 0:eG.asistentes)||[];await (0,t.r7)(a,{asistentes:[...s,e]}),eI(""),ew("")},eq=async()=>{if(!eo||!ez||null===eS)return;let e=[...(null==eG?void 0:eG.asistentes)||[]];e[eS]={...e[eS],nombre:ez.nombre,rut:eV(ez.rut)};let a=(0,t.JU)(n.N$,"charlas",eo);await (0,t.r7)(a,{asistentes:e}),eA(null),eD(null),V({title:"Asistente actualizado"})},eQ=async e=>{if(!eo)return;let a=((null==eG?void 0:eG.asistentes)||[]).filter((a,s)=>s!==e),s=(0,t.JU)(n.N$,"charlas",eo);await (0,t.r7)(s,{asistentes:a}),V({title:"Asistente eliminado"})},eJ=async e=>{if(e&&eC&&eo)try{let a=await (await fetch(e)).blob(),s=(0,eu.iH)(n.IG,"charlas/".concat(eo,"/firmas/").concat(eC.nombre.replace(/ /g,"_"),".png"));await (0,eu.KV)(s,a,{contentType:"image/png"});let i=await (0,eu.Jt)(s),r=(0,t.JU)(n.N$,"charlas",eo),l=((null==eG?void 0:eG.asistentes)||[]).map(e=>e.nombre===eC.nombre?{...e,firmaUrl:i,firmadoEn:new Date().toISOString(),firmadoPorUsuarioId:null==U?void 0:U.uid}:e);await (0,t.r7)(r,{asistentes:l}),V({title:"Firma guardada"}),eN(!1)}catch(e){console.error("Error guardando firma:",e),V({variant:"destructive",title:"Error",description:"No se pudo guardar la firma."})}},eW=async e=>{if(e)try{await (0,t.oe)((0,t.JU)(n.N$,"charlas",e)),V({title:"Charla eliminada"}),eo===e&&ep(null)}catch(e){console.error(e),V({variant:"destructive",title:"Error",description:"No se pudo eliminar la charla."})}},eX=e=>{q(a=>({...a,...e.valores,id:void 0,createdAt:void 0})),eE(!1),V({title:"Plantilla aplicada",description:'Se han cargado los valores de "'.concat(e.nombre,'".')})};return(0,i.jsxs)("section",{className:"space-y-6",children:[(0,i.jsxs)("header",{className:"flex items-center gap-4 no-print",children:[(0,i.jsx)(f.z,{variant:"outline",size:"icon",onClick:()=>L.push("/prevencion"),children:(0,i.jsx)(o.Z,{})}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"Formularios Generales de Prevenci\xf3n"}),(0,i.jsx)("p",{className:"text-lg text-muted-foreground",children:"Herramientas para registrar y analizar eventos, desde casi accidentes hasta accidentes graves, e identificar peligros."})]})]}),(0,i.jsxs)(g.Zb,{children:[(0,i.jsxs)(g.Ol,{children:[(0,i.jsx)(g.ll,{children:"Selecci\xf3n de Obra"}),(0,i.jsx)(g.SZ,{children:"Seleccione la obra para ver y registrar formularios."})]}),(0,i.jsx)(g.aY,{children:(0,i.jsxs)("div",{className:"max-w-md space-y-2",children:[(0,i.jsx)(j._,{htmlFor:"obra-select",children:"Obra Activa"}),(0,i.jsxs)(v.Ph,{value:R,onValueChange:_,children:[(0,i.jsx)(v.i4,{id:"obra-select",children:(0,i.jsx)(v.ki,{placeholder:"Seleccione una obra..."})}),(0,i.jsx)(v.Bw,{children:a.map(e=>(0,i.jsx)(v.Ql,{value:e.id,children:e.nombreFaena},e.id))})]})]})})]}),(0,i.jsxs)(b.mQ,{value:en,onValueChange:e=>el(e),className:"w-full",children:[(0,i.jsxs)(b.dr,{className:"grid w-full grid-cols-4",children:[(0,i.jsx)(b.SP,{value:"iper",children:"IPER con Enfoque de G\xe9nero"}),(0,i.jsx)(b.SP,{value:"incidentes",children:"Incidentes (Ishikawa / 5 Porqu\xe9s)"}),(0,i.jsx)(b.SP,{value:"accidentes",children:"Accidentes (\xc1rbol de Causas)"}),(0,i.jsx)(b.SP,{value:"charlas",children:"Charlas de Seguridad"})]}),(0,i.jsx)(b.nU,{value:"iper",children:(0,i.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 items-start",children:[(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)(g.Zb,{children:[(0,i.jsxs)(g.Ol,{children:[(0,i.jsx)(g.ll,{children:$.id?"Editando IPER":"Registrar Nuevo IPER con enfoque de g\xe9nero"}),(0,i.jsx)(g.SZ,{children:"Identifique peligros, eval\xfae riesgos y proponga controles."})]}),(0,i.jsx)(g.aY,{children:(0,i.jsxs)("form",{onSubmit:eL,children:[(0,i.jsx)("div",{className:"mb-4",children:(0,i.jsxs)(f.z,{type:"button",variant:"outline",onClick:()=>eE(!0),children:[(0,i.jsx)(c.Z,{className:"mr-2 h-4 w-4 text-yellow-500"}),"Usar IPER El\xe9ctrico Predise\xf1ado"]})}),(0,i.jsx)(X,{value:$,onChange:e=>q(a=>({...a,...e}))}),(0,i.jsx)(F.Z,{className:"my-6"}),(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsx)("h4",{className:"font-semibold text-md",children:"Firma del Prevencionista / Responsable"}),(0,i.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)(j._,{children:"Nombre"}),(0,i.jsx)(C.I,{value:$.firmaPrevencionistaNombre||"",onChange:e=>q(a=>({...a,firmaPrevencionistaNombre:e.target.value}))})]}),(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)(j._,{children:"RUT"}),(0,i.jsx)(C.I,{value:$.firmaPrevencionistaRut||"",onChange:e=>q(a=>({...a,firmaPrevencionistaRut:e.target.value}))})]})]}),(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)(j._,{children:"Cargo"}),(0,i.jsx)(C.I,{value:$.firmaPrevencionistaCargo||"",onChange:e=>q(a=>({...a,firmaPrevencionistaCargo:e.target.value}))})]}),$.firmaPrevencionistaUrl?(0,i.jsxs)("div",{className:"text-center p-2 border rounded-md bg-green-50",children:[(0,i.jsx)("p",{className:"text-sm font-medium text-green-700",children:"Firma guardada."}),(0,i.jsx)("img",{src:$.firmaPrevencionistaUrl,alt:"Firma",className:"mx-auto h-16"})]}):(0,i.jsx)(f.z,{type:"button",variant:"secondary",className:"w-full",onClick:()=>eF(!0),children:"Abrir panel para firmar"})]}),(0,i.jsxs)("div",{className:"flex gap-4 mt-6",children:[(0,i.jsx)(f.z,{type:"submit",disabled:Q,children:Q?"Guardando IPER...":$.id?"Actualizar Registro IPER":"Guardar Registro IPER"}),(0,i.jsx)(f.z,{type:"button",variant:"outline",onClick:()=>{q(eh),ee(null)},children:"Limpiar / Nuevo"})]})]})})]}),(0,i.jsxs)(g.Zb,{children:[(0,i.jsxs)(g.Ol,{children:[(0,i.jsx)(g.ll,{children:"Historial de IPER Registrados"}),(0,i.jsx)(g.SZ,{children:"Seleccione un registro para ver sus detalles y acciones."})]}),(0,i.jsxs)(g.aY,{children:[(0,i.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2 mb-4",children:[(0,i.jsx)(C.I,{placeholder:"Buscar por tarea o peligro...",value:ea,onChange:e=>es(e.target.value)}),(0,i.jsxs)(v.Ph,{value:er,onValueChange:et,children:[(0,i.jsx)(v.i4,{className:"w-full sm:w-[200px]",children:(0,i.jsx)(v.ki,{})}),(0,i.jsxs)(v.Bw,{children:[(0,i.jsx)(v.Ql,{value:"todos",children:"Todos los estados"}),(0,i.jsx)(v.Ql,{value:"PENDIENTE",children:"Pendiente"}),(0,i.jsx)(v.Ql,{value:"EN_EJECUCION",children:"En Ejecuci\xf3n"}),(0,i.jsx)(v.Ql,{value:"IMPLEMENTADO",children:"Implementado"}),(0,i.jsx)(v.Ql,{value:"RECHAZADO",children:"Rechazado"})]})]})]}),M?(0,i.jsx)("p",{children:"Cargando..."}):0===eZ.length?(0,i.jsx)("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No hay registros IPER que coincidan con los filtros."}):(0,i.jsx)("div",{className:"border rounded-md max-h-96 overflow-y-auto",children:(0,i.jsxs)(I.iA,{children:[(0,i.jsx)(I.xD,{children:(0,i.jsxs)(I.SC,{children:[(0,i.jsx)(I.ss,{children:"Fecha"}),(0,i.jsx)(I.ss,{children:"Tarea"}),(0,i.jsx)(I.ss,{children:"Riesgo"}),(0,i.jsx)(I.ss,{children:"Estado"})]})}),(0,i.jsx)(I.RM,{children:eZ.map(e=>{var a;return(0,i.jsxs)(I.SC,{onClick:()=>ee(e),className:(0,K.cn)("cursor-pointer",(null==W?void 0:W.id)===e.id&&"bg-accent/20"),children:[(0,i.jsx)(I.pj,{className:"text-xs",children:null===(a=e.createdAt)||void 0===a?void 0:a.toDate().toLocaleDateString("es-CL")}),(0,i.jsx)(I.pj,{className:"font-medium text-xs",children:e.tarea}),(0,i.jsx)(I.pj,{className:"text-xs",children:Math.max(e.nivel_riesgo_hombre,e.nivel_riesgo_mujer)}),(0,i.jsx)(I.pj,{className:"text-xs",children:e.estadoControl.replace("_"," ")})]},e.id)})})]})})]})]})]}),(0,i.jsx)("div",{className:"sticky top-24",children:W?(0,i.jsxs)(g.Zb,{children:[(0,i.jsx)(g.Ol,{children:(0,i.jsxs)("div",{className:"flex justify-between items-start",children:[(0,i.jsxs)("div",{children:[(0,i.jsxs)(g.ll,{children:["Detalle de IPER: ",W.tarea]}),(0,i.jsxs)(g.SZ,{children:["Peligro: ",W.peligro]})]}),(0,i.jsxs)(P.C,{variant:"outline",children:["IPER-",String(W.correlativo).padStart(3,"0")]})]})}),(0,i.jsxs)(g.aY,{className:"space-y-4 text-sm",children:[(0,i.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:"font-semibold",children:"Riesgo Inherente (H/M)"}),(0,i.jsxs)("p",{children:[(0,i.jsx)("span",{className:"font-bold text-blue-600",children:W.nivel_riesgo_hombre})," / ",(0,i.jsx)("span",{className:"font-bold text-pink-600",children:W.nivel_riesgo_mujer})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:"font-semibold",children:"Riesgo Residual"}),(0,i.jsx)("p",{className:"font-bold text-green-700",children:W.nivel_riesgo_residual})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:"font-semibold",children:"Fecha de Creaci\xf3n"}),(0,i.jsx)("p",{className:"text-muted-foreground",children:null===(e=W.createdAt)||void 0===e?void 0:e.toDate().toLocaleDateString("es-CL")})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:"font-semibold",children:"Estado del Control"}),(0,i.jsx)("p",{className:"font-bold",children:W.estadoControl})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:"font-semibold",children:"Control Espec\xedfico G\xe9nero"}),(0,i.jsx)("p",{className:"text-muted-foreground",children:W.control_especifico_genero||"No especificado"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:"font-semibold",children:"Responsable"}),(0,i.jsx)("p",{className:"text-muted-foreground",children:W.responsable||"No asignado"})]}),(0,i.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,i.jsxs)(f.z,{onClick:()=>q(W),children:[(0,i.jsx)(d.Z,{className:"mr-2 h-4 w-4"}),"Editar IPER"]}),(0,i.jsxs)(f.z,{variant:"outline",onClick:()=>{if(!W)return;let e=a.find(e=>e.id===R);if(!e){V({variant:"destructive",title:"Error",description:"No se encontr\xf3 la obra para generar el PDF."});return}ei(W,e)},children:[(0,i.jsx)(u.Z,{className:"mr-2 h-4 w-4"}),"Descargar Ficha PDF"]}),(0,i.jsxs)(S.aR,{children:[(0,i.jsx)(S.vW,{asChild:!0,children:(0,i.jsx)(f.z,{variant:"ghost",size:"icon",className:"text-destructive",children:(0,i.jsx)(m.Z,{className:"h-4 w-4"})})}),(0,i.jsxs)(S._T,{children:[(0,i.jsxs)(S.fY,{children:[(0,i.jsx)(S.f$,{children:"\xbfEliminar este registro IPER?"}),(0,i.jsxs)(S.yT,{children:["Esta acci\xf3n no se puede deshacer y eliminar\xe1 permanentemente el registro de la tarea '",W.tarea,"'."]})]}),(0,i.jsxs)(S.xo,{children:[(0,i.jsx)(S.le,{children:"Cancelar"}),(0,i.jsx)(S.OL,{onClick:()=>eU(W.id),className:"bg-destructive hover:bg-destructive/90",children:"Eliminar"})]})]})]})]}),(0,i.jsx)("div",{className:"pt-2",children:(0,i.jsxs)(f.z,{onClick:eB,variant:"secondary",className:"w-full",children:[(0,i.jsx)(h.Z,{className:"mr-2 h-4 w-4"}),"Generar Charla de Seguridad desde IPER"]})})]})]}):(0,i.jsx)(g.Zb,{className:"flex items-center justify-center h-96 border-dashed",children:(0,i.jsx)("p",{className:"text-muted-foreground",children:"Seleccione un IPER del listado para ver su detalle."})})})]})}),(0,i.jsx)(b.nU,{value:"incidentes",children:(0,i.jsx)(D,{obraId:R,investigaciones:E.filter(e=>"arbol_causas"!==e.metodoAnalisis),loading:M,onUpdate:()=>{}})}),(0,i.jsx)(b.nU,{value:"accidentes",children:(0,i.jsx)(Y,{obraId:R,investigaciones:E.filter(e=>"arbol_causas"===e.metodoAnalisis),loading:M,onUpdate:()=>{}})}),(0,i.jsx)(b.nU,{value:"charlas",children:(0,i.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 items-start",children:[(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)(g.Zb,{children:[(0,i.jsx)(g.Ol,{children:(0,i.jsx)(g.ll,{children:eo?"Editar Charla":"Registrar Nueva Charla"})}),(0,i.jsx)(g.aY,{children:(0,i.jsxs)("form",{onSubmit:eY,className:"space-y-4",children:[(0,i.jsx)(C.I,{value:ef.titulo||"",onChange:e=>eg(a=>({...a,titulo:e.target.value})),placeholder:"T\xedtulo de la charla"}),(0,i.jsx)(y.g,{value:ef.contenido||"",onChange:e=>eg(a=>({...a,contenido:e.target.value})),placeholder:"Contenido o temas a tratar..."}),(0,i.jsxs)("div",{className:"flex gap-4",children:[(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsx)(j._,{children:"Fecha Realizaci\xf3n"}),(0,i.jsx)(C.I,{type:"date",value:ef.fechaRealizacion?new Date(ef.fechaRealizacion).toISOString().slice(0,10):"",onChange:e=>eg(a=>({...a,fechaRealizacion:e.target.value}))})]}),(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsx)(j._,{children:"Estado"}),(0,i.jsxs)(v.Ph,{value:ef.estado,onValueChange:e=>eg(a=>({...a,estado:e})),children:[(0,i.jsx)(v.i4,{children:(0,i.jsx)(v.ki,{})}),(0,i.jsxs)(v.Bw,{children:[(0,i.jsx)(v.Ql,{value:"borrador",children:"Borrador"}),(0,i.jsx)(v.Ql,{value:"realizada",children:"Realizada"})]})]})]})]}),(0,i.jsx)(f.z,{type:"submit",disabled:ej,children:ej?"Guardando...":"Guardar Charla"})]})})]}),(0,i.jsxs)(g.Zb,{children:[(0,i.jsx)(g.Ol,{children:(0,i.jsx)(g.ll,{children:"Listado de Charlas"})}),(0,i.jsx)(g.aY,{children:H.map(e=>(0,i.jsxs)("div",{className:"flex justify-between items-center p-2 rounded-md hover:bg-muted/50",children:[(0,i.jsxs)("div",{onClick:()=>ep(e.id),className:(0,K.cn)("flex-1 cursor-pointer",eo===e.id&&"font-bold"),children:[(0,i.jsx)("p",{className:"font-medium",children:e.titulo}),e.fechaCreacion&&(0,i.jsx)("p",{className:"text-xs text-muted-foreground",children:e.fechaCreacion.toDate().toLocaleDateString()})]}),(0,i.jsxs)(S.aR,{children:[(0,i.jsx)(S.vW,{asChild:!0,children:(0,i.jsx)(f.z,{variant:"ghost",size:"icon",className:"text-destructive h-8 w-8",onClick:e=>e.stopPropagation(),children:(0,i.jsx)(m.Z,{className:"h-4 w-4"})})}),(0,i.jsxs)(S._T,{children:[(0,i.jsxs)(S.fY,{children:[(0,i.jsx)(S.f$,{children:"\xbfEliminar esta charla?"}),(0,i.jsx)(S.yT,{children:"Esta acci\xf3n no se puede deshacer."})]}),(0,i.jsxs)(S.xo,{children:[(0,i.jsx)(S.le,{children:"Cancelar"}),(0,i.jsx)(S.OL,{onClick:()=>eW(e.id),className:"bg-destructive hover:bg-destructive/90",children:"Eliminar"})]})]})]})]},e.id))})]})]}),(0,i.jsx)("div",{className:"sticky top-24",children:eG?(0,i.jsxs)(g.Zb,{children:[(0,i.jsxs)(g.Ol,{children:[(0,i.jsx)(g.ll,{children:eG.titulo}),(0,i.jsxs)(g.SZ,{children:["ID: ",eG.id]})]}),(0,i.jsxs)(g.aY,{children:[(0,i.jsx)("h4",{className:"font-semibold mb-2",children:"Asistentes"}),(0,i.jsx)("div",{className:"space-y-2 mb-4",children:(eG.asistentes||[]).map((e,a)=>(0,i.jsx)("div",{className:"flex justify-between items-center text-sm p-2 rounded-md bg-muted/50",children:eS===a?(0,i.jsxs)("div",{className:"flex gap-2 items-center flex-1",children:[(0,i.jsx)(C.I,{value:(null==ez?void 0:ez.nombre)||"",onChange:e=>eD(a=>({...a,nombre:e.target.value})),className:"h-8"}),(0,i.jsx)(C.I,{value:(null==ez?void 0:ez.rut)||"",onChange:e=>eD(a=>({...a,rut:eV(e.target.value)})),className:"h-8 w-28"}),(0,i.jsx)(f.z,{size:"sm",onClick:eq,children:"Guardar"}),(0,i.jsx)(f.z,{size:"sm",variant:"ghost",onClick:()=>eA(null),children:"Cancelar"})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:"font-medium",children:e.nombre}),(0,i.jsx)("p",{className:"text-xs text-muted-foreground",children:e.rut})]}),(0,i.jsxs)("div",{className:"flex items-center gap-1",children:[e.firmaUrl?(0,i.jsx)(P.C,{children:"Firmado"}):(0,i.jsx)(f.z,{size:"sm",variant:"outline",onClick:()=>{ey(e),eN(!0)},children:"Firmar"}),(0,i.jsx)(f.z,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>{eA(a),eD(e)},children:(0,i.jsx)(x.Z,{className:"h-4 w-4"})}),(0,i.jsxs)(S.aR,{children:[(0,i.jsx)(S.vW,{asChild:!0,children:(0,i.jsx)(f.z,{variant:"ghost",size:"icon",className:"text-destructive h-8 w-8",children:(0,i.jsx)(m.Z,{className:"h-4 w-4"})})}),(0,i.jsxs)(S._T,{children:[(0,i.jsxs)(S.fY,{children:[(0,i.jsx)(S.f$,{children:"\xbfEliminar Asistente?"}),(0,i.jsxs)(S.yT,{children:["Se eliminar\xe1 a ",e.nombre," de la lista."]})]}),(0,i.jsxs)(S.xo,{children:[(0,i.jsx)(S.le,{children:"Cancelar"}),(0,i.jsx)(S.OL,{onClick:()=>eQ(a),className:"bg-destructive hover:bg-destructive/90",children:"Eliminar"})]})]})]})]})]})},a))}),(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsx)(C.I,{value:eP,onChange:e=>eI(e.target.value),placeholder:"Nombre del asistente"}),(0,i.jsx)(C.I,{value:eR,onChange:e=>ew(e.target.value),placeholder:"RUT del asistente"}),(0,i.jsxs)(f.z,{onClick:e$,children:[(0,i.jsx)(p.Z,{size:16})," Agregar"]})]})]}),(0,i.jsx)(g.eW,{children:(0,i.jsx)(ec,{charla:eG,obra:a.find(e=>e.id===R)})})]}):(0,i.jsx)(g.Zb,{className:"flex items-center justify-center h-96 border-dashed",children:(0,i.jsx)("p",{className:"text-muted-foreground",children:"Seleccione una charla para ver sus detalles."})})})]})})]}),(0,i.jsx)(S.aR,{open:eb,onOpenChange:eN,children:(0,i.jsxs)(S._T,{children:[(0,i.jsx)(S.fY,{children:(0,i.jsxs)(S.f$,{children:["Firmar Asistencia: ",null==eC?void 0:eC.nombre]})}),(0,i.jsx)(ed.Z,{onChange:eJ,onClear:()=>{}})]})}),(0,i.jsx)(w.Vq,{open:eT,onOpenChange:eF,children:(0,i.jsxs)(w.cZ,{children:[(0,i.jsx)(w.fK,{children:(0,i.jsx)(w.$N,{children:"Firmar como Prevencionista Responsable"})}),(0,i.jsx)(ed.Z,{onChange:e=>eH(e),onClear:()=>{eH(null),eM(!1)},onDraw:()=>eM(!0)}),(0,i.jsxs)(w.cN,{children:[(0,i.jsx)(f.z,{variant:"ghost",onClick:()=>eF(!1),children:"Cancelar"}),(0,i.jsx)(f.z,{onClick:()=>{if(!eO){V({variant:"destructive",title:"Firma Vac\xeda",description:"Debe dibujar la firma para guardarla."});return}eF(!1)},children:"Confirmar Firma"})]})]})}),(0,i.jsx)(w.Vq,{open:e_,onOpenChange:eE,children:(0,i.jsxs)(w.cZ,{className:"max-w-2xl bg-slate-50",children:[(0,i.jsxs)(w.fK,{children:[(0,i.jsx)(w.$N,{className:"text-xl font-semibold",children:"Seleccionar Plantilla IPER para Trabajos El\xe9ctricos"}),(0,i.jsx)(w.Be,{className:"text-sm text-muted-foreground",children:"Elija una plantilla para pre-rellenar el formulario con datos estandarizados. Podr\xe1 ajustarlos antes de guardar."})]}),(0,i.jsx)("div",{className:"py-4 space-y-3 max-h-[60vh] overflow-y-auto",children:em.map(e=>(0,i.jsxs)("div",{className:"border-l-4 border-blue-500 rounded-r-lg bg-white p-4 shadow-sm hover:shadow-lg hover:-translate-y-1 transition-all duration-150 cursor-pointer flex justify-between items-center gap-4",onClick:()=>eX(e),children:[(0,i.jsxs)("div",{className:"flex items-start gap-4",children:[(0,i.jsx)("div",{className:"p-2 bg-blue-100 rounded-full mt-1",children:(0,i.jsx)(c.Z,{className:"h-5 w-5 text-blue-600"})}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h4",{className:"font-semibold text-base",children:e.nombre}),(0,i.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:e.descripcion})]})]}),(0,i.jsx)(f.z,{className:"px-5 py-2 text-sm font-semibold flex-shrink-0",onClick:a=>{a.stopPropagation(),eX(e)},children:"Aplicar"})]},e.id))})]})})]})}},27316:function(e,a,s){"use strict";s.d(a,{Z:function(){return n}});var i=s(57437),r=s(2265),t=s(12381);function n(e){let{onChange:a,onClear:s,onDraw:n}=e,l=(0,r.useRef)(null),o=!1,c=0,d=0;(0,r.useEffect)(()=>{let e=l.current;if(e){let a=Math.max(window.devicePixelRatio||1,1);e.width=e.offsetWidth*a,e.height=e.offsetHeight*a;let s=e.getContext("2d");s&&(s.scale(a,a),s.fillStyle="#ffffff",s.fillRect(0,0,e.width,e.height))}},[]);let u=e=>{let a=l.current.getBoundingClientRect(),s=e.touches?e.touches[0]:e;return{x:s.clientX-a.left,y:s.clientY-a.top}},m=e=>{e.preventDefault(),o=!0;let{x:a,y:s}=u(e);[c,d]=[a,s],null==n||n()},h=e=>{if(e.preventDefault(),!o)return;let a=l.current.getContext("2d"),{x:s,y:i}=u(e);a.beginPath(),a.moveTo(c,d),a.lineTo(s,i),a.strokeStyle="#000000",a.lineWidth=2,a.lineCap="round",a.stroke(),[c,d]=[s,i]},x=async()=>{if(!o)return;o=!1;let e=l.current.toDataURL("image/png");await (await fetch(e)).blob(),a(e)};return(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)("canvas",{ref:l,className:"w-full h-40 rounded-md border bg-white touch-none",onMouseDown:m,onMouseMove:h,onMouseUp:x,onMouseLeave:x,onTouchStart:m,onTouchMove:h,onTouchEnd:x}),(0,i.jsx)(t.z,{type:"button",onClick:()=>{let e=l.current,a=e.getContext("2d");a.fillStyle="#ffffff",a.fillRect(0,0,e.width,e.height),s()},variant:"outline",size:"sm",children:"Limpiar Firma"})]})}},30767:function(e,a,s){"use strict";s.d(a,{OL:function(){return g},_T:function(){return m},aR:function(){return o},f$:function(){return p},fY:function(){return h},le:function(){return j},vW:function(){return c},xo:function(){return x},yT:function(){return f}});var i=s(57437),r=s(2265),t=s(7880),n=s(93448),l=s(12381);let o=t.fC,c=t.xz,d=t.h_,u=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,i.jsx)(t.aV,{className:(0,n.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...r,ref:a})});u.displayName=t.aV.displayName;let m=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,i.jsxs)(d,{children:[(0,i.jsx)(u,{}),(0,i.jsx)(t.VY,{ref:a,className:(0,n.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...r})]})});m.displayName=t.VY.displayName;let h=e=>{let{className:a,...s}=e;return(0,i.jsx)("div",{className:(0,n.cn)("flex flex-col space-y-2 text-center sm:text-left",a),...s})};h.displayName="AlertDialogHeader";let x=e=>{let{className:a,...s}=e;return(0,i.jsx)("div",{className:(0,n.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...s})};x.displayName="AlertDialogFooter";let p=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,i.jsx)(t.Dx,{ref:a,className:(0,n.cn)("text-lg font-semibold",s),...r})});p.displayName=t.Dx.displayName;let f=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,i.jsx)(t.dk,{ref:a,className:(0,n.cn)("text-sm text-muted-foreground",s),...r})});f.displayName=t.dk.displayName;let g=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,i.jsx)(t.aU,{ref:a,className:(0,n.cn)((0,l.d)(),s),...r})});g.displayName=t.aU.displayName;let j=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,i.jsx)(t.$j,{ref:a,className:(0,n.cn)((0,l.d)({variant:"outline"}),"mt-2 sm:mt-0",s),...r})});j.displayName=t.$j.displayName},69174:function(e,a,s){"use strict";s.d(a,{C:function(){return l}});var i=s(57437);s(2265);var r=s(90535),t=s(93448);let n=(0,r.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function l(e){let{className:a,variant:s,...r}=e;return(0,i.jsx)("div",{className:(0,t.cn)(n({variant:s}),a),...r})}},68245:function(e,a,s){"use strict";s.d(a,{X:function(){return o}});var i=s(57437),r=s(2265),t=s(9270),n=s(59559),l=s(93448);let o=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,i.jsx)(t.fC,{ref:a,className:(0,l.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s),...r,children:(0,i.jsx)(t.z$,{className:(0,l.cn)("flex items-center justify-center text-current"),children:(0,i.jsx)(n.Z,{className:"h-4 w-4"})})})});o.displayName=t.fC.displayName},74291:function(e,a,s){"use strict";s.d(a,{$N:function(){return p},Be:function(){return f},Vq:function(){return o},cN:function(){return x},cZ:function(){return m},fK:function(){return h},hg:function(){return c}});var i=s(57437),r=s(2265),t=s(70001),n=s(44986),l=s(93448);let o=t.fC,c=t.xz,d=t.h_;t.x8;let u=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,i.jsx)(t.aV,{ref:a,className:(0,l.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...r})});u.displayName=t.aV.displayName;let m=r.forwardRef((e,a)=>{let{className:s,children:r,...o}=e;return(0,i.jsxs)(d,{children:[(0,i.jsx)(u,{}),(0,i.jsxs)(t.VY,{ref:a,className:(0,l.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...o,children:[r,(0,i.jsxs)(t.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,i.jsx)(n.Z,{className:"h-4 w-4"}),(0,i.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});m.displayName=t.VY.displayName;let h=e=>{let{className:a,...s}=e;return(0,i.jsx)("div",{className:(0,l.cn)("flex flex-col space-y-1.5 text-center sm:text-left",a),...s})};h.displayName="DialogHeader";let x=e=>{let{className:a,...s}=e;return(0,i.jsx)("div",{className:(0,l.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...s})};x.displayName="DialogFooter";let p=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,i.jsx)(t.Dx,{ref:a,className:(0,l.cn)("text-lg font-semibold leading-none tracking-tight",s),...r})});p.displayName=t.Dx.displayName;let f=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,i.jsx)(t.dk,{ref:a,className:(0,l.cn)("text-sm text-muted-foreground",s),...r})});f.displayName=t.dk.displayName},15291:function(e,a,s){"use strict";s.d(a,{Bw:function(){return p},Ph:function(){return d},Ql:function(){return f},i4:function(){return m},ki:function(){return u}});var i=s(57437),r=s(2265),t=s(74797),n=s(3289),l=s(47969),o=s(59559),c=s(93448);let d=t.fC;t.ZA;let u=t.B4,m=r.forwardRef((e,a)=>{let{className:s,children:r,...l}=e;return(0,i.jsxs)(t.xz,{ref:a,className:(0,c.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...l,children:[r,(0,i.jsx)(t.JO,{asChild:!0,children:(0,i.jsx)(n.Z,{className:"h-4 w-4 opacity-50"})})]})});m.displayName=t.xz.displayName;let h=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,i.jsx)(t.u_,{ref:a,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",s),...r,children:(0,i.jsx)(l.Z,{className:"h-4 w-4"})})});h.displayName=t.u_.displayName;let x=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,i.jsx)(t.$G,{ref:a,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",s),...r,children:(0,i.jsx)(n.Z,{className:"h-4 w-4"})})});x.displayName=t.$G.displayName;let p=r.forwardRef((e,a)=>{let{className:s,children:r,position:n="popper",...l}=e;return(0,i.jsx)(t.h_,{children:(0,i.jsxs)(t.VY,{ref:a,className:(0,c.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===n&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:n,...l,children:[(0,i.jsx)(h,{}),(0,i.jsx)(t.l_,{className:(0,c.cn)("p-1","popper"===n&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),(0,i.jsx)(x,{})]})})});p.displayName=t.VY.displayName,r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,i.jsx)(t.__,{ref:a,className:(0,c.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...r})}).displayName=t.__.displayName;let f=r.forwardRef((e,a)=>{let{className:s,children:r,...n}=e;return(0,i.jsxs)(t.ck,{ref:a,className:(0,c.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...n,children:[(0,i.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,i.jsx)(t.wU,{children:(0,i.jsx)(o.Z,{className:"h-4 w-4"})})}),(0,i.jsx)(t.eT,{children:r})]})});f.displayName=t.ck.displayName,r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,i.jsx)(t.Z0,{ref:a,className:(0,c.cn)("-mx-1 my-1 h-px bg-muted",s),...r})}).displayName=t.Z0.displayName},31593:function(e,a,s){"use strict";s.d(a,{Z:function(){return l}});var i=s(57437),r=s(2265),t=s(90759),n=s(93448);let l=r.forwardRef((e,a)=>{let{className:s,orientation:r="horizontal",decorative:l=!0,...o}=e;return(0,i.jsx)(t.f,{ref:a,decorative:l,orientation:r,className:(0,n.cn)("shrink-0 bg-border","horizontal"===r?"h-[1px] w-full":"h-full w-[1px]",s),...o})});l.displayName=t.f.displayName},33804:function(e,a,s){"use strict";s.d(a,{RM:function(){return o},SC:function(){return c},iA:function(){return n},pj:function(){return u},ss:function(){return d},xD:function(){return l}});var i=s(57437),r=s(2265),t=s(93448);let n=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,i.jsx)("div",{className:"relative w-full overflow-auto",children:(0,i.jsx)("table",{ref:a,className:(0,t.cn)("w-full caption-bottom text-sm",s),...r})})});n.displayName="Table";let l=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,i.jsx)("thead",{ref:a,className:(0,t.cn)("[&_tr]:border-b",s),...r})});l.displayName="TableHeader";let o=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,i.jsx)("tbody",{ref:a,className:(0,t.cn)("[&_tr:last-child]:border-0",s),...r})});o.displayName="TableBody",r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,i.jsx)("tfoot",{ref:a,className:(0,t.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",s),...r})}).displayName="TableFooter";let c=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,i.jsx)("tr",{ref:a,className:(0,t.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",s),...r})});c.displayName="TableRow";let d=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,i.jsx)("th",{ref:a,className:(0,t.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",s),...r})});d.displayName="TableHead";let u=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,i.jsx)("td",{ref:a,className:(0,t.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",s),...r})});u.displayName="TableCell",r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,i.jsx)("caption",{ref:a,className:(0,t.cn)("mt-4 text-sm text-muted-foreground",s),...r})}).displayName="TableCaption"},17168:function(e,a,s){"use strict";s.d(a,{SP:function(){return c},dr:function(){return o},mQ:function(){return l},nU:function(){return d}});var i=s(57437),r=s(2265),t=s(20271),n=s(93448);let l=t.fC,o=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,i.jsx)(t.aV,{ref:a,className:(0,n.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...r})});o.displayName=t.aV.displayName;let c=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,i.jsx)(t.xz,{ref:a,className:(0,n.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",s),...r})});c.displayName=t.xz.displayName;let d=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,i.jsx)(t.VY,{ref:a,className:(0,n.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...r})});d.displayName=t.VY.displayName},23675:function(e,a,s){"use strict";s.d(a,{g:function(){return n}});var i=s(57437),r=s(2265),t=s(93448);let n=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,i.jsx)("textarea",{className:(0,t.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:a,...r})});n.displayName="Textarea"}},function(e){e.O(0,[4358,9990,2505,6137,1211,9759,3562,6008,9923,2550,1,6313,2578,3626,2981,2971,2117,1744],function(){return e(e.s=11583)}),_N_E=e.O()}]);