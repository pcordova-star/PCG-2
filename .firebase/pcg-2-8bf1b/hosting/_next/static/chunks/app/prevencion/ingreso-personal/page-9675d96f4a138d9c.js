(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1315],{39986:function(e,a,s){Promise.resolve().then(s.bind(s,24527))},24527:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return T}});var r=s(57437),n=s(2265),o=s(12381),t=s(79820),d=s(40279),i=s(75060),l=s(15291),c=s(33804),m=s(23675),u=s(31593),x=s(69174),h=s(93448),p=s(86700),g=s(87928),j=s(16049),f=s(36086),b=s(19965),v=s(5485),N=s(44986),y=s(7204),C=s(68245),P=s(99764),E=s(5978),I=s(99376),S=s(71245);let w=[],R=[],F=[],k=[{tipoDocumento:"INDUCCION_OBRA",codigo:"PCG-PRV-IND-001",titulo:"Registro de Inducci\xf3n de Seguridad de la Obra",version:"V1.0",fechaEmision:"2025-01-01",elaboradoPor:"Prevencionista de Obra",revisadoPor:"Jefe de Prevenci\xf3n",aprobadoPor:"Gerente de Operaciones"},{tipoDocumento:"ENTREGA_EPP",codigo:"PCG-PRV-EPP-001",titulo:"Registro de Entrega de Elementos de Protecci\xf3n Personal",version:"V1.0",fechaEmision:"2025-01-01",elaboradoPor:"Prevencionista de Obra",revisadoPor:"Jefe de Bodega",aprobadoPor:"Gerente de Operaciones"},{tipoDocumento:"CHARLA_SEGURIDAD",codigo:"PCG-PRV-CHR-001",titulo:"Registro de Charla de Seguridad al Trabajador",version:"V1.0",fechaEmision:"2025-01-01",elaboradoPor:"Prevencionista de Obra",revisadoPor:"Jefe de Prevenci\xf3n",aprobadoPor:"Gerente de Operaciones"}];function _(e){let{estado:a}=e;return(0,r.jsx)(x.C,{variant:"outline",className:(0,h.cn)("font-semibold",{Autorizado:"bg-green-100 text-green-800 border-green-200",Pendiente:"bg-yellow-100 text-yellow-800 border-yellow-200",Rechazado:"bg-red-100 text-red-800 border-red-200"}[a]),children:a})}function D(e){let a=[e.docContrato,e.docMutualAlDia,e.docExamenMedico,e.docInduccion,e.docEPPEntregados,e.docRegistroListaPersonal],s=a.length,r=a.filter(Boolean).length;return{total:s,cumplidos:r,porcentaje:s>0?r/s*100:0}}function z(e){let{config:a,nombreObra:s}=e;return(0,r.jsxs)("header",{className:"mb-4 rounded-xl border bg-card p-4 shadow-sm text-xs print:shadow-none print:rounded-none",children:[(0,r.jsxs)("div",{className:"flex flex-col gap-3 md:flex-row md:items-start md:justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-[11px] font-semibold text-muted-foreground",children:"[Nombre de la Empresa Constructora]"}),(0,r.jsx)("h1",{className:"text-sm font-bold text-card-foreground",children:a.titulo}),(0,r.jsxs)("p",{className:"text-[11px] text-muted-foreground",children:["Obra: ",s]})]}),(0,r.jsxs)("div",{className:"text-[11px] text-right text-muted-foreground space-y-0.5",children:[(0,r.jsxs)("p",{children:[(0,r.jsx)("span",{className:"font-semibold",children:"C\xf3digo:"})," ",a.codigo]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("span",{className:"font-semibold",children:"Versi\xf3n:"})," ",a.version]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("span",{className:"font-semibold",children:"Emisi\xf3n:"})," ",a.fechaEmision]})]})]}),(0,r.jsxs)("div",{className:"mt-3 grid gap-2 md:grid-cols-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-semibold text-[11px] text-muted-foreground",children:"Elaborado por"}),(0,r.jsx)("p",{className:"text-[11px] text-muted-foreground",children:a.elaboradoPor})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-semibold text-[11px] text-muted-foreground",children:"Revisado por"}),(0,r.jsx)("p",{className:"text-[11px] text-muted-foreground",children:a.revisadoPor||"-"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-semibold text-[11px] text-muted-foreground",children:"Aprobado por"}),(0,r.jsx)("p",{className:"text-[11px] text-muted-foreground",children:a.aprobadoPor||"-"})]})]})]})}function T(){var e,a,s,T,O,A,U;let[G,X]=(0,n.useState)([]),[M,Z]=(0,n.useState)(!0),[L,V]=(0,n.useState)(""),[Q,q]=(0,n.useState)("Empresa"),[B,J]=(0,n.useState)([]),[$,Y]=(0,n.useState)(null),[H,K]=(0,n.useState)(null),W=(0,I.useRouter)(),{user:ee,companyId:ea,role:es}=(0,S.a)(),[er,en]=(0,n.useState)([]),[eo,et]=(0,n.useState)("Empresa"),[ed,ei]=(0,n.useState)(""),[el,ec]=(0,n.useState)(""),[em,eu]=(0,n.useState)(""),[ex,eh]=(0,n.useState)(""),[ep,eg]=(0,n.useState)(new Date().toISOString().split("T")[0]),[ej,ef]=(0,n.useState)(""),[eb,ev]=(0,n.useState)(!1),[eN,ey]=(0,n.useState)(!1),[eC,eP]=(0,n.useState)(!1),[eE,eI]=(0,n.useState)(!1),[eS,ew]=(0,n.useState)(null),[eR,eF]=(0,n.useState)(null),[ek,e_]=(0,n.useState)(!1),[eD,ez]=(0,n.useState)({fecha:new Date().toISOString().split("T")[0],texto1:"",texto2:""}),[eT,eO]=(0,n.useState)(w),[eA,eU]=(0,n.useState)(!1),[eG,eX]=(0,n.useState)({fechaInduccion:new Date().toISOString().slice(0,10),lugar:"",relator:"",contenidoReglasGenerales:!0,contenidoPlanEmergencia:!0,contenidoRiesgosCriticos:!0,contenidoUsoEPP:!0,contenidoReporteIncidentes:!0,evaluacionAplicada:!1,resultadoEvaluacion:"No aplica",observaciones:"",aceptaInduccion:!1,nombreFirmaTrabajador:""}),[eM,eZ]=(0,n.useState)(null),[eL,eV]=(0,n.useState)(R),[eQ,eq]=(0,n.useState)(!1),[eB,eJ]=(0,n.useState)({fechaEntrega:new Date().toISOString().slice(0,10),responsableEntrega:"",casco:!0,zapatosSeguridad:!0,lentesSeguridad:!0,guantes:!1,ropaTrabajo:!1,arnes:!1,otrosDescripcion:"",instruidoUsoCuidado:!0,instruidoConsecuenciasNoUso:!0,aceptaEPP:!1,nombreFirmaTrabajador:"",observaciones:""}),[e$,eY]=(0,n.useState)(null),[eH,eK]=(0,n.useState)(F),[eW,e0]=(0,n.useState)(!1),[e1,e2]=(0,n.useState)({fechaCharla:new Date().toISOString().slice(0,10),tipoCharla:"Charla diaria",tema:"",relator:"",riesgoPrincipal:"",medidasReforzadas:"",asistencia:"Asiste",observaciones:"",aceptaCharla:!1,nombreFirmaTrabajador:""}),[e4,e3]=(0,n.useState)(null);(0,n.useEffect)(()=>{(ea||"superadmin"===es)&&(async()=>{Z(!0);try{let e;e="superadmin"===es?(0,E.IO)((0,E.hJ)(P.N$,"obras"),(0,E.Xo)("nombreFaena","asc")):(0,E.IO)((0,E.hJ)(P.N$,"obras"),(0,E.ar)("empresaId","==",ea),(0,E.Xo)("nombreFaena","asc"));let a=(await (0,E.PL)(e)).docs.map(e=>({id:e.id,nombreFaena:e.data().nombreFaena,mandanteRazonSocial:e.data().mandanteRazonSocial,...e.data()}));X(a),a.length>0&&!L&&V(a[0].id)}catch(e){console.error("Error loading obras: ",e),eF("No se pudieron cargar las obras disponibles.")}finally{Z(!1)}})()},[ea,es]),(0,n.useEffect)(()=>{if(!L)return;let e=async()=>{e_(!0);try{let e=(0,E.hJ)(P.N$,"ingresosPersonal"),a=(0,E.IO)(e,(0,E.ar)("obraId","==",L)),s=(await (0,E.PL)(a)).docs.map(e=>({id:e.id,...e.data()}));J(s)}catch(e){console.error("Error cargando ingresos de personal",e),eF("No se pudieron cargar los registros de personal.")}finally{e_(!1)}},a=(0,E.hJ)(P.N$,"empresasContratistas"),s=(0,E.IO)(a,(0,E.ar)("obraId","==",L)),r=(0,E.cf)(s,e=>{en(e.docs.map(e=>({id:e.id,...e.data()})))},e=>{console.error("Error cargando empresas contratistas:",e),eF("No se pudieron cargar las empresas para el formulario.")});return e(),()=>{r()}},[L]);let e5=(0,n.useMemo)(()=>"Empresa"===Q?er.filter(e=>"MANDANTE"===e.tipoEmpresa||"CONTRATISTA_PRINCIPAL"===e.tipoEmpresa):er.filter(e=>"SUBCONTRATISTA"===e.tipoEmpresa||"SERVICIOS"===e.tipoEmpresa),[er,Q]),e6=(0,n.useMemo)(()=>B.filter(e=>e.obraId===L&&e.tipoRelacion===Q),[B,L,Q]),e9=(0,n.useMemo)(()=>B.find(e=>e.id===$),[B,$]),e7=e9?eT.filter(e=>e.trabajadorId===e9.id).sort((e,a)=>e.fechaInduccion<a.fechaInduccion?1:-1):[],e8=null!==(a=e7[0])&&void 0!==a?a:null,ae=e9?eL.filter(e=>e.trabajadorId===e9.id).sort((e,a)=>e.fechaEntrega<a.fechaEntrega?1:-1):[],aa=null!==(s=ae[0])&&void 0!==s?s:null,as=e9?eH.filter(e=>e.trabajadorId===e9.id).sort((e,a)=>e.fechaCharla<a.fechaCharla?1:-1):[],ar=null!==(T=as[0])&&void 0!==T?T:null,an=(0,n.useMemo)(()=>e9?D(e9):null,[e9]),ao=(0,n.useMemo)(()=>(function(e,a,s){let r=e.filter(e=>e.obraId===a&&e.tipoRelacion===s),n=r.length,o=r.filter(e=>"Autorizado"===e.estadoIngreso).length,t=r.filter(e=>"Pendiente"===e.estadoIngreso).length,d=r.filter(e=>"Rechazado"===e.estadoIngreso).length,i=r.map(e=>D(e)),l=i.reduce((e,a)=>e+a.total,0),c=i.reduce((e,a)=>e+a.cumplidos,0);return{total:n,autorizados:o,pendientes:t,rechazados:d,totalPasosGlobal:l,cumplidosGlobal:c,porcentaje:l>0?Math.round(100*c/l):0}})(B,L,Q),[B,L,Q]),at=G.find(e=>e.id===L),ad=null!==(O=null==at?void 0:at.mandanteRazonSocial)&&void 0!==O?O:"",ai=()=>{ec(""),ei(""),eh(""),eu(""),eg(new Date().toISOString().split("T")[0]),ef(""),ev(!1),ey(!1),eP(!1),eF(null),ew(null)},al=async e=>{e.preventDefault(),eI(!0),ew(null),eF(null);let a="";try{if(!L)throw Error("No se encontr\xf3 el ID de la obra (obraId).");if(!ed||!el||!Q)throw Error("Faltan campos obligatorios (nombre, RUT o tipo).");if("Empresa"===Q){if(!ad)throw Error("No se ha definido la empresa mandante en la configuraci\xf3n de la obra.");a=ad}else{if(!em)throw Error("Debe seleccionar una empresa subcontratista.");let e=e5.find(e=>e.id===em);if(!e)throw Error("La empresa subcontratista seleccionada no es v\xe1lida.");a=e.razonSocial}let e=(0,E.hJ)(P.N$,"ingresosPersonal"),s={obraId:L,tipoRelacion:Q,nombre:ed,rut:el,empresa:a,cargo:ex,fechaIngreso:ep,observaciones:ej||null,fechaRegistro:E.EK.now(),docContrato:eb,docMutualAlDia:!1,docExamenMedico:eC,docInduccion:eN,docEPPEntregados:!1,docRegistroListaPersonal:!1,estadoIngreso:"Pendiente"},r=await (0,E.ET)(e,s);J(e=>[{id:r.id,...s},...e]),ew("Ingreso registrado correctamente."),ai()}catch(e){console.error(e),eF(e instanceof Error?e.message:"Error al registrar el ingreso de personal.")}finally{eI(!1)}},ac=e=>{e.preventDefault(),$&&H&&(J(e=>e.map(e=>{if(e.id!==$)return e;let a={...e};switch(H){case"Reglamento":a.docContrato=!0,a.docMutualAlDia=!0,a.docExamenMedico=!0;break;case"Induccion":a.docInduccion=!0;break;case"EPP":a.docEPPEntregados=!0;break;case"Charla":a.docRegistroListaPersonal=!0}let{cumplidos:s,total:r}=D(a);return s===r&&(a.estadoIngreso="Autorizado"),a})),K(null),ez({fecha:new Date().toISOString().split("T")[0],texto1:"",texto2:""}))},am=e=>{K(e),ez({fecha:new Date().toISOString().split("T")[0],texto1:"",texto2:""})},au=[{id:"Reglamento",label:"Documentos (Contrato, Mutual, Examen)",icon:g.Z,docFields:["docContrato","docMutualAlDia","docExamenMedico"]},{id:"Induccion",label:"Inducci\xf3n de Seguridad",icon:j.Z,docFields:["docInduccion"]},{id:"EPP",label:"Entrega de EPP",icon:f.Z,docFields:["docEPPEntregados"]},{id:"Charla",label:"Inclusi\xf3n en Listados / Charlas",icon:b.Z,docFields:["docRegistroListaPersonal"]}];return(0,r.jsxs)("div",{className:"space-y-8",children:[(0,r.jsxs)("header",{className:"flex items-center gap-4",children:[(0,r.jsx)(o.z,{variant:"outline",size:"icon",onClick:()=>W.push("/prevencion"),children:(0,r.jsx)(v.Z,{})}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("h1",{className:"text-4xl font-bold font-headline tracking-tight",children:"Ingreso de Personal – DS44"}),(0,r.jsx)("p",{className:"mt-2 text-lg text-muted-foreground",children:"Este m\xf3dulo registra el ingreso de trabajadores a la obra, tanto propios del mandante como de subcontratos, y gestiona los pasos de cumplimiento documental."})]})]}),(0,r.jsxs)(t.Zb,{children:[(0,r.jsx)(t.Ol,{children:(0,r.jsx)(t.ll,{children:"Filtros"})}),(0,r.jsxs)(t.aY,{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(i._,{htmlFor:"obra-select",children:"Seleccione una obra"}),(0,r.jsxs)(l.Ph,{value:L,onValueChange:e=>{V(e),Y(null)},children:[(0,r.jsx)(l.i4,{id:"obra-select",children:(0,r.jsx)(l.ki,{placeholder:M?"Cargando obras...":"Seleccione una obra"})}),(0,r.jsx)(l.Bw,{children:M?(0,r.jsx)(l.Ql,{value:"loading",disabled:!0,children:"Cargando..."}):G.map(e=>(0,r.jsx)(l.Ql,{value:e.id,children:e.nombreFaena},e.id))})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(i._,{children:"Tipo de Personal a Gestionar"}),(0,r.jsxs)(p.E,{value:Q,onValueChange:e=>{q(e),Y(null),eu("")},className:"flex items-center space-x-4 pt-2",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(p.m,{value:"Empresa",id:"r-empresa"}),(0,r.jsx)(i._,{htmlFor:"r-empresa",children:"Personal Empresa"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(p.m,{value:"Subcontrato",id:"r-subcontrato"}),(0,r.jsx)(i._,{htmlFor:"r-subcontrato",children:"Personal Subcontrato"})]})]})]})]})]}),(0,r.jsxs)(t.Zb,{children:[(0,r.jsx)(t.Ol,{children:(0,r.jsxs)(t.ll,{children:["Indicadores DS44 – ",null==at?void 0:at.nombreFaena," / ",Q]})}),(0,r.jsx)(t.aY,{children:0===ao.total?(0,r.jsx)("p",{className:"text-muted-foreground text-center py-4",children:"No hay personal registrado a\xfan para esta obra y tipo. Los indicadores aparecer\xe1n cuando registres trabajadores."}):(0,r.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-center",children:[(0,r.jsxs)("div",{className:"p-4 bg-muted/50 rounded-lg",children:[(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Total Personas"}),(0,r.jsx)("p",{className:"text-3xl font-bold",children:ao.total})]}),(0,r.jsxs)("div",{className:"p-4 bg-green-100/60 rounded-lg",children:[(0,r.jsx)("p",{className:"text-sm text-green-800",children:"Autorizados"}),(0,r.jsx)("p",{className:"text-3xl font-bold text-green-900",children:ao.autorizados})]}),(0,r.jsxs)("div",{className:"p-4 bg-yellow-100/60 rounded-lg",children:[(0,r.jsx)("p",{className:"text-sm text-yellow-800",children:"Pendientes"}),(0,r.jsx)("p",{className:"text-3xl font-bold text-yellow-900",children:ao.pendientes})]}),(0,r.jsxs)("div",{className:"col-span-2 md:col-span-4 p-4 border rounded-lg mt-4",children:[(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Progreso de Cumplimiento (Pasos DS44)"}),(0,r.jsxs)("div",{className:"flex items-center justify-center gap-4 mt-2",children:[(0,r.jsxs)("p",{className:"text-2xl font-bold",children:[ao.cumplidosGlobal," / ",ao.totalPasosGlobal]}),(0,r.jsx)("div",{className:"w-full max-w-xs",children:(0,r.jsx)(y.E,{value:ao.porcentaje,className:"h-4"})}),(0,r.jsxs)("p",{className:"text-2xl font-bold",children:[ao.porcentaje,"%"]})]})]})]})})]}),(0,r.jsxs)(t.Zb,{children:[(0,r.jsx)(t.Ol,{children:(0,r.jsx)(t.ll,{children:"1. Crear Ficha de Nuevo Trabajador"})}),(0,r.jsx)(t.aY,{children:(0,r.jsxs)("form",{onSubmit:al,className:"space-y-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(i._,{htmlFor:"rut",children:"RUT*"}),(0,r.jsx)(d.I,{id:"rut",value:el,onChange:e=>ec(e.target.value)})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(i._,{htmlFor:"nombre",children:"Nombre*"}),(0,r.jsx)(d.I,{id:"nombre",value:ed,onChange:e=>ei(e.target.value)})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(i._,{htmlFor:"cargo",children:"Cargo*"}),(0,r.jsx)(d.I,{id:"cargo",value:ex,onChange:e=>eh(e.target.value)})]}),(0,r.jsxs)("div",{className:"space-y-2 lg:col-span-2",children:[(0,r.jsx)(i._,{htmlFor:"empresa-select",children:"Empresa*"}),"Empresa"===Q?(0,r.jsx)(d.I,{value:ad,disabled:!0}):(0,r.jsxs)(l.Ph,{value:em,onValueChange:eu,children:[(0,r.jsx)(l.i4,{id:"empresa-select",children:(0,r.jsx)(l.ki,{placeholder:"Seleccionar Subcontrato"})}),(0,r.jsx)(l.Bw,{children:e5.map(e=>(0,r.jsxs)(l.Ql,{value:e.id,children:[e.razonSocial," - ",e.rut]},e.id))})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(i._,{htmlFor:"fechaIngreso",children:"Fecha de Ingreso"}),(0,r.jsx)(d.I,{id:"fechaIngreso",type:"date",value:ep,onChange:e=>eg(e.target.value)})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(i._,{htmlFor:"observaciones-nuevo",children:"Observaciones iniciales"}),(0,r.jsx)(m.g,{id:"observaciones-nuevo",value:ej,onChange:e=>ef(e.target.value),placeholder:"Ej: Ingresa para faenas de terminaciones."})]}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-x-4 gap-y-2",children:[(0,r.jsxs)(i._,{className:"flex items-center gap-2 font-normal text-sm",children:[(0,r.jsx)(C.X,{checked:eb,onCheckedChange:e=>ev(!!e)}),(0,r.jsx)("span",{children:"Tiene contrato"})]}),(0,r.jsxs)(i._,{className:"flex items-center gap-2 font-normal text-sm",children:[(0,r.jsx)(C.X,{checked:eN,onCheckedChange:e=>ey(!!e)}),(0,r.jsx)("span",{children:"Inducci\xf3n realizada"})]}),(0,r.jsxs)(i._,{className:"flex items-center gap-2 font-normal text-sm",children:[(0,r.jsx)(C.X,{checked:eC,onCheckedChange:e=>eP(!!e)}),(0,r.jsx)("span",{children:"Apto m\xe9dico vigente"})]})]}),eR&&(0,r.jsx)("p",{className:"text-sm font-medium text-destructive",children:eR}),eS&&(0,r.jsx)("p",{className:"text-sm font-medium text-green-600",children:eS}),(0,r.jsx)(o.z,{type:"submit",disabled:eE,children:eE?"Registrando...":"Crear Ficha de Trabajador"})]})})]}),(0,r.jsxs)(t.Zb,{children:[(0,r.jsxs)(t.Ol,{children:[(0,r.jsx)(t.ll,{children:"2. Listado de Personal y Gesti\xf3n de Fichas"}),(0,r.jsxs)(t.SZ,{children:['Mostrando personal de tipo "',Q,'" para la obra "',null==at?void 0:at.nombreFaena,'". Seleccione un trabajador para ver su ficha de cumplimiento.']})]}),(0,r.jsx)(t.aY,{className:"p-0",children:(0,r.jsx)("div",{className:"overflow-x-auto",children:ek?(0,r.jsx)("p",{className:"text-sm text-muted-foreground text-center py-8",children:"Cargando registros..."}):(0,r.jsxs)(c.iA,{children:[(0,r.jsx)(c.xD,{children:(0,r.jsxs)(c.SC,{children:[(0,r.jsx)(c.ss,{children:"Nombre / RUT"}),(0,r.jsx)(c.ss,{children:"Cargo / Empresa"}),(0,r.jsx)(c.ss,{children:"Progreso DS44"}),(0,r.jsx)(c.ss,{children:"Estado General"}),(0,r.jsx)(c.ss,{className:"text-right",children:"Acciones"})]})}),(0,r.jsx)(c.RM,{children:e6.length>0?e6.map(e=>{let a=D(e);return(0,r.jsxs)(c.SC,{className:(0,h.cn)($===e.id&&"bg-accent/10"),children:[(0,r.jsxs)(c.pj,{children:[(0,r.jsx)("div",{className:"font-medium",children:e.nombre}),(0,r.jsx)("div",{className:"text-xs text-muted-foreground",children:e.rut})]}),(0,r.jsxs)(c.pj,{children:[(0,r.jsx)("div",{className:"font-medium",children:e.cargo}),(0,r.jsx)("div",{className:"text-xs text-muted-foreground",children:e.empresa})]}),(0,r.jsx)(c.pj,{children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(y.E,{value:a.porcentaje,className:"w-24 h-2"}),(0,r.jsxs)("span",{className:"text-xs font-medium text-muted-foreground",children:[a.cumplidos,"/",a.total]})]})}),(0,r.jsx)(c.pj,{children:(0,r.jsx)(_,{estado:e.estadoIngreso})}),(0,r.jsx)(c.pj,{className:"text-right",children:(0,r.jsx)(o.z,{variant:"outline",size:"sm",onClick:()=>Y(e.id),children:"Abrir Ficha"})})]},e.id)}):(0,r.jsx)(c.SC,{children:(0,r.jsx)(c.pj,{colSpan:5,className:"text-center text-muted-foreground py-8",children:"No hay trabajadores registrados para esta obra y tipo de empresa."})})})]})})})]}),e9&&(0,r.jsxs)("section",{className:"mt-6 space-y-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center gap-2 print:hidden",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-card-foreground",children:"Ficha de trabajador y formularios DS44"}),(0,r.jsx)(o.z,{type:"button",onClick:()=>window.print(),variant:"outline",size:"sm",children:"Imprimir / Guardar PDF"})]}),(0,r.jsxs)("div",{id:"printable-trabajador",className:"space-y-4 bg-card print:bg-white print:shadow-none print:border-0 rounded-xl print:rounded-none p-4 print:p-0",children:[(0,r.jsx)(z,{config:(U="INDUCCION_OBRA",k.find(e=>e.tipoDocumento===U)||{tipoDocumento:U,codigo:"PCG-PRV-XXX-000",titulo:"Documento de Prevenci\xf3n",version:"V1.0",fechaEmision:"2025-01-01",elaboradoPor:"Prevenci\xf3n de Riesgos",revisadoPor:"",aprobadoPor:""}),nombreObra:null!==(A=null===(e=G.find(e=>e.id===e9.obraId))||void 0===e?void 0:e.nombreFaena)&&void 0!==A?A:""}),an&&(0,r.jsxs)(t.Zb,{className:"border-accent shadow-lg",children:[(0,r.jsxs)(t.Ol,{className:"flex flex-row items-start justify-between",children:[(0,r.jsxs)("div",{className:"space-y-1.5",children:[(0,r.jsxs)(t.ll,{className:"text-2xl font-bold text-accent",children:["Ficha de Cumplimiento: ",e9.nombre]}),(0,r.jsxs)(t.SZ,{className:"text-base",children:[e9.rut," | ",e9.cargo," en ",e9.empresa]}),(0,r.jsxs)("div",{className:"flex items-center gap-4 pt-2",children:[(0,r.jsx)(_,{estado:e9.estadoIngreso}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(y.E,{value:an.porcentaje,className:"w-32 h-2.5"}),(0,r.jsxs)("span",{className:"text-sm font-semibold",children:[an.cumplidos,"/",an.total," pasos DS44"]})]})]})]}),(0,r.jsx)(o.z,{variant:"ghost",size:"icon",onClick:()=>Y(null),className:"print:hidden",children:(0,r.jsx)(N.Z,{className:"h-5 w-5"})})]}),(0,r.jsxs)(t.aY,{children:[(0,r.jsx)(u.Z,{className:"my-4"}),(0,r.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"3. Pasos de Cumplimiento DS44"}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 print:hidden",children:au.map(e=>{let a=e.docFields.every(e=>e9[e]);return(0,r.jsxs)(t.Zb,{className:(0,h.cn)("flex flex-col",a?"bg-green-50 border-green-200":"bg-yellow-50 border-yellow-200"),children:[(0,r.jsxs)(t.Ol,{className:"flex-row items-center gap-3 space-y-0 pb-2",children:[(0,r.jsx)(e.icon,{className:(0,h.cn)("h-6 w-6",a?"text-green-600":"text-yellow-600")}),(0,r.jsx)("h4",{className:"font-semibold",children:e.label})]}),(0,r.jsx)(t.aY,{className:"pb-4",children:(0,r.jsx)(x.C,{variant:a?"default":"secondary",className:(0,h.cn)(a?"bg-green-600":"bg-yellow-600"),children:a?"Completado":"Pendiente"})}),(0,r.jsx)(t.eW,{className:"mt-auto",children:(0,r.jsx)(o.z,{className:"w-full",size:"sm",variant:a?"outline":"default",onClick:()=>am(e.id),disabled:!!a,children:a?"Ver Registro":"Abrir Formulario"})})]},e.id)})}),(0,r.jsx)("div",{className:"print:hidden",children:(()=>{let e,a;if(!H)return null;switch(H){case"Reglamento":e="Registro: Contrato, Mutualidad y Examen M\xe9dico",a=(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(i._,{htmlFor:"fecha-paso",children:"Fecha de revisi\xf3n documental"}),(0,r.jsx)(d.I,{id:"fecha-paso",type:"date",value:eD.fecha,onChange:e=>ez({...eD,fecha:e.target.value})})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(i._,{htmlFor:"obs-paso",children:"Observaciones (Contrato, Mutualidad, Examen)"}),(0,r.jsx)(m.g,{id:"obs-paso",value:eD.texto1,onChange:e=>ez({...eD,texto1:e.target.value})})]})]});break;case"Induccion":e="Registro de Inducci\xf3n de Seguridad",a=(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(i._,{htmlFor:"fecha-paso",children:"Fecha de inducci\xf3n"}),(0,r.jsx)(d.I,{id:"fecha-paso",type:"date",value:eD.fecha,onChange:e=>ez({...eD,fecha:e.target.value})})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(i._,{htmlFor:"tipo-induccion",children:"Tipo de inducci\xf3n (General/Espec\xedfica)"}),(0,r.jsx)(d.I,{id:"tipo-induccion",value:eD.texto1,onChange:e=>ez({...eD,texto1:e.target.value})})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(i._,{htmlFor:"obs-paso",children:"Observaciones"}),(0,r.jsx)(m.g,{id:"obs-paso",value:eD.texto2,onChange:e=>ez({...eD,texto2:e.target.value})})]})]});break;case"EPP":e="Registro de Entrega de EPP",a=(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(i._,{htmlFor:"fecha-paso",children:"Fecha de entrega"}),(0,r.jsx)(d.I,{id:"fecha-paso",type:"date",value:eD.fecha,onChange:e=>ez({...eD,fecha:e.target.value})})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(i._,{htmlFor:"epp-list",children:"Listado de EPP entregados"}),(0,r.jsx)(m.g,{id:"epp-list",placeholder:"Casco, Lentes, Guantes, Zapatos...",value:eD.texto1,onChange:e=>ez({...eD,texto1:e.target.value})})]})]});break;case"Charla":e="Registro de Charla de Seguridad e Inclusi\xf3n en Listado",a=(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(i._,{htmlFor:"fecha-paso",children:"Fecha de la charla"}),(0,r.jsx)(d.I,{id:"fecha-paso",type:"date",value:eD.fecha,onChange:e=>ez({...eD,fecha:e.target.value})})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(i._,{htmlFor:"tema-charla",children:"Tema de la charla (Ej: Inducci\xf3n)"}),(0,r.jsx)(d.I,{id:"tema-charla",value:eD.texto1,onChange:e=>ez({...eD,texto1:e.target.value})})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(i._,{htmlFor:"obs-paso",children:"Observaciones"}),(0,r.jsx)(m.g,{id:"obs-paso",value:eD.texto2,onChange:e=>ez({...eD,texto2:e.target.value})})]})]});break;default:return null}return(0,r.jsxs)(t.Zb,{className:"mt-4 bg-muted/30",children:[(0,r.jsx)(t.Ol,{children:(0,r.jsx)(t.ll,{className:"text-lg",children:e})}),(0,r.jsx)(t.aY,{children:(0,r.jsxs)("form",{onSubmit:ac,className:"space-y-4",children:[a,(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(o.z,{type:"submit",children:"Guardar y marcar como completado"}),(0,r.jsx)(o.z,{type:"button",variant:"ghost",onClick:()=>K(null),children:"Cancelar"})]})]})})]})})()})]})]}),(0,r.jsxs)("div",{className:"mt-6 space-y-4",children:[(0,r.jsx)("header",{className:"flex flex-col gap-1 md:flex-row md:items-center md:justify-between",children:(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-card-foreground",children:"Formularios DS44 – Trabajador"}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Aqu\xed se registran los formularios clave de Prevenci\xf3n de Riesgos asociados a este trabajador (inducci\xf3n, EPP, charlas, etc.)."})]})}),(0,r.jsxs)("div",{className:"rounded-xl border bg-card p-4 shadow-sm space-y-3",children:[(0,r.jsxs)("div",{className:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"text-sm font-semibold text-card-foreground",children:"Inducci\xf3n de seguridad de la obra"}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Formulario para registrar que el trabajador recibi\xf3 la inducci\xf3n de seguridad espec\xedfica de la obra, de acuerdo al DS44."})]}),(0,r.jsxs)("div",{className:"flex flex-col items-start md:items-end gap-1 print:hidden",children:[e8?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("span",{className:"text-xs font-semibold text-card-foreground",children:["\xdaltima inducci\xf3n: ",e8.fechaInduccion]}),(0,r.jsxs)("span",{className:"text-xs text-muted-foreground",children:["Relator: ",e8.relator||"No registrado"]})]}):(0,r.jsx)("span",{className:"text-xs text-muted-foreground",children:"Este trabajador a\xfan no tiene una inducci\xf3n registrada."}),(0,r.jsx)(o.z,{type:"button",onClick:()=>{eZ(null),eU(e=>!e)},variant:"outline",size:"sm",className:"mt-1",children:eA?"Cerrar formulario":"Registrar nueva inducci\xf3n"})]})]}),eA&&(0,r.jsxs)("form",{className:"space-y-3 border-t pt-3 text-xs print:hidden",onSubmit:e=>{if(e.preventDefault(),eZ(null),!e9){eZ("Debes seleccionar un trabajador.");return}if(!eG.fechaInduccion){eZ("Debes indicar la fecha de la inducci\xf3n.");return}if(!eG.lugar.trim()){eZ("Indica el lugar donde se realiz\xf3 la inducci\xf3n.");return}if(!eG.relator.trim()){eZ("Indica qui\xe9n realiz\xf3 la inducci\xf3n.");return}if(!eG.aceptaInduccion){eZ("Debes marcar que el trabajador declara haber recibido y comprendido la inducci\xf3n.");return}if(!eG.nombreFirmaTrabajador.trim()){eZ("Indica el nombre del trabajador como simulaci\xf3n de firma.");return}let a={id:"undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():Date.now().toString(),trabajadorId:e9.id,obraId:e9.obraId,fechaInduccion:eG.fechaInduccion,lugar:eG.lugar,relator:eG.relator,contenidoReglasGenerales:eG.contenidoReglasGenerales,contenidoPlanEmergencia:eG.contenidoPlanEmergencia,contenidoRiesgosCriticos:eG.contenidoRiesgosCriticos,contenidoUsoEPP:eG.contenidoUsoEPP,contenidoReporteIncidentes:eG.contenidoReporteIncidentes,evaluacionAplicada:eG.evaluacionAplicada,resultadoEvaluacion:eG.resultadoEvaluacion,observaciones:eG.observaciones,aceptaInduccion:eG.aceptaInduccion,nombreFirmaTrabajador:eG.nombreFirmaTrabajador};eO(e=>[a,...e]),eX(e=>({...e,lugar:"",relator:"",observaciones:"",aceptaInduccion:!1,nombreFirmaTrabajador:""})),eU(!1)},children:[eM&&(0,r.jsx)("p",{className:"text-[11px] text-red-600",children:eM}),(0,r.jsxs)("div",{className:"grid gap-3 md:grid-cols-3",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(i._,{className:"font-medium text-muted-foreground",children:"Fecha de inducci\xf3n"}),(0,r.jsx)(d.I,{type:"date",value:eG.fechaInduccion,onChange:e=>eX(a=>({...a,fechaInduccion:e.target.value}))})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(i._,{className:"font-medium text-muted-foreground",children:"Lugar"}),(0,r.jsx)(d.I,{type:"text",value:eG.lugar,onChange:e=>eX(a=>({...a,lugar:e.target.value})),placeholder:"Ej: Oficina de obra, sala reuniones, terreno..."})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(i._,{className:"font-medium text-muted-foreground",children:"Relator / Responsable"}),(0,r.jsx)(d.I,{type:"text",value:eG.relator,onChange:e=>eX(a=>({...a,relator:e.target.value})),placeholder:"Nombre del prevencionista o jefe de obra"})]})]}),(0,r.jsxs)("div",{className:"grid gap-2 md:grid-cols-2",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("p",{className:"font-medium text-muted-foreground",children:"Contenidos m\xednimos impartidos"}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsxs)(i._,{className:"flex items-center gap-2 font-normal",children:[(0,r.jsx)(C.X,{checked:eG.contenidoReglasGenerales,onCheckedChange:e=>eX(a=>({...a,contenidoReglasGenerales:!!e}))}),(0,r.jsx)("span",{children:"Reglas generales de seguridad y comportamiento en la obra."})]}),(0,r.jsxs)(i._,{className:"flex items-center gap-2 font-normal",children:[(0,r.jsx)(C.X,{checked:eG.contenidoPlanEmergencia,onCheckedChange:e=>eX(a=>({...a,contenidoPlanEmergencia:!!e}))}),(0,r.jsx)("span",{children:"Plan de emergencia, rutas de evacuaci\xf3n y puntos de encuentro."})]}),(0,r.jsxs)(i._,{className:"flex items-center gap-2 font-normal",children:[(0,r.jsx)(C.X,{checked:eG.contenidoRiesgosCriticos,onCheckedChange:e=>eX(a=>({...a,contenidoRiesgosCriticos:!!e}))}),(0,r.jsx)("span",{children:"Riesgos cr\xedticos espec\xedficos de la obra."})]}),(0,r.jsxs)(i._,{className:"flex items-center gap-2 font-normal",children:[(0,r.jsx)(C.X,{checked:eG.contenidoUsoEPP,onCheckedChange:e=>eX(a=>({...a,contenidoUsoEPP:!!e}))}),(0,r.jsx)("span",{children:"Uso obligatorio y cuidado de EPP."})]}),(0,r.jsxs)(i._,{className:"flex items-center gap-2 font-normal",children:[(0,r.jsx)(C.X,{checked:eG.contenidoReporteIncidentes,onCheckedChange:e=>eX(a=>({...a,contenidoReporteIncidentes:!!e}))}),(0,r.jsx)("span",{children:"Procedimiento para reportar incidentes, condiciones y actos inseguros."})]})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(i._,{className:"font-medium text-muted-foreground",children:"Evaluaci\xf3n / verificaci\xf3n"}),(0,r.jsxs)(i._,{className:"flex items-center gap-2 font-normal",children:[(0,r.jsx)(C.X,{checked:eG.evaluacionAplicada,onCheckedChange:e=>eX(a=>({...a,evaluacionAplicada:!!e}))}),(0,r.jsx)("span",{children:"Se aplic\xf3 una verificaci\xf3n de comprensi\xf3n."})]}),(0,r.jsxs)(l.Ph,{value:eG.resultadoEvaluacion,onValueChange:e=>eX(a=>({...a,resultadoEvaluacion:e})),children:[(0,r.jsx)(l.i4,{className:"mt-1 w-full",children:(0,r.jsx)(l.ki,{})}),(0,r.jsxs)(l.Bw,{children:[(0,r.jsx)(l.Ql,{value:"Aprobado",children:"Aprobado"}),(0,r.jsx)(l.Ql,{value:"Reforzar contenidos",children:"Reforzar contenidos"}),(0,r.jsx)(l.Ql,{value:"No aplica",children:"No aplica"})]})]})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(i._,{className:"font-medium text-muted-foreground",children:"Observaciones"}),(0,r.jsx)(m.g,{value:eG.observaciones,onChange:e=>eX(a=>({...a,observaciones:e.target.value})),rows:3})]})]})]}),(0,r.jsxs)("div",{className:"border-t pt-3 space-y-2",children:[(0,r.jsxs)(i._,{className:"flex items-center gap-2 font-normal",children:[(0,r.jsx)(C.X,{checked:eG.aceptaInduccion,onCheckedChange:e=>eX(a=>({...a,aceptaInduccion:!!e}))}),(0,r.jsx)("span",{children:"El trabajador declara haber recibido y comprendido la inducci\xf3n de seguridad de la obra."})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(i._,{className:"font-medium text-muted-foreground",children:"Nombre del trabajador (simulaci\xf3n de firma)"}),(0,r.jsx)(d.I,{type:"text",value:eG.nombreFirmaTrabajador,onChange:e=>eX(a=>({...a,nombreFirmaTrabajador:e.target.value})),placeholder:"Nombre completo del trabajador"}),(0,r.jsx)("p",{className:"text-[11px] text-muted-foreground",children:"M\xe1s adelante se puede reemplazar por una firma digital con el dedo (canvas). Por ahora se registra el nombre como aceptaci\xf3n."})]})]}),(0,r.jsx)("div",{className:"pt-2",children:(0,r.jsx)(o.z,{type:"submit",children:"Guardar registro de inducci\xf3n"})})]}),e7.length>0&&(0,r.jsxs)("div",{className:"border-t pt-3",children:[(0,r.jsx)("h5",{className:"text-xs font-semibold text-muted-foreground mb-2",children:"Historial de inducciones registradas"}),(0,r.jsx)("div",{className:"space-y-2 max-h-64 overflow-y-auto pr-1",children:e7.map(e=>(0,r.jsxs)("article",{className:"rounded-lg border bg-muted/30 p-3 text-[11px] space-y-1",children:[(0,r.jsxs)("p",{className:"font-semibold text-foreground",children:[e.fechaInduccion," – ",e.lugar]}),(0,r.jsxs)("p",{className:"text-muted-foreground",children:["Relator: ",e.relator||"No registrado"]}),(0,r.jsxs)("p",{className:"text-muted-foreground",children:["Resultado: ",e.resultadoEvaluacion]}),e.observaciones&&(0,r.jsxs)("p",{className:"text-muted-foreground",children:["Observaciones: ",e.observaciones]})]},e.id))})]})]}),(0,r.jsxs)("div",{className:"rounded-xl border bg-card p-4 shadow-sm space-y-3",children:[(0,r.jsxs)("div",{className:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"text-sm font-semibold text-card-foreground",children:"Entrega de Elementos de Protecci\xf3n Personal (EPP)"}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Registro de la entrega de EPP al trabajador, incluyendo los elementos entregados y la aceptaci\xf3n de uso, de acuerdo a los requisitos de prevenci\xf3n."})]}),(0,r.jsxs)("div",{className:"flex flex-col items-start gap-1 text-xs md:items-end print:hidden",children:[aa?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("span",{className:"font-semibold text-card-foreground",children:["\xdaltima entrega: ",aa.fechaEntrega]}),(0,r.jsxs)("span",{className:"text-muted-foreground",children:["Responsable:"," ",aa.responsableEntrega||"No registrado"]})]}):(0,r.jsx)("span",{className:"text-muted-foreground",children:"Este trabajador a\xfan no tiene registros de entrega de EPP."}),(0,r.jsx)(o.z,{type:"button",onClick:()=>{eY(null),eq(e=>!e)},variant:"outline",size:"sm",className:"mt-1",children:eQ?"Cerrar formulario EPP":"Registrar nueva entrega EPP"})]})]}),eQ&&(0,r.jsxs)("form",{className:"space-y-3 border-t pt-3 text-xs print:hidden",onSubmit:e=>{if(e.preventDefault(),eY(null),!e9){eY("Debes seleccionar un trabajador.");return}if(!eB.fechaEntrega){eY("Debes indicar la fecha de entrega.");return}if(!eB.responsableEntrega.trim()){eY("Indica qui\xe9n entrega los EPP.");return}if(!eB.aceptaEPP){eY("Debes marcar que el trabajador acepta y se compromete a usar los EPP.");return}if(!eB.nombreFirmaTrabajador.trim()){eY("Indica el nombre del trabajador como simulaci\xf3n de firma.");return}let a={id:"undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():Date.now().toString(),trabajadorId:e9.id,obraId:e9.obraId,fechaEntrega:eB.fechaEntrega,responsableEntrega:eB.responsableEntrega,casco:eB.casco,zapatosSeguridad:eB.zapatosSeguridad,lentesSeguridad:eB.lentesSeguridad,guantes:eB.guantes,ropaTrabajo:eB.ropaTrabajo,arnes:eB.arnes,otrosDescripcion:eB.otrosDescripcion,instruidoUsoCuidado:eB.instruidoUsoCuidado,instruidoConsecuenciasNoUso:eB.instruidoConsecuenciasNoUso,aceptaEPP:eB.aceptaEPP,nombreFirmaTrabajador:eB.nombreFirmaTrabajador,observaciones:eB.observaciones};eV(e=>[a,...e]),eJ(e=>({...e,responsableEntrega:"",otrosDescripcion:"",aceptaEPP:!1,nombreFirmaTrabajador:"",observaciones:""})),eq(!1)},children:[e$&&(0,r.jsx)("p",{className:"text-[11px] text-red-600",children:e$}),(0,r.jsxs)("div",{className:"grid gap-3 md:grid-cols-3",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(i._,{className:"font-medium text-muted-foreground",children:"Fecha de entrega"}),(0,r.jsx)(d.I,{type:"date",value:eB.fechaEntrega,onChange:e=>eJ(a=>({...a,fechaEntrega:e.target.value}))})]}),(0,r.jsxs)("div",{className:"space-y-1 md:col-span-2",children:[(0,r.jsx)(i._,{className:"font-medium text-muted-foreground",children:"Responsable de entrega"}),(0,r.jsx)(d.I,{type:"text",value:eB.responsableEntrega,onChange:e=>eJ(a=>({...a,responsableEntrega:e.target.value})),placeholder:"Nombre del prevencionista, bodeguero o jefe de obra"})]})]}),(0,r.jsxs)("div",{className:"grid gap-3 md:grid-cols-2",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("p",{className:"font-medium text-muted-foreground",children:"Elementos entregados"}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsxs)(i._,{className:"flex items-center gap-2 font-normal",children:[(0,r.jsx)(C.X,{checked:eB.casco,onCheckedChange:e=>eJ(a=>({...a,casco:!!e}))}),(0,r.jsx)("span",{children:"Casco de seguridad"})]}),(0,r.jsxs)(i._,{className:"flex items-center gap-2 font-normal",children:[(0,r.jsx)(C.X,{checked:eB.zapatosSeguridad,onCheckedChange:e=>eJ(a=>({...a,zapatosSeguridad:!!e}))}),(0,r.jsx)("span",{children:"Zapatos de seguridad"})]}),(0,r.jsxs)(i._,{className:"flex items-center gap-2 font-normal",children:[(0,r.jsx)(C.X,{checked:eB.lentesSeguridad,onCheckedChange:e=>eJ(a=>({...a,lentesSeguridad:!!e}))}),(0,r.jsx)("span",{children:"Lentes de seguridad"})]}),(0,r.jsxs)(i._,{className:"flex items-center gap-2 font-normal",children:[(0,r.jsx)(C.X,{checked:eB.guantes,onCheckedChange:e=>eJ(a=>({...a,guantes:!!e}))}),(0,r.jsx)("span",{children:"Guantes"})]}),(0,r.jsxs)(i._,{className:"flex items-center gap-2 font-normal",children:[(0,r.jsx)(C.X,{checked:eB.ropaTrabajo,onCheckedChange:e=>eJ(a=>({...a,ropaTrabajo:!!e}))}),(0,r.jsx)("span",{children:"Ropa de trabajo"})]}),(0,r.jsxs)(i._,{className:"flex items-center gap-2 font-normal",children:[(0,r.jsx)(C.X,{checked:eB.arnes,onCheckedChange:e=>eJ(a=>({...a,arnes:!!e}))}),(0,r.jsx)("span",{children:"Arn\xe9s de seguridad (si aplica)"})]})]}),(0,r.jsxs)("div",{className:"mt-2 space-y-1",children:[(0,r.jsx)(i._,{className:"font-medium text-muted-foreground",children:"Otros elementos / detalles"}),(0,r.jsx)(d.I,{type:"text",value:eB.otrosDescripcion,onChange:e=>eJ(a=>({...a,otrosDescripcion:e.target.value})),placeholder:"Ej: protector auditivo, mascarilla espec\xedfica, etc."})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("p",{className:"font-medium text-muted-foreground",children:"Instrucci\xf3n al trabajador"}),(0,r.jsxs)(i._,{className:"flex items-center gap-2 font-normal",children:[(0,r.jsx)(C.X,{checked:eB.instruidoUsoCuidado,onCheckedChange:e=>eJ(a=>({...a,instruidoUsoCuidado:!!e}))}),(0,r.jsx)("span",{children:"Se instruye sobre uso, cuidado y reposici\xf3n de EPP."})]}),(0,r.jsxs)(i._,{className:"flex items-center gap-2 font-normal",children:[(0,r.jsx)(C.X,{checked:eB.instruidoConsecuenciasNoUso,onCheckedChange:e=>eJ(a=>({...a,instruidoConsecuenciasNoUso:!!e}))}),(0,r.jsx)("span",{children:"Se informa sobre consecuencias de no usar EPP."})]})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(i._,{className:"font-medium text-muted-foreground",children:"Observaciones"}),(0,r.jsx)(m.g,{value:eB.observaciones,onChange:e=>eJ(a=>({...a,observaciones:e.target.value})),rows:4})]})]})]}),(0,r.jsxs)("div",{className:"border-t pt-3 space-y-2",children:[(0,r.jsxs)(i._,{className:"flex items-center gap-2 font-normal",children:[(0,r.jsx)(C.X,{checked:eB.aceptaEPP,onCheckedChange:e=>eJ(a=>({...a,aceptaEPP:!!e}))}),(0,r.jsx)("span",{children:"El trabajador declara recibir y comprometerse a usar los EPP entregados."})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(i._,{className:"font-medium text-muted-foreground",children:"Nombre del trabajador (simulaci\xf3n de firma)"}),(0,r.jsx)(d.I,{type:"text",value:eB.nombreFirmaTrabajador,onChange:e=>eJ(a=>({...a,nombreFirmaTrabajador:e.target.value})),placeholder:"Nombre completo del trabajador"}),(0,r.jsx)("p",{className:"text-[11px] text-muted-foreground",children:"M\xe1s adelante se puede reemplazar por una firma digital con el dedo (canvas). Por ahora se registra el nombre como aceptaci\xf3n."})]})]}),(0,r.jsx)("div",{className:"pt-2",children:(0,r.jsx)(o.z,{type:"submit",children:"Guardar registro de entrega de EPP"})})]}),ae.length>0&&(0,r.jsxs)("div",{className:"border-t pt-3",children:[(0,r.jsx)("h5",{className:"text-xs font-semibold text-muted-foreground mb-2",children:"Historial de entregas de EPP"}),(0,r.jsx)("div",{className:"space-y-2 max-h-64 overflow-y-auto pr-1",children:ae.map(e=>(0,r.jsxs)("article",{className:"rounded-lg border bg-muted/30 p-3 text-[11px] space-y-1",children:[(0,r.jsxs)("p",{className:"font-semibold text-foreground",children:[e.fechaEntrega," – Responsable:"," ",e.responsableEntrega||"No registrado"]}),(0,r.jsxs)("p",{className:"text-muted-foreground",children:["Elementos:"," ",[e.casco&&"casco",e.zapatosSeguridad&&"zapatos",e.lentesSeguridad&&"lentes",e.guantes&&"guantes",e.ropaTrabajo&&"ropa",e.arnes&&"arn\xe9s"].filter(Boolean).join(", ")||"No registrado"]}),e.otrosDescripcion&&(0,r.jsxs)("p",{className:"text-muted-foreground",children:["Otros: ",e.otrosDescripcion]}),e.observaciones&&(0,r.jsxs)("p",{className:"text-muted-foreground",children:["Observaciones: ",e.observaciones]})]},e.id))})]})]}),(0,r.jsxs)("div",{className:"rounded-xl border bg-card p-4 shadow-sm space-y-3",children:[(0,r.jsxs)("div",{className:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"text-sm font-semibold text-card-foreground",children:"Charla de seguridad / charla espec\xedfica"}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Registra la participaci\xf3n del trabajador en charlas de seguridad (diarias, espec\xedficas o reinducciones), incluyendo tema, riesgo principal y observaciones."})]}),(0,r.jsxs)("div",{className:"flex flex-col items-start gap-1 text-xs md:items-end print:hidden",children:[ar?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("span",{className:"font-semibold text-card-foreground",children:["\xdaltima charla: ",ar.fechaCharla]}),(0,r.jsxs)("span",{className:"text-muted-foreground",children:["Tema: ",ar.tema||"Sin tema registrado"]})]}):(0,r.jsx)("span",{className:"text-muted-foreground",children:"Este trabajador a\xfan no tiene charlas registradas en el sistema."}),(0,r.jsx)(o.z,{type:"button",onClick:()=>{e3(null),e0(e=>!e)},variant:"outline",size:"sm",className:"mt-1",children:eW?"Cerrar formulario de charla":"Registrar nueva charla"})]})]}),eW&&(0,r.jsxs)("form",{className:"space-y-3 border-t pt-3 text-xs print:hidden",onSubmit:e=>{if(e.preventDefault(),e3(null),!e9){e3("Debes seleccionar un trabajador.");return}if(!e1.fechaCharla){e3("Debes indicar la fecha de la charla.");return}if(!e1.tema.trim()){e3("Indica el tema de la charla.");return}if(!e1.relator.trim()){e3("Indica qui\xe9n dict\xf3 la charla.");return}if(!e1.aceptaCharla){e3("Debes marcar que el trabajador declara haber participado en la charla.");return}if(!e1.nombreFirmaTrabajador.trim()){e3("Indica el nombre del trabajador como simulaci\xf3n de firma.");return}let a={id:"undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():Date.now().toString(),trabajadorId:e9.id,obraId:e9.obraId,fechaCharla:e1.fechaCharla,tipoCharla:e1.tipoCharla,tema:e1.tema,relator:e1.relator,riesgoPrincipal:e1.riesgoPrincipal,medidasReforzadas:e1.medidasReforzadas,asistencia:e1.asistencia,observaciones:e1.observaciones,aceptaCharla:e1.aceptaCharla,nombreFirmaTrabajador:e1.nombreFirmaTrabajador};eK(e=>[a,...e]),e2(e=>({...e,tema:"",relator:"",riesgoPrincipal:"",medidasReforzadas:"",observaciones:"",aceptaCharla:!1,nombreFirmaTrabajador:""})),e0(!1)},children:[e4&&(0,r.jsx)("p",{className:"text-[11px] text-red-600",children:e4}),(0,r.jsxs)("div",{className:"grid gap-3 md:grid-cols-3",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(i._,{className:"font-medium text-muted-foreground",children:"Fecha de la charla"}),(0,r.jsx)(d.I,{type:"date",value:e1.fechaCharla,onChange:e=>e2(a=>({...a,fechaCharla:e.target.value}))})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(i._,{className:"font-medium text-muted-foreground",children:"Tipo de charla"}),(0,r.jsxs)(l.Ph,{value:e1.tipoCharla,onValueChange:e=>e2(a=>({...a,tipoCharla:e})),children:[(0,r.jsx)(l.i4,{children:(0,r.jsx)(l.ki,{})}),(0,r.jsxs)(l.Bw,{children:[(0,r.jsx)(l.Ql,{value:"Charla diaria",children:"Charla diaria"}),(0,r.jsx)(l.Ql,{value:"Charla espec\xedfica",children:"Charla espec\xedfica"}),(0,r.jsx)(l.Ql,{value:"Reinducci\xf3n",children:"Reinducci\xf3n"}),(0,r.jsx)(l.Ql,{value:"Otra",children:"Otra"})]})]})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(i._,{className:"font-medium text-muted-foreground",children:"Relator"}),(0,r.jsx)(d.I,{type:"text",value:e1.relator,onChange:e=>e2(a=>({...a,relator:e.target.value})),placeholder:"Nombre de quien dicta la charla"})]})]}),(0,r.jsxs)("div",{className:"grid gap-3 md:grid-cols-2",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(i._,{className:"font-medium text-muted-foreground",children:"Tema de la charla"}),(0,r.jsx)(d.I,{type:"text",value:e1.tema,onChange:e=>e2(a=>({...a,tema:e.target.value})),placeholder:"Ej: Trabajo en altura, orden y limpieza, etc."})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(i._,{className:"font-medium text-muted-foreground",children:"Riesgo principal abordado"}),(0,r.jsx)(d.I,{type:"text",value:e1.riesgoPrincipal,onChange:e=>e2(a=>({...a,riesgoPrincipal:e.target.value})),placeholder:"Ej: Ca\xeddas de altura, atrapamientos, el\xe9ctrico..."})]})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(i._,{className:"font-medium text-muted-foreground",children:"Medidas espec\xedficas reforzadas"}),(0,r.jsx)(m.g,{value:e1.medidasReforzadas,onChange:e=>e2(a=>({...a,medidasReforzadas:e.target.value})),rows:3})]}),(0,r.jsxs)("div",{className:"grid gap-3 md:grid-cols-2",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(i._,{className:"font-medium text-muted-foreground",children:"Asistencia del trabajador"}),(0,r.jsxs)(l.Ph,{value:e1.asistencia,onValueChange:e=>e2(a=>({...a,asistencia:e})),children:[(0,r.jsx)(l.i4,{children:(0,r.jsx)(l.ki,{})}),(0,r.jsxs)(l.Bw,{children:[(0,r.jsx)(l.Ql,{value:"Asiste",children:"Asiste"}),(0,r.jsx)(l.Ql,{value:"No asiste",children:"No asiste"}),(0,r.jsx)(l.Ql,{value:"Llega tarde",children:"Llega tarde"})]})]})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(i._,{className:"font-medium text-muted-foreground",children:"Observaciones"}),(0,r.jsx)(m.g,{value:e1.observaciones,onChange:e=>e2(a=>({...a,observaciones:e.target.value})),rows:3})]})]}),(0,r.jsxs)("div",{className:"border-t pt-3 space-y-2",children:[(0,r.jsxs)(i._,{className:"flex items-center gap-2 font-normal",children:[(0,r.jsx)(C.X,{checked:e1.aceptaCharla,onCheckedChange:e=>e2(a=>({...a,aceptaCharla:!!e}))}),(0,r.jsx)("span",{children:"El trabajador declara haber participado en la charla de seguridad."})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(i._,{className:"font-medium text-muted-foreground",children:"Nombre del trabajador (simulaci\xf3n de firma)"}),(0,r.jsx)(d.I,{type:"text",value:e1.nombreFirmaTrabajador,onChange:e=>e2(a=>({...a,nombreFirmaTrabajador:e.target.value})),placeholder:"Nombre completo del trabajador"}),(0,r.jsx)("p",{className:"text-[11px] text-muted-foreground",children:"M\xe1s adelante se puede reemplazar por una firma digital con el dedo (canvas). Por ahora se registra el nombre como aceptaci\xf3n."})]})]}),(0,r.jsx)("div",{className:"pt-2",children:(0,r.jsx)(o.z,{type:"submit",children:"Guardar registro de charla"})})]}),as.length>0&&(0,r.jsxs)("div",{className:"border-t pt-3",children:[(0,r.jsx)("h5",{className:"text-xs font-semibold text-muted-foreground mb-2",children:"Historial de charlas de seguridad"}),(0,r.jsx)("div",{className:"space-y-2 max-h-64 overflow-y-auto pr-1",children:as.map(e=>(0,r.jsxs)("article",{className:"rounded-lg border bg-muted/30 p-3 text-[11px] space-y-1",children:[(0,r.jsxs)("p",{className:"font-semibold text-foreground",children:[e.fechaCharla," – ",e.tema||"Sin tema registrado"]}),(0,r.jsxs)("p",{className:"text-muted-foreground",children:["Tipo: ",e.tipoCharla," \xb7 Relator:"," ",e.relator||"No registrado"]}),e.riesgoPrincipal&&(0,r.jsxs)("p",{className:"text-muted-foreground",children:["Riesgo principal: ",e.riesgoPrincipal]}),e.medidasReforzadas&&(0,r.jsxs)("p",{className:"text-muted-foreground",children:["Medidas reforzadas: ",e.medidasReforzadas]}),e.observaciones&&(0,r.jsxs)("p",{className:"text-muted-foreground",children:["Observaciones: ",e.observaciones]})]},e.id))})]})]})]})]})]})]})}},68245:function(e,a,s){"use strict";s.d(a,{X:function(){return i}});var r=s(57437),n=s(2265),o=s(9270),t=s(59559),d=s(93448);let i=n.forwardRef((e,a)=>{let{className:s,...n}=e;return(0,r.jsx)(o.fC,{ref:a,className:(0,d.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s),...n,children:(0,r.jsx)(o.z$,{className:(0,d.cn)("flex items-center justify-center text-current"),children:(0,r.jsx)(t.Z,{className:"h-4 w-4"})})})});i.displayName=o.fC.displayName},40279:function(e,a,s){"use strict";s.d(a,{I:function(){return t}});var r=s(57437),n=s(2265),o=s(93448);let t=n.forwardRef((e,a)=>{let{className:s,type:n,...t}=e;return(0,r.jsx)("input",{type:n,className:(0,o.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:a,...t})});t.displayName="Input"},7204:function(e,a,s){"use strict";s.d(a,{E:function(){return d}});var r=s(57437),n=s(2265),o=s(1505),t=s(93448);let d=n.forwardRef((e,a)=>{let{className:s,value:n,...d}=e;return(0,r.jsx)(o.fC,{ref:a,className:(0,t.cn)("relative h-4 w-full overflow-hidden rounded-full bg-secondary",s),...d,children:(0,r.jsx)(o.z$,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:"translateX(-".concat(100-(n||0),"%)")}})})});d.displayName=o.fC.displayName},86700:function(e,a,s){"use strict";s.d(a,{E:function(){return i},m:function(){return l}});var r=s(57437),n=s(2265),o=s(42325),t=s(78084),d=s(93448);let i=n.forwardRef((e,a)=>{let{className:s,...n}=e;return(0,r.jsx)(o.fC,{className:(0,d.cn)("grid gap-2",s),...n,ref:a})});i.displayName=o.fC.displayName;let l=n.forwardRef((e,a)=>{let{className:s,...n}=e;return(0,r.jsx)(o.ck,{ref:a,className:(0,d.cn)("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),...n,children:(0,r.jsx)(o.z$,{className:"flex items-center justify-center",children:(0,r.jsx)(t.Z,{className:"h-2.5 w-2.5 fill-current text-current"})})})});l.displayName=o.ck.displayName},31593:function(e,a,s){"use strict";s.d(a,{Z:function(){return d}});var r=s(57437),n=s(2265),o=s(90759),t=s(93448);let d=n.forwardRef((e,a)=>{let{className:s,orientation:n="horizontal",decorative:d=!0,...i}=e;return(0,r.jsx)(o.f,{ref:a,decorative:d,orientation:n,className:(0,t.cn)("shrink-0 bg-border","horizontal"===n?"h-[1px] w-full":"h-full w-[1px]",s),...i})});d.displayName=o.f.displayName},23675:function(e,a,s){"use strict";s.d(a,{g:function(){return t}});var r=s(57437),n=s(2265),o=s(93448);let t=n.forwardRef((e,a)=>{let{className:s,...n}=e;return(0,r.jsx)("textarea",{className:(0,o.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:a,...n})});t.displayName="Textarea"}},function(e){e.O(0,[4358,9990,6137,1211,9759,3562,6008,9923,2550,5862,7465,5284,2971,2117,1744],function(){return e(e.s=39986)}),_N_E=e.O()}]);