(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5508],{18583:function(e,s,r){Promise.resolve().then(r.bind(r,9688))},9688:function(e,s,r){"use strict";r.r(s),r.d(s,{default:function(){return p}});var l=r(57437),i=r(2265),a=r(12381),d=r(5485),c=r(53459),t=r(56141),n=r(27648),o=r(71245),h=r(5978),x=r(99764),j=r(79820),u=r(33804),m=r(15291),f=r(75060);function p(){let{user:e,companyId:s}=(0,o.a)(),[r,p]=(0,i.useState)([]),[N,_]=(0,i.useState)("__all__"),[v,b]=(0,i.useState)([]),[g,C]=(0,i.useState)(!0);return(0,i.useEffect)(()=>{if(!s)return;let e=(0,h.IO)((0,h.hJ)(x.N$,"obras"),(0,h.ar)("empresaId","==",s)),r=(0,h.cf)(e,e=>{p(e.docs.map(e=>({id:e.id,...e.data()})))});return()=>r()},[s]),(0,i.useEffect)(()=>{let e;if(!s){b([]),C(!1);return}C(!0);let r=(0,h.hJ)(x.N$,"safetyChecklistRecords"),l=(0,h.ar)("companyId","==",s);e="__all__"===N?(0,h.IO)(r,l,(0,h.Xo)("filledAt","desc")):(0,h.IO)(r,l,(0,h.ar)("obraId","==",N),(0,h.Xo)("filledAt","desc"));let i=(0,h.cf)(e,e=>{b(e.docs.map(e=>({id:e.id,...e.data()}))),C(!1)},e=>{console.error("Error fetching safety records: ",e),C(!1)});return()=>i()},[s,N]),(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("header",{className:"flex items-center gap-4",children:[(0,l.jsx)(a.z,{variant:"outline",size:"icon",asChild:!0,children:(0,l.jsx)(n.default,{href:"/prevencion/safety-checklists",children:(0,l.jsx)(d.Z,{className:"h-4 w-4"})})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h1",{className:"text-2xl font-bold",children:"Registros de Checklists de Seguridad"}),(0,l.jsx)("p",{className:"text-muted-foreground",children:"Historial de todos los formularios de seguridad completados."})]})]}),(0,l.jsxs)(j.Zb,{children:[(0,l.jsx)(j.Ol,{children:(0,l.jsx)(j.ll,{children:"Filtro por Obra"})}),(0,l.jsx)(j.aY,{children:(0,l.jsxs)("div",{className:"max-w-sm",children:[(0,l.jsx)(f._,{children:"Filtrar por obra"}),(0,l.jsxs)(m.Ph,{value:N,onValueChange:e=>_(e),children:[(0,l.jsx)(m.i4,{children:(0,l.jsx)(m.ki,{placeholder:"Todas las obras"})}),(0,l.jsxs)(m.Bw,{children:[(0,l.jsx)(m.Ql,{value:"__all__",children:"Todas las obras"}),r.map(e=>(0,l.jsx)(m.Ql,{value:e.id,children:e.nombreFaena},e.id))]})]})]})})]}),(0,l.jsxs)(j.Zb,{children:[(0,l.jsx)(j.Ol,{children:(0,l.jsx)(j.ll,{children:"Historial de Registros de Seguridad"})}),(0,l.jsx)(j.aY,{children:g?(0,l.jsx)("div",{className:"text-center py-8",children:(0,l.jsx)(c.Z,{className:"animate-spin mx-auto"})}):0===v.length?(0,l.jsx)("div",{className:"text-center py-16 border-2 border-dashed rounded-lg",children:(0,l.jsx)("p",{className:"text-muted-foreground",children:"No se han completado formularios de seguridad que coincidan con el filtro."})}):(0,l.jsxs)(u.iA,{children:[(0,l.jsx)(u.xD,{children:(0,l.jsxs)(u.SC,{children:[(0,l.jsx)(u.ss,{children:"Fecha"}),(0,l.jsx)(u.ss,{children:"Nombre Formulario"}),(0,l.jsx)(u.ss,{children:"Completado Por"}),(0,l.jsx)(u.ss,{children:"Sector"}),(0,l.jsx)(u.ss,{className:"text-right",children:"Acciones"})]})}),(0,l.jsx)(u.RM,{children:v.map(e=>{var s;return(0,l.jsxs)(u.SC,{children:[(0,l.jsx)(u.pj,{children:e.filledAt.toDate().toLocaleString("es-CL")}),(0,l.jsx)(u.pj,{className:"font-medium",children:e.templateTitleSnapshot}),(0,l.jsx)(u.pj,{children:e.filledByEmail}),(0,l.jsx)(u.pj,{children:(null===(s=e.header)||void 0===s?void 0:s.sector)||"N/A"}),(0,l.jsx)(u.pj,{className:"text-right",children:(0,l.jsx)(a.z,{asChild:!0,variant:"outline",size:"sm",children:(0,l.jsxs)(n.default,{href:"/prevencion/safety-checklists/records/".concat(e.id),children:[(0,l.jsx)(t.Z,{className:"mr-2 h-4 w-4"})," Ver Detalle"]})})})]},e.id)})})]})})]})]})}}},function(e){e.O(0,[4358,9990,6137,1211,2972,9759,3562,6008,9923,2550,670,2971,2117,1744],function(){return e(e.s=18583)}),_N_E=e.O()}]);