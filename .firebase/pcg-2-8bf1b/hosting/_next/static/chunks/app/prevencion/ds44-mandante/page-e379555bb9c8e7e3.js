(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5733],{12789:function(e,a,r){Promise.resolve().then(r.bind(r,5664))},5664:function(e,a,r){"use strict";r.r(a),r.d(a,{default:function(){return b}});var n=r(57437),s=r(2265),i=r(12381),t=r(79820),o=r(40279),l=r(75060),d=r(15291),c=r(23675),u=r(68245),m=r(31593),f=r(99764),p=r(5978),h=r(27648),x=r(5485),g=r(99376),v=r(71245);function b(){let e=(0,g.useRouter)(),{user:a,companyId:r,role:b}=(0,v.a)(),[j,N]=(0,s.useState)([]),[y,C]=(0,s.useState)(""),[w,I]=(0,s.useState)(null),[R,E]=(0,s.useState)(null),[S,_]=(0,s.useState)(!0),[O,P]=(0,s.useState)(!1),[k,A]=(0,s.useState)(null),[D,F]=(0,s.useState)(null);(0,s.useEffect)(()=>{let e;if(!a||!r&&"superadmin"!==b)return;let n=(0,p.hJ)(f.N$,"obras");e="superadmin"===b?(0,p.IO)(n):(0,p.IO)(n,(0,p.ar)("empresaId","==",r));let s=(0,p.cf)(e,e=>{let a=e.docs.map(e=>{var a,r,n,s;return{id:e.id,nombreFaena:null!==(a=e.data().nombreFaena)&&void 0!==a?a:"",mandanteRazonSocial:null!==(r=e.data().mandanteRazonSocial)&&void 0!==r?r:"",mandanteRut:null!==(n=e.data().mandanteRut)&&void 0!==n?n:"",mutualidad:null!==(s=e.data().mutualidad)&&void 0!==s?s:""}});N(a),a.length>0&&!y&&C(a[0].id)},e=>{console.error("Error cargando obras",e),A("No se pudieron cargar las obras desde Firestore.")});return()=>s()},[a,r,b]),(0,s.useEffect)(()=>{(async()=>{if(!y){E(null),I(null),_(!1);return}I(j.find(e=>e.id===y)||null),_(!0),A(null),F(null);try{let b=(0,p.JU)(f.N$,"obras",y,"ds44MandanteObra","ficha"),j=await (0,p.QT)(b);if(j.exists()){var e,a,r,n,s,i,t,o,l,d,c,u,m,h,x,g,v;let f=j.data();E({obraId:y,representanteLegal:null!==(r=f.representanteLegal)&&void 0!==r?r:"",responsableCoordinacionNombre:null!==(n=f.responsableCoordinacionNombre)&&void 0!==n?n:"",responsableCoordinacionCargo:null!==(s=f.responsableCoordinacionCargo)&&void 0!==s?s:"",responsableCoordinacionContacto:null!==(i=f.responsableCoordinacionContacto)&&void 0!==i?i:"",fechaInicioObra:null!==(t=f.fechaInicioObra)&&void 0!==t?t:"",fechaTerminoEstimado:null!==(o=f.fechaTerminoEstimado)&&void 0!==o?o:"",existeReglamentoEspecial:null!==(l=f.existeReglamentoEspecial)&&void 0!==l&&l,existePlanUnicoSeguridad:null!==(d=f.existePlanUnicoSeguridad)&&void 0!==d&&d,existeProgramaCoordinacion:null!==(c=f.existeProgramaCoordinacion)&&void 0!==c&&c,frecuenciaReunionesCoordinacion:null!==(u=f.frecuenciaReunionesCoordinacion)&&void 0!==u?u:"",mecanismosComunicacion:null!==(m=f.mecanismosComunicacion)&&void 0!==m?m:"",estadoGlobal:null!==(h=f.estadoGlobal)&&void 0!==h?h:"EN_IMPLEMENTACION",observacionesGenerales:null!==(x=f.observacionesGenerales)&&void 0!==x?x:"",fechaUltimaRevision:null!==(g=f.fechaUltimaRevision)&&void 0!==g?g:new Date().toISOString().slice(0,10),revisadoPor:null!==(v=f.revisadoPor)&&void 0!==v?v:"",createdAt:(null===(e=f.createdAt)||void 0===e?void 0:e.toDate)?f.createdAt.toDate():null,updatedAt:(null===(a=f.updatedAt)||void 0===a?void 0:a.toDate)?f.updatedAt.toDate():null})}else E({obraId:y,representanteLegal:"",responsableCoordinacionNombre:"",responsableCoordinacionCargo:"",responsableCoordinacionContacto:"",fechaInicioObra:"",fechaTerminoEstimado:"",existeReglamentoEspecial:!1,existePlanUnicoSeguridad:!1,existeProgramaCoordinacion:!1,frecuenciaReunionesCoordinacion:"",mecanismosComunicacion:"",estadoGlobal:"EN_IMPLEMENTACION",observacionesGenerales:"",fechaUltimaRevision:new Date().toISOString().slice(0,10),revisadoPor:""})}catch(e){console.error(e),A("Error al cargar la ficha DS44 Mandante / Obra.")}finally{_(!1)}})()},[y,j]);let M=(e,a)=>{E(r=>r?{...r,[e]:a}:r)},U=async e=>{if(e.preventDefault(),A(null),F(null),!y){A("Debes seleccionar una obra antes de guardar la ficha.");return}if(!R){A("No se pudo cargar la ficha en memoria para guardar.");return}if(!R.responsableCoordinacionNombre){A("Completa al menos el nombre del responsable de coordinaci\xf3n.");return}try{P(!0);let e=(0,p.JU)(f.N$,"obras",y,"ds44MandanteObra","ficha");await (0,p.pl)(e,{...R,obraId:y,createdAt:R.createdAt?p.EK.fromDate(R.createdAt):(0,p.Bt)(),updatedAt:(0,p.Bt)()},{merge:!0}),F("Ficha DS44 Mandante / Obra guardada correctamente!"),setTimeout(()=>F(null),4e3)}catch(e){console.error(e),A("Error al guardar la ficha DS44 Mandante / Obra. Intenta nuevamente.")}finally{P(!1)}};return j.length||"superadmin"===b||r?(0,n.jsxs)("div",{className:"space-y-8",children:[(0,n.jsxs)("header",{className:"flex items-center gap-4",children:[(0,n.jsx)(i.z,{variant:"outline",size:"icon",onClick:()=>e.push("/prevencion"),children:(0,n.jsx)(x.Z,{})}),(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsx)("h1",{className:"text-3xl font-bold font-headline tracking-tight",children:"DS44 â€“ Mandante / Obra"}),(0,n.jsx)("p",{className:"text-lg text-muted-foreground",children:"Ficha global de cumplimiento de la obligaci\xf3n de coordinar las actividades preventivas en la obra, desde la perspectiva del mandante (DS44, Art. 3)."})]})]}),(0,n.jsxs)(t.Zb,{children:[(0,n.jsxs)(t.Ol,{children:[(0,n.jsx)(t.ll,{children:"Selecci\xf3n de Obra"}),(0,n.jsx)(t.SZ,{children:"Seleccione la obra para la cual desea ver o editar la ficha DS44 global."})]}),(0,n.jsx)(t.aY,{children:(0,n.jsxs)("div",{className:"max-w-md",children:[(0,n.jsx)(l._,{htmlFor:"obra-select",children:"Obra / Faena"}),(0,n.jsxs)(d.Ph,{value:y,onValueChange:C,children:[(0,n.jsx)(d.i4,{id:"obra-select",children:(0,n.jsx)(d.ki,{placeholder:"Seleccione una obra"})}),(0,n.jsx)(d.Bw,{children:j.map(e=>(0,n.jsx)(d.Ql,{value:e.id,children:e.nombreFaena},e.id))})]})]})})]}),S&&(0,n.jsx)("p",{className:"text-muted-foreground text-center",children:"Cargando ficha..."}),R&&w&&(0,n.jsxs)("form",{onSubmit:U,className:"space-y-6",children:[(0,n.jsxs)(t.Zb,{children:[(0,n.jsxs)(t.Ol,{children:[(0,n.jsx)(t.ll,{children:"A. Datos de la Obra y del Mandante"}),(0,n.jsx)(t.SZ,{children:"La Raz\xf3n Social, el RUT del Mandante y la Mutualidad se gestionan desde el m\xf3dulo de Obras."})]}),(0,n.jsxs)(t.aY,{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(l._,{children:"Raz\xf3n Social Mandante"}),(0,n.jsx)(o.I,{value:w.mandanteRazonSocial||"No definido en Obra",disabled:!0})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(l._,{children:"RUT Mandante"}),(0,n.jsx)(o.I,{value:w.mandanteRut||"No definido en Obra",disabled:!0})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(l._,{children:"Mutualidad"}),(0,n.jsx)(o.I,{value:w.mutualidad||"No definido en Obra",disabled:!0})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(l._,{children:"Representante Legal"}),(0,n.jsx)(o.I,{value:R.representanteLegal,onChange:e=>M("representanteLegal",e.target.value)})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(l._,{children:"Fecha de Inicio de Obra"}),(0,n.jsx)(o.I,{type:"date",value:R.fechaInicioObra,onChange:e=>M("fechaInicioObra",e.target.value)})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(l._,{children:"Fecha de T\xe9rmino Estimado"}),(0,n.jsx)(o.I,{type:"date",value:R.fechaTerminoEstimado,onChange:e=>M("fechaTerminoEstimado",e.target.value)})]})]})]}),(0,n.jsxs)(t.Zb,{children:[(0,n.jsx)(t.Ol,{children:(0,n.jsx)(t.ll,{children:"B. Responsable de Coordinaci\xf3n DS44"})}),(0,n.jsxs)(t.aY,{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(l._,{children:"Nombre"}),(0,n.jsx)(o.I,{value:R.responsableCoordinacionNombre,onChange:e=>M("responsableCoordinacionNombre",e.target.value)})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(l._,{children:"Cargo"}),(0,n.jsx)(o.I,{value:R.responsableCoordinacionCargo,onChange:e=>M("responsableCoordinacionCargo",e.target.value)})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(l._,{children:"Contacto (Tel\xe9fono / Email)"}),(0,n.jsx)(o.I,{value:R.responsableCoordinacionContacto,onChange:e=>M("responsableCoordinacionContacto",e.target.value)})]})]})]}),(0,n.jsxs)(t.Zb,{children:[(0,n.jsx)(t.Ol,{children:(0,n.jsx)(t.ll,{children:"C. Documentos y Coordinaci\xf3n DS44"})}),(0,n.jsxs)(t.aY,{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(u.X,{id:"reglamento",checked:R.existeReglamentoEspecial,onCheckedChange:e=>M("existeReglamentoEspecial",!!e)}),(0,n.jsx)(l._,{htmlFor:"reglamento",children:"Existe Reglamento Especial de Faena"})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(u.X,{id:"plan",checked:R.existePlanUnicoSeguridad,onCheckedChange:e=>M("existePlanUnicoSeguridad",!!e)}),(0,n.jsx)(l._,{htmlFor:"plan",children:"Existe Plan de Seguridad Coordinado"})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(u.X,{id:"programa",checked:R.existeProgramaCoordinacion,onCheckedChange:e=>M("existeProgramaCoordinacion",!!e)}),(0,n.jsx)(l._,{htmlFor:"programa",children:"Existe Programa de Coordinaci\xf3n"})]})]}),(0,n.jsx)(m.Z,{}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(l._,{children:"Frecuencia de Reuniones de Coordinaci\xf3n"}),(0,n.jsx)(o.I,{value:R.frecuenciaReunionesCoordinacion,onChange:e=>M("frecuenciaReunionesCoordinacion",e.target.value),placeholder:"Ej: Semanal, Quincenal"})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(l._,{children:"Mecanismos de Comunicaci\xf3n"}),(0,n.jsx)(c.g,{value:R.mecanismosComunicacion,onChange:e=>M("mecanismosComunicacion",e.target.value),placeholder:"Ej: Correo, reuniones, actas..."})]})]})]})]}),(0,n.jsxs)(t.Zb,{children:[(0,n.jsx)(t.Ol,{children:(0,n.jsx)(t.ll,{children:"D. Estado Global y Observaciones"})}),(0,n.jsxs)(t.aY,{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(l._,{children:"Estado Global de Cumplimiento DS44"}),(0,n.jsxs)(d.Ph,{value:R.estadoGlobal,onValueChange:e=>M("estadoGlobal",e),children:[(0,n.jsx)(d.i4,{children:(0,n.jsx)(d.ki,{})}),(0,n.jsxs)(d.Bw,{children:[(0,n.jsx)(d.Ql,{value:"EN_IMPLEMENTACION",children:"En implementaci\xf3n"}),(0,n.jsx)(d.Ql,{value:"CUMPLE",children:"Cumple"}),(0,n.jsx)(d.Ql,{value:"CON_OBSERVACIONES",children:"Cumple con observaciones"}),(0,n.jsx)(d.Ql,{value:"CRITICO",children:"Cr\xedtico"})]})]})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(l._,{children:"Observaciones Generales"}),(0,n.jsx)(c.g,{value:R.observacionesGenerales,onChange:e=>M("observacionesGenerales",e.target.value)})]})]}),(0,n.jsx)(m.Z,{}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(l._,{children:"Fecha de \xdaltima Revisi\xf3n"}),(0,n.jsx)(o.I,{type:"date",value:R.fechaUltimaRevision,onChange:e=>M("fechaUltimaRevision",e.target.value)})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(l._,{children:"Revisado Por"}),(0,n.jsx)(o.I,{value:R.revisadoPor,onChange:e=>M("revisadoPor",e.target.value),placeholder:"Nombre del Prevencionista / Comit\xe9"})]})]})]})]}),(0,n.jsxs)("div",{className:"flex flex-col sm:flex-row items-center gap-4",children:[(0,n.jsx)(i.z,{type:"submit",className:"w-full sm:w-auto bg-accent text-accent-foreground hover:bg-accent/90",disabled:O,children:O?"Guardando...":"Guardar Ficha DS44 de la Obra"}),(0,n.jsx)(i.z,{asChild:!0,variant:"outline",className:"w-full sm:w-auto",disabled:!y,children:(0,n.jsx)(h.default,{href:"/prevencion/ds44-mandante/".concat(y,"/imprimir"),children:"Imprimir Ficha"})}),k&&(0,n.jsx)("p",{className:"text-sm font-medium text-destructive",children:k}),D&&(0,n.jsx)("p",{className:"text-sm font-medium text-green-600",children:D})]})]})]}):(0,n.jsx)("div",{className:"text-center p-8 text-muted-foreground",children:"Cargando..."})}},12381:function(e,a,r){"use strict";r.d(a,{d:function(){return l},z:function(){return d}});var n=r(57437),s=r(2265),i=r(37053),t=r(90535),o=r(93448);let l=(0,t.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=s.forwardRef((e,a)=>{let{className:r,variant:s,size:t,asChild:d=!1,...c}=e,u=d?i.g7:"button";return(0,n.jsx)(u,{className:(0,o.cn)(l({variant:s,size:t,className:r})),ref:a,...c})});d.displayName="Button"},79820:function(e,a,r){"use strict";r.d(a,{Ol:function(){return o},SZ:function(){return d},Zb:function(){return t},aY:function(){return c},eW:function(){return u},ll:function(){return l}});var n=r(57437),s=r(2265),i=r(93448);let t=s.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,n.jsx)("div",{ref:a,className:(0,i.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...s})});t.displayName="Card";let o=s.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,n.jsx)("div",{ref:a,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",r),...s})});o.displayName="CardHeader";let l=s.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,n.jsx)("div",{ref:a,className:(0,i.cn)("text-2xl font-semibold leading-none tracking-tight",r),...s})});l.displayName="CardTitle";let d=s.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,n.jsx)("div",{ref:a,className:(0,i.cn)("text-sm text-muted-foreground",r),...s})});d.displayName="CardDescription";let c=s.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,n.jsx)("div",{ref:a,className:(0,i.cn)("p-6 pt-0",r),...s})});c.displayName="CardContent";let u=s.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,n.jsx)("div",{ref:a,className:(0,i.cn)("flex items-center p-6 pt-0",r),...s})});u.displayName="CardFooter"},68245:function(e,a,r){"use strict";r.d(a,{X:function(){return l}});var n=r(57437),s=r(2265),i=r(9270),t=r(59559),o=r(93448);let l=s.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,n.jsx)(i.fC,{ref:a,className:(0,o.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",r),...s,children:(0,n.jsx)(i.z$,{className:(0,o.cn)("flex items-center justify-center text-current"),children:(0,n.jsx)(t.Z,{className:"h-4 w-4"})})})});l.displayName=i.fC.displayName},40279:function(e,a,r){"use strict";r.d(a,{I:function(){return t}});var n=r(57437),s=r(2265),i=r(93448);let t=s.forwardRef((e,a)=>{let{className:r,type:s,...t}=e;return(0,n.jsx)("input",{type:s,className:(0,i.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:a,...t})});t.displayName="Input"},75060:function(e,a,r){"use strict";r.d(a,{_:function(){return d}});var n=r(57437),s=r(2265),i=r(370),t=r(90535),o=r(93448);let l=(0,t.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=s.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,n.jsx)(i.f,{ref:a,className:(0,o.cn)(l(),r),...s})});d.displayName=i.f.displayName},15291:function(e,a,r){"use strict";r.d(a,{Bw:function(){return h},Ph:function(){return c},Ql:function(){return x},i4:function(){return m},ki:function(){return u}});var n=r(57437),s=r(2265),i=r(74797),t=r(3289),o=r(47969),l=r(59559),d=r(93448);let c=i.fC;i.ZA;let u=i.B4,m=s.forwardRef((e,a)=>{let{className:r,children:s,...o}=e;return(0,n.jsxs)(i.xz,{ref:a,className:(0,d.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",r),...o,children:[s,(0,n.jsx)(i.JO,{asChild:!0,children:(0,n.jsx)(t.Z,{className:"h-4 w-4 opacity-50"})})]})});m.displayName=i.xz.displayName;let f=s.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,n.jsx)(i.u_,{ref:a,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",r),...s,children:(0,n.jsx)(o.Z,{className:"h-4 w-4"})})});f.displayName=i.u_.displayName;let p=s.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,n.jsx)(i.$G,{ref:a,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",r),...s,children:(0,n.jsx)(t.Z,{className:"h-4 w-4"})})});p.displayName=i.$G.displayName;let h=s.forwardRef((e,a)=>{let{className:r,children:s,position:t="popper",...o}=e;return(0,n.jsx)(i.h_,{children:(0,n.jsxs)(i.VY,{ref:a,className:(0,d.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===t&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",r),position:t,...o,children:[(0,n.jsx)(f,{}),(0,n.jsx)(i.l_,{className:(0,d.cn)("p-1","popper"===t&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s}),(0,n.jsx)(p,{})]})})});h.displayName=i.VY.displayName,s.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,n.jsx)(i.__,{ref:a,className:(0,d.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",r),...s})}).displayName=i.__.displayName;let x=s.forwardRef((e,a)=>{let{className:r,children:s,...t}=e;return(0,n.jsxs)(i.ck,{ref:a,className:(0,d.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r),...t,children:[(0,n.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,n.jsx)(i.wU,{children:(0,n.jsx)(l.Z,{className:"h-4 w-4"})})}),(0,n.jsx)(i.eT,{children:s})]})});x.displayName=i.ck.displayName,s.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,n.jsx)(i.Z0,{ref:a,className:(0,d.cn)("-mx-1 my-1 h-px bg-muted",r),...s})}).displayName=i.Z0.displayName},31593:function(e,a,r){"use strict";r.d(a,{Z:function(){return o}});var n=r(57437),s=r(2265),i=r(90759),t=r(93448);let o=s.forwardRef((e,a)=>{let{className:r,orientation:s="horizontal",decorative:o=!0,...l}=e;return(0,n.jsx)(i.f,{ref:a,decorative:o,orientation:s,className:(0,t.cn)("shrink-0 bg-border","horizontal"===s?"h-[1px] w-full":"h-full w-[1px]",r),...l})});o.displayName=i.f.displayName},23675:function(e,a,r){"use strict";r.d(a,{g:function(){return t}});var n=r(57437),s=r(2265),i=r(93448);let t=s.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,n.jsx)("textarea",{className:(0,i.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:a,...s})});t.displayName="Textarea"},71245:function(e,a,r){"use strict";r.d(a,{H:function(){return m},a:function(){return f}});var n=r(57437),s=r(43301),i=r(2265),t=r(99764),o=r(99376),l=r(5978);async function d(e){var a;let r=t.N$,n=null===(a=e.email)||void 0===a?void 0:a.toLowerCase().trim();if(!n)return{role:"none",companyId:null};let s=(0,l.IO)((0,l.hJ)(r,"invitacionesUsuarios"),(0,l.ar)("email","==",n),(0,l.ar)("estado","==","pendiente_auth"),(0,l.b9)(1)),i=await (0,l.PL)(s);if(i.empty)return console.log("No hay invitaci\xf3n pendiente para ".concat(n,".")),{role:"none",companyId:null};let o=i.docs[0],d=o.data(),c=(0,l.JU)(r,"users",e.uid),u=(0,l.qs)(r);return u.set(c,{nombre:d.nombre||e.displayName,email:n,role:d.roleDeseado,empresaId:d.empresaId,activo:!0,createdAt:(0,l.Bt)(),updatedAt:(0,l.Bt)()},{merge:!0}),u.update(o.ref,{estado:"activado",uid:e.uid,activatedAt:(0,l.Bt)()}),await u.commit(),console.log("Usuario ".concat(n," activado con rol ").concat(d.roleDeseado," en empresa ").concat(d.empresaId,".")),{role:d.roleDeseado,companyId:d.empresaId}}async function c(e){}let u=(0,i.createContext)(void 0);function m(e){let{children:a}=e,[r,m]=(0,i.useState)(null),[f,p]=(0,i.useState)("none"),[h,x]=(0,i.useState)(null),[g,v]=(0,i.useState)(null),[b,j]=(0,i.useState)(!0),N=(0,o.useRouter)(),y=(0,o.usePathname)();async function C(e,a){try{await (0,s.e5)(t.lX,e,a)}catch(e){if("auth/invalid-credential"===e.code||"auth/wrong-password"===e.code||"auth/user-not-found"===e.code)throw Error("Credenciales inv\xe1lidas. Por favor, revisa tu correo y contrase\xf1a.");if("auth/too-many-requests"===e.code)throw Error("Demasiados intentos fallidos. Por seguridad, el acceso desde este dispositivo ha sido bloqueado temporalmente.");throw console.error("Error de login no manejado:",e),Error("Ocurri\xf3 un error inesperado al iniciar sesi\xf3n.")}}async function w(){try{await (0,s.w7)(t.lX),m(null),p("none"),x(null),v(null),N.push("/")}catch(e){console.error("Error al cerrar sesi\xf3n",e)}}return(0,i.useEffect)(()=>{let e=(0,s.Aj)(t.lX,async e=>{if(e){await c(e);let a=(0,l.JU)(t.N$,"users",e.uid),r=await (0,l.QT)(a),n="none",s=null,i=!1;if(r.exists()){let e=r.data();e.role&&void 0!==e.empresaId&&(n=e.role,s=e.empresaId,i=!0===e.mustChangePassword)}if("none"===n){let a=await d(e);n=a.role,s=a.companyId,i=!0}p(n),x(s),m(e);let o="/cambiar-password"===y;if(i&&!o)N.replace("/cambiar-password");else if(!i){if("none"===n)N.replace("/sin-acceso");else if(y.startsWith("/login")||"/"===y||o){let e="cliente"===n?"/cliente":"contratista"===n?"/cumplimiento/contratista":"/dashboard";N.replace(e)}}}else m(null),p("none"),x(null),v(null);j(!1)});return()=>e()},[N,y]),(0,i.useEffect)(()=>{if(h){let e=(0,l.JU)(t.N$,"companies",h),a=(0,s.Aj)(t.lX,a=>{a&&(0,l.QT)(e).then(e=>{e.exists()?v({id:e.id,...e.data()}):v(null)})});return()=>a()}v(null)},[h]),(0,n.jsx)(u.Provider,{value:{user:r,role:f,companyId:h,company:g,loading:b,login:C,logout:w},children:a})}function f(){let e=(0,i.useContext)(u);if(!e)throw Error("useAuth debe usarse dentro de un AuthProvider");return e}},99764:function(e,a,r){"use strict";let n,s,i,t,o;r.d(a,{IG:function(){return t},N$:function(){return i},lX:function(){return s},x2:function(){return o}});var l=r(738),d=r(43301),c=r(5978),u=r(60062),m=r(13491);let f={apiKey:"AIzaSyBfMp_dH9XhFSXEeMxY-Cdy8MDRIgWrxR0",authDomain:"pcg-2-8bf1b.firebaseapp.com",projectId:"pcg-2-8bf1b",storageBucket:"pcg-2-8bf1b.appspot.com",messagingSenderId:"1073834543546",appId:"1:1073834543546:web:2f85a4a8350280f8589737"};for(let e in f)if(Object.prototype.hasOwnProperty.call(f,e)&&!f[e]){let a=e.replace(/([A-Z])/g,"_$1").toUpperCase(),r="NEXT_PUBLIC_FIREBASE_".concat(a);throw Error("Error de configuraci\xf3n del cliente: La variable de entorno Firebase '".concat(r,"' no est\xe1 definida o est\xe1 vac\xeda. ")+"Aseg\xfarate de que est\xe9 configurada en tu archivo .env.local o en las variables de entorno de producci\xf3n.")}n=(0,l.C6)().length?(0,l.Mq)():(0,l.ZF)(f),s=(0,d.v0)(n),i=(0,c.ad)(n),t=(0,u.cF)(n),o=(0,m.$C)(n,"us-central1")},93448:function(e,a,r){"use strict";r.d(a,{cn:function(){return i}});var n=r(61994),s=r(53335);function i(){for(var e=arguments.length,a=Array(e),r=0;r<e;r++)a[r]=arguments[r];return(0,s.m6)((0,n.W)(a))}}},function(e){e.O(0,[4358,9990,6137,1211,2972,9759,3562,6008,9923,2550,3539,2971,2117,1744],function(){return e(e.s=12789)}),_N_E=e.O()}]);