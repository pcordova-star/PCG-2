(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5722],{88295:function(e,a,s){Promise.resolve().then(s.bind(s,70434))},70434:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return p}});var t=s(57437),n=s(2265),r=s(99376),i=s(71245),l=s(5978),c=s(99764),d=s(79820),o=s(12381),h=s(27648),m=s(53459),u=s(3683),x=s(91120),f=s(91230);function p(){let{user:e,role:a,companyId:s,loading:p,logout:j}=(0,i.a)(),N=(0,r.useRouter)(),[g,y]=(0,n.useState)([]),[b,v]=(0,n.useState)(!0),[k,w]=(0,n.useState)(null),[Z,M]=(0,n.useState)(!0);return((0,n.useEffect)(()=>{if(!p&&!e){N.replace("/login/cliente");return}!p&&e&&"cliente"!==a&&"superadmin"!==a&&N.replace("/dashboard")},[e,p,a,N]),(0,n.useEffect)(()=>{e&&(async()=>{v(!0);try{let a=(0,l.IO)((0,l.hJ)(c.N$,"obras"),(0,l.ar)("clienteEmail","==",e.email)),s=(await (0,l.PL)(a)).docs.map(e=>({id:e.id,...e.data()}));y(s)}catch(e){console.error("Error fetching client's obras: ",e)}finally{v(!1)}})()},[e]),(0,n.useEffect)(()=>{if(!s){M(!1);return}(async()=>{M(!0);try{let e=(0,l.JU)(c.N$,"companies",s),a=await (0,l.QT)(e);a.exists()?w({id:a.id,...a.data()}):w(null)}catch(e){console.error("Error fetching company data:",e),w(null)}finally{M(!1)}})()},[s]),p||b||Z)?(0,t.jsxs)("div",{className:"flex items-center justify-center min-h-screen",children:[(0,t.jsx)(m.Z,{className:"h-8 w-8 animate-spin"}),(0,t.jsx)("p",{className:"ml-2",children:"Cargando portal del cliente..."})]}):e&&("cliente"===a||"superadmin"===a)?(0,t.jsxs)("div",{className:"min-h-screen bg-muted/40",children:[(0,t.jsx)("header",{className:"bg-background border-b",children:(0,t.jsxs)("div",{className:"container mx-auto flex justify-between items-center p-4",children:[(0,t.jsx)("h1",{className:"text-xl font-bold text-primary",children:"Portal del Cliente"}),(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("span",{className:"text-sm text-muted-foreground hidden sm:inline",children:e.email}),(0,t.jsxs)(o.z,{variant:"outline",onClick:j,children:[(0,t.jsx)(u.Z,{className:"mr-2 h-4 w-4"}),"Cerrar Sesi\xf3n"]})]})]})}),(0,t.jsxs)("main",{className:"container mx-auto p-4 md:p-8",children:[(0,t.jsxs)("header",{className:"rounded-lg border p-4 bg-card shadow-sm mb-8",children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Dashboard de Cliente"}),(0,t.jsxs)("h1",{className:"text-xl font-semibold",children:["Hola, ",(null==e?void 0:e.displayName)||(null==e?void 0:e.email)]}),k&&(0,t.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:["Empresa: ",(0,t.jsx)("span",{className:"font-medium text-foreground",children:k.nombreFantasia||k.razonSocial||"Sin nombre registrado"})]}),!k&&s&&(0,t.jsx)("p",{className:"text-sm text-destructive mt-1",children:"No se encontr\xf3 la empresa asociada a tu usuario. Contacta al administrador."})]}),0===g.length?(0,t.jsxs)(d.Zb,{children:[(0,t.jsx)(d.Ol,{children:(0,t.jsx)(d.ll,{children:"No tiene obras asignadas"})}),(0,t.jsx)(d.aY,{children:(0,t.jsx)("p",{className:"text-muted-foreground",children:"Actualmente no tiene ninguna obra asociada a su correo electr\xf3nico. Por favor, contacte con el administrador."})})]}):(0,t.jsx)("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:g.map(e=>{var a;return(0,t.jsxs)(d.Zb,{className:"flex flex-col",children:[(0,t.jsxs)(d.Ol,{children:[(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsx)(d.ll,{children:e.nombreFaena}),(0,t.jsx)(x.Z,{className:"h-6 w-6 text-muted-foreground"})]}),(0,t.jsx)(d.SZ,{children:e.direccion})]}),(0,t.jsxs)(d.aY,{className:"flex-grow",children:[(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:"Avance global"}),(0,t.jsxs)("div",{className:"text-4xl font-bold",children:[(null!==(a=e.avanceAcumulado)&&void 0!==a?a:0).toFixed(1),"%"]})]}),(0,t.jsx)(d.eW,{children:(0,t.jsx)(o.z,{asChild:!0,className:"w-full",children:(0,t.jsxs)(h.default,{href:"/cliente/obras/".concat(e.id),children:["Ver Detalle de Avance",(0,t.jsx)(f.Z,{className:"ml-2 h-4 w-4"})]})})})]},e.id)})})]})]}):(0,t.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,t.jsx)("p",{children:"No tienes permiso para ver esta p\xe1gina. Redirigiendo..."})})}},91120:function(e,a,s){"use strict";s.d(a,{Z:function(){return t}});let t=(0,s(96471).Z)("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]])},53459:function(e,a,s){"use strict";s.d(a,{Z:function(){return t}});let t=(0,s(96471).Z)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},3683:function(e,a,s){"use strict";s.d(a,{Z:function(){return t}});let t=(0,s(96471).Z)("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]])}},function(e){e.O(0,[4358,9990,6137,1211,2972,3288,2971,2117,1744],function(){return e(e.s=88295)}),_N_E=e.O()}]);