(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7755],{34294:function(e,a,t){Promise.resolve().then(t.bind(t,99959))},99959:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return C}});var s=t(57437),r=t(2265),i=t(99376),n=t(71245),l=t(88215),d=t(23340),c=t(12381),o=t(79820),u=t(40279),x=t(75060),m=t(15291),p=t(23675),f=t(94589),h=t(69174),j=t(53459),g=t(5485),v=t(54585),y=t(87928),N=t(35465),b=t(30767),w=t(93448);let I={baja:"bg-blue-100 text-blue-800 border-blue-200",media:"bg-yellow-100 text-yellow-800 border-yellow-200",alta:"bg-orange-100 text-orange-800 border-orange-200",critica:"bg-red-100 text-red-800 border-red-200"},R={borrador:"bg-gray-100 text-gray-800",enviada:"bg-blue-100 text-blue-800",respondida:"bg-purple-100 text-purple-800",cerrada:"bg-green-100 text-green-800",anulada:"bg-red-100 text-red-800 line-through"};function C(){var e,a;let t=(0,i.useParams)(),C=(0,i.useRouter)(),{user:z}=(0,n.a)(),{toast:A}=(0,d.pm)(),D=t.obraId,_=t.rdiId,[k,E]=(0,r.useState)(null),[Q,P]=(0,r.useState)(!0),[Z,V]=(0,r.useState)(!1),[S,T]=(0,r.useState)(null);(0,r.useEffect)(()=>{D&&_&&(async()=>{P(!0);try{let e=await (0,l.Vp)(D,_);e?E(e):T("RDI no encontrada.")}catch(e){console.error("Error fetching RDI:",e),T("No se pudo cargar la RDI.")}finally{P(!1)}})()},[D,_]);let B=async()=>{if(k){V(!0);try{let{id:e,createdAt:a,obraId:t,companyId:s,...r}=k;await (0,l.w6)(D,_,r),A({title:"\xc9xito",description:"RDI actualizada correctamente."})}catch(e){console.error("Error updating RDI:",e),A({variant:"destructive",title:"Error",description:"No se pudo actualizar la RDI."})}finally{V(!1)}}},O=async()=>{if(k)try{await (0,l.w6)(D,_,{deleted:!0,estado:"anulada"}),A({title:"RDI Anulada",description:"El requerimiento ha sido anulado y no se mostrar\xe1 en los listados."}),C.back()}catch(e){console.error("Error deleting RDI:",e),A({variant:"destructive",title:"Error",description:"No se pudo anular la RDI."})}},U=(e,a)=>{E(t=>t?{...t,[e]:a}:null)},Y=(e,a)=>{E(t=>t?{...t,destinatario:{...t.destinatario,[e]:a}}:null)};return Q?(0,s.jsxs)("div",{className:"p-8 text-center",children:[(0,s.jsx)(j.Z,{className:"animate-spin"})," Cargando RDI..."]}):S?(0,s.jsx)("div",{className:"p-8 text-center text-destructive",children:S}):k?(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("header",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)(c.z,{variant:"outline",size:"icon",onClick:()=>C.back(),children:(0,s.jsx)(g.Z,{className:"h-4 w-4"})}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("h1",{className:"text-2xl font-bold",children:["Detalle de RDI: ",k.correlativo]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,s.jsx)(h.C,{variant:"outline",className:(0,w.cn)(R[k.estado]),children:k.estado}),(0,s.jsx)(h.C,{variant:"outline",className:(0,w.cn)(I[k.prioridad]),children:k.prioridad})]})]})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsxs)(c.z,{variant:"outline",size:"sm",onClick:()=>{D&&k&&(k.tieneAdicional&&k.adicionalId?C.push("/operaciones/presupuestos/".concat(k.adicionalId)):C.push("/operaciones/presupuestos/nuevo?obraId=".concat(D,"&rdiId=").concat(k.id)))},children:[(0,s.jsx)(v.Z,{className:"mr-2 h-4 w-4"}),k.tieneAdicional?"Ver Adicional Asociado":"Crear Adicional desde RDI"]}),(0,s.jsxs)(c.z,{variant:"outline",size:"sm",onClick:()=>C.push("/rdi/".concat(D,"/").concat(k.id,"/imprimir")),children:[(0,s.jsx)(y.Z,{className:"mr-2 h-4 w-4"}),"Imprimir PDF"]}),(0,s.jsxs)(b.aR,{children:[(0,s.jsx)(b.vW,{asChild:!0,children:(0,s.jsx)(c.z,{variant:"destructive",size:"sm",children:"Anular RDI"})}),(0,s.jsxs)(b._T,{children:[(0,s.jsxs)(b.fY,{children:[(0,s.jsx)(b.f$,{children:"\xbfAnular esta RDI?"}),(0,s.jsx)(b.yT,{children:"Esta acci\xf3n marcar\xe1 la RDI como anulada. No podr\xe1 ser editada y no se mostrar\xe1 en los listados principales. Esta acci\xf3n no se puede deshacer."})]}),(0,s.jsxs)(b.xo,{children:[(0,s.jsx)(b.le,{children:"Cancelar"}),(0,s.jsx)(b.OL,{onClick:O,children:"Confirmar Anulaci\xf3n"})]})]})]}),(0,s.jsxs)(c.z,{onClick:B,disabled:Z,children:[Z?(0,s.jsx)(j.Z,{className:"mr-2 h-4 w-4 animate-spin"}):(0,s.jsx)(N.Z,{className:"mr-2 h-4 w-4"}),"Guardar Cambios"]})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,s.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,s.jsxs)(o.Zb,{children:[(0,s.jsx)(o.Ol,{children:(0,s.jsx)(o.ll,{children:"Informaci\xf3n del Requerimiento"})}),(0,s.jsxs)(o.aY,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(x._,{children:"T\xedtulo"}),(0,s.jsx)(u.I,{value:k.titulo,onChange:e=>U("titulo",e.target.value)})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(x._,{children:"Descripci\xf3n"}),(0,s.jsx)(p.g,{value:k.descripcion,onChange:e=>U("descripcion",e.target.value)})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(x._,{children:"Tipo"}),(0,s.jsxs)(m.Ph,{value:k.tipo,onValueChange:e=>U("tipo",e),children:[(0,s.jsx)(m.i4,{children:(0,s.jsx)(m.ki,{})}),(0,s.jsxs)(m.Bw,{children:[(0,s.jsx)(m.Ql,{value:"a_mandante",children:"A Mandante"}),(0,s.jsx)(m.Ql,{value:"a_contratista",children:"A Contratista"}),(0,s.jsx)(m.Ql,{value:"interna",children:"Interna"})]})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(x._,{children:"Especialidad"}),(0,s.jsxs)(m.Ph,{value:k.especialidad,onValueChange:e=>U("especialidad",e),children:[(0,s.jsx)(m.i4,{children:(0,s.jsx)(m.ki,{})}),(0,s.jsxs)(m.Bw,{children:[(0,s.jsx)(m.Ql,{value:"arquitectura",children:"Arquitectura"}),(0,s.jsx)(m.Ql,{value:"estructuras",children:"Estructuras"}),(0,s.jsx)(m.Ql,{value:"electrica",children:"El\xe9ctrica"}),(0,s.jsx)(m.Ql,{value:"sanitaria",children:"Sanitaria"}),(0,s.jsx)(m.Ql,{value:"climatizacion",children:"Climatizaci\xf3n"}),(0,s.jsx)(m.Ql,{value:"otra",children:"Otra"})]})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(x._,{children:"Prioridad"}),(0,s.jsxs)(m.Ph,{value:k.prioridad,onValueChange:e=>U("prioridad",e),children:[(0,s.jsx)(m.i4,{children:(0,s.jsx)(m.ki,{})}),(0,s.jsxs)(m.Bw,{children:[(0,s.jsx)(m.Ql,{value:"baja",children:"Baja"}),(0,s.jsx)(m.Ql,{value:"media",children:"Media"}),(0,s.jsx)(m.Ql,{value:"alta",children:"Alta"}),(0,s.jsx)(m.Ql,{value:"critica",children:"Cr\xedtica"})]})]})]})]})]})]}),(0,s.jsxs)(o.Zb,{children:[(0,s.jsx)(o.Ol,{children:(0,s.jsx)(o.ll,{children:"Destinatario"})}),(0,s.jsxs)(o.aY,{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(x._,{children:"Nombre"}),(0,s.jsx)(u.I,{value:k.destinatario.nombre,onChange:e=>Y("nombre",e.target.value)})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(x._,{children:"Email"}),(0,s.jsx)(u.I,{value:k.destinatario.email,onChange:e=>Y("email",e.target.value)})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(x._,{children:"Empresa"}),(0,s.jsx)(u.I,{value:k.destinatario.empresa,onChange:e=>Y("empresa",e.target.value)})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(x._,{children:"Cargo"}),(0,s.jsx)(u.I,{value:k.destinatario.cargo,onChange:e=>Y("cargo",e.target.value)})]})]})]}),(0,s.jsxs)(o.Zb,{children:[(0,s.jsx)(o.Ol,{children:(0,s.jsx)(o.ll,{children:"Plazos e Impacto"})}),(0,s.jsxs)(o.aY,{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(x._,{children:"Plazo de respuesta (d\xedas)"}),(0,s.jsx)(u.I,{type:"number",value:null!==(e=k.plazoRespuestaDias)&&void 0!==e?e:"",onChange:e=>U("plazoRespuestaDias",Number(e.target.value))})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2 pt-6",children:[(0,s.jsx)(f.r,{id:"afecta-plazo",checked:k.afectaPlazo,onCheckedChange:e=>U("afectaPlazo",e)}),(0,s.jsx)(x._,{htmlFor:"afecta-plazo",children:"\xbfAfecta al plazo de la obra?"})]}),k.afectaPlazo&&(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(x._,{children:"D\xedas de aumento solicitados"}),(0,s.jsx)(u.I,{type:"number",value:null!==(a=k.diasAumentoSolicitados)&&void 0!==a?a:"",onChange:e=>U("diasAumentoSolicitados",Number(e.target.value))})]})]})]})]}),(0,s.jsx)("div",{className:"space-y-6",children:(0,s.jsxs)(o.Zb,{children:[(0,s.jsx)(o.Ol,{children:(0,s.jsx)(o.ll,{children:"Metadatos"})}),(0,s.jsxs)(o.aY,{className:"text-sm space-y-2",children:[(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Emisor:"})," ",k.solicitante.nombre," (",k.solicitante.email,")"]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Fecha Emisi\xf3n:"})," ",k.createdAt.toDate().toLocaleString()]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"\xdaltima Actualizaci\xf3n:"})," ",k.updatedAt.toDate().toLocaleString()]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(x._,{children:"Estado"}),(0,s.jsxs)(m.Ph,{value:k.estado,onValueChange:e=>U("estado",e),children:[(0,s.jsx)(m.i4,{children:(0,s.jsx)(m.ki,{})}),(0,s.jsxs)(m.Bw,{children:[(0,s.jsx)(m.Ql,{value:"borrador",children:"Borrador"}),(0,s.jsx)(m.Ql,{value:"enviada",children:"Enviada"}),(0,s.jsx)(m.Ql,{value:"respondida",children:"Respondida"}),(0,s.jsx)(m.Ql,{value:"cerrada",children:"Cerrada"}),(0,s.jsx)(m.Ql,{value:"anulada",children:"Anulada"})]})]})]})]})]})})]})]}):(0,s.jsx)("div",{className:"p-8 text-center",children:"RDI no encontrada."})}},30767:function(e,a,t){"use strict";t.d(a,{OL:function(){return j},_T:function(){return x},aR:function(){return d},f$:function(){return f},fY:function(){return m},le:function(){return g},vW:function(){return c},xo:function(){return p},yT:function(){return h}});var s=t(57437),r=t(2265),i=t(7880),n=t(93448),l=t(12381);let d=i.fC,c=i.xz,o=i.h_,u=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(i.aV,{className:(0,n.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...r,ref:a})});u.displayName=i.aV.displayName;let x=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsxs)(o,{children:[(0,s.jsx)(u,{}),(0,s.jsx)(i.VY,{ref:a,className:(0,n.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...r})]})});x.displayName=i.VY.displayName;let m=e=>{let{className:a,...t}=e;return(0,s.jsx)("div",{className:(0,n.cn)("flex flex-col space-y-2 text-center sm:text-left",a),...t})};m.displayName="AlertDialogHeader";let p=e=>{let{className:a,...t}=e;return(0,s.jsx)("div",{className:(0,n.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...t})};p.displayName="AlertDialogFooter";let f=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(i.Dx,{ref:a,className:(0,n.cn)("text-lg font-semibold",t),...r})});f.displayName=i.Dx.displayName;let h=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(i.dk,{ref:a,className:(0,n.cn)("text-sm text-muted-foreground",t),...r})});h.displayName=i.dk.displayName;let j=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(i.aU,{ref:a,className:(0,n.cn)((0,l.d)(),t),...r})});j.displayName=i.aU.displayName;let g=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(i.$j,{ref:a,className:(0,n.cn)((0,l.d)({variant:"outline"}),"mt-2 sm:mt-0",t),...r})});g.displayName=i.$j.displayName},69174:function(e,a,t){"use strict";t.d(a,{C:function(){return l}});var s=t(57437);t(2265);var r=t(90535),i=t(93448);let n=(0,r.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function l(e){let{className:a,variant:t,...r}=e;return(0,s.jsx)("div",{className:(0,i.cn)(n({variant:t}),a),...r})}},15291:function(e,a,t){"use strict";t.d(a,{Bw:function(){return f},Ph:function(){return o},Ql:function(){return h},i4:function(){return x},ki:function(){return u}});var s=t(57437),r=t(2265),i=t(74797),n=t(3289),l=t(47969),d=t(59559),c=t(93448);let o=i.fC;i.ZA;let u=i.B4,x=r.forwardRef((e,a)=>{let{className:t,children:r,...l}=e;return(0,s.jsxs)(i.xz,{ref:a,className:(0,c.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...l,children:[r,(0,s.jsx)(i.JO,{asChild:!0,children:(0,s.jsx)(n.Z,{className:"h-4 w-4 opacity-50"})})]})});x.displayName=i.xz.displayName;let m=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(i.u_,{ref:a,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",t),...r,children:(0,s.jsx)(l.Z,{className:"h-4 w-4"})})});m.displayName=i.u_.displayName;let p=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(i.$G,{ref:a,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",t),...r,children:(0,s.jsx)(n.Z,{className:"h-4 w-4"})})});p.displayName=i.$G.displayName;let f=r.forwardRef((e,a)=>{let{className:t,children:r,position:n="popper",...l}=e;return(0,s.jsx)(i.h_,{children:(0,s.jsxs)(i.VY,{ref:a,className:(0,c.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===n&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:n,...l,children:[(0,s.jsx)(m,{}),(0,s.jsx)(i.l_,{className:(0,c.cn)("p-1","popper"===n&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),(0,s.jsx)(p,{})]})})});f.displayName=i.VY.displayName,r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(i.__,{ref:a,className:(0,c.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",t),...r})}).displayName=i.__.displayName;let h=r.forwardRef((e,a)=>{let{className:t,children:r,...n}=e;return(0,s.jsxs)(i.ck,{ref:a,className:(0,c.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...n,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(i.wU,{children:(0,s.jsx)(d.Z,{className:"h-4 w-4"})})}),(0,s.jsx)(i.eT,{children:r})]})});h.displayName=i.ck.displayName,r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(i.Z0,{ref:a,className:(0,c.cn)("-mx-1 my-1 h-px bg-muted",t),...r})}).displayName=i.Z0.displayName},23675:function(e,a,t){"use strict";t.d(a,{g:function(){return n}});var s=t(57437),r=t(2265),i=t(93448);let n=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("textarea",{className:(0,i.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:a,...r})});n.displayName="Textarea"},88215:function(e,a,t){"use strict";t.d(a,{DZ:function(){return c},Vp:function(){return o},i:function(){return d},sd:function(){return x},w6:function(){return u}});var s=t(99764),r=t(5978),i=t(60062);function n(e){return(0,r.hJ)(s.N$,"obras",e,"rdi")}async function l(e){let a=(0,r.JU)(s.N$,"obras",e,"counters","rdi");return await (0,r.i3)(s.N$,async e=>{let t=await e.get(a),s=0;if(t.exists()){var r;s=null!==(r=t.data().ultimoNumero)&&void 0!==r?r:0}let i=s+1;return e.set(a,{ultimoNumero:i},{merge:!0}),i})}async function d(e){let a=n(e.obraId),t=await l(e.obraId),s="RDI-".concat(String(t).padStart(3,"0")),i={companyId:e.companyId,obraId:e.obraId,correlativo:s,titulo:e.titulo,descripcion:e.descripcion,tipo:e.tipo,especialidad:e.especialidad,prioridad:e.prioridad,solicitante:e.solicitante,destinatario:e.destinatario,planoId:e.planoId||null,afectaPlazo:e.afectaPlazo||!1,diasAumentoSolicitados:e.diasAumentoSolicitados||null,fechaLimiteRespuesta:e.fechaLimiteRespuesta?r.EK.fromDate(e.fechaLimiteRespuesta):null,plazoRespuestaDias:e.plazoRespuestaDias||null,paraCliente:e.paraCliente||!1,estado:"enviada",respuestaTexto:null,clienteRespondio:!1,fechaRespuestaCliente:null,adjuntos:[],tieneAdjuntos:!1,emailClienteNotificado:!1,fechaNotificacionEmail:null,diasAumentoAprobados:null,closedAt:null,deleted:!1,createdAt:(0,r.Bt)(),updatedAt:(0,r.Bt)()},d=await (0,r.ET)(a,i),c=await (0,r.QT)(d);return{id:c.id,...c.data()}}async function c(e){let a=n(e),t=(0,r.IO)(a,(0,r.Xo)("createdAt","desc")),s=await (0,r.PL)(t);return s.empty?[]:s.docs.map(e=>({id:e.id,...e.data()}))}async function o(e,a){let t=(0,r.JU)(n(e),a),s=await (0,r.QT)(t);return s.exists()?{id:s.id,...s.data()}:null}async function u(e,a,t){let s=(0,r.JU)(n(e),a);await (0,r.r7)(s,{...t,updatedAt:(0,r.Bt)()})}async function x(e){let{obraId:a,rdiId:t,file:l,subidoPorUserId:d}=e,c="rdis/".concat(a,"/").concat(t,"/").concat(Date.now(),"-").concat(l.name),o=(0,i.iH)(s.IG,c);await (0,i.KV)(o,l);let u=await (0,i.Jt)(o),x={id:crypto.randomUUID(),nombreArchivo:l.name,tipo:l.type.startsWith("image/")?"imagen":"application/pdf"===l.type?"pdf":"otro",storagePath:c,downloadUrl:u,subidoPorUserId:d,fechaSubida:r.EK.now()},m=(0,r.JU)(n(a),t);await (0,r.r7)(m,{adjuntos:(0,r.vr)(x),tieneAdjuntos:!0,updatedAt:(0,r.Bt)()});let p=await (0,r.QT)(m);return{id:p.id,...p.data()}}}},function(e){e.O(0,[4358,9990,6137,1211,9759,3562,6008,9923,2550,1,687,2981,2971,2117,1744],function(){return e(e.s=34294)}),_N_E=e.O()}]);