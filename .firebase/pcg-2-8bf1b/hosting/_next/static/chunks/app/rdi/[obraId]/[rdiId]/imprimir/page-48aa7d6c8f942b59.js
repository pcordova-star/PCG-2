(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6491],{55189:function(e,a,s){Promise.resolve().then(s.bind(s,21817))},21817:function(e,a,s){"use strict";s.r(a);var t=s(57437),n=s(29),i=s.n(n),r=s(2265),d=s(99376),o=s(88215),c=s(5978),l=s(99764),b=s(71245),u=s(53459),m=s(12381);a.default=function(){var e;let a=(0,d.useParams)(),s=(0,d.useRouter)(),{user:n}=(0,b.a)(),x=a.obraId,p=a.rdiId,[f,j]=(0,r.useState)(null),[h,N]=(0,r.useState)(null),[v,g]=(0,r.useState)(!0),[y,w]=(0,r.useState)(null);return((0,r.useEffect)(()=>{if(!x||!p||!n){v||g(!0);return}(async()=>{g(!0);try{let e=await (0,o.Vp)(x,p);if(!e)throw Error("RDI no encontrado.");j(e);let a=(0,c.JU)(l.N$,"obras",x),s=await (0,c.QT)(a);if(s.exists())N({id:s.id,...s.data()});else throw Error("Obra no encontrada.")}catch(e){w(e.message)}finally{g(!1)}})()},[x,p,n]),v)?(0,t.jsxs)("div",{className:"flex justify-center items-center h-screen bg-slate-100",children:[(0,t.jsx)(u.Z,{className:"animate-spin mr-2"}),"Cargando documento..."]}):y?(0,t.jsx)("div",{className:"text-center text-destructive p-8 bg-slate-100",children:y}):f&&h?(0,t.jsxs)("div",{className:"jsx-db045125aab20236 min-h-screen bg-slate-100 flex flex-col items-center py-6 print:bg-white print:py-0",children:[(0,t.jsx)(i(),{id:"db045125aab20236",children:"@media print{body{background-color:#fff;color:#000}.print\\\\:hidden{display:none!important}}"}),(0,t.jsxs)("div",{className:"jsx-db045125aab20236 w-full max-w-4xl flex justify-between mb-4 print:hidden px-4",children:[(0,t.jsx)(m.z,{onClick:()=>s.back(),variant:"outline",children:"Volver"}),(0,t.jsx)(m.z,{onClick:()=>window.print(),children:"Imprimir / Guardar como PDF"})]}),(0,t.jsxs)("div",{className:"jsx-db045125aab20236 w-full max-w-4xl bg-white text-black shadow-md rounded-md p-8 print:shadow-none print:rounded-none print:p-0",children:[(0,t.jsxs)("header",{className:"jsx-db045125aab20236 mb-8",children:[(0,t.jsxs)("div",{className:"jsx-db045125aab20236 flex justify-between items-start border-b pb-4",children:[(0,t.jsxs)("div",{className:"jsx-db045125aab20236",children:[(0,t.jsx)("h2",{className:"jsx-db045125aab20236 text-xl font-semibold text-gray-800",children:(null===(e=h.empresa)||void 0===e?void 0:e.nombre)||"Constructora PCG"}),(0,t.jsx)("p",{className:"jsx-db045125aab20236 text-sm text-gray-500",children:h.mandanteRazonSocial})]}),(0,t.jsx)("div",{className:"jsx-db045125aab20236 text-right text-xs",children:(0,t.jsxs)("p",{className:"jsx-db045125aab20236",children:[(0,t.jsx)("strong",{className:"jsx-db045125aab20236 font-semibold",children:"Correlativo:"})," ",f.correlativo]})})]}),(0,t.jsx)("h1",{className:"jsx-db045125aab20236 text-center text-2xl font-bold mt-6",children:"Requerimiento de Informaci\xf3n (RDI)"})]}),(0,t.jsxs)("main",{className:"jsx-db045125aab20236 space-y-6 text-sm",children:[(0,t.jsxs)("section",{className:"jsx-db045125aab20236",children:[(0,t.jsx)("h2",{className:"jsx-db045125aab20236 text-base font-semibold border-b pb-1 mb-2",children:"Datos Generales"}),(0,t.jsxs)("div",{className:"jsx-db045125aab20236 grid grid-cols-2 gap-x-6 gap-y-1",children:[(0,t.jsxs)("div",{className:"jsx-db045125aab20236",children:[(0,t.jsx)("span",{className:"jsx-db045125aab20236 font-medium",children:"Obra:"})," ",h.nombreFaena]}),(0,t.jsxs)("div",{className:"jsx-db045125aab20236",children:[(0,t.jsx)("span",{className:"jsx-db045125aab20236 font-medium",children:"Tipo:"})," ",f.tipo]}),(0,t.jsxs)("div",{className:"jsx-db045125aab20236",children:[(0,t.jsx)("span",{className:"jsx-db045125aab20236 font-medium",children:"Especialidad:"})," ",f.especialidad]}),(0,t.jsxs)("div",{className:"jsx-db045125aab20236",children:[(0,t.jsx)("span",{className:"jsx-db045125aab20236 font-medium",children:"Estado:"})," ",f.estado]}),(0,t.jsxs)("div",{className:"jsx-db045125aab20236",children:[(0,t.jsx)("span",{className:"jsx-db045125aab20236 font-medium",children:"Prioridad:"})," ",f.prioridad]}),(0,t.jsxs)("div",{className:"jsx-db045125aab20236",children:[(0,t.jsx)("span",{className:"jsx-db045125aab20236 font-medium",children:"Fecha Emisi\xf3n:"})," ",f.createdAt.toDate().toLocaleDateString("es-CL")]})]})]}),(0,t.jsxs)("section",{className:"jsx-db045125aab20236",children:[(0,t.jsx)("h2",{className:"jsx-db045125aab20236 text-base font-semibold border-b pb-1 mb-2",children:"Solicitante"}),(0,t.jsxs)("div",{className:"jsx-db045125aab20236 grid grid-cols-2 gap-x-6 gap-y-1",children:[(0,t.jsxs)("div",{className:"jsx-db045125aab20236",children:[(0,t.jsx)("span",{className:"jsx-db045125aab20236 font-medium",children:"Nombre:"})," ",f.solicitante.nombre]}),(0,t.jsxs)("div",{className:"jsx-db045125aab20236",children:[(0,t.jsx)("span",{className:"jsx-db045125aab20236 font-medium",children:"Email:"})," ",f.solicitante.email]}),(0,t.jsxs)("div",{className:"jsx-db045125aab20236 col-span-2",children:[(0,t.jsx)("span",{className:"jsx-db045125aab20236 font-medium",children:"Cargo:"})," ",f.solicitante.cargo||"No especificado"]})]})]}),(0,t.jsxs)("section",{className:"jsx-db045125aab20236",children:[(0,t.jsx)("h2",{className:"jsx-db045125aab20236 text-base font-semibold border-b pb-1 mb-2",children:"Destinatario"}),(0,t.jsxs)("div",{className:"jsx-db045125aab20236 grid grid-cols-2 gap-x-6 gap-y-1",children:[(0,t.jsxs)("div",{className:"jsx-db045125aab20236",children:[(0,t.jsx)("span",{className:"jsx-db045125aab20236 font-medium",children:"Nombre:"})," ",f.destinatario.nombre]}),(0,t.jsxs)("div",{className:"jsx-db045125aab20236",children:[(0,t.jsx)("span",{className:"jsx-db045125aab20236 font-medium",children:"Email:"})," ",f.destinatario.email]}),(0,t.jsxs)("div",{className:"jsx-db045125aab20236",children:[(0,t.jsx)("span",{className:"jsx-db045125aab20236 font-medium",children:"Empresa:"})," ",f.destinatario.empresa||"No especificada"]}),(0,t.jsxs)("div",{className:"jsx-db045125aab20236",children:[(0,t.jsx)("span",{className:"jsx-db045125aab20236 font-medium",children:"Cargo:"})," ",f.destinatario.cargo||"No especificado"]})]})]}),(0,t.jsxs)("section",{className:"jsx-db045125aab20236",children:[(0,t.jsx)("h2",{className:"jsx-db045125aab20236 text-base font-semibold border-b pb-1 mb-2",children:"Requerimiento"}),(0,t.jsxs)("div",{className:"jsx-db045125aab20236 space-y-2",children:[(0,t.jsxs)("p",{className:"jsx-db045125aab20236",children:[(0,t.jsx)("span",{className:"jsx-db045125aab20236 font-medium",children:"T\xedtulo:"})," ",f.titulo]}),(0,t.jsxs)("div",{className:"jsx-db045125aab20236",children:[(0,t.jsx)("p",{className:"jsx-db045125aab20236 font-medium",children:"Descripci\xf3n:"}),(0,t.jsx)("p",{className:"jsx-db045125aab20236 text-gray-700 whitespace-pre-line mt-1",children:f.descripcion})]})]})]}),(0,t.jsxs)("section",{className:"jsx-db045125aab20236",children:[(0,t.jsx)("h2",{className:"jsx-db045125aab20236 text-base font-semibold border-b pb-1 mb-2",children:"Plazos e Impacto en Programa"}),(0,t.jsxs)("div",{className:"jsx-db045125aab20236 grid grid-cols-2 gap-x-6 gap-y-1",children:[(0,t.jsxs)("div",{className:"jsx-db045125aab20236",children:[(0,t.jsx)("span",{className:"jsx-db045125aab20236 font-medium",children:"Plazo de respuesta (d\xedas):"})," ",f.plazoRespuestaDias||"No especificado"]}),(0,t.jsxs)("div",{className:"jsx-db045125aab20236",children:[(0,t.jsx)("span",{className:"jsx-db045125aab20236 font-medium",children:"\xbfAfecta plazo de obra?:"})," ",f.afectaPlazo?"S\xed":"No"]}),f.afectaPlazo&&(0,t.jsxs)("div",{className:"jsx-db045125aab20236",children:[(0,t.jsx)("span",{className:"jsx-db045125aab20236 font-medium",children:"D\xedas de aumento solicitados:"})," ",f.diasAumentoSolicitados||"No especificado"]}),f.afectaPlazo&&(0,t.jsxs)("div",{className:"jsx-db045125aab20236",children:[(0,t.jsx)("span",{className:"jsx-db045125aab20236 font-medium",children:"D\xedas de aumento aprobados:"})," ",f.diasAumentoAprobados||"No especificado"]})]})]}),f.respuestaTexto&&(0,t.jsxs)("section",{className:"jsx-db045125aab20236",children:[(0,t.jsx)("h2",{className:"jsx-db045125aab20236 text-base font-semibold border-b pb-1 mb-2",children:"Respuesta del Cliente"}),(0,t.jsx)("p",{className:"jsx-db045125aab20236 text-gray-700 whitespace-pre-line",children:f.respuestaTexto})]})]}),(0,t.jsx)("footer",{className:"jsx-db045125aab20236 mt-16 text-sm",children:(0,t.jsxs)("div",{className:"jsx-db045125aab20236 grid grid-cols-2 gap-8",children:[(0,t.jsx)("div",{className:"jsx-db045125aab20236 text-center",children:(0,t.jsx)("div",{className:"jsx-db045125aab20236 border-t border-black mt-8 pt-1",children:"Firma representante Empresa"})}),(0,t.jsx)("div",{className:"jsx-db045125aab20236 text-center",children:(0,t.jsx)("div",{className:"jsx-db045125aab20236 border-t border-black mt-8 pt-1",children:"Firma representante Cliente"})})]})})]})]}):(0,t.jsx)("div",{className:"text-center text-muted-foreground p-8 bg-slate-100",children:"No se encontraron los datos para generar el documento."})}},12381:function(e,a,s){"use strict";s.d(a,{d:function(){return o},z:function(){return c}});var t=s(57437),n=s(2265),i=s(37053),r=s(90535),d=s(93448);let o=(0,r.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=n.forwardRef((e,a)=>{let{className:s,variant:n,size:r,asChild:c=!1,...l}=e,b=c?i.g7:"button";return(0,t.jsx)(b,{className:(0,d.cn)(o({variant:n,size:r,className:s})),ref:a,...l})});c.displayName="Button"},71245:function(e,a,s){"use strict";s.d(a,{H:function(){return u},a:function(){return m}});var t=s(57437),n=s(43301),i=s(2265),r=s(99764),d=s(99376),o=s(5978);async function c(e){var a;let s=r.N$,t=null===(a=e.email)||void 0===a?void 0:a.toLowerCase().trim();if(!t)return{role:"none",companyId:null};let n=(0,o.IO)((0,o.hJ)(s,"invitacionesUsuarios"),(0,o.ar)("email","==",t),(0,o.ar)("estado","==","pendiente_auth"),(0,o.b9)(1)),i=await (0,o.PL)(n);if(i.empty)return console.log("No hay invitaci\xf3n pendiente para ".concat(t,".")),{role:"none",companyId:null};let d=i.docs[0],c=d.data(),l=(0,o.JU)(s,"users",e.uid),b=(0,o.qs)(s);return b.set(l,{nombre:c.nombre||e.displayName,email:t,role:c.roleDeseado,empresaId:c.empresaId,activo:!0,createdAt:(0,o.Bt)(),updatedAt:(0,o.Bt)()},{merge:!0}),b.update(d.ref,{estado:"activado",uid:e.uid,activatedAt:(0,o.Bt)()}),await b.commit(),console.log("Usuario ".concat(t," activado con rol ").concat(c.roleDeseado," en empresa ").concat(c.empresaId,".")),{role:c.roleDeseado,companyId:c.empresaId}}async function l(e){}let b=(0,i.createContext)(void 0);function u(e){let{children:a}=e,[s,u]=(0,i.useState)(null),[m,x]=(0,i.useState)("none"),[p,f]=(0,i.useState)(null),[j,h]=(0,i.useState)(null),[N,v]=(0,i.useState)(!0),g=(0,d.useRouter)(),y=(0,d.usePathname)();async function w(e,a){try{await (0,n.e5)(r.lX,e,a)}catch(e){if("auth/invalid-credential"===e.code||"auth/wrong-password"===e.code||"auth/user-not-found"===e.code)throw Error("Credenciales inv\xe1lidas. Por favor, revisa tu correo y contrase\xf1a.");if("auth/too-many-requests"===e.code)throw Error("Demasiados intentos fallidos. Por seguridad, el acceso desde este dispositivo ha sido bloqueado temporalmente.");throw console.error("Error de login no manejado:",e),Error("Ocurri\xf3 un error inesperado al iniciar sesi\xf3n.")}}async function I(){try{await (0,n.w7)(r.lX),u(null),x("none"),f(null),h(null),g.push("/")}catch(e){console.error("Error al cerrar sesi\xf3n",e)}}return(0,i.useEffect)(()=>{let e=(0,n.Aj)(r.lX,async e=>{if(e){await l(e);let a=(0,o.JU)(r.N$,"users",e.uid),s=await (0,o.QT)(a),t="none",n=null,i=!1;if(s.exists()){let e=s.data();e.role&&void 0!==e.empresaId&&(t=e.role,n=e.empresaId,i=!0===e.mustChangePassword)}if("none"===t){let a=await c(e);t=a.role,n=a.companyId,i=!0}x(t),f(n),u(e);let d="/cambiar-password"===y;if(i&&!d)g.replace("/cambiar-password");else if(!i){if("none"===t)g.replace("/sin-acceso");else if(y.startsWith("/login")||"/"===y||d){let e="cliente"===t?"/cliente":"contratista"===t?"/cumplimiento/contratista":"/dashboard";g.replace(e)}}}else u(null),x("none"),f(null),h(null);v(!1)});return()=>e()},[g,y]),(0,i.useEffect)(()=>{if(p){let e=(0,o.JU)(r.N$,"companies",p),a=(0,n.Aj)(r.lX,a=>{a&&(0,o.QT)(e).then(e=>{e.exists()?h({id:e.id,...e.data()}):h(null)})});return()=>a()}h(null)},[p]),(0,t.jsx)(b.Provider,{value:{user:s,role:m,companyId:p,company:j,loading:N,login:w,logout:I},children:a})}function m(){let e=(0,i.useContext)(b);if(!e)throw Error("useAuth debe usarse dentro de un AuthProvider");return e}},99764:function(e,a,s){"use strict";let t,n,i,r,d;s.d(a,{IG:function(){return r},N$:function(){return i},lX:function(){return n},x2:function(){return d}});var o=s(738),c=s(43301),l=s(5978),b=s(60062),u=s(13491);let m={apiKey:"AIzaSyBfMp_dH9XhFSXEeMxY-Cdy8MDRIgWrxR0",authDomain:"pcg-2-8bf1b.firebaseapp.com",projectId:"pcg-2-8bf1b",storageBucket:"pcg-2-8bf1b.appspot.com",messagingSenderId:"1073834543546",appId:"1:1073834543546:web:2f85a4a8350280f8589737"};for(let e in m)if(Object.prototype.hasOwnProperty.call(m,e)&&!m[e]){let a=e.replace(/([A-Z])/g,"_$1").toUpperCase(),s="NEXT_PUBLIC_FIREBASE_".concat(a);throw Error("Error de configuraci\xf3n del cliente: La variable de entorno Firebase '".concat(s,"' no est\xe1 definida o est\xe1 vac\xeda. ")+"Aseg\xfarate de que est\xe9 configurada en tu archivo .env.local o en las variables de entorno de producci\xf3n.")}t=(0,o.C6)().length?(0,o.Mq)():(0,o.ZF)(m),n=(0,c.v0)(t),i=(0,l.ad)(t),r=(0,b.cF)(t),d=(0,u.$C)(t,"us-central1")},88215:function(e,a,s){"use strict";s.d(a,{DZ:function(){return c},Vp:function(){return l},i:function(){return o},sd:function(){return u},w6:function(){return b}});var t=s(99764),n=s(5978),i=s(60062);function r(e){return(0,n.hJ)(t.N$,"obras",e,"rdi")}async function d(e){let a=(0,n.JU)(t.N$,"obras",e,"counters","rdi");return await (0,n.i3)(t.N$,async e=>{let s=await e.get(a),t=0;if(s.exists()){var n;t=null!==(n=s.data().ultimoNumero)&&void 0!==n?n:0}let i=t+1;return e.set(a,{ultimoNumero:i},{merge:!0}),i})}async function o(e){let a=r(e.obraId),s=await d(e.obraId),t="RDI-".concat(String(s).padStart(3,"0")),i={companyId:e.companyId,obraId:e.obraId,correlativo:t,titulo:e.titulo,descripcion:e.descripcion,tipo:e.tipo,especialidad:e.especialidad,prioridad:e.prioridad,solicitante:e.solicitante,destinatario:e.destinatario,planoId:e.planoId||null,afectaPlazo:e.afectaPlazo||!1,diasAumentoSolicitados:e.diasAumentoSolicitados||null,fechaLimiteRespuesta:e.fechaLimiteRespuesta?n.EK.fromDate(e.fechaLimiteRespuesta):null,plazoRespuestaDias:e.plazoRespuestaDias||null,paraCliente:e.paraCliente||!1,estado:"enviada",respuestaTexto:null,clienteRespondio:!1,fechaRespuestaCliente:null,adjuntos:[],tieneAdjuntos:!1,emailClienteNotificado:!1,fechaNotificacionEmail:null,diasAumentoAprobados:null,closedAt:null,deleted:!1,createdAt:(0,n.Bt)(),updatedAt:(0,n.Bt)()},o=await (0,n.ET)(a,i),c=await (0,n.QT)(o);return{id:c.id,...c.data()}}async function c(e){let a=r(e),s=(0,n.IO)(a,(0,n.Xo)("createdAt","desc")),t=await (0,n.PL)(s);return t.empty?[]:t.docs.map(e=>({id:e.id,...e.data()}))}async function l(e,a){let s=(0,n.JU)(r(e),a),t=await (0,n.QT)(s);return t.exists()?{id:t.id,...t.data()}:null}async function b(e,a,s){let t=(0,n.JU)(r(e),a);await (0,n.r7)(t,{...s,updatedAt:(0,n.Bt)()})}async function u(e){let{obraId:a,rdiId:s,file:d,subidoPorUserId:o}=e,c="rdis/".concat(a,"/").concat(s,"/").concat(Date.now(),"-").concat(d.name),l=(0,i.iH)(t.IG,c);await (0,i.KV)(l,d);let b=await (0,i.Jt)(l),u={id:crypto.randomUUID(),nombreArchivo:d.name,tipo:d.type.startsWith("image/")?"imagen":"application/pdf"===d.type?"pdf":"otro",storagePath:c,downloadUrl:b,subidoPorUserId:o,fechaSubida:n.EK.now()},m=(0,n.JU)(r(a),s);await (0,n.r7)(m,{adjuntos:(0,n.vr)(u),tieneAdjuntos:!0,updatedAt:(0,n.Bt)()});let x=await (0,n.QT)(m);return{id:x.id,...x.data()}}},93448:function(e,a,s){"use strict";s.d(a,{cn:function(){return i}});var t=s(61994),n=s(53335);function i(){for(var e=arguments.length,a=Array(e),s=0;s<e;s++)a[s]=arguments[s];return(0,n.m6)((0,t.W)(a))}}},function(e){e.O(0,[4358,9990,6137,1211,646,2971,2117,1744],function(){return e(e.s=55189)}),_N_E=e.O()}]);