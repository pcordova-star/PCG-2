(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6888,2087],{71449:function(e,a,t){Promise.resolve().then(t.bind(t,63987))},27648:function(e,a,t){"use strict";t.d(a,{default:function(){return n.a}});var r=t(72972),n=t.n(r)},63987:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return C}});var r=t(57437),n=t(2265),s=t(99376),i=t(71245),o=t(5978),l=t(99764),d=t(12381),c=t(79820),u=t(74291),f=t(30767),m=t(40279),p=t(75060),x=t(33804),h=t(5485),b=t(54233),v=t(54585),g=t(59022),y=t(15847),j=t(43728),N=t(27648),w=t(23340);async function R(e,a){let t=(0,o.hJ)(e,a),r=(0,o.IO)(t),n=await (0,o.PL)(r);if(n.empty)return;let s=(0,o.qs)(e);n.docs.forEach(e=>{s.delete(e.ref)}),await s.commit()}function C(){let{user:e,role:a,companyId:t,loading:C}=(0,i.a)(),S=(0,s.useRouter)(),{toast:E}=(0,w.pm)(),[I,D]=(0,n.useState)([]),[k,A]=(0,n.useState)(!0),[O,_]=(0,n.useState)(null),[z,T]=(0,n.useState)(!1),[F,M]=(0,n.useState)(null),[Z,P]=(0,n.useState)(!1),V="superadmin"===a||"admin_empresa"===a||"prevencionista"===a;(0,n.useEffect)(()=>{if(!C&&!e){S.replace("/login/usuario");return}if(!C&&e&&"cliente"===a){S.replace("/cliente");return}},[C,e,a,S]),(0,n.useEffect)(()=>{if(!C&&e){if("superadmin"!==a&&!t){A(!1);return}r()}async function r(){try{let e;A(!0),_(null);let r=(0,o.hJ)(l.N$,"obras");e="superadmin"===a?(0,o.IO)(r,(0,o.Xo)("creadoEn","desc")):(0,o.IO)(r,(0,o.ar)("empresaId","==",t),(0,o.Xo)("creadoEn","desc"));let n=(await (0,o.PL)(e)).docs.map(e=>({id:e.id,...e.data()}));D(n)}catch(e){console.error(e),_("No se pudieron cargar las obras desde el servidor."),E({variant:"destructive",title:"Error al cargar obras",description:"Verifica los permisos de lectura en Firestore."})}finally{A(!1)}}},[e,C,a,t,E]);let $=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!t&&"superadmin"!==a){E({variant:"destructive",title:"Error",description:"No se puede crear una obra sin una empresa asignada."});return}M(e||{nombreFaena:"",direccion:"",clienteEmail:"",mandanteRazonSocial:"",mandanteRut:"",jefeObraNombre:"",prevencionistaNombre:"",mutualidad:"",empresaId:t||""}),T(!0),_(null)},q=e=>{F&&M({...F,[e.target.name]:e.target.value})},L=async e=>{if(e.preventDefault(),_(null),!F||!F.nombreFaena||!F.direccion||!F.clienteEmail){_("Todos los campos con * son obligatorios.");return}if(!F.empresaId){_("La obra debe estar asociada a una empresa.");return}P(!0);let a={nombreFaena:F.nombreFaena,direccion:F.direccion,clienteEmail:F.clienteEmail,mandanteRazonSocial:F.mandanteRazonSocial||"",mandanteRut:F.mandanteRut||"",jefeObraNombre:F.jefeObraNombre||"",prevencionistaNombre:F.prevencionistaNombre||"",mutualidad:F.mutualidad||"",empresaId:F.empresaId};try{if(F.id){let e=(0,o.JU)(l.N$,"obras",F.id);await (0,o.r7)(e,a),D(I.map(e=>e.id===F.id?{...e,...F,...a}:e)),E({title:"Obra actualizada",description:'La obra "'.concat(a.nombreFaena,'" ha sido actualizada.')})}else{let e=(0,o.hJ)(l.N$,"obras"),t={id:(await (0,o.ET)(e,{...a,creadoEn:(0,o.Bt)()})).id,...a,creadoEn:new Date};D([t,...I]),E({title:"Obra creada",description:'La obra "'.concat(a.nombreFaena,'" ha sido creada.')})}T(!1),M(null)}catch(e){console.error(e),_("No se pudo guardar la obra. Intenta nuevamente."),E({variant:"destructive",title:"Error al guardar",description:"No se pudo guardar la obra. Revisa los permisos."})}finally{P(!1)}},U=async e=>{try{await Promise.all(["actividades","avancesDiarios","estadosDePago","empresasSubcontratistasDs44","ds44MandanteObra"].map(a=>R(l.N$,"obras/".concat(e,"/").concat(a))));let a=(0,o.JU)(l.N$,"obras",e);await (0,o.oe)(a),D(I.filter(a=>a.id!==e)),E({title:"Obra eliminada",description:"La obra y todos sus datos asociados han sido eliminados."})}catch(e){console.error(e),_("No se pudo eliminar la obra y sus datos asociados. Intenta nuevamente."),E({variant:"destructive",title:"Error al eliminar",description:"No se pudo eliminar la obra. Revisa los permisos."})}};return C?(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Cargando sesi\xf3n..."}):e&&("superadmin"===a||t)?(0,r.jsxs)("section",{className:"space-y-6",children:[(0,r.jsx)(d.z,{asChild:!0,variant:"outline",size:"sm",children:(0,r.jsxs)(N.default,{href:"/dashboard",children:[(0,r.jsx)(h.Z,{className:"mr-2 h-4 w-4"}),"Volver al Dashboard"]})}),(0,r.jsxs)("header",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("h2",{className:"text-2xl font-semibold",children:"Gesti\xf3n de Obras"}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Crea, edita y gestiona las obras."})]}),V&&(0,r.jsxs)(d.z,{onClick:()=>$(),children:[(0,r.jsx)(b.Z,{className:"mr-2 h-4 w-4"}),"Crear Nueva Obra"]})]}),O&&(0,r.jsx)("p",{className:"text-sm font-medium text-destructive",children:O}),(0,r.jsxs)(c.Zb,{children:[(0,r.jsxs)(c.Ol,{children:[(0,r.jsx)(c.ll,{children:"Obras Registradas"}),(0,r.jsx)(c.SZ,{children:k?"Cargando obras...":"Mostrando ".concat(I.length," obras.")})]}),(0,r.jsx)(c.aY,{children:(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)(x.iA,{children:[(0,r.jsx)(x.xD,{children:(0,r.jsxs)(x.SC,{children:[(0,r.jsx)(x.ss,{children:"Nombre Faena"}),(0,r.jsx)(x.ss,{children:"Administrador de obra"}),(0,r.jsx)(x.ss,{children:"Prevencionista"}),(0,r.jsx)(x.ss,{className:"text-right",children:"Acciones"})]})}),(0,r.jsx)(x.RM,{children:k?(0,r.jsx)(x.SC,{children:(0,r.jsx)(x.pj,{colSpan:4,className:"text-center text-muted-foreground",children:"Cargando..."})}):0===I.length?(0,r.jsx)(x.SC,{children:(0,r.jsx)(x.pj,{colSpan:4,className:"text-center text-muted-foreground h-24",children:"No hay obras registradas a\xfan."})}):I.map(e=>(0,r.jsxs)(x.SC,{children:[(0,r.jsx)(x.pj,{className:"font-medium",children:e.nombreFaena}),(0,r.jsx)(x.pj,{children:e.jefeObraNombre}),(0,r.jsx)(x.pj,{children:e.prevencionistaNombre}),(0,r.jsx)(x.pj,{className:"text-right",children:(0,r.jsxs)("div",{className:"flex justify-end gap-2",children:["prevencionista"!==a&&(0,r.jsx)(d.z,{variant:"secondary",size:"sm",asChild:!0,children:(0,r.jsxs)(N.default,{href:"/operaciones/presupuestos?obraId=".concat(e.id),children:[(0,r.jsx)(v.Z,{className:"mr-2 h-3 w-3"}),"Crear Itemizado"]})}),(0,r.jsx)(d.z,{variant:"outline",size:"sm",asChild:!0,children:(0,r.jsxs)(N.default,{href:"/cliente/obras/".concat(e.id,"?preview=true"),target:"_blank",children:[(0,r.jsx)(g.Z,{className:"mr-2 h-3 w-3"}),"Ver Panel Cliente"]})}),V&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(d.z,{variant:"ghost",size:"icon",onClick:()=>$(e),children:[(0,r.jsx)(y.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Editar"})]}),(0,r.jsxs)(f.aR,{children:[(0,r.jsx)(f.vW,{asChild:!0,children:(0,r.jsxs)(d.z,{variant:"ghost",size:"icon",className:"text-destructive hover:text-destructive",children:[(0,r.jsx)(j.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Eliminar"})]})}),(0,r.jsxs)(f._T,{children:[(0,r.jsxs)(f.fY,{children:[(0,r.jsx)(f.f$,{children:"\xbfEst\xe1s seguro de que deseas eliminar esta obra?"}),(0,r.jsxs)(f.yT,{children:['Esta acci\xf3n no se puede deshacer. Se eliminar\xe1 permanentemente la obra "',e.nombreFaena,'" y todos sus datos asociados (actividades, avances, etc.).']})]}),(0,r.jsxs)(f.xo,{children:[(0,r.jsx)(f.le,{children:"Cancelar"}),(0,r.jsx)(f.OL,{onClick:()=>U(e.id),className:"bg-destructive hover:bg-destructive/90",children:"Eliminar"})]})]})]})]})]})})]},e.id))})]})})})]}),(0,r.jsx)(u.Vq,{open:z,onOpenChange:T,children:(0,r.jsx)(u.cZ,{className:"sm:max-w-2xl",children:(0,r.jsxs)("form",{onSubmit:L,children:[(0,r.jsxs)(u.fK,{children:[(0,r.jsx)(u.$N,{children:(null==F?void 0:F.id)?"Editar Obra":"Crear Nueva Obra"}),(0,r.jsx)(u.Be,{children:(null==F?void 0:F.id)?"Modifica los detalles de la obra y haz clic en Guardar.":"Completa los detalles para registrar una nueva obra."})]}),(0,r.jsxs)("div",{className:"grid gap-4 py-4 md:grid-cols-2",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(p._,{htmlFor:"nombreFaena",children:"Nombre Faena*"}),(0,r.jsx)(m.I,{id:"nombreFaena",name:"nombreFaena",value:(null==F?void 0:F.nombreFaena)||"",onChange:q,required:!0})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(p._,{htmlFor:"direccion",children:"Direcci\xf3n*"}),(0,r.jsx)(m.I,{id:"direccion",name:"direccion",value:(null==F?void 0:F.direccion)||"",onChange:q,required:!0})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(p._,{htmlFor:"clienteEmail",children:"Email Cliente*"}),(0,r.jsx)(m.I,{id:"clienteEmail",name:"clienteEmail",type:"email",value:(null==F?void 0:F.clienteEmail)||"",onChange:q,required:!0})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(p._,{htmlFor:"jefeObraNombre",children:"Administrador de obra"}),(0,r.jsx)(m.I,{id:"jefeObraNombre",name:"jefeObraNombre",value:(null==F?void 0:F.jefeObraNombre)||"",onChange:q})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(p._,{htmlFor:"prevencionistaNombre",children:"Nombre Prevencionista"}),(0,r.jsx)(m.I,{id:"prevencionistaNombre",name:"prevencionistaNombre",value:(null==F?void 0:F.prevencionistaNombre)||"",onChange:q})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(p._,{htmlFor:"mandanteRazonSocial",children:"Raz\xf3n Social Mandante"}),(0,r.jsx)(m.I,{id:"mandanteRazonSocial",name:"mandanteRazonSocial",value:(null==F?void 0:F.mandanteRazonSocial)||"",onChange:q})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(p._,{htmlFor:"mandanteRut",children:"RUT Mandante"}),(0,r.jsx)(m.I,{id:"mandanteRut",name:"mandanteRut",value:(null==F?void 0:F.mandanteRut)||"",onChange:q})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(p._,{htmlFor:"mutualidad",children:"Mutualidad"}),(0,r.jsx)(m.I,{id:"mutualidad",name:"mutualidad",value:(null==F?void 0:F.mutualidad)||"",onChange:q})]}),O&&(0,r.jsx)("p",{className:"col-span-full text-sm font-medium text-destructive",children:O})]}),(0,r.jsxs)(u.cN,{children:[(0,r.jsx)(d.z,{type:"button",variant:"ghost",onClick:()=>T(!1),children:"Cancelar"}),(0,r.jsx)(d.z,{type:"submit",disabled:Z,children:Z?"Guardando...":"Guardar Obra"})]})]})})})]}):(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"No tienes permisos para ver este m\xf3dulo o tu empresa no est\xe1 configurada."})}},30767:function(e,a,t){"use strict";t.d(a,{OL:function(){return b},_T:function(){return f},aR:function(){return l},f$:function(){return x},fY:function(){return m},le:function(){return v},vW:function(){return d},xo:function(){return p},yT:function(){return h}});var r=t(57437),n=t(2265),s=t(7880),i=t(93448),o=t(12381);let l=s.fC,d=s.xz,c=s.h_,u=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)(s.aV,{className:(0,i.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...n,ref:a})});u.displayName=s.aV.displayName;let f=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsxs)(c,{children:[(0,r.jsx)(u,{}),(0,r.jsx)(s.VY,{ref:a,className:(0,i.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...n})]})});f.displayName=s.VY.displayName;let m=e=>{let{className:a,...t}=e;return(0,r.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-2 text-center sm:text-left",a),...t})};m.displayName="AlertDialogHeader";let p=e=>{let{className:a,...t}=e;return(0,r.jsx)("div",{className:(0,i.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...t})};p.displayName="AlertDialogFooter";let x=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)(s.Dx,{ref:a,className:(0,i.cn)("text-lg font-semibold",t),...n})});x.displayName=s.Dx.displayName;let h=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)(s.dk,{ref:a,className:(0,i.cn)("text-sm text-muted-foreground",t),...n})});h.displayName=s.dk.displayName;let b=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)(s.aU,{ref:a,className:(0,i.cn)((0,o.d)(),t),...n})});b.displayName=s.aU.displayName;let v=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)(s.$j,{ref:a,className:(0,i.cn)((0,o.d)({variant:"outline"}),"mt-2 sm:mt-0",t),...n})});v.displayName=s.$j.displayName},12381:function(e,a,t){"use strict";t.d(a,{d:function(){return l},z:function(){return d}});var r=t(57437),n=t(2265),s=t(37053),i=t(90535),o=t(93448);let l=(0,i.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=n.forwardRef((e,a)=>{let{className:t,variant:n,size:i,asChild:d=!1,...c}=e,u=d?s.g7:"button";return(0,r.jsx)(u,{className:(0,o.cn)(l({variant:n,size:i,className:t})),ref:a,...c})});d.displayName="Button"},79820:function(e,a,t){"use strict";t.d(a,{Ol:function(){return o},SZ:function(){return d},Zb:function(){return i},aY:function(){return c},eW:function(){return u},ll:function(){return l}});var r=t(57437),n=t(2265),s=t(93448);let i=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)("div",{ref:a,className:(0,s.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",t),...n})});i.displayName="Card";let o=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)("div",{ref:a,className:(0,s.cn)("flex flex-col space-y-1.5 p-6",t),...n})});o.displayName="CardHeader";let l=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)("div",{ref:a,className:(0,s.cn)("text-2xl font-semibold leading-none tracking-tight",t),...n})});l.displayName="CardTitle";let d=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)("div",{ref:a,className:(0,s.cn)("text-sm text-muted-foreground",t),...n})});d.displayName="CardDescription";let c=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)("div",{ref:a,className:(0,s.cn)("p-6 pt-0",t),...n})});c.displayName="CardContent";let u=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)("div",{ref:a,className:(0,s.cn)("flex items-center p-6 pt-0",t),...n})});u.displayName="CardFooter"},74291:function(e,a,t){"use strict";t.d(a,{$N:function(){return x},Be:function(){return h},Vq:function(){return l},cN:function(){return p},cZ:function(){return f},fK:function(){return m},hg:function(){return d}});var r=t(57437),n=t(2265),s=t(70001),i=t(44986),o=t(93448);let l=s.fC,d=s.xz,c=s.h_;s.x8;let u=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)(s.aV,{ref:a,className:(0,o.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...n})});u.displayName=s.aV.displayName;let f=n.forwardRef((e,a)=>{let{className:t,children:n,...l}=e;return(0,r.jsxs)(c,{children:[(0,r.jsx)(u,{}),(0,r.jsxs)(s.VY,{ref:a,className:(0,o.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...l,children:[n,(0,r.jsxs)(s.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,r.jsx)(i.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});f.displayName=s.VY.displayName;let m=e=>{let{className:a,...t}=e;return(0,r.jsx)("div",{className:(0,o.cn)("flex flex-col space-y-1.5 text-center sm:text-left",a),...t})};m.displayName="DialogHeader";let p=e=>{let{className:a,...t}=e;return(0,r.jsx)("div",{className:(0,o.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...t})};p.displayName="DialogFooter";let x=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)(s.Dx,{ref:a,className:(0,o.cn)("text-lg font-semibold leading-none tracking-tight",t),...n})});x.displayName=s.Dx.displayName;let h=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)(s.dk,{ref:a,className:(0,o.cn)("text-sm text-muted-foreground",t),...n})});h.displayName=s.dk.displayName},40279:function(e,a,t){"use strict";t.d(a,{I:function(){return i}});var r=t(57437),n=t(2265),s=t(93448);let i=n.forwardRef((e,a)=>{let{className:t,type:n,...i}=e;return(0,r.jsx)("input",{type:n,className:(0,s.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:a,...i})});i.displayName="Input"},75060:function(e,a,t){"use strict";t.d(a,{_:function(){return d}});var r=t(57437),n=t(2265),s=t(370),i=t(90535),o=t(93448);let l=(0,i.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)(s.f,{ref:a,className:(0,o.cn)(l(),t),...n})});d.displayName=s.f.displayName},33804:function(e,a,t){"use strict";t.d(a,{RM:function(){return l},SC:function(){return d},iA:function(){return i},pj:function(){return u},ss:function(){return c},xD:function(){return o}});var r=t(57437),n=t(2265),s=t(93448);let i=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)("div",{className:"relative w-full overflow-auto",children:(0,r.jsx)("table",{ref:a,className:(0,s.cn)("w-full caption-bottom text-sm",t),...n})})});i.displayName="Table";let o=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)("thead",{ref:a,className:(0,s.cn)("[&_tr]:border-b",t),...n})});o.displayName="TableHeader";let l=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)("tbody",{ref:a,className:(0,s.cn)("[&_tr:last-child]:border-0",t),...n})});l.displayName="TableBody",n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)("tfoot",{ref:a,className:(0,s.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",t),...n})}).displayName="TableFooter";let d=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)("tr",{ref:a,className:(0,s.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",t),...n})});d.displayName="TableRow";let c=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)("th",{ref:a,className:(0,s.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",t),...n})});c.displayName="TableHead";let u=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)("td",{ref:a,className:(0,s.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",t),...n})});u.displayName="TableCell",n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)("caption",{ref:a,className:(0,s.cn)("mt-4 text-sm text-muted-foreground",t),...n})}).displayName="TableCaption"},71245:function(e,a,t){"use strict";t.d(a,{H:function(){return f},a:function(){return m}});var r=t(57437),n=t(43301),s=t(2265),i=t(99764),o=t(99376),l=t(5978);async function d(e){var a;let t=i.N$,r=null===(a=e.email)||void 0===a?void 0:a.toLowerCase().trim();if(!r)return{role:"none",companyId:null};let n=(0,l.IO)((0,l.hJ)(t,"invitacionesUsuarios"),(0,l.ar)("email","==",r),(0,l.ar)("estado","==","pendiente_auth"),(0,l.b9)(1)),s=await (0,l.PL)(n);if(s.empty)return console.log("No hay invitaci\xf3n pendiente para ".concat(r,".")),{role:"none",companyId:null};let o=s.docs[0],d=o.data(),c=(0,l.JU)(t,"users",e.uid),u=(0,l.qs)(t);return u.set(c,{nombre:d.nombre||e.displayName,email:r,role:d.roleDeseado,empresaId:d.empresaId,activo:!0,createdAt:(0,l.Bt)(),updatedAt:(0,l.Bt)()},{merge:!0}),u.update(o.ref,{estado:"activado",uid:e.uid,activatedAt:(0,l.Bt)()}),await u.commit(),console.log("Usuario ".concat(r," activado con rol ").concat(d.roleDeseado," en empresa ").concat(d.empresaId,".")),{role:d.roleDeseado,companyId:d.empresaId}}async function c(e){}let u=(0,s.createContext)(void 0);function f(e){let{children:a}=e,[t,f]=(0,s.useState)(null),[m,p]=(0,s.useState)("none"),[x,h]=(0,s.useState)(null),[b,v]=(0,s.useState)(null),[g,y]=(0,s.useState)(!0),j=(0,o.useRouter)(),N=(0,o.usePathname)();async function w(e,a){try{await (0,n.e5)(i.lX,e,a)}catch(e){if("auth/invalid-credential"===e.code||"auth/wrong-password"===e.code||"auth/user-not-found"===e.code)throw Error("Credenciales inv\xe1lidas. Por favor, revisa tu correo y contrase\xf1a.");if("auth/too-many-requests"===e.code)throw Error("Demasiados intentos fallidos. Por seguridad, el acceso desde este dispositivo ha sido bloqueado temporalmente.");throw console.error("Error de login no manejado:",e),Error("Ocurri\xf3 un error inesperado al iniciar sesi\xf3n.")}}async function R(){try{await (0,n.w7)(i.lX),f(null),p("none"),h(null),v(null),j.push("/")}catch(e){console.error("Error al cerrar sesi\xf3n",e)}}return(0,s.useEffect)(()=>{let e=(0,n.Aj)(i.lX,async e=>{if(e){await c(e);let a=(0,l.JU)(i.N$,"users",e.uid),t=await (0,l.QT)(a),r="none",n=null,s=!1;if(t.exists()){let e=t.data();e.role&&void 0!==e.empresaId&&(r=e.role,n=e.empresaId,s=!0===e.mustChangePassword)}if("none"===r){let a=await d(e);r=a.role,n=a.companyId,s=!0}p(r),h(n),f(e);let o="/cambiar-password"===N;if(s&&!o)j.replace("/cambiar-password");else if(!s){if("none"===r)j.replace("/sin-acceso");else if(N.startsWith("/login")||"/"===N||o){let e="cliente"===r?"/cliente":"contratista"===r?"/cumplimiento/contratista":"/dashboard";j.replace(e)}}}else f(null),p("none"),h(null),v(null);y(!1)});return()=>e()},[j,N]),(0,s.useEffect)(()=>{if(x){let e=(0,l.JU)(i.N$,"companies",x),a=(0,n.Aj)(i.lX,a=>{a&&(0,l.QT)(e).then(e=>{e.exists()?v({id:e.id,...e.data()}):v(null)})});return()=>a()}v(null)},[x]),(0,r.jsx)(u.Provider,{value:{user:t,role:m,companyId:x,company:b,loading:g,login:w,logout:R},children:a})}function m(){let e=(0,s.useContext)(u);if(!e)throw Error("useAuth debe usarse dentro de un AuthProvider");return e}},23340:function(e,a,t){"use strict";t.d(a,{pm:function(){return f}});var r=t(2265);let n=0,s=new Map,i=e=>{if(s.has(e))return;let a=setTimeout(()=>{s.delete(e),c({type:"REMOVE_TOAST",toastId:e})},1e6);s.set(e,a)},o=(e,a)=>{switch(a.type){case"ADD_TOAST":return{...e,toasts:[a.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===a.toast.id?{...e,...a.toast}:e)};case"DISMISS_TOAST":{let{toastId:t}=a;return t?i(t):e.toasts.forEach(e=>{i(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===t||void 0===t?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===a.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==a.toastId)}}},l=[],d={toasts:[]};function c(e){d=o(d,e),l.forEach(e=>{e(d)})}function u(e){let{...a}=e,t=(n=(n+1)%Number.MAX_SAFE_INTEGER).toString(),r=()=>c({type:"DISMISS_TOAST",toastId:t});return c({type:"ADD_TOAST",toast:{...a,id:t,open:!0,onOpenChange:e=>{e||r()}}}),{id:t,dismiss:r,update:e=>c({type:"UPDATE_TOAST",toast:{...e,id:t}})}}function f(){let[e,a]=r.useState(d);return r.useEffect(()=>(l.push(a),()=>{let e=l.indexOf(a);e>-1&&l.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>c({type:"DISMISS_TOAST",toastId:e})}}},99764:function(e,a,t){"use strict";let r,n,s,i,o;t.d(a,{IG:function(){return i},N$:function(){return s},lX:function(){return n},x2:function(){return o}});var l=t(738),d=t(43301),c=t(5978),u=t(60062),f=t(13491);let m={apiKey:"AIzaSyBfMp_dH9XhFSXEeMxY-Cdy8MDRIgWrxR0",authDomain:"pcg-2-8bf1b.firebaseapp.com",projectId:"pcg-2-8bf1b",storageBucket:"pcg-2-8bf1b.appspot.com",messagingSenderId:"1073834543546",appId:"1:1073834543546:web:2f85a4a8350280f8589737"};for(let e in m)if(Object.prototype.hasOwnProperty.call(m,e)&&!m[e]){let a=e.replace(/([A-Z])/g,"_$1").toUpperCase(),t="NEXT_PUBLIC_FIREBASE_".concat(a);throw Error("Error de configuraci\xf3n del cliente: La variable de entorno Firebase '".concat(t,"' no est\xe1 definida o est\xe1 vac\xeda. ")+"Aseg\xfarate de que est\xe9 configurada en tu archivo .env.local o en las variables de entorno de producci\xf3n.")}r=(0,l.C6)().length?(0,l.Mq)():(0,l.ZF)(m),n=(0,d.v0)(r),s=(0,c.ad)(r),i=(0,u.cF)(r),o=(0,f.$C)(r,"us-central1")},93448:function(e,a,t){"use strict";t.d(a,{cn:function(){return s}});var r=t(61994),n=t(53335);function s(){for(var e=arguments.length,a=Array(e),t=0;t<e;t++)a[t]=arguments[t];return(0,n.m6)((0,r.W)(a))}},7880:function(e,a,t){"use strict";t.d(a,{aU:function(){return F},$j:function(){return M},VY:function(){return T},dk:function(){return P},aV:function(){return z},h_:function(){return _},fC:function(){return A},Dx:function(){return Z},xz:function(){return O}});var r=t(2265),n=t(73966),s=t(98575),i=t(70001),o=t(6741),l=t(57437),d=Symbol("radix.slottable"),c="AlertDialog",[u,f]=(0,n.b)(c,[i.p8]),m=(0,i.p8)(),p=e=>{let{__scopeAlertDialog:a,...t}=e,r=m(a);return(0,l.jsx)(i.fC,{...r,...t,modal:!0})};p.displayName=c;var x=r.forwardRef((e,a)=>{let{__scopeAlertDialog:t,...r}=e,n=m(t);return(0,l.jsx)(i.xz,{...n,...r,ref:a})});x.displayName="AlertDialogTrigger";var h=e=>{let{__scopeAlertDialog:a,...t}=e,r=m(a);return(0,l.jsx)(i.h_,{...r,...t})};h.displayName="AlertDialogPortal";var b=r.forwardRef((e,a)=>{let{__scopeAlertDialog:t,...r}=e,n=m(t);return(0,l.jsx)(i.aV,{...n,...r,ref:a})});b.displayName="AlertDialogOverlay";var v="AlertDialogContent",[g,y]=u(v),j=function(e){let a=({children:e})=>(0,l.jsx)(l.Fragment,{children:e});return a.displayName=`${e}.Slottable`,a.__radixId=d,a}("AlertDialogContent"),N=r.forwardRef((e,a)=>{let{__scopeAlertDialog:t,children:n,...d}=e,c=m(t),u=r.useRef(null),f=(0,s.e)(a,u),p=r.useRef(null);return(0,l.jsx)(i.jm,{contentName:v,titleName:w,docsSlug:"alert-dialog",children:(0,l.jsx)(g,{scope:t,cancelRef:p,children:(0,l.jsxs)(i.VY,{role:"alertdialog",...c,...d,ref:f,onOpenAutoFocus:(0,o.Mj)(d.onOpenAutoFocus,e=>{var a;e.preventDefault(),null===(a=p.current)||void 0===a||a.focus({preventScroll:!0})}),onPointerDownOutside:e=>e.preventDefault(),onInteractOutside:e=>e.preventDefault(),children:[(0,l.jsx)(j,{children:n}),(0,l.jsx)(k,{contentRef:u})]})})})});N.displayName=v;var w="AlertDialogTitle",R=r.forwardRef((e,a)=>{let{__scopeAlertDialog:t,...r}=e,n=m(t);return(0,l.jsx)(i.Dx,{...n,...r,ref:a})});R.displayName=w;var C="AlertDialogDescription",S=r.forwardRef((e,a)=>{let{__scopeAlertDialog:t,...r}=e,n=m(t);return(0,l.jsx)(i.dk,{...n,...r,ref:a})});S.displayName=C;var E=r.forwardRef((e,a)=>{let{__scopeAlertDialog:t,...r}=e,n=m(t);return(0,l.jsx)(i.x8,{...n,...r,ref:a})});E.displayName="AlertDialogAction";var I="AlertDialogCancel",D=r.forwardRef((e,a)=>{let{__scopeAlertDialog:t,...r}=e,{cancelRef:n}=y(I,t),o=m(t),d=(0,s.e)(a,n);return(0,l.jsx)(i.x8,{...o,...r,ref:d})});D.displayName=I;var k=e=>{let{contentRef:a}=e,t="`".concat(v,"` requires a description for the component to be accessible for screen reader users.\n\nYou can add a description to the `").concat(v,"` by passing a `").concat(C,"` component as a child, which also benefits sighted users by adding visible context to the dialog.\n\nAlternatively, you can use your own component as a description by assigning it an `id` and passing the same value to the `aria-describedby` prop in `").concat(v,"`. If the description is confusing or duplicative for sighted users, you can use the `@radix-ui/react-visually-hidden` primitive as a wrapper around your description component.\n\nFor more information, see https://radix-ui.com/primitives/docs/components/alert-dialog");return r.useEffect(()=>{var e;document.getElementById(null===(e=a.current)||void 0===e?void 0:e.getAttribute("aria-describedby"))||console.warn(t)},[t,a]),null},A=p,O=x,_=h,z=b,T=N,F=E,M=D,Z=R,P=S},370:function(e,a,t){"use strict";t.d(a,{f:function(){return l}});var r=t(2265);t(54887);var n=t(37053),s=t(57437),i=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,a)=>{let t=(0,n.Z8)(`Primitive.${a}`),i=r.forwardRef((e,r)=>{let{asChild:n,...i}=e,o=n?t:a;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,s.jsx)(o,{...i,ref:r})});return i.displayName=`Primitive.${a}`,{...e,[a]:i}},{}),o=r.forwardRef((e,a)=>(0,s.jsx)(i.label,{...e,ref:a,onMouseDown:a=>{var t;a.target.closest("button, input, select, textarea")||(null===(t=e.onMouseDown)||void 0===t||t.call(e,a),!a.defaultPrevented&&a.detail>1&&a.preventDefault())}}));o.displayName="Label";var l=o},5485:function(e,a,t){"use strict";t.d(a,{Z:function(){return r}});let r=(0,t(96471).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},54233:function(e,a,t){"use strict";t.d(a,{Z:function(){return r}});let r=(0,t(96471).Z)("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]])},54585:function(e,a,t){"use strict";t.d(a,{Z:function(){return r}});let r=(0,t(96471).Z)("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]])},59022:function(e,a,t){"use strict";t.d(a,{Z:function(){return r}});let r=(0,t(96471).Z)("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]])},15847:function(e,a,t){"use strict";t.d(a,{Z:function(){return r}});let r=(0,t(96471).Z)("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]])},43728:function(e,a,t){"use strict";t.d(a,{Z:function(){return r}});let r=(0,t(96471).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},44986:function(e,a,t){"use strict";t.d(a,{Z:function(){return r}});let r=(0,t(96471).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])}},function(e){e.O(0,[4358,9990,6137,1211,2972,9759,3562,1,2971,2117,1744],function(){return e(e.s=71449)}),_N_E=e.O()}]);