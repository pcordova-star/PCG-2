(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1011],{87155:function(e,a,s){Promise.resolve().then(s.bind(s,17279))},17279:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return R}});var t=s(57437),n=s(2265),i=s(79820),l=s(12381),r=s(75060),c=s(71245),d=s(23340),o=s(5252),m=s(15847),h=s(13147),u=s(53459),x=s(5485),f=s(86049),p=s(76848),j=s(69140),g=s(74291),v=s(84843),y=s(93448);function w(e){let{className:a,classNames:s,showOutsideDays:n=!0,...i}=e;return(0,t.jsx)(v._W,{showOutsideDays:n,className:(0,y.cn)("p-3",a),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:(0,y.cn)((0,l.d)({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:(0,y.cn)((0,l.d)({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...s},components:{IconLeft:e=>{let{className:a,...s}=e;return(0,t.jsx)(f.Z,{className:(0,y.cn)("h-4 w-4",a),...s})},IconRight:e=>{let{className:a,...s}=e;return(0,t.jsx)(p.Z,{className:(0,y.cn)("h-4 w-4",a),...s})}},...i})}w.displayName="Calendar";var N=s(51777);let b=N.fC,C=N.xz,_=n.forwardRef((e,a)=>{let{className:s,align:n="center",sideOffset:i=4,...l}=e;return(0,t.jsx)(N.h_,{children:(0,t.jsx)(N.VY,{ref:a,align:n,sideOffset:i,className:(0,y.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...l})})});_.displayName=N.VY.displayName;var P=s(27107),z=s(93292),S=s(69174),D=s(27648);async function Z(e,a){let s=await fetch("/api/mclp/calendar?companyId=".concat(e,"&year=").concat(a));if(!s.ok)throw Error((await s.json()).error||"Failed to fetch calendar data");return s.json()}async function E(e,a,s,t){let n=await fetch("/api/mclp/calendar/update",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({companyId:e,year:a,monthId:s,data:t})});if(!n.ok)throw Error((await n.json()).error||"Failed to update month");return n.json()}function O(e){let{month:a,onEdit:s}=e,n=a.editable;return(0,t.jsxs)(i.Zb,{className:n?"":"bg-muted/50 border-dashed",children:[(0,t.jsxs)(i.Ol,{className:"flex-row justify-between items-center pb-2",children:[(0,t.jsx)(i.ll,{className:"text-base font-bold",children:new Date(a.id+"-02T00:00:00").toLocaleString("es-CL",{month:"long",timeZone:"UTC"}).toUpperCase()}),(0,t.jsx)(S.C,{variant:n?"default":"secondary",children:n?"Editable":(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o.Z,{className:"h-3 w-3 mr-1"}),"Bloqueado"]})})]}),(0,t.jsxs)(i.aY,{className:"text-sm space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"\uD83D\uDCE5 Corte carga:"}),(0,t.jsx)("span",{className:"font-semibold",children:(0,P.WU)(new Date(a.corteCarga),"dd 'de' MMM",{locale:z.es})})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"\uD83E\uDDD0 L\xedmite revisi\xf3n:"}),(0,t.jsx)("span",{className:"font-semibold",children:(0,P.WU)(new Date(a.limiteRevision),"dd 'de' MMM",{locale:z.es})})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"\uD83D\uDCB0 Fecha pago:"}),(0,t.jsx)("span",{className:"font-semibold",children:(0,P.WU)(new Date(a.fechaPago),"dd 'de' MMM",{locale:z.es})})]})]}),(0,t.jsx)(i.eW,{children:(0,t.jsxs)(l.z,{size:"sm",variant:"outline",className:"w-full",disabled:!n,onClick:()=>s(a),children:[(0,t.jsx)(m.Z,{className:"mr-2 h-4 w-4"})," Editar Fechas"]})})]})}function F(e){let{month:a,isOpen:s,onClose:i,onSave:c}=e,[d,o]=(0,n.useState)(a),[m,x]=(0,n.useState)(!1);if((0,n.useEffect)(()=>{a&&o(a)},[a]),!d)return null;let f=(e,a)=>{a&&o(s=>s?{...s,[e]:a}:null)},p=async()=>{x(!0),await c(d),x(!1)};return(0,t.jsx)(g.Vq,{open:s,onOpenChange:i,children:(0,t.jsxs)(g.cZ,{children:[(0,t.jsx)(g.fK,{children:(0,t.jsxs)(g.$N,{children:["Editar Fechas de ",new Date(d.id+"-02T00:00:00").toLocaleString("es-CL",{month:"long",year:"numeric",timeZone:"UTC"})]})}),(0,t.jsxs)("div",{className:"py-4 space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(r._,{children:"Fecha de corte de carga"}),(0,t.jsxs)(b,{children:[(0,t.jsx)(C,{asChild:!0,children:(0,t.jsxs)(l.z,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[(0,t.jsx)(h.Z,{className:"mr-2 h-4 w-4"}),(0,P.WU)(d.corteCarga,"PPP",{locale:z.es})]})}),(0,t.jsx)(_,{className:"w-auto p-0",children:(0,t.jsx)(w,{mode:"single",selected:d.corteCarga,onSelect:e=>f("corteCarga",e)})})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(r._,{children:"Fecha l\xedmite de revisi\xf3n"}),(0,t.jsxs)(b,{children:[(0,t.jsx)(C,{asChild:!0,children:(0,t.jsxs)(l.z,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[(0,t.jsx)(h.Z,{className:"mr-2 h-4 w-4"}),(0,P.WU)(d.limiteRevision,"PPP",{locale:z.es})]})}),(0,t.jsx)(_,{className:"w-auto p-0",children:(0,t.jsx)(w,{mode:"single",selected:d.limiteRevision,onSelect:e=>f("limiteRevision",e)})})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(r._,{children:"Fecha propuesta de pago"}),(0,t.jsxs)(b,{children:[(0,t.jsx)(C,{asChild:!0,children:(0,t.jsxs)(l.z,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[(0,t.jsx)(h.Z,{className:"mr-2 h-4 w-4"}),(0,P.WU)(d.fechaPago,"PPP",{locale:z.es})]})}),(0,t.jsx)(_,{className:"w-auto p-0",children:(0,t.jsx)(w,{mode:"single",selected:d.fechaPago,onSelect:e=>f("fechaPago",e)})})]})]})]}),(0,t.jsxs)(g.cN,{children:[(0,t.jsx)(l.z,{variant:"ghost",onClick:i,disabled:m,children:"Cancelar"}),(0,t.jsxs)(l.z,{onClick:p,disabled:m,children:[m&&(0,t.jsx)(u.Z,{className:"animate-spin mr-2"}),"Guardar Cambios"]})]})]})})}function R(){let{companyId:e}=(0,c.a)(),{toast:a}=(0,d.pm)(),[s,r]=(0,n.useTransition)(),[o,m]=(0,n.useState)(new Date().getFullYear()),[h,g]=(0,n.useState)([]),[v,y]=(0,n.useState)(!0),[w,N]=(0,n.useState)(null),b=s=>{e&&(y(!0),r(async()=>{try{let a=await Z(e,s);g(a)}catch(e){a({variant:"destructive",title:"Error",description:e.message}),g([])}finally{y(!1)}}))};(0,n.useEffect)(()=>{b(o)},[e,o]);let C=e=>{N({id:e.id,corteCarga:new Date(e.corteCarga),limiteRevision:new Date(e.limiteRevision),fechaPago:new Date(e.fechaPago)})},_=async s=>{if(e){if(s.corteCarga>=s.limiteRevision||s.limiteRevision>=s.fechaPago){a({variant:"destructive",title:"Fechas inv\xe1lidas",description:"El orden debe ser: Corte Carga < L\xedmite Revisi\xf3n < Fecha Pago."});return}r(async()=>{try{await E(e,o,s.id,{corteCarga:s.corteCarga.toISOString(),limiteRevision:s.limiteRevision.toISOString(),fechaPago:s.fechaPago.toISOString()}),a({title:"\xc9xito",description:"Fechas del mes actualizadas."}),N(null),b(o)}catch(e){a({variant:"destructive",title:"Error",description:e.message})}})}};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("header",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)(l.z,{variant:"outline",size:"sm",asChild:!0,children:(0,t.jsxs)(D.default,{href:"/cumplimiento/admin",children:[(0,t.jsx)(x.Z,{className:"mr-2 h-4 w-4"}),"Volver"]})}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("h1",{className:"text-2xl font-bold",children:["Calendario de Cumplimiento ",o]}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Visualiza y edita las fechas clave de cada per\xedodo mensual."})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(l.z,{variant:"outline",size:"icon",onClick:()=>m(e=>e-1),children:(0,t.jsx)(f.Z,{})}),(0,t.jsx)("span",{className:"font-bold text-lg w-24 text-center",children:o}),(0,t.jsx)(l.z,{variant:"outline",size:"icon",onClick:()=>m(e=>e+1),children:(0,t.jsx)(p.Z,{})})]})]}),v?(0,t.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:Array.from({length:12}).map((e,a)=>(0,t.jsx)(j.O,{className:"h-48"},a))}):0===h.length?(0,t.jsxs)(i.Zb,{className:"text-center p-8",children:[(0,t.jsxs)(i.Ol,{children:[(0,t.jsx)(i.ll,{children:"Calendario no generado"}),(0,t.jsxs)(i.SZ,{children:["Parece que el calendario para el a\xf1o ",o," a\xfan no se ha creado."]})]}),(0,t.jsx)(i.aY,{children:(0,t.jsxs)(l.z,{onClick:()=>b(o),disabled:s,children:[s&&(0,t.jsx)(u.Z,{className:"animate-spin mr-2"}),s?"Creando...":"Crear Calendario ".concat(o)]})})]}):(0,t.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:h.map(e=>(0,t.jsx)(O,{month:e,onEdit:C},e.id))}),(0,t.jsx)(F,{month:w,isOpen:!!w,onClose:()=>N(null),onSave:_})]})}},69140:function(e,a,s){"use strict";s.d(a,{O:function(){return i}});var t=s(57437),n=s(93448);function i(e){let{className:a,...s}=e;return(0,t.jsx)("div",{className:(0,n.cn)("animate-pulse rounded-md bg-muted",a),...s})}}},function(e){e.O(0,[4358,9990,6137,1211,2972,9759,3562,6008,1,3719,2900,5518,2971,2117,1744],function(){return e(e.s=87155)}),_N_E=e.O()}]);