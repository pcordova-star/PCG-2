(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[83],{4014:function(e,t,r){Promise.resolve().then(r.bind(r,6112))},99376:function(e,t,r){"use strict";var n=r(35475);r.o(n,"notFound")&&r.d(t,{notFound:function(){return n.notFound}}),r.o(n,"useParams")&&r.d(t,{useParams:function(){return n.useParams}}),r.o(n,"usePathname")&&r.d(t,{usePathname:function(){return n.usePathname}}),r.o(n,"useRouter")&&r.d(t,{useRouter:function(){return n.useRouter}}),r.o(n,"useSearchParams")&&r.d(t,{useSearchParams:function(){return n.useSearchParams}})},6112:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return u}});var n=r(57437),a=r(71245),o=r(99376),i=r(2265),s=r(53459);function u(){let{role:e,loading:t}=(0,a.a)(),r=(0,o.useRouter)();return(0,i.useEffect)(()=>{t||("admin_empresa"===e||"superadmin"===e?r.replace("/cumplimiento/admin"):"contratista"===e?r.replace("/cumplimiento/contratista/dashboard"):r.replace("/dashboard"))},[e,t,r]),(0,n.jsxs)("div",{className:"flex items-center justify-center h-full",children:[(0,n.jsx)(s.Z,{className:"h-8 w-8 animate-spin"}),(0,n.jsx)("p",{className:"ml-4",children:"Cargando M\xf3dulo de Cumplimiento..."})]})}},71245:function(e,t,r){"use strict";r.d(t,{H:function(){return f},a:function(){return m}});var n=r(57437),a=r(43301),o=r(2265),i=r(99764),s=r(99376),u=r(5978);async function c(e){var t;let r=i.N$,n=null===(t=e.email)||void 0===t?void 0:t.toLowerCase().trim();if(!n)return{role:"none",companyId:null};let a=(0,u.IO)((0,u.hJ)(r,"invitacionesUsuarios"),(0,u.ar)("email","==",n),(0,u.ar)("estado","==","pendiente_auth"),(0,u.b9)(1)),o=await (0,u.PL)(a);if(o.empty)return console.log("No hay invitaci\xf3n pendiente para ".concat(n,".")),{role:"none",companyId:null};let s=o.docs[0],c=s.data(),l=(0,u.JU)(r,"users",e.uid),d=(0,u.qs)(r);return d.set(l,{nombre:c.nombre||e.displayName,email:n,role:c.roleDeseado,empresaId:c.empresaId,activo:!0,createdAt:(0,u.Bt)(),updatedAt:(0,u.Bt)()},{merge:!0}),d.update(s.ref,{estado:"activado",uid:e.uid,activatedAt:(0,u.Bt)()}),await d.commit(),console.log("Usuario ".concat(n," activado con rol ").concat(c.roleDeseado," en empresa ").concat(c.empresaId,".")),{role:c.roleDeseado,companyId:c.empresaId}}async function l(e){}let d=(0,o.createContext)(void 0);function f(e){let{children:t}=e,[r,f]=(0,o.useState)(null),[m,p]=(0,o.useState)("none"),[h,v]=(0,o.useState)(null),[w,g]=(0,o.useState)(null),[b,y]=(0,o.useState)(!0),E=(0,s.useRouter)(),I=(0,s.usePathname)();async function P(e,t){try{await (0,a.e5)(i.lX,e,t)}catch(e){if("auth/invalid-credential"===e.code||"auth/wrong-password"===e.code||"auth/user-not-found"===e.code)throw Error("Credenciales inv\xe1lidas. Por favor, revisa tu correo y contrase\xf1a.");if("auth/too-many-requests"===e.code)throw Error("Demasiados intentos fallidos. Por seguridad, el acceso desde este dispositivo ha sido bloqueado temporalmente.");throw console.error("Error de login no manejado:",e),Error("Ocurri\xf3 un error inesperado al iniciar sesi\xf3n.")}}async function C(){try{await (0,a.w7)(i.lX),f(null),p("none"),v(null),g(null),E.push("/")}catch(e){console.error("Error al cerrar sesi\xf3n",e)}}return(0,o.useEffect)(()=>{let e=(0,a.Aj)(i.lX,async e=>{if(e){await l(e);let t=(0,u.JU)(i.N$,"users",e.uid),r=await (0,u.QT)(t),n="none",a=null,o=!1;if(r.exists()){let e=r.data();e.role&&void 0!==e.empresaId&&(n=e.role,a=e.empresaId,o=!0===e.mustChangePassword)}if("none"===n){let t=await c(e);n=t.role,a=t.companyId,o=!0}p(n),v(a),f(e);let s="/cambiar-password"===I;if(o&&!s)E.replace("/cambiar-password");else if(!o){if("none"===n)E.replace("/sin-acceso");else if(I.startsWith("/login")||"/"===I||s){let e="cliente"===n?"/cliente":"contratista"===n?"/cumplimiento/contratista":"/dashboard";E.replace(e)}}}else f(null),p("none"),v(null),g(null);y(!1)});return()=>e()},[E,I]),(0,o.useEffect)(()=>{if(h){let e=(0,u.JU)(i.N$,"companies",h),t=(0,a.Aj)(i.lX,t=>{t&&(0,u.QT)(e).then(e=>{e.exists()?g({id:e.id,...e.data()}):g(null)})});return()=>t()}g(null)},[h]),(0,n.jsx)(d.Provider,{value:{user:r,role:m,companyId:h,company:w,loading:b,login:P,logout:C},children:t})}function m(){let e=(0,o.useContext)(d);if(!e)throw Error("useAuth debe usarse dentro de un AuthProvider");return e}},99764:function(e,t,r){"use strict";let n,a,o,i,s;r.d(t,{IG:function(){return i},N$:function(){return o},lX:function(){return a},x2:function(){return s}});var u=r(738),c=r(43301),l=r(5978),d=r(60062),f=r(13491);let m={apiKey:"AIzaSyBfMp_dH9XhFSXEeMxY-Cdy8MDRIgWrxR0",authDomain:"pcg-2-8bf1b.firebaseapp.com",projectId:"pcg-2-8bf1b",storageBucket:"pcg-2-8bf1b.appspot.com",messagingSenderId:"1073834543546",appId:"1:1073834543546:web:2f85a4a8350280f8589737"};for(let e in m)if(Object.prototype.hasOwnProperty.call(m,e)&&!m[e]){let t=e.replace(/([A-Z])/g,"_$1").toUpperCase(),r="NEXT_PUBLIC_FIREBASE_".concat(t);throw Error("Error de configuraci\xf3n del cliente: La variable de entorno Firebase '".concat(r,"' no est\xe1 definida o est\xe1 vac\xeda. ")+"Aseg\xfarate de que est\xe9 configurada en tu archivo .env.local o en las variables de entorno de producci\xf3n.")}n=(0,u.C6)().length?(0,u.Mq)():(0,u.ZF)(m),a=(0,c.v0)(n),o=(0,l.ad)(n),i=(0,d.cF)(n),s=(0,f.$C)(n,"us-central1")},96471:function(e,t,r){"use strict";r.d(t,{Z:function(){return u}});var n=r(2265);let a=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),o=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim()};var i={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let s=(0,n.forwardRef)((e,t)=>{let{color:r="currentColor",size:a=24,strokeWidth:s=2,absoluteStrokeWidth:u,className:c="",children:l,iconNode:d,...f}=e;return(0,n.createElement)("svg",{ref:t,...i,width:a,height:a,stroke:r,strokeWidth:u?24*Number(s)/Number(a):s,className:o("lucide",c),...f},[...d.map(e=>{let[t,r]=e;return(0,n.createElement)(t,r)}),...Array.isArray(l)?l:[l]])}),u=(e,t)=>{let r=(0,n.forwardRef)((r,i)=>{let{className:u,...c}=r;return(0,n.createElement)(s,{ref:i,iconNode:t,className:o("lucide-".concat(a(e)),u),...c})});return r.displayName="".concat(e),r}},53459:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});let n=(0,r(96471).Z)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])}},function(e){e.O(0,[4358,9990,1211,2971,2117,1744],function(){return e(e.s=4014)}),_N_E=e.O()}]);