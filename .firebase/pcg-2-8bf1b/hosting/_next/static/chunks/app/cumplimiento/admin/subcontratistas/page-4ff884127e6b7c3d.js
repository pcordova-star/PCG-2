(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4812,2087,5518],{49729:function(e,t,a){Promise.resolve().then(a.bind(a,10147))},27648:function(e,t,a){"use strict";a.d(t,{default:function(){return n.a}});var r=a(72972),n=a.n(r)},10147:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return C}});var r=a(57437),n=a(2265),s=a(79820),o=a(12381),i=a(27648),l=a(5485),c=a(54233),d=a(53459);let u=(0,a(96471).Z)("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);var f=a(43728),m=a(71245),p=a(23340),x=a(33804),h=a(74291),v=a(40279),y=a(75060),g=a(30767),b=a(69174);async function j(e){let t=await fetch("/api/mclp/subcontractors?companyId=".concat(e));if(!t.ok)throw Error("Failed to fetch subcontractors");return t.json()}async function N(e){let t=await fetch("/api/mclp/subcontractors",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json()).error||"Failed to create subcontractor");return t.json()}async function w(e,t){let a=await fetch("/api/mclp/subcontractors?companyId=".concat(e,"&subcontractorId=").concat(t),{method:"DELETE"});if(!a.ok)throw Error((await a.json()).error||"Failed to deactivate subcontractor");return a.json()}async function S(e){let t=await fetch("/api/mclp/subcontractors/invite",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json()).error||"Failed to invite user");return t.json()}function C(){let{companyId:e}=(0,m.a)(),{toast:t}=(0,p.pm)(),[a,C]=(0,n.useState)([]),[k,R]=(0,n.useState)(!0),[D,E]=(0,n.useState)(!1),[A,I]=(0,n.useState)(!1),[T,_]=(0,n.useState)(null),[z,O]=(0,n.useState)({razonSocial:"",rut:"",contactoNombre:"",contactoEmail:""}),[M,Z]=(0,n.useState)({nombre:"",email:""}),P=async()=>{if(e){R(!0);try{let t=await j(e);C(t||[])}catch(e){t({variant:"destructive",title:"Error",description:e.message})}finally{R(!1)}}};(0,n.useEffect)(()=>{P()},[e,t]);let V=async a=>{if(a.preventDefault(),e)try{await N({...z,companyId:e}),t({title:"\xc9xito",description:"Subcontratista creado correctamente."}),E(!1),O({razonSocial:"",rut:"",contactoNombre:"",contactoEmail:""}),await P()}catch(e){t({variant:"destructive",title:"Error",description:e.message})}},U=async a=>{if(a.preventDefault(),e&&T)try{await S({...M,companyId:e,subcontractorId:T.id}),t({title:"\xc9xito",description:"Invitaci\xf3n enviada a ".concat(M.email,".")}),I(!1),Z({nombre:"",email:""}),await P()}catch(e){t({variant:"destructive",title:"Error",description:e.message})}},F=async a=>{if(e)try{await w(e,a),t({title:"\xc9xito",description:"Subcontratista desactivado."}),await P()}catch(e){t({variant:"destructive",title:"Error",description:e.message})}};return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("header",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)(o.z,{variant:"outline",size:"icon",asChild:!0,children:(0,r.jsx)(i.default,{href:"/cumplimiento/admin",children:(0,r.jsx)(l.Z,{})})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-2xl font-bold",children:"Gesti\xf3n de Subcontratistas"}),(0,r.jsx)("p",{className:"text-muted-foreground",children:"A\xf1ade, desactiva y gestiona el acceso de tus subcontratistas."})]})]}),(0,r.jsxs)(o.z,{onClick:()=>E(!0),children:[(0,r.jsx)(c.Z,{className:"mr-2"}),"Nuevo Subcontratista"]})]}),(0,r.jsxs)(s.Zb,{children:[(0,r.jsx)(s.Ol,{children:(0,r.jsx)(s.ll,{children:"Listado de Subcontratistas Activos"})}),(0,r.jsx)(s.aY,{children:k?(0,r.jsx)(d.Z,{className:"animate-spin"}):(0,r.jsxs)(x.iA,{children:[(0,r.jsx)(x.xD,{children:(0,r.jsxs)(x.SC,{children:[(0,r.jsx)(x.ss,{children:"Raz\xf3n Social"}),(0,r.jsx)(x.ss,{children:"RUT"}),(0,r.jsx)(x.ss,{children:"Contacto"}),(0,r.jsx)(x.ss,{children:"Usuarios"}),(0,r.jsx)(x.ss,{className:"text-right",children:"Acciones"})]})}),(0,r.jsx)(x.RM,{children:a.map(e=>{var t,a;return(0,r.jsxs)(x.SC,{children:[(0,r.jsx)(x.pj,{className:"font-medium",children:e.razonSocial}),(0,r.jsx)(x.pj,{children:e.rut}),(0,r.jsx)(x.pj,{children:(null===(t=e.contactoPrincipal)||void 0===t?void 0:t.nombre)||"N/A"}),(0,r.jsx)(x.pj,{children:(0,r.jsx)(b.C,{children:(null===(a=e.userIds)||void 0===a?void 0:a.length)||0})}),(0,r.jsx)(x.pj,{className:"text-right",children:(0,r.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,r.jsxs)(o.z,{size:"sm",variant:"outline",onClick:()=>{_(e),I(!0)},children:[(0,r.jsx)(u,{className:"mr-2 h-4 w-4"}),"Invitar Usuario"]}),(0,r.jsxs)(g.aR,{children:[(0,r.jsx)(g.vW,{asChild:!0,children:(0,r.jsxs)(o.z,{size:"sm",variant:"destructive",children:[(0,r.jsx)(f.Z,{className:"mr-2 h-4 w-4"}),"Desactivar"]})}),(0,r.jsxs)(g._T,{children:[(0,r.jsxs)(g.fY,{children:[(0,r.jsxs)(g.f$,{children:["\xbfDesactivar a ",e.razonSocial,"?"]}),(0,r.jsx)(g.yT,{children:"Esta acci\xf3n es reversible. El subcontratista no podr\xe1 acceder al sistema hasta que sea reactivado."})]}),(0,r.jsxs)("div",{className:"flex justify-end gap-2 pt-4",children:[(0,r.jsx)(g.le,{children:"Cancelar"}),(0,r.jsx)(g.OL,{onClick:()=>F(e.id),children:"Desactivar"})]})]})]})]})})]},e.id)})})]})})]}),(0,r.jsx)(h.Vq,{open:D,onOpenChange:E,children:(0,r.jsxs)(h.cZ,{children:[(0,r.jsx)(h.fK,{children:(0,r.jsx)(h.$N,{children:"Crear Nuevo Subcontratista"})}),(0,r.jsxs)("form",{onSubmit:V,className:"space-y-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(y._,{children:"Raz\xf3n Social"}),(0,r.jsx)(v.I,{value:z.razonSocial,onChange:e=>O(t=>({...t,razonSocial:e.target.value}))})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(y._,{children:"RUT"}),(0,r.jsx)(v.I,{value:z.rut,onChange:e=>O(t=>({...t,rut:e.target.value}))})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(y._,{children:"Nombre Contacto"}),(0,r.jsx)(v.I,{value:z.contactoNombre,onChange:e=>O(t=>({...t,contactoNombre:e.target.value}))})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(y._,{children:"Email Contacto"}),(0,r.jsx)(v.I,{type:"email",value:z.contactoEmail,onChange:e=>O(t=>({...t,contactoEmail:e.target.value}))})]}),(0,r.jsxs)(h.cN,{children:[(0,r.jsx)(o.z,{type:"button",variant:"ghost",onClick:()=>E(!1),children:"Cancelar"}),(0,r.jsx)(o.z,{type:"submit",children:"Guardar"})]})]})]})}),(0,r.jsx)(h.Vq,{open:A,onOpenChange:I,children:(0,r.jsxs)(h.cZ,{children:[(0,r.jsx)(h.fK,{children:(0,r.jsxs)(h.$N,{children:["Invitar Usuario a ",null==T?void 0:T.razonSocial]})}),(0,r.jsxs)("form",{onSubmit:U,className:"space-y-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(y._,{children:"Nombre del Usuario"}),(0,r.jsx)(v.I,{value:M.nombre,onChange:e=>Z(t=>({...t,nombre:e.target.value}))})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(y._,{children:"Email del Usuario"}),(0,r.jsx)(v.I,{type:"email",value:M.email,onChange:e=>Z(t=>({...t,email:e.target.value}))})]}),(0,r.jsxs)(h.cN,{children:[(0,r.jsx)(o.z,{type:"button",variant:"ghost",onClick:()=>I(!1),children:"Cancelar"}),(0,r.jsx)(o.z,{type:"submit",children:"Enviar Invitaci\xf3n"})]})]})]})})]})}},30767:function(e,t,a){"use strict";a.d(t,{OL:function(){return v},_T:function(){return f},aR:function(){return l},f$:function(){return x},fY:function(){return m},le:function(){return y},vW:function(){return c},xo:function(){return p},yT:function(){return h}});var r=a(57437),n=a(2265),s=a(7880),o=a(93448),i=a(12381);let l=s.fC,c=s.xz,d=s.h_,u=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)(s.aV,{className:(0,o.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...n,ref:t})});u.displayName=s.aV.displayName;let f=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsxs)(d,{children:[(0,r.jsx)(u,{}),(0,r.jsx)(s.VY,{ref:t,className:(0,o.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...n})]})});f.displayName=s.VY.displayName;let m=e=>{let{className:t,...a}=e;return(0,r.jsx)("div",{className:(0,o.cn)("flex flex-col space-y-2 text-center sm:text-left",t),...a})};m.displayName="AlertDialogHeader";let p=e=>{let{className:t,...a}=e;return(0,r.jsx)("div",{className:(0,o.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a})};p.displayName="AlertDialogFooter";let x=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)(s.Dx,{ref:t,className:(0,o.cn)("text-lg font-semibold",a),...n})});x.displayName=s.Dx.displayName;let h=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)(s.dk,{ref:t,className:(0,o.cn)("text-sm text-muted-foreground",a),...n})});h.displayName=s.dk.displayName;let v=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)(s.aU,{ref:t,className:(0,o.cn)((0,i.d)(),a),...n})});v.displayName=s.aU.displayName;let y=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)(s.$j,{ref:t,className:(0,o.cn)((0,i.d)({variant:"outline"}),"mt-2 sm:mt-0",a),...n})});y.displayName=s.$j.displayName},69174:function(e,t,a){"use strict";a.d(t,{C:function(){return i}});var r=a(57437);a(2265);var n=a(90535),s=a(93448);let o=(0,n.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i(e){let{className:t,variant:a,...n}=e;return(0,r.jsx)("div",{className:(0,s.cn)(o({variant:a}),t),...n})}},12381:function(e,t,a){"use strict";a.d(t,{d:function(){return l},z:function(){return c}});var r=a(57437),n=a(2265),s=a(37053),o=a(90535),i=a(93448);let l=(0,o.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=n.forwardRef((e,t)=>{let{className:a,variant:n,size:o,asChild:c=!1,...d}=e,u=c?s.g7:"button";return(0,r.jsx)(u,{className:(0,i.cn)(l({variant:n,size:o,className:a})),ref:t,...d})});c.displayName="Button"},79820:function(e,t,a){"use strict";a.d(t,{Ol:function(){return i},SZ:function(){return c},Zb:function(){return o},aY:function(){return d},eW:function(){return u},ll:function(){return l}});var r=a(57437),n=a(2265),s=a(93448);let o=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)("div",{ref:t,className:(0,s.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...n})});o.displayName="Card";let i=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)("div",{ref:t,className:(0,s.cn)("flex flex-col space-y-1.5 p-6",a),...n})});i.displayName="CardHeader";let l=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)("div",{ref:t,className:(0,s.cn)("text-2xl font-semibold leading-none tracking-tight",a),...n})});l.displayName="CardTitle";let c=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)("div",{ref:t,className:(0,s.cn)("text-sm text-muted-foreground",a),...n})});c.displayName="CardDescription";let d=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)("div",{ref:t,className:(0,s.cn)("p-6 pt-0",a),...n})});d.displayName="CardContent";let u=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)("div",{ref:t,className:(0,s.cn)("flex items-center p-6 pt-0",a),...n})});u.displayName="CardFooter"},74291:function(e,t,a){"use strict";a.d(t,{$N:function(){return x},Be:function(){return h},Vq:function(){return l},cN:function(){return p},cZ:function(){return f},fK:function(){return m},hg:function(){return c}});var r=a(57437),n=a(2265),s=a(70001),o=a(44986),i=a(93448);let l=s.fC,c=s.xz,d=s.h_;s.x8;let u=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)(s.aV,{ref:t,className:(0,i.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...n})});u.displayName=s.aV.displayName;let f=n.forwardRef((e,t)=>{let{className:a,children:n,...l}=e;return(0,r.jsxs)(d,{children:[(0,r.jsx)(u,{}),(0,r.jsxs)(s.VY,{ref:t,className:(0,i.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...l,children:[n,(0,r.jsxs)(s.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,r.jsx)(o.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});f.displayName=s.VY.displayName;let m=e=>{let{className:t,...a}=e;return(0,r.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...a})};m.displayName="DialogHeader";let p=e=>{let{className:t,...a}=e;return(0,r.jsx)("div",{className:(0,i.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a})};p.displayName="DialogFooter";let x=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)(s.Dx,{ref:t,className:(0,i.cn)("text-lg font-semibold leading-none tracking-tight",a),...n})});x.displayName=s.Dx.displayName;let h=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)(s.dk,{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",a),...n})});h.displayName=s.dk.displayName},40279:function(e,t,a){"use strict";a.d(t,{I:function(){return o}});var r=a(57437),n=a(2265),s=a(93448);let o=n.forwardRef((e,t)=>{let{className:a,type:n,...o}=e;return(0,r.jsx)("input",{type:n,className:(0,s.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:t,...o})});o.displayName="Input"},75060:function(e,t,a){"use strict";a.d(t,{_:function(){return c}});var r=a(57437),n=a(2265),s=a(370),o=a(90535),i=a(93448);let l=(0,o.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)(s.f,{ref:t,className:(0,i.cn)(l(),a),...n})});c.displayName=s.f.displayName},33804:function(e,t,a){"use strict";a.d(t,{RM:function(){return l},SC:function(){return c},iA:function(){return o},pj:function(){return u},ss:function(){return d},xD:function(){return i}});var r=a(57437),n=a(2265),s=a(93448);let o=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)("div",{className:"relative w-full overflow-auto",children:(0,r.jsx)("table",{ref:t,className:(0,s.cn)("w-full caption-bottom text-sm",a),...n})})});o.displayName="Table";let i=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)("thead",{ref:t,className:(0,s.cn)("[&_tr]:border-b",a),...n})});i.displayName="TableHeader";let l=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)("tbody",{ref:t,className:(0,s.cn)("[&_tr:last-child]:border-0",a),...n})});l.displayName="TableBody",n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)("tfoot",{ref:t,className:(0,s.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",a),...n})}).displayName="TableFooter";let c=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)("tr",{ref:t,className:(0,s.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",a),...n})});c.displayName="TableRow";let d=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)("th",{ref:t,className:(0,s.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",a),...n})});d.displayName="TableHead";let u=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)("td",{ref:t,className:(0,s.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",a),...n})});u.displayName="TableCell",n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)("caption",{ref:t,className:(0,s.cn)("mt-4 text-sm text-muted-foreground",a),...n})}).displayName="TableCaption"},71245:function(e,t,a){"use strict";a.d(t,{H:function(){return f},a:function(){return m}});var r=a(57437),n=a(43301),s=a(2265),o=a(99764),i=a(99376),l=a(5978);async function c(e){var t;let a=o.N$,r=null===(t=e.email)||void 0===t?void 0:t.toLowerCase().trim();if(!r)return{role:"none",companyId:null};let n=(0,l.IO)((0,l.hJ)(a,"invitacionesUsuarios"),(0,l.ar)("email","==",r),(0,l.ar)("estado","==","pendiente_auth"),(0,l.b9)(1)),s=await (0,l.PL)(n);if(s.empty)return console.log("No hay invitaci\xf3n pendiente para ".concat(r,".")),{role:"none",companyId:null};let i=s.docs[0],c=i.data(),d=(0,l.JU)(a,"users",e.uid),u=(0,l.qs)(a);return u.set(d,{nombre:c.nombre||e.displayName,email:r,role:c.roleDeseado,empresaId:c.empresaId,activo:!0,createdAt:(0,l.Bt)(),updatedAt:(0,l.Bt)()},{merge:!0}),u.update(i.ref,{estado:"activado",uid:e.uid,activatedAt:(0,l.Bt)()}),await u.commit(),console.log("Usuario ".concat(r," activado con rol ").concat(c.roleDeseado," en empresa ").concat(c.empresaId,".")),{role:c.roleDeseado,companyId:c.empresaId}}async function d(e){}let u=(0,s.createContext)(void 0);function f(e){let{children:t}=e,[a,f]=(0,s.useState)(null),[m,p]=(0,s.useState)("none"),[x,h]=(0,s.useState)(null),[v,y]=(0,s.useState)(null),[g,b]=(0,s.useState)(!0),j=(0,i.useRouter)(),N=(0,i.usePathname)();async function w(e,t){try{await (0,n.e5)(o.lX,e,t)}catch(e){if("auth/invalid-credential"===e.code||"auth/wrong-password"===e.code||"auth/user-not-found"===e.code)throw Error("Credenciales inv\xe1lidas. Por favor, revisa tu correo y contrase\xf1a.");if("auth/too-many-requests"===e.code)throw Error("Demasiados intentos fallidos. Por seguridad, el acceso desde este dispositivo ha sido bloqueado temporalmente.");throw console.error("Error de login no manejado:",e),Error("Ocurri\xf3 un error inesperado al iniciar sesi\xf3n.")}}async function S(){try{await (0,n.w7)(o.lX),f(null),p("none"),h(null),y(null),j.push("/")}catch(e){console.error("Error al cerrar sesi\xf3n",e)}}return(0,s.useEffect)(()=>{let e=(0,n.Aj)(o.lX,async e=>{if(e){await d(e);let t=(0,l.JU)(o.N$,"users",e.uid),a=await (0,l.QT)(t),r="none",n=null,s=!1;if(a.exists()){let e=a.data();e.role&&void 0!==e.empresaId&&(r=e.role,n=e.empresaId,s=!0===e.mustChangePassword)}if("none"===r){let t=await c(e);r=t.role,n=t.companyId,s=!0}p(r),h(n),f(e);let i="/cambiar-password"===N;if(s&&!i)j.replace("/cambiar-password");else if(!s){if("none"===r)j.replace("/sin-acceso");else if(N.startsWith("/login")||"/"===N||i){let e="cliente"===r?"/cliente":"contratista"===r?"/cumplimiento/contratista":"/dashboard";j.replace(e)}}}else f(null),p("none"),h(null),y(null);b(!1)});return()=>e()},[j,N]),(0,s.useEffect)(()=>{if(x){let e=(0,l.JU)(o.N$,"companies",x),t=(0,n.Aj)(o.lX,t=>{t&&(0,l.QT)(e).then(e=>{e.exists()?y({id:e.id,...e.data()}):y(null)})});return()=>t()}y(null)},[x]),(0,r.jsx)(u.Provider,{value:{user:a,role:m,companyId:x,company:v,loading:g,login:w,logout:S},children:t})}function m(){let e=(0,s.useContext)(u);if(!e)throw Error("useAuth debe usarse dentro de un AuthProvider");return e}},23340:function(e,t,a){"use strict";a.d(t,{pm:function(){return f}});var r=a(2265);let n=0,s=new Map,o=e=>{if(s.has(e))return;let t=setTimeout(()=>{s.delete(e),d({type:"REMOVE_TOAST",toastId:e})},1e6);s.set(e,t)},i=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:a}=t;return a?o(a):e.toasts.forEach(e=>{o(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===a||void 0===a?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},l=[],c={toasts:[]};function d(e){c=i(c,e),l.forEach(e=>{e(c)})}function u(e){let{...t}=e,a=(n=(n+1)%Number.MAX_SAFE_INTEGER).toString(),r=()=>d({type:"DISMISS_TOAST",toastId:a});return d({type:"ADD_TOAST",toast:{...t,id:a,open:!0,onOpenChange:e=>{e||r()}}}),{id:a,dismiss:r,update:e=>d({type:"UPDATE_TOAST",toast:{...e,id:a}})}}function f(){let[e,t]=r.useState(c);return r.useEffect(()=>(l.push(t),()=>{let e=l.indexOf(t);e>-1&&l.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>d({type:"DISMISS_TOAST",toastId:e})}}},99764:function(e,t,a){"use strict";let r,n,s,o,i;a.d(t,{IG:function(){return o},N$:function(){return s},lX:function(){return n},x2:function(){return i}});var l=a(738),c=a(43301),d=a(5978),u=a(60062),f=a(13491);let m={apiKey:"AIzaSyBfMp_dH9XhFSXEeMxY-Cdy8MDRIgWrxR0",authDomain:"pcg-2-8bf1b.firebaseapp.com",projectId:"pcg-2-8bf1b",storageBucket:"pcg-2-8bf1b.appspot.com",messagingSenderId:"1073834543546",appId:"1:1073834543546:web:2f85a4a8350280f8589737"};for(let e in m)if(Object.prototype.hasOwnProperty.call(m,e)&&!m[e]){let t=e.replace(/([A-Z])/g,"_$1").toUpperCase(),a="NEXT_PUBLIC_FIREBASE_".concat(t);throw Error("Error de configuraci\xf3n del cliente: La variable de entorno Firebase '".concat(a,"' no est\xe1 definida o est\xe1 vac\xeda. ")+"Aseg\xfarate de que est\xe9 configurada en tu archivo .env.local o en las variables de entorno de producci\xf3n.")}r=(0,l.C6)().length?(0,l.Mq)():(0,l.ZF)(m),n=(0,c.v0)(r),s=(0,d.ad)(r),o=(0,u.cF)(r),i=(0,f.$C)(r,"us-central1")},93448:function(e,t,a){"use strict";a.d(t,{cn:function(){return s}});var r=a(61994),n=a(53335);function s(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,n.m6)((0,r.W)(t))}},7880:function(e,t,a){"use strict";a.d(t,{aU:function(){return M},$j:function(){return Z},VY:function(){return O},dk:function(){return V},aV:function(){return z},h_:function(){return _},fC:function(){return I},Dx:function(){return P},xz:function(){return T}});var r=a(2265),n=a(73966),s=a(98575),o=a(70001),i=a(6741),l=a(57437),c=Symbol("radix.slottable"),d="AlertDialog",[u,f]=(0,n.b)(d,[o.p8]),m=(0,o.p8)(),p=e=>{let{__scopeAlertDialog:t,...a}=e,r=m(t);return(0,l.jsx)(o.fC,{...r,...a,modal:!0})};p.displayName=d;var x=r.forwardRef((e,t)=>{let{__scopeAlertDialog:a,...r}=e,n=m(a);return(0,l.jsx)(o.xz,{...n,...r,ref:t})});x.displayName="AlertDialogTrigger";var h=e=>{let{__scopeAlertDialog:t,...a}=e,r=m(t);return(0,l.jsx)(o.h_,{...r,...a})};h.displayName="AlertDialogPortal";var v=r.forwardRef((e,t)=>{let{__scopeAlertDialog:a,...r}=e,n=m(a);return(0,l.jsx)(o.aV,{...n,...r,ref:t})});v.displayName="AlertDialogOverlay";var y="AlertDialogContent",[g,b]=u(y),j=function(e){let t=({children:e})=>(0,l.jsx)(l.Fragment,{children:e});return t.displayName=`${e}.Slottable`,t.__radixId=c,t}("AlertDialogContent"),N=r.forwardRef((e,t)=>{let{__scopeAlertDialog:a,children:n,...c}=e,d=m(a),u=r.useRef(null),f=(0,s.e)(t,u),p=r.useRef(null);return(0,l.jsx)(o.jm,{contentName:y,titleName:w,docsSlug:"alert-dialog",children:(0,l.jsx)(g,{scope:a,cancelRef:p,children:(0,l.jsxs)(o.VY,{role:"alertdialog",...d,...c,ref:f,onOpenAutoFocus:(0,i.Mj)(c.onOpenAutoFocus,e=>{var t;e.preventDefault(),null===(t=p.current)||void 0===t||t.focus({preventScroll:!0})}),onPointerDownOutside:e=>e.preventDefault(),onInteractOutside:e=>e.preventDefault(),children:[(0,l.jsx)(j,{children:n}),(0,l.jsx)(A,{contentRef:u})]})})})});N.displayName=y;var w="AlertDialogTitle",S=r.forwardRef((e,t)=>{let{__scopeAlertDialog:a,...r}=e,n=m(a);return(0,l.jsx)(o.Dx,{...n,...r,ref:t})});S.displayName=w;var C="AlertDialogDescription",k=r.forwardRef((e,t)=>{let{__scopeAlertDialog:a,...r}=e,n=m(a);return(0,l.jsx)(o.dk,{...n,...r,ref:t})});k.displayName=C;var R=r.forwardRef((e,t)=>{let{__scopeAlertDialog:a,...r}=e,n=m(a);return(0,l.jsx)(o.x8,{...n,...r,ref:t})});R.displayName="AlertDialogAction";var D="AlertDialogCancel",E=r.forwardRef((e,t)=>{let{__scopeAlertDialog:a,...r}=e,{cancelRef:n}=b(D,a),i=m(a),c=(0,s.e)(t,n);return(0,l.jsx)(o.x8,{...i,...r,ref:c})});E.displayName=D;var A=e=>{let{contentRef:t}=e,a="`".concat(y,"` requires a description for the component to be accessible for screen reader users.\n\nYou can add a description to the `").concat(y,"` by passing a `").concat(C,"` component as a child, which also benefits sighted users by adding visible context to the dialog.\n\nAlternatively, you can use your own component as a description by assigning it an `id` and passing the same value to the `aria-describedby` prop in `").concat(y,"`. If the description is confusing or duplicative for sighted users, you can use the `@radix-ui/react-visually-hidden` primitive as a wrapper around your description component.\n\nFor more information, see https://radix-ui.com/primitives/docs/components/alert-dialog");return r.useEffect(()=>{var e;document.getElementById(null===(e=t.current)||void 0===e?void 0:e.getAttribute("aria-describedby"))||console.warn(a)},[a,t]),null},I=p,T=x,_=h,z=v,O=N,M=R,Z=E,P=S,V=k},370:function(e,t,a){"use strict";a.d(t,{f:function(){return l}});var r=a(2265);a(54887);var n=a(37053),s=a(57437),o=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,t)=>{let a=(0,n.Z8)(`Primitive.${t}`),o=r.forwardRef((e,r)=>{let{asChild:n,...o}=e,i=n?a:t;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,s.jsx)(i,{...o,ref:r})});return o.displayName=`Primitive.${t}`,{...e,[t]:o}},{}),i=r.forwardRef((e,t)=>(0,s.jsx)(o.label,{...e,ref:t,onMouseDown:t=>{var a;t.target.closest("button, input, select, textarea")||(null===(a=e.onMouseDown)||void 0===a||a.call(e,t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));i.displayName="Label";var l=i},5485:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(96471).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},54233:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(96471).Z)("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]])},53459:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(96471).Z)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},43728:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(96471).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},44986:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(96471).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])}},function(e){e.O(0,[4358,9990,6137,1211,2972,9759,3562,1,2971,2117,1744],function(){return e(e.s=49729)}),_N_E=e.O()}]);