(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1286,2087,5518],{59888:function(e,a,t){Promise.resolve().then(t.bind(t,12923))},12923:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return w}});var n=t(57437),r=t(2265),s=t(99376),l=t(12381),o=t(79820),i=t(74291),d=t(30767),c=t(40279),u=t(75060),f=t(33804),m=t(68245),p=t(69174),x=t(54233),h=t(15847),_=t(43728),b=t(27648),v=t(5978),j=t(99764),g=t(71245),y=t(23340);async function N(e,a){let t=(0,v.hJ)(e,a),n=(0,v.IO)(t),r=await (0,v.PL)(n);if(r.empty)return;let s=(0,v.qs)(e);r.docs.forEach(e=>{s.delete(e.ref)}),await s.commit()}function w(){let{role:e,loading:a}=(0,g.a)(),t="superadmin"===e,w=(0,s.useRouter)(),{toast:C}=(0,y.pm)(),[k,E]=(0,r.useState)([]),[S,I]=(0,r.useState)(!0),[R,A]=(0,r.useState)(null),[T,O]=(0,r.useState)(!1),[M,D]=(0,r.useState)(null),[z,P]=(0,r.useState)(!1);(0,r.useEffect)(()=>{a||t||w.replace("/dashboard")},[a,t,w]),(0,r.useEffect)(()=>{t&&e();async function e(){I(!0);try{let e=(0,v.IO)((0,v.hJ)(j.N$,"companies"),(0,v.Xo)("createdAt","desc")),a=(await (0,v.PL)(e)).docs.map(e=>({id:e.id,...e.data()}));E(a)}catch(e){console.error("Error fetching companies:",e),A("No se pudieron cargar las empresas.")}finally{I(!1)}}},[t]);let F=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;D(e||{nombreFantasia:"",razonSocial:"",rut:"",activa:!0,baseMensual:1e5,valorPorUsuario:35e3,feature_compliance_module_enabled:!1,feature_plan_analysis_enabled:!1,feature_plan_comparison_enabled:!1,feature_risk_prevention_enabled:!1,feature_operational_checklists_enabled:!1,feature_document_control_enabled:!1}),O(!0),A(null)},U=e=>{if(M){let{name:a,value:t,type:n,checked:r}=e.target,s="checkbox"===n?r:"number"===n?Number(t):t;D({...M,[a]:s})}},$=async e=>{if(e.preventDefault(),!M||!M.nombreFantasia||!M.razonSocial||!M.rut){A("Nombre de fantas\xeda, Raz\xf3n Social y RUT son obligatorios.");return}P(!0),A(null);let a={...M,baseMensual:M.baseMensual||1e5,valorPorUsuario:M.valorPorUsuario||35e3,feature_compliance_module_enabled:M.feature_compliance_module_enabled||!1,feature_plan_analysis_enabled:M.feature_plan_analysis_enabled||!1,feature_plan_comparison_enabled:M.feature_plan_comparison_enabled||!1,feature_risk_prevention_enabled:M.feature_risk_prevention_enabled||!1,feature_operational_checklists_enabled:M.feature_operational_checklists_enabled||!1,feature_document_control_enabled:M.feature_document_control_enabled||!1};try{if(M.id){let e=(0,v.JU)(j.N$,"companies",M.id);await (0,v.r7)(e,{...a,updatedAt:(0,v.Bt)()}),E(k.map(e=>e.id===M.id?{...e,...a}:e))}else{let e={id:(await (0,v.ET)((0,v.hJ)(j.N$,"companies"),{...a,createdAt:(0,v.Bt)(),updatedAt:(0,v.Bt)()})).id,...a,createdAt:new Date};E([e,...k])}O(!1)}catch(e){console.error("Error saving company:",e),A("No se pudo guardar la empresa.")}finally{P(!1)}},X=async e=>{if(!t){C({variant:"destructive",title:"Error",description:"No tienes permisos para eliminar empresas."});return}try{await N(j.N$,"companies/".concat(e,"/users"));let a=(0,v.hJ)(j.N$,"companies/".concat(e,"/obras"));for(let t of(await (0,v.PL)(a)).docs){let a=t.id;await N(j.N$,"companies/".concat(e,"/obras/").concat(a,"/actividades")),await N(j.N$,"companies/".concat(e,"/obras/").concat(a,"/avancesDiarios")),await (0,v.oe)((0,v.JU)(j.N$,"companies/".concat(e,"/obras"),a))}await (0,v.oe)((0,v.JU)(j.N$,"companies",e)),E(a=>a.filter(a=>a.id!==e)),C({title:"Empresa Eliminada",description:"La empresa y todos sus datos asociados han sido eliminados."})}catch(e){console.error("Error deleting company and its subcollections:",e),C({variant:"destructive",title:"Error",description:"No se pudo eliminar la empresa. Revisa la consola para m\xe1s detalles."})}};return!a&&(t||S)?(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("header",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"text-2xl font-bold",children:"Gesti\xf3n de Empresas"}),(0,n.jsx)("p",{className:"text-muted-foreground",children:"Crea, edita y administra las empresas en la plataforma."})]}),(0,n.jsxs)(l.z,{onClick:()=>F(),children:[(0,n.jsx)(x.Z,{className:"mr-2 h-4 w-4"}),"Nueva Empresa"]})]}),R&&!T&&(0,n.jsx)("p",{className:"text-sm font-medium text-destructive",children:R}),(0,n.jsxs)(o.Zb,{children:[(0,n.jsx)(o.Ol,{children:(0,n.jsx)(o.ll,{children:"Empresas Registradas"})}),(0,n.jsx)(o.aY,{children:(0,n.jsxs)(f.iA,{children:[(0,n.jsx)(f.xD,{children:(0,n.jsxs)(f.SC,{children:[(0,n.jsx)(f.ss,{children:"Nombre Fantas\xeda"}),(0,n.jsx)(f.ss,{children:"RUT"}),(0,n.jsx)(f.ss,{children:"M. Cumplimiento"}),(0,n.jsx)(f.ss,{children:"M. An\xe1lisis IA"}),(0,n.jsx)(f.ss,{children:"M. Comparaci\xf3n IA"}),(0,n.jsx)(f.ss,{children:"M. Prevenci\xf3n"}),(0,n.jsx)(f.ss,{children:"M. Checklists"}),(0,n.jsx)(f.ss,{children:"M. Documental"}),(0,n.jsx)(f.ss,{className:"text-right",children:"Acciones"})]})}),(0,n.jsx)(f.RM,{children:S?(0,n.jsx)(f.SC,{children:(0,n.jsx)(f.pj,{colSpan:9,className:"text-center h-24",children:"Cargando empresas..."})}):k.map(e=>(0,n.jsxs)(f.SC,{children:[(0,n.jsx)(f.pj,{className:"font-medium",children:e.nombreFantasia}),(0,n.jsx)(f.pj,{children:e.rut}),(0,n.jsx)(f.pj,{children:(0,n.jsx)(p.C,{variant:e.feature_compliance_module_enabled?"default":"outline",children:e.feature_compliance_module_enabled?"On":"Off"})}),(0,n.jsx)(f.pj,{children:(0,n.jsx)(p.C,{variant:e.feature_plan_analysis_enabled?"default":"outline",children:e.feature_plan_analysis_enabled?"On":"Off"})}),(0,n.jsx)(f.pj,{children:(0,n.jsx)(p.C,{variant:e.feature_plan_comparison_enabled?"default":"outline",children:e.feature_plan_comparison_enabled?"On":"Off"})}),(0,n.jsx)(f.pj,{children:(0,n.jsx)(p.C,{variant:e.feature_risk_prevention_enabled?"default":"outline",children:e.feature_risk_prevention_enabled?"On":"Off"})}),(0,n.jsx)(f.pj,{children:(0,n.jsx)(p.C,{variant:e.feature_operational_checklists_enabled?"default":"outline",children:e.feature_operational_checklists_enabled?"On":"Off"})}),(0,n.jsx)(f.pj,{children:(0,n.jsx)(p.C,{variant:e.feature_document_control_enabled?"default":"outline",children:e.feature_document_control_enabled?"On":"Off"})}),(0,n.jsx)(f.pj,{className:"text-right",children:(0,n.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,n.jsx)(l.z,{variant:"outline",size:"sm",asChild:!0,children:(0,n.jsx)(b.default,{href:"/admin/empresas/".concat(e.id,"/usuarios"),children:"Ver usuarios"})}),(0,n.jsx)(l.z,{variant:"ghost",size:"icon",onClick:()=>F(e),children:(0,n.jsx)(h.Z,{className:"h-4 w-4"})}),(0,n.jsxs)(d.aR,{children:[(0,n.jsx)(d.vW,{asChild:!0,children:(0,n.jsx)(l.z,{variant:"ghost",size:"icon",className:"text-destructive hover:text-destructive",children:(0,n.jsx)(_.Z,{className:"h-4 w-4"})})}),(0,n.jsxs)(d._T,{children:[(0,n.jsxs)(d.fY,{children:[(0,n.jsx)(d.f$,{children:"\xbfEliminar empresa?"}),(0,n.jsxs)(d.yT,{children:['Esta acci\xf3n no se puede deshacer. Se eliminar\xe1 permanentemente la empresa "',e.nombreFantasia,'" y todos sus datos asociados (usuarios, obras, etc.).']})]}),(0,n.jsxs)(d.xo,{children:[(0,n.jsx)(d.le,{children:"Cancelar"}),(0,n.jsx)(d.OL,{onClick:()=>X(e.id),className:"bg-destructive hover:bg-destructive/90",children:"Eliminar Permanentemente"})]})]})]})]})})]},e.id))})]})})]}),(0,n.jsx)(i.Vq,{open:T,onOpenChange:O,children:(0,n.jsx)(i.cZ,{className:"sm:max-w-2xl",children:(0,n.jsxs)("form",{onSubmit:$,children:[(0,n.jsx)(i.fK,{children:(0,n.jsx)(i.$N,{children:(null==M?void 0:M.id)?"Editar Empresa":"Crear Nueva Empresa"})}),(0,n.jsxs)("div",{className:"grid gap-4 py-4 md:grid-cols-2",children:[(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(u._,{children:"Nombre Fantas\xeda*"}),(0,n.jsx)(c.I,{name:"nombreFantasia",value:(null==M?void 0:M.nombreFantasia)||"",onChange:U})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(u._,{children:"Raz\xf3n Social*"}),(0,n.jsx)(c.I,{name:"razonSocial",value:(null==M?void 0:M.razonSocial)||"",onChange:U})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(u._,{children:"RUT*"}),(0,n.jsx)(c.I,{name:"rut",value:(null==M?void 0:M.rut)||"",onChange:U})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(u._,{children:"Giro"}),(0,n.jsx)(c.I,{name:"giro",value:(null==M?void 0:M.giro)||"",onChange:U})]}),(0,n.jsxs)("div",{className:"space-y-2 col-span-2",children:[(0,n.jsx)(u._,{children:"Direcci\xf3n"}),(0,n.jsx)(c.I,{name:"direccion",value:(null==M?void 0:M.direccion)||"",onChange:U})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(u._,{children:"Comuna"}),(0,n.jsx)(c.I,{name:"comuna",value:(null==M?void 0:M.comuna)||"",onChange:U})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(u._,{children:"Ciudad"}),(0,n.jsx)(c.I,{name:"ciudad",value:(null==M?void 0:M.ciudad)||"",onChange:U})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(u._,{children:"Tel\xe9fono Contacto"}),(0,n.jsx)(c.I,{name:"telefonoContacto",value:(null==M?void 0:M.telefonoContacto)||"",onChange:U})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(u._,{children:"Email Contacto"}),(0,n.jsx)(c.I,{name:"emailContacto",type:"email",value:(null==M?void 0:M.emailContacto)||"",onChange:U})]}),(0,n.jsxs)("div",{className:"col-span-2 border-t pt-4 mt-2 grid md:grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(u._,{children:"Monto Base Mensual"}),(0,n.jsx)(c.I,{name:"baseMensual",type:"number",value:(null==M?void 0:M.baseMensual)||1e5,onChange:U})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(u._,{children:"Valor por Usuario"}),(0,n.jsx)(c.I,{name:"valorPorUsuario",type:"number",value:(null==M?void 0:M.valorPorUsuario)||35e3,onChange:U})]})]}),(0,n.jsxs)("div",{className:"col-span-2 pt-4 border-t space-y-2",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(m.X,{id:"activa",name:"activa",checked:null==M?void 0:M.activa,onCheckedChange:e=>U({target:{name:"activa",value:"",type:"checkbox",checked:!!e}})}),(0,n.jsx)(u._,{htmlFor:"activa",children:"Empresa activa"})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(m.X,{id:"feature_compliance_module_enabled",name:"feature_compliance_module_enabled",checked:null==M?void 0:M.feature_compliance_module_enabled,onCheckedChange:e=>U({target:{name:"feature_compliance_module_enabled",value:"",type:"checkbox",checked:!!e}})}),(0,n.jsx)(u._,{htmlFor:"feature_compliance_module_enabled",children:"M\xf3dulo de Cumplimiento Legal (MCLP)"})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(m.X,{id:"feature_plan_analysis_enabled",name:"feature_plan_analysis_enabled",checked:null==M?void 0:M.feature_plan_analysis_enabled,onCheckedChange:e=>U({target:{name:"feature_plan_analysis_enabled",value:"",type:"checkbox",checked:!!e}})}),(0,n.jsx)(u._,{htmlFor:"feature_plan_analysis_enabled",children:"M\xf3dulo de An\xe1lisis de Planos IA"})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(m.X,{id:"feature_plan_comparison_enabled",name:"feature_plan_comparison_enabled",checked:null==M?void 0:M.feature_plan_comparison_enabled,onCheckedChange:e=>U({target:{name:"feature_plan_comparison_enabled",value:"",type:"checkbox",checked:!!e}})}),(0,n.jsx)(u._,{htmlFor:"feature_plan_comparison_enabled",children:"M\xf3dulo de Comparaci\xf3n de Planos IA"})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(m.X,{id:"feature_risk_prevention_enabled",name:"feature_risk_prevention_enabled",checked:null==M?void 0:M.feature_risk_prevention_enabled,onCheckedChange:e=>U({target:{name:"feature_risk_prevention_enabled",value:"",type:"checkbox",checked:!!e}})}),(0,n.jsx)(u._,{htmlFor:"feature_risk_prevention_enabled",children:"M\xf3dulo de Prevenci\xf3n de Riesgos"})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(m.X,{id:"feature_operational_checklists_enabled",name:"feature_operational_checklists_enabled",checked:null==M?void 0:M.feature_operational_checklists_enabled,onCheckedChange:e=>U({target:{name:"feature_operational_checklists_enabled",value:"",type:"checkbox",checked:!!e}})}),(0,n.jsx)(u._,{htmlFor:"feature_operational_checklists_enabled",children:"M\xf3dulo de Checklists Operacionales"})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(m.X,{id:"feature_document_control_enabled",name:"feature_document_control_enabled",checked:null==M?void 0:M.feature_document_control_enabled,onCheckedChange:e=>U({target:{name:"feature_document_control_enabled",value:"",type:"checkbox",checked:!!e}})}),(0,n.jsx)(u._,{htmlFor:"feature_document_control_enabled",children:"M\xf3dulo de Control Documental (ISO 9001)"})]})]}),R&&(0,n.jsx)("p",{className:"text-sm font-medium text-destructive col-span-2",children:R})]}),(0,n.jsxs)(i.cN,{children:[(0,n.jsx)(l.z,{type:"button",variant:"ghost",onClick:()=>O(!1),children:"Cancelar"}),(0,n.jsx)(l.z,{type:"submit",disabled:z,children:z?"Guardando...":"Guardar"})]})]})})})]}):(0,n.jsx)("div",{className:"p-8 text-center text-muted-foreground",children:"Verificando permisos..."})}},30767:function(e,a,t){"use strict";t.d(a,{OL:function(){return _},_T:function(){return f},aR:function(){return i},f$:function(){return x},fY:function(){return m},le:function(){return b},vW:function(){return d},xo:function(){return p},yT:function(){return h}});var n=t(57437),r=t(2265),s=t(7880),l=t(93448),o=t(12381);let i=s.fC,d=s.xz,c=s.h_,u=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,n.jsx)(s.aV,{className:(0,l.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...r,ref:a})});u.displayName=s.aV.displayName;let f=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,n.jsxs)(c,{children:[(0,n.jsx)(u,{}),(0,n.jsx)(s.VY,{ref:a,className:(0,l.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...r})]})});f.displayName=s.VY.displayName;let m=e=>{let{className:a,...t}=e;return(0,n.jsx)("div",{className:(0,l.cn)("flex flex-col space-y-2 text-center sm:text-left",a),...t})};m.displayName="AlertDialogHeader";let p=e=>{let{className:a,...t}=e;return(0,n.jsx)("div",{className:(0,l.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...t})};p.displayName="AlertDialogFooter";let x=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,n.jsx)(s.Dx,{ref:a,className:(0,l.cn)("text-lg font-semibold",t),...r})});x.displayName=s.Dx.displayName;let h=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,n.jsx)(s.dk,{ref:a,className:(0,l.cn)("text-sm text-muted-foreground",t),...r})});h.displayName=s.dk.displayName;let _=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,n.jsx)(s.aU,{ref:a,className:(0,l.cn)((0,o.d)(),t),...r})});_.displayName=s.aU.displayName;let b=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,n.jsx)(s.$j,{ref:a,className:(0,l.cn)((0,o.d)({variant:"outline"}),"mt-2 sm:mt-0",t),...r})});b.displayName=s.$j.displayName},69174:function(e,a,t){"use strict";t.d(a,{C:function(){return o}});var n=t(57437);t(2265);var r=t(90535),s=t(93448);let l=(0,r.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function o(e){let{className:a,variant:t,...r}=e;return(0,n.jsx)("div",{className:(0,s.cn)(l({variant:t}),a),...r})}},12381:function(e,a,t){"use strict";t.d(a,{d:function(){return i},z:function(){return d}});var n=t(57437),r=t(2265),s=t(37053),l=t(90535),o=t(93448);let i=(0,l.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=r.forwardRef((e,a)=>{let{className:t,variant:r,size:l,asChild:d=!1,...c}=e,u=d?s.g7:"button";return(0,n.jsx)(u,{className:(0,o.cn)(i({variant:r,size:l,className:t})),ref:a,...c})});d.displayName="Button"},79820:function(e,a,t){"use strict";t.d(a,{Ol:function(){return o},SZ:function(){return d},Zb:function(){return l},aY:function(){return c},eW:function(){return u},ll:function(){return i}});var n=t(57437),r=t(2265),s=t(93448);let l=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,n.jsx)("div",{ref:a,className:(0,s.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",t),...r})});l.displayName="Card";let o=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,n.jsx)("div",{ref:a,className:(0,s.cn)("flex flex-col space-y-1.5 p-6",t),...r})});o.displayName="CardHeader";let i=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,n.jsx)("div",{ref:a,className:(0,s.cn)("text-2xl font-semibold leading-none tracking-tight",t),...r})});i.displayName="CardTitle";let d=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,n.jsx)("div",{ref:a,className:(0,s.cn)("text-sm text-muted-foreground",t),...r})});d.displayName="CardDescription";let c=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,n.jsx)("div",{ref:a,className:(0,s.cn)("p-6 pt-0",t),...r})});c.displayName="CardContent";let u=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,n.jsx)("div",{ref:a,className:(0,s.cn)("flex items-center p-6 pt-0",t),...r})});u.displayName="CardFooter"},68245:function(e,a,t){"use strict";t.d(a,{X:function(){return i}});var n=t(57437),r=t(2265),s=t(9270),l=t(59559),o=t(93448);let i=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,n.jsx)(s.fC,{ref:a,className:(0,o.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",t),...r,children:(0,n.jsx)(s.z$,{className:(0,o.cn)("flex items-center justify-center text-current"),children:(0,n.jsx)(l.Z,{className:"h-4 w-4"})})})});i.displayName=s.fC.displayName},74291:function(e,a,t){"use strict";t.d(a,{$N:function(){return x},Be:function(){return h},Vq:function(){return i},cN:function(){return p},cZ:function(){return f},fK:function(){return m},hg:function(){return d}});var n=t(57437),r=t(2265),s=t(70001),l=t(44986),o=t(93448);let i=s.fC,d=s.xz,c=s.h_;s.x8;let u=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,n.jsx)(s.aV,{ref:a,className:(0,o.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...r})});u.displayName=s.aV.displayName;let f=r.forwardRef((e,a)=>{let{className:t,children:r,...i}=e;return(0,n.jsxs)(c,{children:[(0,n.jsx)(u,{}),(0,n.jsxs)(s.VY,{ref:a,className:(0,o.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...i,children:[r,(0,n.jsxs)(s.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,n.jsx)(l.Z,{className:"h-4 w-4"}),(0,n.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});f.displayName=s.VY.displayName;let m=e=>{let{className:a,...t}=e;return(0,n.jsx)("div",{className:(0,o.cn)("flex flex-col space-y-1.5 text-center sm:text-left",a),...t})};m.displayName="DialogHeader";let p=e=>{let{className:a,...t}=e;return(0,n.jsx)("div",{className:(0,o.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...t})};p.displayName="DialogFooter";let x=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,n.jsx)(s.Dx,{ref:a,className:(0,o.cn)("text-lg font-semibold leading-none tracking-tight",t),...r})});x.displayName=s.Dx.displayName;let h=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,n.jsx)(s.dk,{ref:a,className:(0,o.cn)("text-sm text-muted-foreground",t),...r})});h.displayName=s.dk.displayName},40279:function(e,a,t){"use strict";t.d(a,{I:function(){return l}});var n=t(57437),r=t(2265),s=t(93448);let l=r.forwardRef((e,a)=>{let{className:t,type:r,...l}=e;return(0,n.jsx)("input",{type:r,className:(0,s.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:a,...l})});l.displayName="Input"},75060:function(e,a,t){"use strict";t.d(a,{_:function(){return d}});var n=t(57437),r=t(2265),s=t(370),l=t(90535),o=t(93448);let i=(0,l.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,n.jsx)(s.f,{ref:a,className:(0,o.cn)(i(),t),...r})});d.displayName=s.f.displayName},33804:function(e,a,t){"use strict";t.d(a,{RM:function(){return i},SC:function(){return d},iA:function(){return l},pj:function(){return u},ss:function(){return c},xD:function(){return o}});var n=t(57437),r=t(2265),s=t(93448);let l=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,n.jsx)("div",{className:"relative w-full overflow-auto",children:(0,n.jsx)("table",{ref:a,className:(0,s.cn)("w-full caption-bottom text-sm",t),...r})})});l.displayName="Table";let o=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,n.jsx)("thead",{ref:a,className:(0,s.cn)("[&_tr]:border-b",t),...r})});o.displayName="TableHeader";let i=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,n.jsx)("tbody",{ref:a,className:(0,s.cn)("[&_tr:last-child]:border-0",t),...r})});i.displayName="TableBody",r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,n.jsx)("tfoot",{ref:a,className:(0,s.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",t),...r})}).displayName="TableFooter";let d=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,n.jsx)("tr",{ref:a,className:(0,s.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",t),...r})});d.displayName="TableRow";let c=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,n.jsx)("th",{ref:a,className:(0,s.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",t),...r})});c.displayName="TableHead";let u=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,n.jsx)("td",{ref:a,className:(0,s.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",t),...r})});u.displayName="TableCell",r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,n.jsx)("caption",{ref:a,className:(0,s.cn)("mt-4 text-sm text-muted-foreground",t),...r})}).displayName="TableCaption"},71245:function(e,a,t){"use strict";t.d(a,{H:function(){return f},a:function(){return m}});var n=t(57437),r=t(43301),s=t(2265),l=t(99764),o=t(99376),i=t(5978);async function d(e){var a;let t=l.N$,n=null===(a=e.email)||void 0===a?void 0:a.toLowerCase().trim();if(!n)return{role:"none",companyId:null};let r=(0,i.IO)((0,i.hJ)(t,"invitacionesUsuarios"),(0,i.ar)("email","==",n),(0,i.ar)("estado","==","pendiente_auth"),(0,i.b9)(1)),s=await (0,i.PL)(r);if(s.empty)return console.log("No hay invitaci\xf3n pendiente para ".concat(n,".")),{role:"none",companyId:null};let o=s.docs[0],d=o.data(),c=(0,i.JU)(t,"users",e.uid),u=(0,i.qs)(t);return u.set(c,{nombre:d.nombre||e.displayName,email:n,role:d.roleDeseado,empresaId:d.empresaId,activo:!0,createdAt:(0,i.Bt)(),updatedAt:(0,i.Bt)()},{merge:!0}),u.update(o.ref,{estado:"activado",uid:e.uid,activatedAt:(0,i.Bt)()}),await u.commit(),console.log("Usuario ".concat(n," activado con rol ").concat(d.roleDeseado," en empresa ").concat(d.empresaId,".")),{role:d.roleDeseado,companyId:d.empresaId}}async function c(e){}let u=(0,s.createContext)(void 0);function f(e){let{children:a}=e,[t,f]=(0,s.useState)(null),[m,p]=(0,s.useState)("none"),[x,h]=(0,s.useState)(null),[_,b]=(0,s.useState)(null),[v,j]=(0,s.useState)(!0),g=(0,o.useRouter)(),y=(0,o.usePathname)();async function N(e,a){try{await (0,r.e5)(l.lX,e,a)}catch(e){if("auth/invalid-credential"===e.code||"auth/wrong-password"===e.code||"auth/user-not-found"===e.code)throw Error("Credenciales inv\xe1lidas. Por favor, revisa tu correo y contrase\xf1a.");if("auth/too-many-requests"===e.code)throw Error("Demasiados intentos fallidos. Por seguridad, el acceso desde este dispositivo ha sido bloqueado temporalmente.");throw console.error("Error de login no manejado:",e),Error("Ocurri\xf3 un error inesperado al iniciar sesi\xf3n.")}}async function w(){try{await (0,r.w7)(l.lX),f(null),p("none"),h(null),b(null),g.push("/")}catch(e){console.error("Error al cerrar sesi\xf3n",e)}}return(0,s.useEffect)(()=>{let e=(0,r.Aj)(l.lX,async e=>{if(e){await c(e);let a=(0,i.JU)(l.N$,"users",e.uid),t=await (0,i.QT)(a),n="none",r=null,s=!1;if(t.exists()){let e=t.data();e.role&&void 0!==e.empresaId&&(n=e.role,r=e.empresaId,s=!0===e.mustChangePassword)}if("none"===n){let a=await d(e);n=a.role,r=a.companyId,s=!0}p(n),h(r),f(e);let o="/cambiar-password"===y;if(s&&!o)g.replace("/cambiar-password");else if(!s){if("none"===n)g.replace("/sin-acceso");else if(y.startsWith("/login")||"/"===y||o){let e="cliente"===n?"/cliente":"contratista"===n?"/cumplimiento/contratista":"/dashboard";g.replace(e)}}}else f(null),p("none"),h(null),b(null);j(!1)});return()=>e()},[g,y]),(0,s.useEffect)(()=>{if(x){let e=(0,i.JU)(l.N$,"companies",x),a=(0,r.Aj)(l.lX,a=>{a&&(0,i.QT)(e).then(e=>{e.exists()?b({id:e.id,...e.data()}):b(null)})});return()=>a()}b(null)},[x]),(0,n.jsx)(u.Provider,{value:{user:t,role:m,companyId:x,company:_,loading:v,login:N,logout:w},children:a})}function m(){let e=(0,s.useContext)(u);if(!e)throw Error("useAuth debe usarse dentro de un AuthProvider");return e}},23340:function(e,a,t){"use strict";t.d(a,{pm:function(){return f}});var n=t(2265);let r=0,s=new Map,l=e=>{if(s.has(e))return;let a=setTimeout(()=>{s.delete(e),c({type:"REMOVE_TOAST",toastId:e})},1e6);s.set(e,a)},o=(e,a)=>{switch(a.type){case"ADD_TOAST":return{...e,toasts:[a.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===a.toast.id?{...e,...a.toast}:e)};case"DISMISS_TOAST":{let{toastId:t}=a;return t?l(t):e.toasts.forEach(e=>{l(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===t||void 0===t?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===a.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==a.toastId)}}},i=[],d={toasts:[]};function c(e){d=o(d,e),i.forEach(e=>{e(d)})}function u(e){let{...a}=e,t=(r=(r+1)%Number.MAX_SAFE_INTEGER).toString(),n=()=>c({type:"DISMISS_TOAST",toastId:t});return c({type:"ADD_TOAST",toast:{...a,id:t,open:!0,onOpenChange:e=>{e||n()}}}),{id:t,dismiss:n,update:e=>c({type:"UPDATE_TOAST",toast:{...e,id:t}})}}function f(){let[e,a]=n.useState(d);return n.useEffect(()=>(i.push(a),()=>{let e=i.indexOf(a);e>-1&&i.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>c({type:"DISMISS_TOAST",toastId:e})}}},99764:function(e,a,t){"use strict";let n,r,s,l,o;t.d(a,{IG:function(){return l},N$:function(){return s},lX:function(){return r},x2:function(){return o}});var i=t(738),d=t(43301),c=t(5978),u=t(60062),f=t(13491);let m={apiKey:"AIzaSyBfMp_dH9XhFSXEeMxY-Cdy8MDRIgWrxR0",authDomain:"pcg-2-8bf1b.firebaseapp.com",projectId:"pcg-2-8bf1b",storageBucket:"pcg-2-8bf1b.appspot.com",messagingSenderId:"1073834543546",appId:"1:1073834543546:web:2f85a4a8350280f8589737"};for(let e in m)if(Object.prototype.hasOwnProperty.call(m,e)&&!m[e]){let a=e.replace(/([A-Z])/g,"_$1").toUpperCase(),t="NEXT_PUBLIC_FIREBASE_".concat(a);throw Error("Error de configuraci\xf3n del cliente: La variable de entorno Firebase '".concat(t,"' no est\xe1 definida o est\xe1 vac\xeda. ")+"Aseg\xfarate de que est\xe9 configurada en tu archivo .env.local o en las variables de entorno de producci\xf3n.")}n=(0,i.C6)().length?(0,i.Mq)():(0,i.ZF)(m),r=(0,d.v0)(n),s=(0,c.ad)(n),l=(0,u.cF)(n),o=(0,f.$C)(n,"us-central1")},93448:function(e,a,t){"use strict";t.d(a,{cn:function(){return s}});var n=t(61994),r=t(53335);function s(){for(var e=arguments.length,a=Array(e),t=0;t<e;t++)a[t]=arguments[t];return(0,r.m6)((0,n.W)(a))}}},function(e){e.O(0,[4358,9990,6137,1211,2972,9759,3562,1,6293,2971,2117,1744],function(){return e(e.s=59888)}),_N_E=e.O()}]);