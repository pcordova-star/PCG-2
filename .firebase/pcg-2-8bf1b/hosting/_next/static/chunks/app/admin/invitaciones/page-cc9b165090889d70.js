(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7286,2087,5284,5518],{54992:function(e,a,t){Promise.resolve().then(t.bind(t,91773))},91773:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return I}});var r=t(57437),n=t(2265),s=t(12381),i=t(79820),o=t(74291),l=t(30767),d=t(40279),c=t(75060),u=t(33804),f=t(15291),m=t(69174),p=t(53459),x=t(5485),h=t(54233),v=t(43728),g=t(66314),j=t(5978),y=t(99764),b=t(23340),N=t(71245),w=t(25566);async function C(e){var a,t;if(!e.email||!e.empresaId||!e.roleDeseado)throw Error("El email, la empresa y el rol son obligatorios.");let r=(0,j.hJ)(y.N$,"invitacionesUsuarios"),n=function(e,a){var t,r;let n=null!==(r=null!==(t=w.env.APP_BASE_URL)&&void 0!==t?t:w.env.NEXT_PUBLIC_APP_BASE_URL)&&void 0!==r?r:"http://localhost:3000";if(!n)throw Error("La URL base de la aplicaci\xf3n no est\xe1 configurada en las variables de entorno.");let s=n.replace(/\/+$/,"");return"".concat(s,"/accept-invite?invId=").concat(encodeURIComponent(e),"&email=").concat(encodeURIComponent(a))}((await (0,j.ET)(r,{email:e.email.toLowerCase().trim(),empresaId:e.empresaId,empresaNombre:e.empresaNombre,roleDeseado:e.roleDeseado,estado:"pendiente",creadoPorUid:e.creadoPorUid||"sistema",createdAt:(0,j.Bt)()})).id,e.email),s=null!==(t=null!==(a=w.env.APP_BASE_URL)&&void 0!==a?a:w.env.NEXT_PUBLIC_APP_BASE_URL)&&void 0!==t?t:"http://localhost:3000",i="".concat(s,"/logo.png"),o=(0,j.hJ)(y.N$,"mail");await (0,j.ET)(o,{to:[e.email],message:{subject:"Invitaci\xf3n para unirte a ".concat(e.empresaNombre," en PCG"),html:"\n            <div style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol'; max-width: 600px; margin: auto; padding: 20px; border: 1px solid #e2e8f0; border-radius: 8px; color: #334155;\">\n            <img src=\"".concat(i,'" alt="Logo PCG" style="max-width: 80px; margin-bottom: 24px;">\n            <h2 style="font-size: 24px; color: #1e293b; margin-top: 0;">\uD83D\uDE80 \xa1Bienvenido a PCG!</h2>\n            <p style="font-size: 16px; line-height: 1.5;">La empresa <strong>').concat(e.empresaNombre,'</strong> ha habilitado tu acceso a <strong>PCG</strong>, la plataforma profesional donde se centraliza y gestiona toda la informaci\xf3n operativa, documental y estrat\xe9gica de tus obras.</p>\n            \n            <div style="background-color: #f1f5f9; padding: 12px; border-radius: 8px; margin: 24px 0;">\n                <p style="margin: 0; font-size: 16px;">\uD83C\uDFAF Tu rol asignado: <strong style="color: #4f46e5;">').concat(e.roleDeseado.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()),'</strong></p>\n            </div>\n            \n            <p style="font-size: 16px; line-height: 1.5;">Este acceso te permitir\xe1 administrar equipos, supervisar obras, gestionar avances, revisar documentaci\xf3n y acceder a reportes clave en tiempo real.</p>\n            \n            <h3 style="font-size: 20px; color: #1e293b; margin-top: 32px;">\uD83D\uDD10 Activa tu cuenta</h3>\n            <p style="font-size: 16px; line-height: 1.5;">Haz clic en el siguiente bot\xf3n para acceder a tu panel personalizado y comenzar a utilizar todas las herramientas de PCG:</p>\n            \n            <a href="').concat(n,'" style="display: inline-block; background-color: #4338ca; color: white; padding: 14px 24px; text-decoration: none; border-radius: 8px; margin: 16px 0; font-weight: 600;">Activar mi cuenta y acceder a PCG</a>\n            \n            <p style="font-size: 14px; color: #64748b;">Si el bot\xf3n no funciona, copia y pega el siguiente enlace en tu navegador:</p>\n            <p style="font-size: 12px; word-break: break-all; color: #475569;">').concat(n,'</p>\n            \n            <hr style="border: none; border-top: 1px solid #e2e8f0; margin: 32px 0;">\n\n            <p style="font-size:14px;"><strong>Acceso directo a la plataforma:</strong></p>\n            <p style="font-size:12px;">Puedes acceder directamente a la plataforma en cualquier momento desde esta direcci\xf3n:</p>\n            <p><a href="').concat(s,'">').concat(s,'</a></p>\n            <p style="font-size:12px;"><strong>Sugerencia:</strong> Guarda esta direcci\xf3n en tus favoritos o crea un acceso directo en tu escritorio para facilitar tu ingreso.</p>\n            \n            <p style="font-size: 14px; color: #64748b;">\uD83D\uDCAC Si tienes dudas o necesitas soporte, comun\xedcate con el administrador de tu empresa.</p>\n            </div>\n        ')}})}var S=t(99376),E=t(27648),R=t(68245);function I(){let{role:e,loading:a}=(0,N.a)(),t=(0,S.useRouter)(),{toast:w}=(0,b.pm)(),[I,_]=(0,n.useState)([]),[A,z]=(0,n.useState)([]),[D,T]=(0,n.useState)(!0),[k,P]=(0,n.useState)(null),[U,O]=(0,n.useState)("all"),[B,Z]=(0,n.useState)("all"),[F,L]=(0,n.useState)(new Set),[$,V]=(0,n.useState)(!1),[M,X]=(0,n.useState)(!1),[Q,Y]=(0,n.useState)({email:"",companyId:"",role:"jefe_obra"});(0,n.useEffect)(()=>{a||"superadmin"===e||t.replace("/dashboard")},[a,e,t]),(0,n.useEffect)(()=>{if("superadmin"!==e)return;T(!0);let a=async()=>{let e=(0,j.hJ)(y.N$,"companies");try{let a=(await (0,j.PL)((0,j.IO)(e,(0,j.Xo)("nombreFantasia")))).docs.map(e=>({id:e.id,...e.data()}));_(a)}catch(e){console.error("Error fetching companies:",e),P("No se pudieron cargar las empresas.")}},t=(0,j.cf)((0,j.IO)((0,j.hJ)(y.N$,"invitacionesUsuarios")),e=>{let a=e.docs.map(e=>{var a;return{id:e.id,...e.data(),createdAt:null===(a=e.data().createdAt)||void 0===a?void 0:a.toDate()}});a.sort((e,a)=>{let t=e.createdAt instanceof Date?e.createdAt.getTime():0;return(a.createdAt instanceof Date?a.createdAt.getTime():0)-t}),z(a),T(!1)},e=>{console.error("Error fetching invitations:",e),P("No se pudieron cargar las invitaciones."),T(!1)});return a(),()=>{t()}},[e]);let G=(0,n.useMemo)(()=>A.filter(e=>{let a="all"===U||e.empresaId===U,t="all"===B||e.estado===B;return a&&t}),[A,U,B]),J=async e=>{if(e.preventDefault(),!Q.email||!Q.companyId||!Q.role){w({variant:"destructive",title:"Error",description:"Todos los campos son obligatorios."});return}X(!0);let a=I.find(e=>e.id===Q.companyId);if(!a){w({variant:"destructive",title:"Error",description:"La empresa seleccionada no es v\xe1lida."}),X(!1);return}try{await C({email:Q.email,empresaId:a.id,empresaNombre:a.nombreFantasia||a.razonSocial,roleDeseado:Q.role}),w({title:"Invitaci\xf3n Enviada",description:"Se ha enviado una invitaci\xf3n a ".concat(Q.email,".")}),V(!1),Y({email:"",companyId:"",role:"jefe_obra"})}catch(e){console.error("Error creating invitation:",e),w({variant:"destructive",title:"Error al invitar",description:e.message||"No se pudo enviar la invitaci\xf3n."})}finally{X(!1)}},q=async e=>{try{await C({email:e.email,empresaId:e.empresaId,empresaNombre:e.empresaNombre,roleDeseado:e.roleDeseado}),w({title:"Invitaci\xf3n Reenviada"})}catch(e){w({variant:"destructive",title:"Error",description:"No se pudo reenviar la invitaci\xf3n."})}},H=async e=>{try{let a=(0,j.JU)(y.N$,"invitacionesUsuarios",e);await (0,j.r7)(a,{estado:"revocada"}),w({title:"Invitaci\xf3n Revocada"})}catch(e){w({variant:"destructive",title:"Error",description:"No se pudo revocar la invitaci\xf3n."})}},W=async e=>{if(0!==e.size)try{let a=(0,j.qs)(y.N$);e.forEach(e=>{let t=(0,j.JU)(y.N$,"invitacionesUsuarios",e);a.delete(t)}),await a.commit(),w({title:"Eliminaci\xf3n exitosa",description:"Se eliminaron ".concat(e.size," invitaciones.")}),L(new Set)}catch(e){w({variant:"destructive",title:"Error al eliminar",description:"No se pudieron eliminar las invitaciones seleccionadas."})}};return D?(0,r.jsxs)("div",{className:"p-8 text-center",children:[(0,r.jsx)(p.Z,{className:"animate-spin"})," Cargando invitaciones..."]}):k?(0,r.jsx)("div",{className:"p-8 text-center text-destructive",children:k}):(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("header",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)(s.z,{variant:"outline",size:"sm",asChild:!0,children:(0,r.jsxs)(E.default,{href:"/admin/dashboard",children:[(0,r.jsx)(x.Z,{className:"mr-2 h-4 w-4"}),"Volver al Dashboard"]})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-2xl font-bold",children:"Gesti\xf3n de Usuarios e Invitaciones"}),(0,r.jsx)("p",{className:"text-muted-foreground",children:"Supervisa, invita y gestiona todos los usuarios de la plataforma."})]})]}),(0,r.jsxs)(s.z,{onClick:()=>V(!0),children:[(0,r.jsx)(h.Z,{className:"mr-2 h-4 w-4"}),"Invitar Usuario"]})]}),(0,r.jsxs)(i.Zb,{children:[(0,r.jsx)(i.Ol,{children:(0,r.jsx)(i.ll,{children:"Filtros"})}),(0,r.jsxs)(i.aY,{className:"flex flex-col md:flex-row gap-4",children:[(0,r.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,r.jsx)(c._,{children:"Filtrar por Empresa"}),(0,r.jsxs)(f.Ph,{value:U,onValueChange:O,children:[(0,r.jsx)(f.i4,{children:(0,r.jsx)(f.ki,{})}),(0,r.jsxs)(f.Bw,{children:[(0,r.jsx)(f.Ql,{value:"all",children:"Todas las empresas"}),I.map(e=>(0,r.jsx)(f.Ql,{value:e.id,children:e.nombreFantasia||e.razonSocial},e.id))]})]})]}),(0,r.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,r.jsx)(c._,{children:"Filtrar por Estado"}),(0,r.jsxs)(f.Ph,{value:B,onValueChange:Z,children:[(0,r.jsx)(f.i4,{children:(0,r.jsx)(f.ki,{})}),(0,r.jsxs)(f.Bw,{children:[(0,r.jsx)(f.Ql,{value:"all",children:"Todos los estados"}),(0,r.jsx)(f.Ql,{value:"pendiente",children:"Pendiente"}),(0,r.jsx)(f.Ql,{value:"aceptada",children:"Aceptada"}),(0,r.jsx)(f.Ql,{value:"revocada",children:"Revocada"})]})]})]})]})]}),(0,r.jsxs)(i.Zb,{children:[(0,r.jsxs)(i.Ol,{className:"flex flex-row justify-between items-center",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(i.ll,{children:"Listado Global de Invitaciones"}),(0,r.jsxs)(i.SZ,{children:["Mostrando ",G.length," de ",A.length," invitaciones totales."]})]}),F.size>0&&(0,r.jsxs)(l.aR,{children:[(0,r.jsx)(l.vW,{asChild:!0,children:(0,r.jsxs)(s.z,{variant:"destructive",children:[(0,r.jsx)(v.Z,{className:"mr-2 h-4 w-4"}),"Eliminar (",F.size,")"]})}),(0,r.jsxs)(l._T,{children:[(0,r.jsxs)(l.fY,{children:[(0,r.jsxs)(l.f$,{children:["\xbfEliminar ",F.size," invitaciones?"]}),(0,r.jsx)(l.yT,{children:"Esta acci\xf3n no se puede deshacer."})]}),(0,r.jsxs)(l.xo,{children:[(0,r.jsx)(l.le,{children:"Cancelar"}),(0,r.jsx)(l.OL,{onClick:()=>W(F),children:"Eliminar"})]})]})]})]}),(0,r.jsx)(i.aY,{children:(0,r.jsxs)(u.iA,{children:[(0,r.jsx)(u.xD,{children:(0,r.jsxs)(u.SC,{children:[(0,r.jsx)(u.ss,{className:"w-10",children:(0,r.jsx)(R.X,{onCheckedChange:e=>{e?L(new Set(G.map(e=>e.id))):L(new Set)}})}),(0,r.jsx)(u.ss,{children:"Email"}),(0,r.jsx)(u.ss,{children:"Empresa"}),(0,r.jsx)(u.ss,{children:"Rol Asignado"}),(0,r.jsx)(u.ss,{children:"Estado"}),(0,r.jsx)(u.ss,{children:"Fecha"}),(0,r.jsx)(u.ss,{className:"text-right",children:"Acciones"})]})}),(0,r.jsx)(u.RM,{children:0===G.length?(0,r.jsx)(u.SC,{children:(0,r.jsx)(u.pj,{colSpan:7,className:"text-center h-24",children:"No hay invitaciones que coincidan con los filtros."})}):G.map(e=>(0,r.jsxs)(u.SC,{children:[(0,r.jsx)(u.pj,{children:(0,r.jsx)(R.X,{checked:F.has(e.id),onCheckedChange:a=>{L(t=>{let r=new Set(t);return a?r.add(e.id):r.delete(e.id),r})}})}),(0,r.jsx)(u.pj,{className:"font-medium",children:e.email}),(0,r.jsx)(u.pj,{children:e.empresaNombre}),(0,r.jsx)(u.pj,{children:(0,r.jsx)(m.C,{variant:"outline",children:e.roleDeseado})}),(0,r.jsx)(u.pj,{children:(0,r.jsx)(m.C,{variant:"pendiente"===e.estado?"secondary":"revocada"===e.estado?"destructive":"default",children:e.estado})}),(0,r.jsx)(u.pj,{children:e.createdAt?new Date(e.createdAt).toLocaleDateString():"N/A"}),(0,r.jsx)(u.pj,{className:"text-right",children:(0,r.jsxs)("div",{className:"flex gap-1 justify-end",children:["pendiente"===e.estado&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.z,{variant:"ghost",size:"icon",onClick:()=>q(e),title:"Reenviar invitaci\xf3n",children:(0,r.jsx)(g.Z,{className:"h-4 w-4"})}),(0,r.jsxs)(l.aR,{children:[(0,r.jsx)(l.vW,{asChild:!0,children:(0,r.jsx)(s.z,{variant:"ghost",size:"icon",className:"text-destructive",title:"Revocar invitaci\xf3n",children:(0,r.jsx)(v.Z,{className:"h-4 w-4"})})}),(0,r.jsxs)(l._T,{children:[(0,r.jsxs)(l.fY,{children:[(0,r.jsx)(l.f$,{children:"\xbfRevocar invitaci\xf3n?"}),(0,r.jsxs)(l.yT,{children:["La invitaci\xf3n para ",e.email," ser\xe1 invalidada."]})]}),(0,r.jsxs)(l.xo,{children:[(0,r.jsx)(l.le,{children:"Cancelar"}),(0,r.jsx)(l.OL,{onClick:()=>H(e.id),className:"bg-destructive hover:bg-destructive/90",children:"Revocar"})]})]})]})]}),"revocada"===e.estado&&(0,r.jsxs)(l.aR,{children:[(0,r.jsx)(l.vW,{asChild:!0,children:(0,r.jsx)(s.z,{variant:"ghost",size:"icon",className:"text-destructive",title:"Eliminar invitaci\xf3n",children:(0,r.jsx)(v.Z,{className:"h-4 w-4"})})}),(0,r.jsxs)(l._T,{children:[(0,r.jsxs)(l.fY,{children:[(0,r.jsx)(l.f$,{children:"\xbfEliminar permanentemente?"}),(0,r.jsxs)(l.yT,{children:["La invitaci\xf3n para ",e.email," ser\xe1 borrada de la base de datos."]})]}),(0,r.jsxs)(l.xo,{children:[(0,r.jsx)(l.le,{children:"Cancelar"}),(0,r.jsx)(l.OL,{onClick:()=>W(new Set([e.id])),className:"bg-destructive hover:bg-destructive/90",children:"Eliminar"})]})]})]})]})})]},e.id))})]})})]}),(0,r.jsx)(o.Vq,{open:$,onOpenChange:V,children:(0,r.jsx)(o.cZ,{children:(0,r.jsxs)("form",{onSubmit:J,children:[(0,r.jsxs)(o.fK,{children:[(0,r.jsx)(o.$N,{children:"Invitar Nuevo Usuario"}),(0,r.jsx)(o.Be,{children:"Seleccione la empresa, el rol e ingrese el email del nuevo usuario."})]}),(0,r.jsxs)("div",{className:"py-4 grid gap-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(c._,{htmlFor:"new-inv-company",children:"Empresa*"}),(0,r.jsxs)(f.Ph,{value:Q.companyId,onValueChange:e=>Y(a=>({...a,companyId:e})),children:[(0,r.jsx)(f.i4,{id:"new-inv-company",children:(0,r.jsx)(f.ki,{placeholder:"Seleccione una empresa"})}),(0,r.jsx)(f.Bw,{children:I.map(e=>(0,r.jsx)(f.Ql,{value:e.id,children:e.nombreFantasia||e.razonSocial},e.id))})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(c._,{htmlFor:"new-inv-email",children:"Email del usuario*"}),(0,r.jsx)(d.I,{id:"new-inv-email",type:"email",value:Q.email,onChange:e=>Y(a=>({...a,email:e.target.value}))})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(c._,{htmlFor:"new-inv-role",children:"Rol en la Empresa*"}),(0,r.jsxs)(f.Ph,{value:Q.role,onValueChange:e=>Y(a=>({...a,role:e})),children:[(0,r.jsx)(f.i4,{id:"new-inv-role",children:(0,r.jsx)(f.ki,{placeholder:"Seleccione un rol"})}),(0,r.jsxs)(f.Bw,{children:[(0,r.jsx)(f.Ql,{value:"admin_empresa",children:"Admin Empresa"}),(0,r.jsx)(f.Ql,{value:"jefe_obra",children:"Jefe de Obra"}),(0,r.jsx)(f.Ql,{value:"prevencionista",children:"Prevencionista"}),(0,r.jsx)(f.Ql,{value:"cliente",children:"Cliente (Solo lectura)"})]})]})]})]}),(0,r.jsxs)(o.cN,{children:[(0,r.jsx)(s.z,{type:"button",variant:"ghost",onClick:()=>V(!1),children:"Cancelar"}),(0,r.jsxs)(s.z,{type:"submit",disabled:M,children:[M&&(0,r.jsx)(p.Z,{className:"mr-2 h-4 w-4 animate-spin"}),M?"Enviando...":"Enviar Invitaci\xf3n"]})]})]})})})]})}},30767:function(e,a,t){"use strict";t.d(a,{OL:function(){return v},_T:function(){return f},aR:function(){return l},f$:function(){return x},fY:function(){return m},le:function(){return g},vW:function(){return d},xo:function(){return p},yT:function(){return h}});var r=t(57437),n=t(2265),s=t(7880),i=t(93448),o=t(12381);let l=s.fC,d=s.xz,c=s.h_,u=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)(s.aV,{className:(0,i.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...n,ref:a})});u.displayName=s.aV.displayName;let f=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsxs)(c,{children:[(0,r.jsx)(u,{}),(0,r.jsx)(s.VY,{ref:a,className:(0,i.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...n})]})});f.displayName=s.VY.displayName;let m=e=>{let{className:a,...t}=e;return(0,r.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-2 text-center sm:text-left",a),...t})};m.displayName="AlertDialogHeader";let p=e=>{let{className:a,...t}=e;return(0,r.jsx)("div",{className:(0,i.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...t})};p.displayName="AlertDialogFooter";let x=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)(s.Dx,{ref:a,className:(0,i.cn)("text-lg font-semibold",t),...n})});x.displayName=s.Dx.displayName;let h=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)(s.dk,{ref:a,className:(0,i.cn)("text-sm text-muted-foreground",t),...n})});h.displayName=s.dk.displayName;let v=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)(s.aU,{ref:a,className:(0,i.cn)((0,o.d)(),t),...n})});v.displayName=s.aU.displayName;let g=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)(s.$j,{ref:a,className:(0,i.cn)((0,o.d)({variant:"outline"}),"mt-2 sm:mt-0",t),...n})});g.displayName=s.$j.displayName},69174:function(e,a,t){"use strict";t.d(a,{C:function(){return o}});var r=t(57437);t(2265);var n=t(90535),s=t(93448);let i=(0,n.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function o(e){let{className:a,variant:t,...n}=e;return(0,r.jsx)("div",{className:(0,s.cn)(i({variant:t}),a),...n})}},12381:function(e,a,t){"use strict";t.d(a,{d:function(){return l},z:function(){return d}});var r=t(57437),n=t(2265),s=t(37053),i=t(90535),o=t(93448);let l=(0,i.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=n.forwardRef((e,a)=>{let{className:t,variant:n,size:i,asChild:d=!1,...c}=e,u=d?s.g7:"button";return(0,r.jsx)(u,{className:(0,o.cn)(l({variant:n,size:i,className:t})),ref:a,...c})});d.displayName="Button"},79820:function(e,a,t){"use strict";t.d(a,{Ol:function(){return o},SZ:function(){return d},Zb:function(){return i},aY:function(){return c},eW:function(){return u},ll:function(){return l}});var r=t(57437),n=t(2265),s=t(93448);let i=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)("div",{ref:a,className:(0,s.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",t),...n})});i.displayName="Card";let o=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)("div",{ref:a,className:(0,s.cn)("flex flex-col space-y-1.5 p-6",t),...n})});o.displayName="CardHeader";let l=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)("div",{ref:a,className:(0,s.cn)("text-2xl font-semibold leading-none tracking-tight",t),...n})});l.displayName="CardTitle";let d=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)("div",{ref:a,className:(0,s.cn)("text-sm text-muted-foreground",t),...n})});d.displayName="CardDescription";let c=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)("div",{ref:a,className:(0,s.cn)("p-6 pt-0",t),...n})});c.displayName="CardContent";let u=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)("div",{ref:a,className:(0,s.cn)("flex items-center p-6 pt-0",t),...n})});u.displayName="CardFooter"},68245:function(e,a,t){"use strict";t.d(a,{X:function(){return l}});var r=t(57437),n=t(2265),s=t(9270),i=t(59559),o=t(93448);let l=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)(s.fC,{ref:a,className:(0,o.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",t),...n,children:(0,r.jsx)(s.z$,{className:(0,o.cn)("flex items-center justify-center text-current"),children:(0,r.jsx)(i.Z,{className:"h-4 w-4"})})})});l.displayName=s.fC.displayName},74291:function(e,a,t){"use strict";t.d(a,{$N:function(){return x},Be:function(){return h},Vq:function(){return l},cN:function(){return p},cZ:function(){return f},fK:function(){return m},hg:function(){return d}});var r=t(57437),n=t(2265),s=t(70001),i=t(44986),o=t(93448);let l=s.fC,d=s.xz,c=s.h_;s.x8;let u=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)(s.aV,{ref:a,className:(0,o.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...n})});u.displayName=s.aV.displayName;let f=n.forwardRef((e,a)=>{let{className:t,children:n,...l}=e;return(0,r.jsxs)(c,{children:[(0,r.jsx)(u,{}),(0,r.jsxs)(s.VY,{ref:a,className:(0,o.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...l,children:[n,(0,r.jsxs)(s.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,r.jsx)(i.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});f.displayName=s.VY.displayName;let m=e=>{let{className:a,...t}=e;return(0,r.jsx)("div",{className:(0,o.cn)("flex flex-col space-y-1.5 text-center sm:text-left",a),...t})};m.displayName="DialogHeader";let p=e=>{let{className:a,...t}=e;return(0,r.jsx)("div",{className:(0,o.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...t})};p.displayName="DialogFooter";let x=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)(s.Dx,{ref:a,className:(0,o.cn)("text-lg font-semibold leading-none tracking-tight",t),...n})});x.displayName=s.Dx.displayName;let h=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)(s.dk,{ref:a,className:(0,o.cn)("text-sm text-muted-foreground",t),...n})});h.displayName=s.dk.displayName},40279:function(e,a,t){"use strict";t.d(a,{I:function(){return i}});var r=t(57437),n=t(2265),s=t(93448);let i=n.forwardRef((e,a)=>{let{className:t,type:n,...i}=e;return(0,r.jsx)("input",{type:n,className:(0,s.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:a,...i})});i.displayName="Input"},75060:function(e,a,t){"use strict";t.d(a,{_:function(){return d}});var r=t(57437),n=t(2265),s=t(370),i=t(90535),o=t(93448);let l=(0,i.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)(s.f,{ref:a,className:(0,o.cn)(l(),t),...n})});d.displayName=s.f.displayName},15291:function(e,a,t){"use strict";t.d(a,{Bw:function(){return x},Ph:function(){return c},Ql:function(){return h},i4:function(){return f},ki:function(){return u}});var r=t(57437),n=t(2265),s=t(74797),i=t(3289),o=t(47969),l=t(59559),d=t(93448);let c=s.fC;s.ZA;let u=s.B4,f=n.forwardRef((e,a)=>{let{className:t,children:n,...o}=e;return(0,r.jsxs)(s.xz,{ref:a,className:(0,d.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...o,children:[n,(0,r.jsx)(s.JO,{asChild:!0,children:(0,r.jsx)(i.Z,{className:"h-4 w-4 opacity-50"})})]})});f.displayName=s.xz.displayName;let m=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)(s.u_,{ref:a,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",t),...n,children:(0,r.jsx)(o.Z,{className:"h-4 w-4"})})});m.displayName=s.u_.displayName;let p=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)(s.$G,{ref:a,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",t),...n,children:(0,r.jsx)(i.Z,{className:"h-4 w-4"})})});p.displayName=s.$G.displayName;let x=n.forwardRef((e,a)=>{let{className:t,children:n,position:i="popper",...o}=e;return(0,r.jsx)(s.h_,{children:(0,r.jsxs)(s.VY,{ref:a,className:(0,d.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===i&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:i,...o,children:[(0,r.jsx)(m,{}),(0,r.jsx)(s.l_,{className:(0,d.cn)("p-1","popper"===i&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:n}),(0,r.jsx)(p,{})]})})});x.displayName=s.VY.displayName,n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)(s.__,{ref:a,className:(0,d.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",t),...n})}).displayName=s.__.displayName;let h=n.forwardRef((e,a)=>{let{className:t,children:n,...i}=e;return(0,r.jsxs)(s.ck,{ref:a,className:(0,d.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...i,children:[(0,r.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,r.jsx)(s.wU,{children:(0,r.jsx)(l.Z,{className:"h-4 w-4"})})}),(0,r.jsx)(s.eT,{children:n})]})});h.displayName=s.ck.displayName,n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)(s.Z0,{ref:a,className:(0,d.cn)("-mx-1 my-1 h-px bg-muted",t),...n})}).displayName=s.Z0.displayName},33804:function(e,a,t){"use strict";t.d(a,{RM:function(){return l},SC:function(){return d},iA:function(){return i},pj:function(){return u},ss:function(){return c},xD:function(){return o}});var r=t(57437),n=t(2265),s=t(93448);let i=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)("div",{className:"relative w-full overflow-auto",children:(0,r.jsx)("table",{ref:a,className:(0,s.cn)("w-full caption-bottom text-sm",t),...n})})});i.displayName="Table";let o=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)("thead",{ref:a,className:(0,s.cn)("[&_tr]:border-b",t),...n})});o.displayName="TableHeader";let l=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)("tbody",{ref:a,className:(0,s.cn)("[&_tr:last-child]:border-0",t),...n})});l.displayName="TableBody",n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)("tfoot",{ref:a,className:(0,s.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",t),...n})}).displayName="TableFooter";let d=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)("tr",{ref:a,className:(0,s.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",t),...n})});d.displayName="TableRow";let c=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)("th",{ref:a,className:(0,s.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",t),...n})});c.displayName="TableHead";let u=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)("td",{ref:a,className:(0,s.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",t),...n})});u.displayName="TableCell",n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)("caption",{ref:a,className:(0,s.cn)("mt-4 text-sm text-muted-foreground",t),...n})}).displayName="TableCaption"},71245:function(e,a,t){"use strict";t.d(a,{H:function(){return f},a:function(){return m}});var r=t(57437),n=t(43301),s=t(2265),i=t(99764),o=t(99376),l=t(5978);async function d(e){var a;let t=i.N$,r=null===(a=e.email)||void 0===a?void 0:a.toLowerCase().trim();if(!r)return{role:"none",companyId:null};let n=(0,l.IO)((0,l.hJ)(t,"invitacionesUsuarios"),(0,l.ar)("email","==",r),(0,l.ar)("estado","==","pendiente_auth"),(0,l.b9)(1)),s=await (0,l.PL)(n);if(s.empty)return console.log("No hay invitaci\xf3n pendiente para ".concat(r,".")),{role:"none",companyId:null};let o=s.docs[0],d=o.data(),c=(0,l.JU)(t,"users",e.uid),u=(0,l.qs)(t);return u.set(c,{nombre:d.nombre||e.displayName,email:r,role:d.roleDeseado,empresaId:d.empresaId,activo:!0,createdAt:(0,l.Bt)(),updatedAt:(0,l.Bt)()},{merge:!0}),u.update(o.ref,{estado:"activado",uid:e.uid,activatedAt:(0,l.Bt)()}),await u.commit(),console.log("Usuario ".concat(r," activado con rol ").concat(d.roleDeseado," en empresa ").concat(d.empresaId,".")),{role:d.roleDeseado,companyId:d.empresaId}}async function c(e){}let u=(0,s.createContext)(void 0);function f(e){let{children:a}=e,[t,f]=(0,s.useState)(null),[m,p]=(0,s.useState)("none"),[x,h]=(0,s.useState)(null),[v,g]=(0,s.useState)(null),[j,y]=(0,s.useState)(!0),b=(0,o.useRouter)(),N=(0,o.usePathname)();async function w(e,a){try{await (0,n.e5)(i.lX,e,a)}catch(e){if("auth/invalid-credential"===e.code||"auth/wrong-password"===e.code||"auth/user-not-found"===e.code)throw Error("Credenciales inv\xe1lidas. Por favor, revisa tu correo y contrase\xf1a.");if("auth/too-many-requests"===e.code)throw Error("Demasiados intentos fallidos. Por seguridad, el acceso desde este dispositivo ha sido bloqueado temporalmente.");throw console.error("Error de login no manejado:",e),Error("Ocurri\xf3 un error inesperado al iniciar sesi\xf3n.")}}async function C(){try{await (0,n.w7)(i.lX),f(null),p("none"),h(null),g(null),b.push("/")}catch(e){console.error("Error al cerrar sesi\xf3n",e)}}return(0,s.useEffect)(()=>{let e=(0,n.Aj)(i.lX,async e=>{if(e){await c(e);let a=(0,l.JU)(i.N$,"users",e.uid),t=await (0,l.QT)(a),r="none",n=null,s=!1;if(t.exists()){let e=t.data();e.role&&void 0!==e.empresaId&&(r=e.role,n=e.empresaId,s=!0===e.mustChangePassword)}if("none"===r){let a=await d(e);r=a.role,n=a.companyId,s=!0}p(r),h(n),f(e);let o="/cambiar-password"===N;if(s&&!o)b.replace("/cambiar-password");else if(!s){if("none"===r)b.replace("/sin-acceso");else if(N.startsWith("/login")||"/"===N||o){let e="cliente"===r?"/cliente":"contratista"===r?"/cumplimiento/contratista":"/dashboard";b.replace(e)}}}else f(null),p("none"),h(null),g(null);y(!1)});return()=>e()},[b,N]),(0,s.useEffect)(()=>{if(x){let e=(0,l.JU)(i.N$,"companies",x),a=(0,n.Aj)(i.lX,a=>{a&&(0,l.QT)(e).then(e=>{e.exists()?g({id:e.id,...e.data()}):g(null)})});return()=>a()}g(null)},[x]),(0,r.jsx)(u.Provider,{value:{user:t,role:m,companyId:x,company:v,loading:j,login:w,logout:C},children:a})}function m(){let e=(0,s.useContext)(u);if(!e)throw Error("useAuth debe usarse dentro de un AuthProvider");return e}},23340:function(e,a,t){"use strict";t.d(a,{pm:function(){return f}});var r=t(2265);let n=0,s=new Map,i=e=>{if(s.has(e))return;let a=setTimeout(()=>{s.delete(e),c({type:"REMOVE_TOAST",toastId:e})},1e6);s.set(e,a)},o=(e,a)=>{switch(a.type){case"ADD_TOAST":return{...e,toasts:[a.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===a.toast.id?{...e,...a.toast}:e)};case"DISMISS_TOAST":{let{toastId:t}=a;return t?i(t):e.toasts.forEach(e=>{i(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===t||void 0===t?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===a.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==a.toastId)}}},l=[],d={toasts:[]};function c(e){d=o(d,e),l.forEach(e=>{e(d)})}function u(e){let{...a}=e,t=(n=(n+1)%Number.MAX_SAFE_INTEGER).toString(),r=()=>c({type:"DISMISS_TOAST",toastId:t});return c({type:"ADD_TOAST",toast:{...a,id:t,open:!0,onOpenChange:e=>{e||r()}}}),{id:t,dismiss:r,update:e=>c({type:"UPDATE_TOAST",toast:{...e,id:t}})}}function f(){let[e,a]=r.useState(d);return r.useEffect(()=>(l.push(a),()=>{let e=l.indexOf(a);e>-1&&l.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>c({type:"DISMISS_TOAST",toastId:e})}}},99764:function(e,a,t){"use strict";let r,n,s,i,o;t.d(a,{IG:function(){return i},N$:function(){return s},lX:function(){return n},x2:function(){return o}});var l=t(738),d=t(43301),c=t(5978),u=t(60062),f=t(13491);let m={apiKey:"AIzaSyBfMp_dH9XhFSXEeMxY-Cdy8MDRIgWrxR0",authDomain:"pcg-2-8bf1b.firebaseapp.com",projectId:"pcg-2-8bf1b",storageBucket:"pcg-2-8bf1b.appspot.com",messagingSenderId:"1073834543546",appId:"1:1073834543546:web:2f85a4a8350280f8589737"};for(let e in m)if(Object.prototype.hasOwnProperty.call(m,e)&&!m[e]){let a=e.replace(/([A-Z])/g,"_$1").toUpperCase(),t="NEXT_PUBLIC_FIREBASE_".concat(a);throw Error("Error de configuraci\xf3n del cliente: La variable de entorno Firebase '".concat(t,"' no est\xe1 definida o est\xe1 vac\xeda. ")+"Aseg\xfarate de que est\xe9 configurada en tu archivo .env.local o en las variables de entorno de producci\xf3n.")}r=(0,l.C6)().length?(0,l.Mq)():(0,l.ZF)(m),n=(0,d.v0)(r),s=(0,c.ad)(r),i=(0,u.cF)(r),o=(0,f.$C)(r,"us-central1")},93448:function(e,a,t){"use strict";t.d(a,{cn:function(){return s}});var r=t(61994),n=t(53335);function s(){for(var e=arguments.length,a=Array(e),t=0;t<e;t++)a[t]=arguments[t];return(0,n.m6)((0,r.W)(a))}}},function(e){e.O(0,[4358,9990,6137,1211,2972,9759,3562,6008,9923,2550,1,3334,2971,2117,1744],function(){return e(e.s=54992)}),_N_E=e.O()}]);